(this["webpackJsonpultraman-lienquan"]=this["webpackJsonpultraman-lienquan"]||[]).push([[0],{81:function(e,t,a){},95:function(e,t,a){"use strict";a.r(t);var i=a(12),r=a.n(i),n=a(15),s=a(9),c=a(26),o=a(4),l=a(5),b=a(6),h=function(){function e(t){Object(l.a)(this,e),this.gl=void 0,this.promises=[],this.atlases=new Map,this.textures=new Map,this.done=0,this.listeners=[],this.fonts=new Map,this.gl=t}return Object(b.a)(e,[{key:"addListener",value:function(e){this.listeners.push(e)}}]),Object(b.a)(e,[{key:"reportDone",value:function(){this.done++;var e,t=Object(s.a)(this.listeners);try{for(t.s();!(e=t.n()).done;){(0,e.value)(this.done/this.getTotal()*100,this.done>=this.getTotal())}}catch(a){t.e(a)}finally{t.f()}}},{key:"loadAtlas",value:function(e){var t=this,a=Object(o.n)(this.gl,e,{}).then((function(a){t.atlases.set(e,a),t.reportDone()}));this.promises.push(a)}},{key:"loadFont",value:function(e){var t=this,a=Object(o.o)(this.gl,e,{}).then((function(a){t.fonts.set(e,a),t.reportDone()}));this.promises.push(a)}},{key:"getFont",value:function(e){return this.fonts.get(e)}},{key:"getAtlas",value:function(e){return this.atlases.get(e)}},{key:"loadTexture",value:function(e){var t=this,a=Object(o.p)(this.gl,e,{}).then((function(a){t.textures.set(e,a),t.reportDone()}));this.promises.push(a)}},{key:"getTexture",value:function(e){return this.textures.get(e)}},{key:"finishLoading",value:function(){var e=Object(n.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.promises);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDone",value:function(){return this.done}},{key:"getTotal",value:function(){return this.promises.length}}]),e}(),u=function e(){Object(l.a)(this,e)};u.CAMERA_WIDTH=4,u.CAMERA_HEIGHT=8,u.GAP=1,u.GRAVITY=20,u.PLAYER_WIDTH=.2,u.PLAYER_HEIGHT=.2,u.PLAYER_SCALE=5,u.JUMP_FORCE=-10,u.RUN_FORCE=2,u.STAR_SIZE=.2,u.TRANSITION_DURATION=1.5,u.ALIEN_SPAWNING_TIME=.5,u.ALIEN_WIDTH=1.3,u.ALIEN_SPEED=1.5*u.CAMERA_WIDTH,u.ALIEN_YS=[u.CAMERA_HEIGHT/2-(u.ALIEN_HEIGHT=u.ALIEN_WIDTH/160*113)/2,u.CAMERA_WIDTH/3-u.ALIEN_HEIGHT/2,u.CAMERA_HEIGHT/1.5-u.ALIEN_HEIGHT/2],u.TOTAL_BLOCK_HEIGHT=15,u.BLOCK_BLOCK_SIZE=2.1*u.CAMERA_WIDTH,u.BLOCK_SIZE=u.CAMERA_HEIGHT/u.TOTAL_BLOCK_HEIGHT,u.BLOCK_OFFSET_Y=u.CAMERA_HEIGHT/1.7;a(81);var p,y,j,d,O,v,f,g,m,A,I,w,E,S,_,T,C,H,R,x,M,L,k,P,D,G,W,B,z,F,N,Y,K,Z,U,J,V,q,Q,X,$,ee,te,ae,ie,re,ne,se,ce,oe,le,be,he,ue,pe,ye,je,de,Oe,ve,fe,ge,me,Ae,Ie,we,Ee,Se,_e,Te,Ce,He,Re,xe,Me,Le,ke,Pe,De,Ge,We,Be,ze,Fe,Ne,Ye,Ke,Ze,Ue,Je,Ve,qe,Qe,Xe,$e,et,tt,at,it,rt,nt,st,ct,ot,lt,bt,ht,ut,pt,yt,jt,dt,Ot,vt,ft,gt,mt,At,It,wt,Et,St,_t,Tt,Ct,Ht,Rt,xt,Mt=a(11),Lt=a(0),kt=a(46),Pt=a(45),Dt=Object(kt.a)({app:"L\u1ea9u Phan Minigame",plugins:[Object(Pt.a)({trackingId:"UA-171082295-4"})]}),Gt=function(){function e(){Object(l.a)(this,e),this.action="run",this.state="A",this.stateTime=0,this.states=["A","B","B","C","C","D"],this.stateIndex=0,this.transitionTime=0,this.stunnedDuration=0,this.appliedStun=!1,this.hp=3,this.score=0,this.complete=!1}return Object(b.a)(e,[{key:"getCurrentStateIndex",value:function(){return this.stateIndex}},{key:"changeAction",value:function(e){e!==this.action&&(this.action=e,this.stateTime=0)}},{key:"changeState",value:function(e){this.transitionTime=u.TRANSITION_DURATION,this.state=e}},{key:"nextState",value:function(){var e=this.stateIndex+1;Dt.track("STATE_".concat(e,"_ACHIEVED")),e>=this.states.length?this.complete=!0:(this.stateIndex=e,this.changeState(this.states[e]))}},{key:"process",value:function(e){this.stateTime+=e,this.transitionTime>0&&(this.transitionTime-=e)}}]),e}(),Wt=a(2),Bt=a(1),zt=a(8),Ft=a(7),Nt=a(3),Yt=(a(13),p=Object(Lt.Inject)("aliens"),y=Object(Lt.Inject)("fixedCamera"),j=Object(Lt.Inject)("context"),d=Object(Lt.Inject)("assetManager"),O=function(e){Object(zt.a)(a,e);var t=Object(Ft.a)(a);function a(){var e;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(Wt.a)(e,"aliens",v,Object(Bt.a)(e)),Object(Wt.a)(e,"fixedCamera",f,Object(Bt.a)(e)),Object(Wt.a)(e,"gl",g,Object(Bt.a)(e)),Object(Wt.a)(e,"assetManager",m,Object(Bt.a)(e)),e.batch=void 0,e.animations=[],e.elapsed=0,e}return Object(b.a)(a,[{key:"initialized",value:function(){var e=this;this.batch=Object(o.g)(this.gl);var t=this.assetManager.getAtlas("./main-char.atlas");t&&["alien1","alien2","alien3"].forEach((function(a){return e.animations.push(Object(o.f)(.4,t.findRegions(a)))}))}},{key:"process",value:function(){this.batch.setProjection(this.fixedCamera.combined),this.batch.begin(),this.elapsed+=this.world.delta;var e,t=Object(s.a)(this.aliens);try{for(t.s();!(e=t.n()).done;){var a=e.value;this.animations[a.type].getKeyFrame(u.ALIEN_SPAWNING_TIME-a.time,o.c.NORMAL).draw(this.batch,a.x,a.y,u.ALIEN_WIDTH,u.ALIEN_HEIGHT)}}catch(i){t.e(i)}finally{t.f()}this.batch.end()}}]),a}(Lt.System),v=Object(Nt.a)(O.prototype,"aliens",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=Object(Nt.a)(O.prototype,"fixedCamera",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=Object(Nt.a)(O.prototype,"gl",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m=Object(Nt.a)(O.prototype,"assetManager",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O),Kt=(A=Object(Lt.Inject)("aliens"),I=Object(Lt.Inject)("playerPosition"),w=Object(Lt.Inject)("playerState"),E=Object(Lt.Inject)("eventEmitter"),S=function(e){Object(zt.a)(a,e);var t=Object(Ft.a)(a);function a(){var e;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(Wt.a)(e,"aliens",_,Object(Bt.a)(e)),Object(Wt.a)(e,"playerPos",T,Object(Bt.a)(e)),Object(Wt.a)(e,"playerState",C,Object(Bt.a)(e)),Object(Wt.a)(e,"eventEmitter",H,Object(Bt.a)(e)),e}return Object(b.a)(a,[{key:"process",value:function(){for(var e=this.aliens.length-1;e>=0;e--){var t=this.aliens[e];if(t.time>0)return void(t.time-=this.world.delta);if(!t.hit){var a=this.playerPos.y;t.x<=u.GAP&&t.x+u.ALIEN_WIDTH>=u.GAP&&t.y<=a&&t.y+u.ALIEN_HEIGHT>=a&&(this.playerState.stunnedDuration=.3,this.playerState.changeAction("hurt"),this.playerState.hp--,t.hit=!0)}t.x-=u.ALIEN_SPEED*this.world.delta,t.x<=-u.ALIEN_WIDTH&&this.aliens.splice(e,1)}}}]),a}(Lt.System),_=Object(Nt.a)(S.prototype,"aliens",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=Object(Nt.a)(S.prototype,"playerPos",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=Object(Nt.a)(S.prototype,"playerState",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H=Object(Nt.a)(S.prototype,"eventEmitter",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S),Zt=(R=Object(Lt.Inject)("context"),x=Object(Lt.Inject)("assetManager"),M=Object(Lt.Inject)("fixedCamera"),L=Object(Lt.Inject)("playerPosition"),k=function(e){Object(zt.a)(a,e);var t=Object(Ft.a)(a);function a(){var e;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(Wt.a)(e,"gl",P,Object(Bt.a)(e)),Object(Wt.a)(e,"assetManager",D,Object(Bt.a)(e)),Object(Wt.a)(e,"fixedCamera",G,Object(Bt.a)(e)),Object(Wt.a)(e,"playerPos",W,Object(Bt.a)(e)),e.batch=void 0,e.textures=new Map,e}return Object(b.a)(a,[{key:"initialized",value:function(){var e=this;this.batch=Object(o.g)(this.gl),["bg","city_01","city_02","cloud_01","cloud_02","smoke_01","smoke_02"].map((function(t){return e.textures.set(t,e.assetManager.getTexture("./background/".concat(t,".png")))}))}},{key:"drawBackground",value:function(){for(var e=this.textures.get("bg"),t=u.CAMERA_HEIGHT,a=t/e.height*e.width,i=0;i*a<u.CAMERA_WIDTH;)this.batch.draw(e,i*a,0,a,t),i++}},{key:"process",value:function(){var e=-this.playerPos.x;this.batch.setProjection(this.fixedCamera.combined),this.batch.begin(),this.drawBackground(),this.drawCloud1(.5*e),this.drawCloud2(.8*e),this.drawCity1(e),this.drawCity2(1.1*e),this.batch.end()}},{key:"drawCity1",value:function(e){for(var t=this.textures.get("city_01"),a=u.CAMERA_HEIGHT/1.5,i=a/t.height*t.width;e<=0;)e+=i;for(this.batch.draw(t,e-i,u.CAMERA_HEIGHT-a,i,a);e<=u.CAMERA_WIDTH;)this.batch.draw(t,e,u.CAMERA_HEIGHT-a,i,a),e+=i}},{key:"drawCity2",value:function(e){for(var t=this.textures.get("city_02"),a=u.CAMERA_HEIGHT/1.5,i=a/t.height*t.width;e<=0;)e+=i;for(this.batch.draw(t,e-i,u.CAMERA_HEIGHT-a,i,a);e<=u.CAMERA_WIDTH;)this.batch.draw(t,e,u.CAMERA_HEIGHT-a,i,a),e+=i}},{key:"drawCloud1",value:function(e){for(var t=this.textures.get("cloud_01"),a=u.CAMERA_HEIGHT/1.2,i=a/t.height*t.width,r=i;e<=0;)e+=i+r;for(this.batch.draw(t,e-i,u.CAMERA_HEIGHT-a,i,a);e+r<=u.CAMERA_WIDTH;)this.batch.draw(t,e+r,u.CAMERA_HEIGHT-a,i,a),e+=i+r}},{key:"drawCloud2",value:function(e){for(var t=this.textures.get("cloud_02"),a=u.CAMERA_HEIGHT/6,i=a/t.height*t.width,r=i;e<=0;)e+=i+r;for(this.batch.draw(t,e-i,u.CAMERA_HEIGHT/4,i,a);e+r<=u.CAMERA_WIDTH;)this.batch.draw(t,e+r,u.CAMERA_HEIGHT/4,i,a),e+=i+r}}]),a}(Lt.System),P=Object(Nt.a)(k.prototype,"gl",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=Object(Nt.a)(k.prototype,"assetManager",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G=Object(Nt.a)(k.prototype,"fixedCamera",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W=Object(Nt.a)(k.prototype,"playerPos",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k),Ut=a(10),Jt=function(e){for(var t=[],a=e.map((function(e){var t=Object(Ut.a)(e,2),a=t[0];return 20*t[1]+a})),i=0;i<a.length;i++){var r=a[i],n=void 0;n=a.includes(r+20)?a.includes(r-20)?2:1:0,t[i]=n}return t},Vt=(B=Object(Lt.Inject)("viewport"),z=Object(Lt.Inject)("physicsWorld"),F=Object(Lt.Inject)("blocks"),N=Object(Lt.Inject)("stars"),Y=Object(Lt.Inject)("aliens"),K=Object(Lt.Inject)("playerPosition"),ee=$=function(e){Object(zt.a)(a,e);var t=Object(Ft.a)(a);function a(){var e;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))).generatedStep=0,Object(Wt.a)(e,"viewport",U,Object(Bt.a)(e)),Object(Wt.a)(e,"physicsWorld",J,Object(Bt.a)(e)),Object(Wt.a)(e,"blocks",V,Object(Bt.a)(e)),Object(Wt.a)(e,"stars",q,Object(Bt.a)(e)),Object(Wt.a)(e,"aliens",Q,Object(Bt.a)(e)),Object(Wt.a)(e,"playerPos",X,Object(Bt.a)(e)),e.typePatterns=void 0,e}return Object(b.a)(a,[{key:"createBox",value:function(e,t,a,i,r){var n=new Mt.b2BodyDef;n.type=Mt.b2BodyType.b2_staticBody,n.position.Set(e,t);var s=this.physicsWorld.CreateBody(n);s.SetUserData({type:"block"});var c=new Mt.b2PolygonShape;c.SetAsBox(a/2,i/2),s.CreateFixture(c),this.blocks.push({x:e,y:t,w:a,h:i,type:r,body:s})}},{key:"initialized",value:function(){for(this.typePatterns=a.patterns.map(Jt);this.generatedStep<2;)this.generateBlocks(this.generatedStep*u.BLOCK_BLOCK_SIZE,!0),this.generatedStep++}},{key:"process",value:function(){for(var e=this.viewport.getCamera().getPosition(),t=Math.floor(e.x/u.BLOCK_BLOCK_SIZE);this.generatedStep<=t+1;)this.generateBlocks(this.generatedStep*u.BLOCK_BLOCK_SIZE),this.generatedStep++}},{key:"createStar",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=new Mt.b2BodyDef;i.type=Mt.b2BodyType.b2_staticBody,i.position.Set(e,t);var r=this.physicsWorld.CreateBody(i);r.SetUserData({type:"star"});var n=new Mt.b2FixtureDef;n.isSensor=!0;var s=new Mt.b2PolygonShape;s.SetAsBox(u.STAR_SIZE,u.STAR_SIZE),n.shape=s,r.CreateFixture(n);var c={x:e,y:t,body:r,active:!0,special:a};r.m_userData.starObject=c,this.stars.push(c)}},{key:"generateBlocks",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t?0:Math.floor(Math.random()*(a.patterns.length-1))+1,r=a.starPatterns[i]||[],n=a.patterns[i],c=this.typePatterns[i],o=0;o<n.length;o++){var l=n[o],b=Object(Ut.a)(l,2),h=b[0],p=b[1],y=void 0;y=0===c[o]?Math.floor(3*Math.random()):1===c[o]?Math.floor(3*Math.random())+6:Math.floor(3*Math.random())+3,this.createBox(e+u.BLOCK_SIZE*h,(u.TOTAL_BLOCK_HEIGHT-p)*u.BLOCK_SIZE,u.BLOCK_SIZE,u.BLOCK_SIZE,y)}var j,d=!1,O=Object(s.a)(r);try{for(O.s();!(j=O.n()).done;){var v=j.value,f=Object(Ut.a)(v,2),g=f[0],m=f[1],A=!d&&Math.random()<=.1;A&&(d=!0),this.createStar(e+u.BLOCK_SIZE*g,(u.TOTAL_BLOCK_HEIGHT-m)*u.BLOCK_SIZE,A)}}catch(w){O.e(w)}finally{O.f()}if(!t&&Math.random()<1){var I=Math.floor(3*Math.random());this.aliens.push({x:u.CAMERA_WIDTH-u.ALIEN_WIDTH,y:this.playerPos.y-u.ALIEN_HEIGHT/2,type:I,time:u.ALIEN_SPAWNING_TIME,hit:!1})}}}]),a}(Lt.System),$.patterns=["1-10,2","1-4,2;6-9,2;4,3-5;5,4;5,8-10;6,7-10;7,7-8","1-9,2;3,3-5;6-8,3;6-7,4","1-9,2;4,5-8;2,11;6,11;2-6,12;2-6,13","1-5,2;8-12,2;3-5,3;8-10,3;4-5,4;8-9,4;5-8,5;2-8,11;3-7,12;4-6,13","1-5,2;8-12,2;4-5,3;8-9,3;4-5,4;8-9,4","1-14,2;4-10,5;4-10,6;4,7;10,7;7,9-12","1-14,2;4-5,3;9-11,3;4,4;10,4;5-6,10;4-11,11;4-11,12"].map((function(e){var t,a=[],i=e.split(";"),r=Object(s.a)(i);try{for(r.s();!(t=r.n()).done;){var n=t.value.split(","),c=Object(Ut.a)(n,2),o=c[0],l=c[1],b=o.split("-").map((function(e){return parseInt(e)})),h=l.split("-").map((function(e){return parseInt(e)}));if(2===b.length){for(var u=[],p=b[0];p<=b[1];p++)u.push(p);b=u}if(2===h.length){for(var y=[],j=h[0];j<=h[1];j++)y.push(j);h=y}var d,O=Object(s.a)(b);try{for(O.s();!(d=O.n()).done;){var v,f=d.value,g=Object(s.a)(h);try{for(g.s();!(v=g.n()).done;){var m=v.value;a.push([f,m])}}catch(A){g.e(A)}finally{g.f()}}}catch(A){O.e(A)}finally{O.f()}}}catch(A){r.e(A)}finally{r.f()}return a})),$.starPatterns=[void 0,"2.5,6.5;3,7.2;3.5,7.9;3.8,9.2;3.9,10.2;4,11.2;4.2,12.2;5.2,12.6;6.1,12.2;6.2,11.3","2.2,6.8;2.8,7.5;3.2,8.1;5.5,6.8;5.9,7.5;6.3,8.3;6.7,9.1","2.5,7.8;2.9,8.5;3.2,9.2;4,9.6;4.8,9.6;5.5,9","2.9,6.5;3.2,7.2;4,7.9;4.8,7.4;5.2,6.5;6.2,6.5;7.2,6.5;8.2,6.5","3.2,6.5;3.5,7;4,7.5;4.8,7.3;5.3,6.5;6.5,8;7,9;8,9;8.5,8;8.8,7.5;9,6.5;9.1,6","4.5,9;5.5,7.5;6.5,7.5;7.5,7.5;8.5,7.5;9.5,8;10.5,9","4.5,5.5;5.5,5.5;5.5,4.5;6.5,4.5;6.5,3.5;8.5,7.5;9,8.5;10,8.5;10.3,7.5;10.5,5.5;11.5,5.5;11.5,4.5;12.5,4.5;12.5,3.5"].map((function(e){return e&&e.split(";").map((function(e){return e.split(",").map((function(e){return parseFloat(e)}))})).map((function(e){var t=Object(Ut.a)(e,2);return[t[0]-.5,t[1]]}))})),Z=ee,U=Object(Nt.a)(Z.prototype,"viewport",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J=Object(Nt.a)(Z.prototype,"physicsWorld",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V=Object(Nt.a)(Z.prototype,"blocks",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q=Object(Nt.a)(Z.prototype,"stars",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q=Object(Nt.a)(Z.prototype,"aliens",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X=Object(Nt.a)(Z.prototype,"playerPos",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z),qt=(te=Object(Lt.Inject)("viewport"),ae=Object(Lt.Inject)("physicsWorld"),ie=Object(Lt.Inject)("blocks"),re=Object(Lt.Inject)("stars"),ne=function(e){Object(zt.a)(a,e);var t=Object(Ft.a)(a);function a(){var e;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(Wt.a)(e,"viewport",se,Object(Bt.a)(e)),Object(Wt.a)(e,"physicsWorld",ce,Object(Bt.a)(e)),Object(Wt.a)(e,"blocks",oe,Object(Bt.a)(e)),Object(Wt.a)(e,"stars",le,Object(Bt.a)(e)),e}return Object(b.a)(a,[{key:"process",value:function(){for(var e=this.viewport.getCamera().getPosition(),t=this.blocks.length-1;t>=0;t--){var a=this.blocks[t];e.x-a.x>=3*u.CAMERA_WIDTH&&(this.physicsWorld.DestroyBody(a.body),this.blocks.splice(t,1))}for(var i=this.stars.length-1;i>=0;i--){var r=this.stars[i];e.x-r.x>=3*u.CAMERA_WIDTH&&(this.physicsWorld.DestroyBody(r.body),this.stars.splice(i,1))}}}]),a}(Lt.System),se=Object(Nt.a)(ne.prototype,"viewport",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ce=Object(Nt.a)(ne.prototype,"physicsWorld",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oe=Object(Nt.a)(ne.prototype,"blocks",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),le=Object(Nt.a)(ne.prototype,"stars",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ne),Qt=(be=Object(Lt.Inject)("viewport"),he=Object(Lt.Inject)("context"),ue=Object(Lt.Inject)("blocks"),pe=Object(Lt.Inject)("assetManager"),ye=function(e){Object(zt.a)(a,e);var t=Object(Ft.a)(a);function a(){var e;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(Wt.a)(e,"viewport",je,Object(Bt.a)(e)),Object(Wt.a)(e,"gl",de,Object(Bt.a)(e)),Object(Wt.a)(e,"blocks",Oe,Object(Bt.a)(e)),Object(Wt.a)(e,"assetManager",ve,Object(Bt.a)(e)),e.batch=void 0,e.whiteTex=void 0,e.atlas=void 0,e.regions=void 0,e}return Object(b.a)(a,[{key:"initialized",value:function(){this.batch=Object(o.g)(this.gl),this.whiteTex=Object(o.m)(this.gl);var e=this.assetManager.getAtlas("./ground.atlas");e&&(this.atlas=e,this.regions=e.findRegions("tile"))}},{key:"process",value:function(){this.batch.setProjection(this.viewport.getCamera().combined),this.batch.begin(),this.batch.setColor(0,0,0,.5);var e,t=Object(s.a)(this.blocks);try{for(t.s();!(e=t.n()).done;){var a=e.value,i=a.x,r=a.y,n=a.w,c=a.h,o=a.type;this.regions[o].draw(this.batch,i-n/2-.05*n,r-c/2+.05*c,n,c)}}catch(O){t.e(O)}finally{t.f()}this.batch.setColor(1,1,1,1);var l,b=Object(s.a)(this.blocks);try{for(b.s();!(l=b.n()).done;){var h=l.value,u=h.x,p=h.y,y=h.w,j=h.h,d=h.type;this.regions[d].draw(this.batch,u-y/2,p-j/2,y,j)}}catch(O){b.e(O)}finally{b.f()}this.batch.end()}}]),a}(Lt.System),je=Object(Nt.a)(ye.prototype,"viewport",[be],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),de=Object(Nt.a)(ye.prototype,"gl",[he],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oe=Object(Nt.a)(ye.prototype,"blocks",[ue],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve=Object(Nt.a)(ye.prototype,"assetManager",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ye),Xt=(fe=Object(Lt.Inject)("viewport"),ge=Object(Lt.Inject)("playerPosition"),me=function(e){Object(zt.a)(a,e);var t=Object(Ft.a)(a);function a(){var e;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(Wt.a)(e,"viewport",Ae,Object(Bt.a)(e)),Object(Wt.a)(e,"playerPos",Ie,Object(Bt.a)(e)),e}return Object(b.a)(a,[{key:"process",value:function(){var e=this.viewport.getCamera().getPosition(),t=e.x+1*(this.playerPos.x-u.GAP-e.x);this.viewport.getCamera().setPosition(t,e.y)}}]),a}(Lt.System),Ae=Object(Nt.a)(me.prototype,"viewport",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ie=Object(Nt.a)(me.prototype,"playerPos",[ge],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),me),$t=(we=Object(Lt.Inject)("physicsWorld"),Ee=function(e){Object(zt.a)(a,e);var t=Object(Ft.a)(a);function a(){var e;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(Wt.a)(e,"physicsWorld",Se,Object(Bt.a)(e)),e}return Object(b.a)(a,[{key:"process",value:function(){this.physicsWorld.Step(this.world.delta,8,3)}}]),a}(Lt.System),Se=Object(Nt.a)(Ee.prototype,"physicsWorld",[we],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ee),ea=function(e,t){for(var a="".concat(e);a.length<t;)a="0".concat(a);return a},ta=(_e=Object(Lt.Inject)("fixedCamera"),Te=Object(Lt.Inject)("context"),Ce=Object(Lt.Inject)("assetManager"),He=Object(Lt.Inject)("playerState"),Re=function(e){Object(zt.a)(a,e);var t=Object(Ft.a)(a);function a(){var e;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(Wt.a)(e,"fixedCamera",xe,Object(Bt.a)(e)),Object(Wt.a)(e,"gl",Me,Object(Bt.a)(e)),Object(Wt.a)(e,"assetManager",Le,Object(Bt.a)(e)),Object(Wt.a)(e,"playerState",ke,Object(Bt.a)(e)),e.batch=void 0,e.panel=void 0,e.heartFull=void 0,e.heartEmpty=void 0,e.bar=void 0,e.scoreLabel=void 0,e.text=void 0,e.whiteText=void 0,e}return Object(b.a)(a,[{key:"initialized",value:function(){this.batch=Object(o.g)(this.gl);var e=this.assetManager.getAtlas("./ui.atlas");this.panel=e.findRegions("panel")[0],this.heartFull=e.findRegions("heart-full")[0],this.heartEmpty=e.findRegions("heart-empty")[0],this.bar=e.findRegions("bar")[0],this.scoreLabel=e.findRegions("score-label")[0];var t=this.assetManager.getFont("./score.fnt");this.text=t.createRenderer(.35*u.CAMERA_WIDTH),this.text.setAlignMode(o.a.right),this.whiteText=Object(o.m)(this.gl)}},{key:"process",value:function(){this.batch.setProjection(this.fixedCamera.combined),this.batch.begin();var e=this.panel,t=e.width,a=e.height,i=.95*u.CAMERA_WIDTH,r=i/t*a,n=.025*u.CAMERA_WIDTH,s=.05*u.CAMERA_WIDTH;this.panel.draw(this.batch,n,s,i,r);for(var c=this.heartFull,o=i/26,l=o/c.width*c.height,b=2*o,h=s+r-1.75*l,p=.2*o,y=0;y<3;y++)y<this.playerState.hp?this.heartFull.draw(this.batch,b+(o+p)*y,h,o,l):this.heartEmpty.draw(this.batch,b+(o+p)*y,h,o,l);var j=this.bar,d=b,O=i-2*(d-n),v=O/j.width*j.height,f=s+r/1.7-v;this.bar.draw(this.batch,d,f,O,v);var g=this.scoreLabel,m=g.width,A=.8*l,I=A/g.height*m,w=h+l-A,E=b+10*o;this.scoreLabel.draw(this.batch,E,w,I,A);var S=1.35*l,_=w+A-S;this.text.setDisplayWidth(i-3*o),this.text.draw(this.batch,ea(this.playerState.score,10),n,_,S);var T=d,C=O/250,H=O/6-C,R=f+v;this.batch.setColor(0,0,0,.8);for(var x=0;x<6;x++)if(x>=this.playerState.stateIndex){var M=v*(1-.12*(5-x));this.batch.draw(this.whiteText,T+x*(C*(1+.08*x)+H),R-M,H,M)}this.batch.setColor(1,1,1,1),this.batch.end()}}]),a}(Lt.System),xe=Object(Nt.a)(Re.prototype,"fixedCamera",[_e],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Me=Object(Nt.a)(Re.prototype,"gl",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Le=Object(Nt.a)(Re.prototype,"assetManager",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ke=Object(Nt.a)(Re.prototype,"playerState",[He],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Re),aa=(Pe=Object(Lt.Inject)("physicsWorld"),De=Object(Lt.Inject)("playerPosition"),Ge=Object(Lt.Inject)("inputHandler"),We=Object(Lt.Inject)("playerState"),Be=Object(Lt.Inject)("eventEmitter"),ze=function(e){Object(zt.a)(a,e);var t=Object(Ft.a)(a);function a(){var e;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(Wt.a)(e,"physicsWorld",Fe,Object(Bt.a)(e)),Object(Wt.a)(e,"playerPos",Ne,Object(Bt.a)(e)),Object(Wt.a)(e,"inputHandler",Ye,Object(Bt.a)(e)),Object(Wt.a)(e,"playerState",Ke,Object(Bt.a)(e)),Object(Wt.a)(e,"eventEmitter",Ze,Object(Bt.a)(e)),e.playerBody=void 0,e.pressed=!1,e.jumpLeft=0,e.gameOver=!1,e.zeroCenter={x:0,y:0},e.runImpulse={x:u.RUN_FORCE,y:0},e.jumpImpulse={x:0,y:u.JUMP_FORCE},e}return Object(b.a)(a,[{key:"initialized",value:function(){var e=new Mt.b2BodyDef;e.type=Mt.b2BodyType.b2_dynamicBody,e.fixedRotation=!0,e.position.Set(2,u.CAMERA_HEIGHT/2);var t=this.physicsWorld.CreateBody(e);t.SetUserData({type:"user"});var a=new Mt.b2CircleShape(u.PLAYER_WIDTH);a.Set({x:-u.PLAYER_WIDTH/2,y:-u.PLAYER_HEIGHT/2},u.PLAYER_WIDTH),t.CreateFixture(a);var i=new Mt.b2PolygonShape;i.SetAsBox(u.PLAYER_WIDTH/8,u.PLAYER_WIDTH/8,{x:0,y:u.PLAYER_HEIGHT/2});var r=new Mt.b2FixtureDef;r.isSensor=!0,r.shape=i,r.userData={type:"playerSensor"},t.CreateFixture(r);var n=new Mt.b2PolygonShape;n.SetAsBox(u.PLAYER_WIDTH/8,u.PLAYER_WIDTH/8,{x:u.PLAYER_WIDTH/2,y:0});var s=new Mt.b2FixtureDef;s.isSensor=!0,s.shape=n,s.userData={type:"playerSensor2"},t.CreateFixture(s),this.playerBody=t;var c=function(e){Object(zt.a)(a,e);var t=Object(Ft.a)(a);function a(e){var i;return Object(l.a)(this,a),(i=t.call(this)).movementSytem=void 0,i.movementSytem=e,i}return Object(b.a)(a,[{key:"processJumpable",value:function(e){var t,a,i,r,n=e.GetFixtureA(),s=e.GetFixtureB();n.IsSensor()&&"playerSensor"===(null===(t=n.GetUserData())||void 0===t?void 0:t.type)?r=s:s.IsSensor()&&"playerSensor"===(null===(a=s.GetUserData())||void 0===a?void 0:a.type)&&(r=n),r&&"block"===(null===(i=r.GetBody().GetUserData())||void 0===i?void 0:i.type)&&(this.movementSytem.jumpLeft=2,this.movementSytem.playerState.changeAction("run"))}},{key:"processObstacle",value:function(e){var t,a,i,r,n=e.GetFixtureA(),s=e.GetFixtureB();n.IsSensor()&&"playerSensor2"===(null===(t=n.GetUserData())||void 0===t?void 0:t.type)?r=s:s.IsSensor()&&"playerSensor2"===(null===(a=s.GetUserData())||void 0===a?void 0:a.type)&&(r=n),r&&"block"===(null===(i=r.GetBody().GetUserData())||void 0===i?void 0:i.type)&&(this.movementSytem.playerState.stunnedDuration=.2,this.movementSytem.playerState.changeAction("hurt"))}},{key:"BeginContact",value:function(e){this.movementSytem.gameOver||(this.processJumpable(e),this.processObstacle(e),this.movementSytem.eventEmitter.emit("beginContact",e))}}]),a}(Mt.b2ContactListener);this.physicsWorld.SetContactListener(new c(this))}},{key:"process",value:function(){if(this.playerState.stunnedDuration>0)this.playerState.appliedStun||(this.playerState.appliedStun=!0,this.playerBody.GetLinearVelocity().Set(0,0),this.playerBody.ApplyLinearImpulse({x:-2*u.RUN_FORCE,y:0},{x:0,y:0})),this.playerState.stunnedDuration-=this.world.delta,this.playerState.stunnedDuration<=0&&(this.playerState.changeAction("run"),this.playerState.appliedStun=!1);else{var e=this.playerBody.GetLinearVelocity();if(e.Set(0,e.y),this.playerBody.ApplyLinearImpulse(this.runImpulse,this.zeroCenter),this.pressed)this.inputHandler.isTouched()||(this.pressed=!1);else if(this.inputHandler.isTouched()&&this.jumpLeft>0){this.jumpLeft--,1===this.jumpLeft?this.playerState.changeAction("jump"):this.playerState.changeAction("doubleJump"),this.pressed=!0;var t=this.playerBody.GetLinearVelocity();t.Set(t.x,0),this.playerBody.ApplyLinearImpulse(this.jumpImpulse,this.zeroCenter)}}var a=this.playerBody.GetPosition();this.playerPos.set(a.x,a.y),!this.gameOver&&(a.y>1.2*u.CAMERA_HEIGHT||this.playerState.hp<=0||this.playerState.complete)&&(this.gameOver=!0,this.eventEmitter.emit("gameOver",ea(this.playerState.score,10)))}}]),a}(Lt.System),Fe=Object(Nt.a)(ze.prototype,"physicsWorld",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ne=Object(Nt.a)(ze.prototype,"playerPos",[De],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye=Object(Nt.a)(ze.prototype,"inputHandler",[Ge],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ke=Object(Nt.a)(ze.prototype,"playerState",[We],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ze=Object(Nt.a)(ze.prototype,"eventEmitter",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ze),ia=(Ue=Object(Lt.Inject)("viewport"),Je=Object(Lt.Inject)("context"),Ve=Object(Lt.Inject)("playerPosition"),qe=Object(Lt.Inject)("assetManager"),Qe=Object(Lt.Inject)("playerState"),Xe=function(e){Object(zt.a)(a,e);var t=Object(Ft.a)(a);function a(){var e;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(Wt.a)(e,"viewport",$e,Object(Bt.a)(e)),Object(Wt.a)(e,"gl",et,Object(Bt.a)(e)),Object(Wt.a)(e,"playerPos",tt,Object(Bt.a)(e)),Object(Wt.a)(e,"assetManager",at,Object(Bt.a)(e)),Object(Wt.a)(e,"playerState",it,Object(Bt.a)(e)),e.batch=void 0,e.whiteTex=void 0,e.atlas=void 0,e.animations={},e.animationFrameDuration={run:.1,jump:.1,doubleJump:.1,hurt:.05},e}return Object(b.a)(a,[{key:"initialized",value:function(){this.batch=Object(o.g)(this.gl),this.whiteTex=Object(o.m)(this.gl);var e=this.assetManager.getAtlas("./main-char.atlas");e&&(this.atlas=e,this.animations.upgrade=Object(o.f)(.08,e.findRegions("upgrade_blast")))}},{key:"getAnimation",value:function(e,t){var a="".concat(e).concat(t);if(!this.animations[a]){var i=this.animationFrameDuration[e]||.1,r=this.atlas.findRegions(a);"jump"!==e&&"doubleJump"!==e||(r=r.slice(0,r.length-2)),this.animations[a]=Object(o.f)(i,r)}return this.animations[a]}},{key:"process",value:function(){this.batch.setProjection(this.viewport.getCamera().combined),this.batch.begin();var e=this.playerPos,t=e.x,a=e.y;this.playerState.process(this.world.delta);var i=o.c.LOOP;("jump"!==this.playerState.action&&"doubleJump"!==this.playerState.action||(i=o.c.NORMAL),this.getAnimation(this.playerState.action,this.playerState.state).getKeyFrame(this.playerState.stateTime,i).draw(this.batch,t-u.PLAYER_WIDTH/2,a-u.PLAYER_HEIGHT/2,u.PLAYER_WIDTH,u.PLAYER_HEIGHT,u.PLAYER_WIDTH/2,u.PLAYER_HEIGHT,0,u.PLAYER_SCALE,u.PLAYER_SCALE),this.playerState.transitionTime>0)&&this.animations.upgrade.getKeyFrame(this.playerState.stateTime,o.c.LOOP).draw(this.batch,t-u.PLAYER_WIDTH/2,a,u.PLAYER_WIDTH,u.PLAYER_HEIGHT,u.PLAYER_WIDTH/2,u.PLAYER_HEIGHT,0,1.2*u.PLAYER_SCALE,1.2*u.PLAYER_SCALE);this.batch.end()}}]),a}(Lt.System),$e=Object(Nt.a)(Xe.prototype,"viewport",[Ue],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),et=Object(Nt.a)(Xe.prototype,"gl",[Je],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tt=Object(Nt.a)(Xe.prototype,"playerPos",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),at=Object(Nt.a)(Xe.prototype,"assetManager",[qe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),it=Object(Nt.a)(Xe.prototype,"playerState",[Qe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xe),ra=(rt=Object(Lt.Inject)("context"),nt=Object(Lt.Inject)("assetManager"),st=Object(Lt.Inject)("fixedCamera"),ct=Object(Lt.Inject)("playerPosition"),ot=function(e){Object(zt.a)(a,e);var t=Object(Ft.a)(a);function a(){var e;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(Wt.a)(e,"gl",lt,Object(Bt.a)(e)),Object(Wt.a)(e,"assetManager",bt,Object(Bt.a)(e)),Object(Wt.a)(e,"fixedCamera",ht,Object(Bt.a)(e)),Object(Wt.a)(e,"playerPos",ut,Object(Bt.a)(e)),e.batch=void 0,e.textures=new Map,e}return Object(b.a)(a,[{key:"initialized",value:function(){var e=this;this.batch=Object(o.g)(this.gl),["bg","city_01","city_02","cloud_01","cloud_02","smoke_01","smoke_02"].map((function(t){return e.textures.set(t,e.assetManager.getTexture("./background/".concat(t,".png")))}))}},{key:"process",value:function(){var e=-this.playerPos.x;this.batch.setProjection(this.fixedCamera.combined),this.batch.begin(),this.drawCloud1(.6*e),this.drawCloud2(.1*e),this.batch.end()}},{key:"drawCloud1",value:function(e){for(var t=this.textures.get("smoke_01"),a=u.CAMERA_HEIGHT/5,i=a/t.height*t.width,r=-i/1.5;e<=0;)e+=i+r;for(this.batch.draw(t,e-i,u.CAMERA_HEIGHT-a/2,i,a);e+r<=u.CAMERA_WIDTH;)this.batch.draw(t,e+r,u.CAMERA_HEIGHT-a/2,i,a),e+=i+r}},{key:"drawCloud2",value:function(e){for(var t=this.textures.get("smoke_02"),a=u.CAMERA_HEIGHT/5,i=a/t.height*t.width,r=-i/1.5;e<=0;)e+=i+r;for(this.batch.draw(t,e-i,u.CAMERA_HEIGHT-a/2,i,a);e+r<=u.CAMERA_WIDTH;)this.batch.draw(t,e+r,u.CAMERA_HEIGHT-a/2,i,a),e+=i+r}}]),a}(Lt.System),lt=Object(Nt.a)(ot.prototype,"gl",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bt=Object(Nt.a)(ot.prototype,"assetManager",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ht=Object(Nt.a)(ot.prototype,"fixedCamera",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ut=Object(Nt.a)(ot.prototype,"playerPos",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ot),na=(pt=Object(Lt.Inject)("physicsWorld"),yt=Object(Lt.Inject)("stars"),jt=Object(Lt.Inject)("eventEmitter"),dt=Object(Lt.Inject)("playerState"),Ot=function(e){Object(zt.a)(a,e);var t=Object(Ft.a)(a);function a(){var e;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(Wt.a)(e,"physicsWorld",vt,Object(Bt.a)(e)),Object(Wt.a)(e,"stars",ft,Object(Bt.a)(e)),Object(Wt.a)(e,"eventEmitter",gt,Object(Bt.a)(e)),Object(Wt.a)(e,"playerState",mt,Object(Bt.a)(e)),e.subscription=void 0,e}return Object(b.a)(a,[{key:"initialized",value:function(){var e=this;this.subscription=this.eventEmitter.addListener("beginContact",(function(t){var a,i,r,n,s,c=t.GetFixtureA(),o=t.GetFixtureB();"star"===(null===(a=c.GetBody().GetUserData())||void 0===a?void 0:a.type)?(n=o,s=c):"star"===(null===(i=c.GetBody().GetUserData())||void 0===i?void 0:i.type)&&(n=c,s=o),s&&n&&"user"===(null===(r=n.GetBody().GetUserData())||void 0===r?void 0:r.type)&&e.removeStar(s.GetBody().GetUserData().starObject)}))}},{key:"process",value:function(){}},{key:"removeStar",value:function(e){e.active&&(e.special?this.playerState.nextState():this.playerState.score+=100*(this.playerState.stateIndex+1),e.active=!1)}},{key:"dispose",value:function(){this.subscription.remove()}}]),a}(Lt.System),vt=Object(Nt.a)(Ot.prototype,"physicsWorld",[pt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ft=Object(Nt.a)(Ot.prototype,"stars",[yt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gt=Object(Nt.a)(Ot.prototype,"eventEmitter",[jt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mt=Object(Nt.a)(Ot.prototype,"playerState",[dt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ot),sa=(At=Object(Lt.Inject)("viewport"),It=Object(Lt.Inject)("context"),wt=Object(Lt.Inject)("stars"),Et=Object(Lt.Inject)("assetManager"),St=Object(Lt.Inject)("playerState"),_t=function(e){Object(zt.a)(a,e);var t=Object(Ft.a)(a);function a(){var e;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(Wt.a)(e,"viewport",Tt,Object(Bt.a)(e)),Object(Wt.a)(e,"gl",Ct,Object(Bt.a)(e)),Object(Wt.a)(e,"stars",Ht,Object(Bt.a)(e)),Object(Wt.a)(e,"assetManager",Rt,Object(Bt.a)(e)),Object(Wt.a)(e,"playerState",xt,Object(Bt.a)(e)),e.batch=void 0,e.whiteTex=void 0,e.starAnimation=void 0,e.specialAnimations=void 0,e.elapsed=0,e}return Object(b.a)(a,[{key:"initialized",value:function(){this.batch=Object(o.g)(this.gl),this.whiteTex=Object(o.m)(this.gl);var e=this.assetManager.getAtlas("./object.atlas");e&&(this.starAnimation=Object(o.f)(.2,e.findRegions("star")),this.specialAnimations=["hand","hand","feet","feet","chest","head"].map((function(t){return Object(o.f)(.2,e.findRegions(t))})))}},{key:"process",value:function(){this.batch.setProjection(this.viewport.getCamera().combined),this.batch.begin(),this.elapsed+=this.world.delta;var e,t=Object(s.a)(this.stars);try{for(t.s();!(e=t.n()).done;){var a=e.value,i=a.x,r=a.y,n=a.active,c=a.special;n&&(c?this.specialAnimations[this.playerState.getCurrentStateIndex()].getKeyFrame(this.elapsed,o.c.LOOP).draw(this.batch,i-u.STAR_SIZE/2,r-u.STAR_SIZE/2,u.STAR_SIZE,u.STAR_SIZE,u.STAR_SIZE/2,u.STAR_SIZE/2,0,2,2):this.starAnimation.getKeyFrame(this.elapsed,o.c.LOOP).draw(this.batch,i-u.STAR_SIZE/2,r-u.STAR_SIZE/2,u.STAR_SIZE,u.STAR_SIZE))}}catch(l){t.e(l)}finally{t.f()}this.batch.end()}}]),a}(Lt.System),Tt=Object(Nt.a)(_t.prototype,"viewport",[At],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ct=Object(Nt.a)(_t.prototype,"gl",[It],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ht=Object(Nt.a)(_t.prototype,"stars",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rt=Object(Nt.a)(_t.prototype,"assetManager",[Et],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xt=Object(Nt.a)(_t.prototype,"playerState",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_t);function ca(e,t,a,i,r){var n=t.getContext();a.loadAtlas("./main-char.atlas"),a.loadAtlas("./ground.atlas"),a.loadAtlas("./object.atlas"),["bg","city_01","city_02","cloud_01","cloud_02","smoke_01","smoke_02"].map((function(e){return a.loadTexture("./background/".concat(e,".png"))})),a.loadAtlas("./ui.atlas"),a.loadFont("./score.fnt"),a.loadTexture("./winning.png"),a.finishLoading().then((function(){setTimeout((function(){e.setScreen(function(e,t,a,i){var r=e.getContext(),n=Object(o.l)(e.getCanvas(),e),s=function(){Dt.track("gameStart");var s=new Mt.b2World({x:0,y:u.GRAVITY}),c=new Lt.World,l=new Gt,b=new o.e(0,0);return e.getCamera().setPosition(0,0),c.register("context",r),c.register("physicsWorld",s),c.register("viewport",e),c.register("blocks",[]),c.register("stars",[]),c.register("aliens",[]),c.register("playerPosition",b),c.register("inputHandler",n),c.register("assetManager",t),c.register("playerState",l),c.register("fixedCamera",a),c.register("eventEmitter",i),c.addSystem(new Vt),c.addSystem(new aa),c.addSystem(new qt),c.addSystem(new na),c.addSystem(new Kt),c.addSystem(new $t),c.addSystem(new Xt,!1),c.addSystem(new Zt,!1),c.addSystem(new Qt,!1),c.addSystem(new sa,!1),c.addSystem(new Yt,!1),c.addSystem(new ia,!1),c.addSystem(new ra,!1),c.addSystem(new ta,!1),c},c=s(),l=!1,b="";i.addListener("gameOver",(function(e){Dt.track("gameOver",{score:e}),l=!0,c.dispose(),b=e}));var h=Object(o.g)(r),p=Object(o.m)(r),y=t.getTexture("./winning.png"),j=.8*u.CAMERA_WIDTH,d=j/y.width*y.height,O=.1*u.CAMERA_WIDTH,v=(u.CAMERA_HEIGHT-d)/2,f=t.getFont("./score.fnt").createRenderer(.9*j);f.setAlignMode(o.a.right);var g=d/20;return{update:function(e){if(r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT),c.setDelta(e),!l&&c.processActiveSystem(),c.processPassiveSystem(),l&&(h.setProjection(a.combined),h.begin(),h.setColor(0,0,0,.75),h.draw(p,0,0,u.CAMERA_WIDTH,u.CAMERA_HEIGHT),h.setColor(1,1,1,1),h.draw(y,O,v,j,d),f.setColor(1,0,0,1),f.draw(h,b,O,v+d/1.48,g),f.setColor(1,1,1,1),f.draw(h,b,O,v+d/1.49,g),h.end(),n.isTouched())){var t=n.getTouchedWorldCoord().y;t>=v+.8*d&&t<v+d&&(c=s(),l=!1,Dt.track("retry"))}}}}(t,a,i,r))}),1e3)}));var s=Object(o.g)(n),c=Object(o.m)(n),l=.8*u.CAMERA_WIDTH,b=.1*u.CAMERA_WIDTH,h=l/40,p=(u.CAMERA_HEIGHT-h)/2,y=a.getTotal(),j=0;return{update:function(e){n.clearColor(.694,.173,.192,1),n.clear(n.COLOR_BUFFER_BIT);var t=a.getDone();j+=.05*(t/y-j),s.setProjection(i.combined),s.begin(),s.draw(c,b,p,l*j,h),s.end()}}}var oa=window.progressListeners||[],la=function(e,t){var a,i=Object(s.a)(oa);try{for(i.s();!(a=i.n()).done;){(0,a.value)(e,t)}}catch(r){i.e(r)}finally{i.f()}},ba=function(){var e=Object(n.a)(r.a.mark((function e(){var t,a,i,n,s,l,b,p;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new c.EventEmitter,a=Object(o.j)(),i=a.getCanvas(),n=Object(o.k)(i,u.CAMERA_WIDTH,u.CAMERA_HEIGHT,{pixelRatio:1}),s=n.getContext(),l=Object(o.i)(u.CAMERA_WIDTH,u.CAMERA_HEIGHT,i.width,i.height),n.addCamera(l),n.update(),(b=new h(s)).addListener((function(e,t){la(e,t)})),(p=new o.b).setScreen(ca(p,n,b,l,t)),Object(o.h)((function(e){p.update(e,{})}));case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Dt.page(),ba()}},[[95,1,2]]]);
//# sourceMappingURL=main.f84f0aa9.chunk.js.map