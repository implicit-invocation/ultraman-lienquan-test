(this["webpackJsonpultraman-lienquan"]=this["webpackJsonpultraman-lienquan"]||[]).push([[0],{89:function(e,t,a){},90:function(e,t,a){"use strict";a.r(t);var i=a(12),r=a.n(i),n=a(14),s=a(6),c=a(11),l=a(0),o=(a(89),a(4)),b=function e(){Object(o.a)(this,e)};b.CAMERA_WIDTH=4,b.CAMERA_HEIGHT=8,b.GAP=1,b.GRAVITY=20,b.PLAYER_WIDTH=.2,b.PLAYER_HEIGHT=.2,b.PLAYER_SCALE=5,b.JUMP_FORCE=-10,b.RUN_FORCE=2,b.STAR_SIZE=.2,b.TRANSITION_DURATION=1.5,b.ALIEN_SPAWNING_TIME=.5,b.ALIEN_WIDTH=1.3,b.ALIEN_SPEED=1.5*b.CAMERA_WIDTH,b.ALIEN_YS=[b.CAMERA_HEIGHT/2-(b.ALIEN_HEIGHT=b.ALIEN_WIDTH/160*113)/2,b.CAMERA_WIDTH/3-b.ALIEN_HEIGHT/2,b.CAMERA_HEIGHT/1.5-b.ALIEN_HEIGHT/2],b.TOTAL_BLOCK_HEIGHT=15,b.BLOCK_BLOCK_SIZE=2.1*b.CAMERA_WIDTH,b.BLOCK_SIZE=b.CAMERA_HEIGHT/b.TOTAL_BLOCK_HEIGHT,b.BLOCK_OFFSET_Y=b.CAMERA_HEIGHT/1.7;var u,h,p,y,j,O,d,v,f,m,g,A,I,E,w,S,_,T,H,C,R,x,L,P,k,M,G,D,B,W,z,N,F,Y,K,Z,U,J,V,q,Q,X,$,ee,te,ae,ie,re,ne,se,ce,le,oe,be,ue,he,pe,ye,je,Oe,de,ve,fe,me,ge,Ae,Ie,Ee,we,Se,_e,Te,He,Ce,Re,xe,Le,Pe,ke,Me,Ge,De,Be,We,ze,Ne,Fe,Ye,Ke,Ze,Ue,Je,Ve,qe,Qe,Xe,$e,et,tt,at,it,rt,nt,st,ct,lt,ot,bt,ut,ht,pt,yt,jt,Ot,dt,vt,ft,mt=a(2),gt=a(5),At=a(1),It=a(8),Et=a(7),wt=a(3),St=(a(13),u=Object(l.Inject)("physicsWorld"),h=function(e){Object(It.a)(a,e);var t=Object(Et.a)(a);function a(){var e;Object(o.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(mt.a)(e,"physicsWorld",p,Object(At.a)(e)),e}return Object(gt.a)(a,[{key:"process",value:function(){this.physicsWorld.Step(this.world.delta,8,3)}}]),a}(l.System),p=Object(wt.a)(h.prototype,"physicsWorld",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h),_t=(y=Object(l.Inject)("viewport"),j=Object(l.Inject)("playerPosition"),O=function(e){Object(It.a)(a,e);var t=Object(Et.a)(a);function a(){var e;Object(o.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(mt.a)(e,"viewport",d,Object(At.a)(e)),Object(mt.a)(e,"playerPos",v,Object(At.a)(e)),e}return Object(gt.a)(a,[{key:"process",value:function(){var e=this.viewport.getCamera().getPosition();this.viewport.getCamera().setPosition(this.playerPos.x-b.GAP,e.y)}}]),a}(l.System),d=Object(wt.a)(O.prototype,"viewport",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=Object(wt.a)(O.prototype,"playerPos",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O),Tt=a(10),Ht=a(9),Ct=(f=Object(l.Inject)("viewport"),m=Object(l.Inject)("physicsWorld"),g=Object(l.Inject)("blocks"),A=Object(l.Inject)("stars"),I=Object(l.Inject)("aliens"),E=Object(l.Inject)("playerPosition"),L=x=function(e){Object(It.a)(a,e);var t=Object(Et.a)(a);function a(){var e;Object(o.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))).generatedStep=0,Object(mt.a)(e,"viewport",S,Object(At.a)(e)),Object(mt.a)(e,"physicsWorld",_,Object(At.a)(e)),Object(mt.a)(e,"blocks",T,Object(At.a)(e)),Object(mt.a)(e,"stars",H,Object(At.a)(e)),Object(mt.a)(e,"aliens",C,Object(At.a)(e)),Object(mt.a)(e,"playerPos",R,Object(At.a)(e)),e}return Object(gt.a)(a,[{key:"createBox",value:function(e,t,a,i,r){var n=new c.b2BodyDef;n.type=c.b2BodyType.b2_staticBody,n.position.Set(e,t);var s=this.physicsWorld.CreateBody(n);s.SetUserData({type:"block"});var l=new c.b2PolygonShape;l.SetAsBox(a/2,i/2),s.CreateFixture(l),this.blocks.push({x:e,y:t,w:a,h:i,type:r,body:s})}},{key:"initialized",value:function(){for(;this.generatedStep<2;)this.generateBlocks(this.generatedStep*b.BLOCK_BLOCK_SIZE,!0),this.generatedStep++}},{key:"process",value:function(){for(var e=this.viewport.getCamera().getPosition(),t=Math.floor(e.x/b.BLOCK_BLOCK_SIZE);this.generatedStep<=t+1;)this.generateBlocks(this.generatedStep*b.BLOCK_BLOCK_SIZE),this.generatedStep++}},{key:"createStar",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=new c.b2BodyDef;i.type=c.b2BodyType.b2_staticBody,i.position.Set(e,t);var r=this.physicsWorld.CreateBody(i);r.SetUserData({type:"star"});var n=new c.b2FixtureDef;n.isSensor=!0;var s=new c.b2PolygonShape;s.SetAsBox(b.STAR_SIZE,b.STAR_SIZE),n.shape=s,r.CreateFixture(n);var l={x:e,y:t,body:r,active:!0,special:a};r.m_userData.starObject=l,this.stars.push(l)}},{key:"generateBlocks",value:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=i?0:Math.floor(Math.random()*(a.patterns.length-1))+1,n=a.starPatterns[r]||[],s=a.patterns[r],c=Object(Ht.a)(s);try{for(c.s();!(t=c.n()).done;){var l=t.value,o=Object(Tt.a)(l,2),u=o[0],h=o[1];this.createBox(e+b.BLOCK_SIZE*u,(b.TOTAL_BLOCK_HEIGHT-h)*b.BLOCK_SIZE,b.BLOCK_SIZE,b.BLOCK_SIZE,Math.floor(3*Math.random()))}}catch(A){c.e(A)}finally{c.f()}var p,y=!1,j=Object(Ht.a)(n);try{for(j.s();!(p=j.n()).done;){var O=p.value,d=Object(Tt.a)(O,2),v=d[0],f=d[1],m=!y&&Math.random()<=.1;m&&(y=!0),this.createStar(e+b.BLOCK_SIZE*v,(b.TOTAL_BLOCK_HEIGHT-f)*b.BLOCK_SIZE,m)}}catch(A){j.e(A)}finally{j.f()}if(!i&&Math.random()<1){var g=Math.floor(3*Math.random());this.aliens.push({x:b.CAMERA_WIDTH-b.ALIEN_WIDTH,y:this.playerPos.y-b.ALIEN_HEIGHT/2,type:g,time:b.ALIEN_SPAWNING_TIME,hit:!1})}}}]),a}(l.System),x.patterns=["1-10,2","1-4,2;6-9,2;4,3-5;5,4;5,8-10;6,7-10;7,7-8","1-9,2;3,3-5;6-8,3;6-7,4","1-9,2;4,5-8;2,11;6,11;2-6,12;2-6,13","1-5,2;8-12,2;3-5,3;8-10,3;4-5,4;8-9,4;5-8,5;2-8,11;3-7,12;4-6,13","1-5,2;8-12,2;4-5,3;8-9,3;4-5,4;8-9,4","1-14,2;4-10,5;4-10,6;4,7;10,7;7,9-12","1-14,2;4-5,3;9-11,3;4,4;10,4;5-6,10;4-11,11;4-11,12"].map((function(e){var t,a=[],i=e.split(";"),r=Object(Ht.a)(i);try{for(r.s();!(t=r.n()).done;){var n=t.value.split(","),s=Object(Tt.a)(n,2),c=s[0],l=s[1],o=c.split("-").map((function(e){return parseInt(e)})),b=l.split("-").map((function(e){return parseInt(e)}));if(2===o.length){for(var u=[],h=o[0];h<=o[1];h++)u.push(h);o=u}if(2===b.length){for(var p=[],y=b[0];y<=b[1];y++)p.push(y);b=p}var j,O=Object(Ht.a)(o);try{for(O.s();!(j=O.n()).done;){var d,v=j.value,f=Object(Ht.a)(b);try{for(f.s();!(d=f.n()).done;){var m=d.value;a.push([v,m])}}catch(g){f.e(g)}finally{f.f()}}}catch(g){O.e(g)}finally{O.f()}}}catch(g){r.e(g)}finally{r.f()}return a})),x.starPatterns=[void 0,"2.5,6.5;3,7.2;3.5,7.9;3.8,9.2;3.9,10.2;4,11.2;4.2,12.2;5.2,12.6;6.1,12.2;6.2,11.3","2.2,6.8;2.8,7.5;3.2,8.1;5.5,6.8;5.9,7.5;6.3,8.3;6.7,9.1","2.5,7.8;2.9,8.5;3.2,9.2;4,9.6;4.8,9.6;5.5,9","2.9,6.5;3.2,7.2;4,7.9;4.8,7.4;5.2,6.5;6.2,6.5;7.2,6.5;8.2,6.5","3.2,6.5;3.5,7;4,7.5;4.8,7.3;5.3,6.5;6.5,8;7,9;8,9;8.5,8;8.8,7.5;9,6.5;9.1,6","4.5,9;5.5,7.5;6.5,7.5;7.5,7.5;8.5,7.5;9.5,8;10.5,9","4.5,5.5;5.5,5.5;5.5,4.5;6.5,4.5;6.5,3.5;8.5,7.5;9,8.5;10,8.5;10.3,7.5;10.5,5.5;11.5,5.5;11.5,4.5;12.5,4.5;12.5,3.5"].map((function(e){return e&&e.split(";").map((function(e){return e.split(",").map((function(e){return parseFloat(e)}))})).map((function(e){var t=Object(Tt.a)(e,2);return[t[0]-.5,t[1]]}))})),w=L,S=Object(wt.a)(w.prototype,"viewport",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=Object(wt.a)(w.prototype,"physicsWorld",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=Object(wt.a)(w.prototype,"blocks",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H=Object(wt.a)(w.prototype,"stars",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=Object(wt.a)(w.prototype,"aliens",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R=Object(wt.a)(w.prototype,"playerPos",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w),Rt=(P=Object(l.Inject)("viewport"),k=Object(l.Inject)("context"),M=Object(l.Inject)("blocks"),G=Object(l.Inject)("assetManager"),D=function(e){Object(It.a)(a,e);var t=Object(Et.a)(a);function a(){var e;Object(o.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(mt.a)(e,"viewport",B,Object(At.a)(e)),Object(mt.a)(e,"gl",W,Object(At.a)(e)),Object(mt.a)(e,"blocks",z,Object(At.a)(e)),Object(mt.a)(e,"assetManager",N,Object(At.a)(e)),e.batch=void 0,e.whiteTex=void 0,e.atlas=void 0,e.regions=void 0,e}return Object(gt.a)(a,[{key:"initialized",value:function(){this.batch=Object(s.e)(this.gl),this.whiteTex=Object(s.k)(this.gl);var e=this.assetManager.getAtlas("./ground.atlas");e&&(this.atlas=e,this.regions=e.findRegions("tile"))}},{key:"process",value:function(){this.batch.setProjection(this.viewport.getCamera().combined),this.batch.begin();var e,t=Object(Ht.a)(this.blocks);try{for(t.s();!(e=t.n()).done;){var a=e.value,i=a.x,r=a.y,n=a.w,s=a.h,c=a.type;this.regions[c].draw(this.batch,i-n/2,r-s/2,n,s)}}catch(l){t.e(l)}finally{t.f()}this.batch.end()}}]),a}(l.System),B=Object(wt.a)(D.prototype,"viewport",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W=Object(wt.a)(D.prototype,"gl",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=Object(wt.a)(D.prototype,"blocks",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N=Object(wt.a)(D.prototype,"assetManager",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D),xt=(F=Object(l.Inject)("physicsWorld"),Y=Object(l.Inject)("playerPosition"),K=Object(l.Inject)("inputHandler"),Z=Object(l.Inject)("playerState"),U=Object(l.Inject)("eventEmitter"),J=function(e){Object(It.a)(a,e);var t=Object(Et.a)(a);function a(){var e;Object(o.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(mt.a)(e,"physicsWorld",V,Object(At.a)(e)),Object(mt.a)(e,"playerPos",q,Object(At.a)(e)),Object(mt.a)(e,"inputHandler",Q,Object(At.a)(e)),Object(mt.a)(e,"playerState",X,Object(At.a)(e)),Object(mt.a)(e,"eventEmitter",$,Object(At.a)(e)),e.playerBody=void 0,e.pressed=!1,e.jumpLeft=0,e.gameOver=!1,e.zeroCenter={x:0,y:0},e.runImpulse={x:b.RUN_FORCE,y:0},e.jumpImpulse={x:0,y:b.JUMP_FORCE},e}return Object(gt.a)(a,[{key:"initialized",value:function(){var e=new c.b2BodyDef;e.type=c.b2BodyType.b2_dynamicBody,e.fixedRotation=!0,e.position.Set(2,b.CAMERA_HEIGHT/2);var t=this.physicsWorld.CreateBody(e);t.SetUserData({type:"user"});var a=new c.b2CircleShape(b.PLAYER_WIDTH);a.Set({x:-b.PLAYER_WIDTH/2,y:-b.PLAYER_HEIGHT/2},b.PLAYER_WIDTH),t.CreateFixture(a);var i=new c.b2PolygonShape;i.SetAsBox(b.PLAYER_WIDTH/8,b.PLAYER_WIDTH/8,{x:0,y:b.PLAYER_HEIGHT/2});var r=new c.b2FixtureDef;r.isSensor=!0,r.shape=i,r.userData={type:"playerSensor"},t.CreateFixture(r);var n=new c.b2PolygonShape;n.SetAsBox(b.PLAYER_WIDTH/8,b.PLAYER_WIDTH/8,{x:b.PLAYER_WIDTH/2,y:0});var s=new c.b2FixtureDef;s.isSensor=!0,s.shape=n,s.userData={type:"playerSensor2"},t.CreateFixture(s),this.playerBody=t;var l=function(e){Object(It.a)(a,e);var t=Object(Et.a)(a);function a(e){var i;return Object(o.a)(this,a),(i=t.call(this)).movementSytem=void 0,i.movementSytem=e,i}return Object(gt.a)(a,[{key:"processJumpable",value:function(e){var t,a,i,r,n=e.GetFixtureA(),s=e.GetFixtureB();n.IsSensor()&&"playerSensor"===(null===(t=n.GetUserData())||void 0===t?void 0:t.type)?r=s:s.IsSensor()&&"playerSensor"===(null===(a=s.GetUserData())||void 0===a?void 0:a.type)&&(r=n),r&&"block"===(null===(i=r.GetBody().GetUserData())||void 0===i?void 0:i.type)&&(this.movementSytem.jumpLeft=2,this.movementSytem.playerState.changeAction("run"))}},{key:"processObstacle",value:function(e){var t,a,i,r,n=e.GetFixtureA(),s=e.GetFixtureB();n.IsSensor()&&"playerSensor2"===(null===(t=n.GetUserData())||void 0===t?void 0:t.type)?r=s:s.IsSensor()&&"playerSensor2"===(null===(a=s.GetUserData())||void 0===a?void 0:a.type)&&(r=n),r&&"block"===(null===(i=r.GetBody().GetUserData())||void 0===i?void 0:i.type)&&(this.movementSytem.playerState.stunnedDuration=.2,this.movementSytem.playerState.changeAction("hurt"))}},{key:"BeginContact",value:function(e){this.movementSytem.gameOver||(this.processJumpable(e),this.processObstacle(e),this.movementSytem.eventEmitter.emit("beginContact",e))}}]),a}(c.b2ContactListener);this.physicsWorld.SetContactListener(new l(this))}},{key:"process",value:function(){if(this.playerState.stunnedDuration>0)this.playerState.appliedStun||(this.playerState.appliedStun=!0,this.playerBody.GetLinearVelocity().Set(0,0),this.playerBody.ApplyLinearImpulse({x:-2*b.RUN_FORCE,y:0},{x:0,y:0})),this.playerState.stunnedDuration-=this.world.delta,this.playerState.stunnedDuration<=0&&(this.playerState.changeAction("run"),this.playerState.appliedStun=!1);else{var e=this.playerBody.GetLinearVelocity();if(e.Set(0,e.y),this.playerBody.ApplyLinearImpulse(this.runImpulse,this.zeroCenter),this.pressed)this.inputHandler.isTouched()||(this.pressed=!1);else if(this.inputHandler.isTouched()&&this.jumpLeft>0){this.jumpLeft--,1===this.jumpLeft?this.playerState.changeAction("jump"):this.playerState.changeAction("doubleJump"),this.pressed=!0;var t=this.playerBody.GetLinearVelocity();t.Set(t.x,0),this.playerBody.ApplyLinearImpulse(this.jumpImpulse,this.zeroCenter)}}var a=this.playerBody.GetPosition();this.playerPos.set(a.x,a.y),!this.gameOver&&a.y>1.2*b.CAMERA_HEIGHT&&(this.gameOver=!0,this.eventEmitter.emit("gameOver"))}}]),a}(l.System),V=Object(wt.a)(J.prototype,"physicsWorld",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q=Object(wt.a)(J.prototype,"playerPos",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q=Object(wt.a)(J.prototype,"inputHandler",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X=Object(wt.a)(J.prototype,"playerState",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$=Object(wt.a)(J.prototype,"eventEmitter",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J),Lt=(ee=Object(l.Inject)("viewport"),te=Object(l.Inject)("context"),ae=Object(l.Inject)("playerPosition"),ie=Object(l.Inject)("assetManager"),re=Object(l.Inject)("playerState"),ne=function(e){Object(It.a)(a,e);var t=Object(Et.a)(a);function a(){var e;Object(o.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(mt.a)(e,"viewport",se,Object(At.a)(e)),Object(mt.a)(e,"gl",ce,Object(At.a)(e)),Object(mt.a)(e,"playerPos",le,Object(At.a)(e)),Object(mt.a)(e,"assetManager",oe,Object(At.a)(e)),Object(mt.a)(e,"playerState",be,Object(At.a)(e)),e.batch=void 0,e.whiteTex=void 0,e.atlas=void 0,e.animations={},e.animationFrameDuration={run:.1,jump:.1,doubleJump:.1,hurt:.05},e}return Object(gt.a)(a,[{key:"initialized",value:function(){this.batch=Object(s.e)(this.gl),this.whiteTex=Object(s.k)(this.gl);var e=this.assetManager.getAtlas("./main-char.atlas");e&&(this.atlas=e,this.animations.upgrade=Object(s.d)(.08,e.findRegions("upgrade_blast")))}},{key:"getAnimation",value:function(e,t){var a="".concat(e).concat(t);if(!this.animations[a]){var i=this.animationFrameDuration[e]||.1,r=this.atlas.findRegions(a);"jump"!==e&&"doubleJump"!==e||(r=r.slice(0,r.length-2)),this.animations[a]=Object(s.d)(i,r)}return this.animations[a]}},{key:"process",value:function(){this.batch.setProjection(this.viewport.getCamera().combined),this.batch.begin();var e=this.playerPos,t=e.x,a=e.y;this.playerState.process(this.world.delta);var i=s.a.LOOP;("jump"!==this.playerState.action&&"doubleJump"!==this.playerState.action||(i=s.a.NORMAL),this.getAnimation(this.playerState.action,this.playerState.state).getKeyFrame(this.playerState.stateTime,i).draw(this.batch,t-b.PLAYER_WIDTH/2,a-b.PLAYER_HEIGHT/2,b.PLAYER_WIDTH,b.PLAYER_HEIGHT,b.PLAYER_WIDTH/2,b.PLAYER_HEIGHT,0,b.PLAYER_SCALE,b.PLAYER_SCALE),this.playerState.transitionTime>0)&&this.animations.upgrade.getKeyFrame(this.playerState.stateTime,s.a.LOOP).draw(this.batch,t-b.PLAYER_WIDTH/2,a,b.PLAYER_WIDTH,b.PLAYER_HEIGHT,b.PLAYER_WIDTH/2,b.PLAYER_HEIGHT,0,1.2*b.PLAYER_SCALE,1.2*b.PLAYER_SCALE);this.batch.end()}}]),a}(l.System),se=Object(wt.a)(ne.prototype,"viewport",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ce=Object(wt.a)(ne.prototype,"gl",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),le=Object(wt.a)(ne.prototype,"playerPos",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oe=Object(wt.a)(ne.prototype,"assetManager",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),be=Object(wt.a)(ne.prototype,"playerState",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ne),Pt=(ue=Object(l.Inject)("viewport"),he=Object(l.Inject)("physicsWorld"),pe=Object(l.Inject)("blocks"),ye=Object(l.Inject)("stars"),je=function(e){Object(It.a)(a,e);var t=Object(Et.a)(a);function a(){var e;Object(o.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(mt.a)(e,"viewport",Oe,Object(At.a)(e)),Object(mt.a)(e,"physicsWorld",de,Object(At.a)(e)),Object(mt.a)(e,"blocks",ve,Object(At.a)(e)),Object(mt.a)(e,"stars",fe,Object(At.a)(e)),e}return Object(gt.a)(a,[{key:"process",value:function(){for(var e=this.viewport.getCamera().getPosition(),t=this.blocks.length-1;t>=0;t--){var a=this.blocks[t];e.x-a.x>=3*b.CAMERA_WIDTH&&(this.physicsWorld.DestroyBody(a.body),this.blocks.splice(t,1))}for(var i=this.stars.length-1;i>=0;i--){var r=this.stars[i];e.x-r.x>=3*b.CAMERA_WIDTH&&(this.physicsWorld.DestroyBody(r.body),this.stars.splice(i,1))}}}]),a}(l.System),Oe=Object(wt.a)(je.prototype,"viewport",[ue],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),de=Object(wt.a)(je.prototype,"physicsWorld",[he],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve=Object(wt.a)(je.prototype,"blocks",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fe=Object(wt.a)(je.prototype,"stars",[ye],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),je),kt=function(){function e(t){Object(o.a)(this,e),this.gl=void 0,this.promises=[],this.atlases=new Map,this.textures=new Map,this.done=0,this.gl=t}return Object(gt.a)(e,[{key:"loadAtlas",value:function(e){var t=this,a=Object(s.l)(this.gl,e,{}).then((function(a){t.atlases.set(e,a),t.done++}));this.promises.push(a)}},{key:"getAtlas",value:function(e){return this.atlases.get(e)}},{key:"loadTexture",value:function(e){var t=this,a=Object(s.m)(this.gl,e,{}).then((function(a){t.textures.set(e,a),t.done++}));this.promises.push(a)}},{key:"getTexture",value:function(e){return this.textures.get(e)}},{key:"finishLoading",value:function(){var e=Object(n.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.promises);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDone",value:function(){return this.done}},{key:"getTotal",value:function(){return this.promises.length}}]),e}(),Mt=function(){function e(){Object(o.a)(this,e),this.action="run",this.state="A",this.stateTime=0,this.states=["A","B","C","D"],this.stateIndex=0,this.transitionTime=0,this.stunnedDuration=0,this.appliedStun=!1}return Object(gt.a)(e,[{key:"getCurrentStateIndex",value:function(){return this.states.indexOf(this.state)}},{key:"changeAction",value:function(e){e!==this.action&&(this.action=e,this.stateTime=0)}},{key:"changeState",value:function(e){this.transitionTime=b.TRANSITION_DURATION,this.state=e}},{key:"nextState",value:function(){var e=this.stateIndex+1;e>=this.states.length||(this.stateIndex=e,this.changeState(this.states[e]))}},{key:"process",value:function(e){this.stateTime+=e,this.transitionTime>0&&(this.transitionTime-=e)}}]),e}(),Gt=(me=Object(l.Inject)("context"),ge=Object(l.Inject)("assetManager"),Ae=Object(l.Inject)("fixedCamera"),Ie=Object(l.Inject)("playerPosition"),Ee=function(e){Object(It.a)(a,e);var t=Object(Et.a)(a);function a(){var e;Object(o.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(mt.a)(e,"gl",we,Object(At.a)(e)),Object(mt.a)(e,"assetManager",Se,Object(At.a)(e)),Object(mt.a)(e,"fixedCamera",_e,Object(At.a)(e)),Object(mt.a)(e,"playerPos",Te,Object(At.a)(e)),e.batch=void 0,e.textures=new Map,e}return Object(gt.a)(a,[{key:"initialized",value:function(){var e=this;this.batch=Object(s.e)(this.gl),["bg","city_01","city_02","cloud_01","cloud_02","smoke_01","smoke_02"].map((function(t){return e.textures.set(t,e.assetManager.getTexture("./background/".concat(t,".png")))}))}},{key:"drawBackground",value:function(){for(var e=this.textures.get("bg"),t=b.CAMERA_HEIGHT,a=t/e.height*e.width,i=0;i*a<b.CAMERA_WIDTH;)this.batch.draw(e,i*a,0,a,t),i++}},{key:"process",value:function(){var e=-this.playerPos.x;this.batch.setProjection(this.fixedCamera.combined),this.batch.begin(),this.drawBackground(),this.drawCloud1(.5*e),this.drawCloud2(.8*e),this.drawCity1(e),this.drawCity2(1.1*e),this.batch.end()}},{key:"drawCity1",value:function(e){for(var t=this.textures.get("city_01"),a=b.CAMERA_HEIGHT/1.5,i=a/t.height*t.width;e<=0;)e+=i;for(this.batch.draw(t,e-i,b.CAMERA_HEIGHT-a,i,a);e<=b.CAMERA_WIDTH;)this.batch.draw(t,e,b.CAMERA_HEIGHT-a,i,a),e+=i}},{key:"drawCity2",value:function(e){for(var t=this.textures.get("city_02"),a=b.CAMERA_HEIGHT/1.5,i=a/t.height*t.width;e<=0;)e+=i;for(this.batch.draw(t,e-i,b.CAMERA_HEIGHT-a,i,a);e<=b.CAMERA_WIDTH;)this.batch.draw(t,e,b.CAMERA_HEIGHT-a,i,a),e+=i}},{key:"drawCloud1",value:function(e){for(var t=this.textures.get("cloud_01"),a=b.CAMERA_HEIGHT/1.2,i=a/t.height*t.width,r=i;e<=0;)e+=i+r;for(this.batch.draw(t,e-i,b.CAMERA_HEIGHT-a,i,a);e+r<=b.CAMERA_WIDTH;)this.batch.draw(t,e+r,b.CAMERA_HEIGHT-a,i,a),e+=i+r}},{key:"drawCloud2",value:function(e){for(var t=this.textures.get("cloud_02"),a=b.CAMERA_HEIGHT/6,i=a/t.height*t.width,r=i;e<=0;)e+=i+r;for(this.batch.draw(t,e-i,b.CAMERA_HEIGHT/4,i,a);e+r<=b.CAMERA_WIDTH;)this.batch.draw(t,e+r,b.CAMERA_HEIGHT/4,i,a),e+=i+r}}]),a}(l.System),we=Object(wt.a)(Ee.prototype,"gl",[me],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Se=Object(wt.a)(Ee.prototype,"assetManager",[ge],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_e=Object(wt.a)(Ee.prototype,"fixedCamera",[Ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Te=Object(wt.a)(Ee.prototype,"playerPos",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ee),Dt=(He=Object(l.Inject)("context"),Ce=Object(l.Inject)("assetManager"),Re=Object(l.Inject)("fixedCamera"),xe=Object(l.Inject)("playerPosition"),Le=function(e){Object(It.a)(a,e);var t=Object(Et.a)(a);function a(){var e;Object(o.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(mt.a)(e,"gl",Pe,Object(At.a)(e)),Object(mt.a)(e,"assetManager",ke,Object(At.a)(e)),Object(mt.a)(e,"fixedCamera",Me,Object(At.a)(e)),Object(mt.a)(e,"playerPos",Ge,Object(At.a)(e)),e.batch=void 0,e.textures=new Map,e}return Object(gt.a)(a,[{key:"initialized",value:function(){var e=this;this.batch=Object(s.e)(this.gl),["bg","city_01","city_02","cloud_01","cloud_02","smoke_01","smoke_02"].map((function(t){return e.textures.set(t,e.assetManager.getTexture("./background/".concat(t,".png")))}))}},{key:"process",value:function(){var e=-this.playerPos.x;this.batch.setProjection(this.fixedCamera.combined),this.batch.begin(),this.drawCloud1(.6*e),this.drawCloud2(.1*e),this.batch.end()}},{key:"drawCloud1",value:function(e){for(var t=this.textures.get("smoke_01"),a=b.CAMERA_HEIGHT/5,i=a/t.height*t.width,r=-i/1.5;e<=0;)e+=i+r;for(this.batch.draw(t,e-i,b.CAMERA_HEIGHT-a/2,i,a);e+r<=b.CAMERA_WIDTH;)this.batch.draw(t,e+r,b.CAMERA_HEIGHT-a/2,i,a),e+=i+r}},{key:"drawCloud2",value:function(e){for(var t=this.textures.get("smoke_02"),a=b.CAMERA_HEIGHT/5,i=a/t.height*t.width,r=-i/1.5;e<=0;)e+=i+r;for(this.batch.draw(t,e-i,b.CAMERA_HEIGHT-a/2,i,a);e+r<=b.CAMERA_WIDTH;)this.batch.draw(t,e+r,b.CAMERA_HEIGHT-a/2,i,a),e+=i+r}}]),a}(l.System),Pe=Object(wt.a)(Le.prototype,"gl",[He],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ke=Object(wt.a)(Le.prototype,"assetManager",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Me=Object(wt.a)(Le.prototype,"fixedCamera",[Re],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ge=Object(wt.a)(Le.prototype,"playerPos",[xe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Le),Bt=a(24),Wt=(De=Object(l.Inject)("viewport"),Be=Object(l.Inject)("context"),We=Object(l.Inject)("stars"),ze=Object(l.Inject)("assetManager"),Ne=Object(l.Inject)("playerState"),Fe=function(e){Object(It.a)(a,e);var t=Object(Et.a)(a);function a(){var e;Object(o.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(mt.a)(e,"viewport",Ye,Object(At.a)(e)),Object(mt.a)(e,"gl",Ke,Object(At.a)(e)),Object(mt.a)(e,"stars",Ze,Object(At.a)(e)),Object(mt.a)(e,"assetManager",Ue,Object(At.a)(e)),Object(mt.a)(e,"playerState",Je,Object(At.a)(e)),e.batch=void 0,e.whiteTex=void 0,e.starAnimation=void 0,e.specialAnimations=void 0,e.elapsed=0,e}return Object(gt.a)(a,[{key:"initialized",value:function(){this.batch=Object(s.e)(this.gl),this.whiteTex=Object(s.k)(this.gl);var e=this.assetManager.getAtlas("./object.atlas");e&&(this.starAnimation=Object(s.d)(.2,e.findRegions("star")),this.specialAnimations=["hand","feet","chest","star"].map((function(t){return Object(s.d)(.2,e.findRegions(t))})))}},{key:"process",value:function(){this.batch.setProjection(this.viewport.getCamera().combined),this.batch.begin(),this.elapsed+=this.world.delta;var e,t=Object(Ht.a)(this.stars);try{for(t.s();!(e=t.n()).done;){var a=e.value,i=a.x,r=a.y,n=a.active,c=a.special;n&&(c?this.specialAnimations[this.playerState.getCurrentStateIndex()].getKeyFrame(this.elapsed,s.a.LOOP).draw(this.batch,i-b.STAR_SIZE/2,r-b.STAR_SIZE/2,b.STAR_SIZE,b.STAR_SIZE,b.STAR_SIZE/2,b.STAR_SIZE/2,0,2,2):this.starAnimation.getKeyFrame(this.elapsed,s.a.LOOP).draw(this.batch,i-b.STAR_SIZE/2,r-b.STAR_SIZE/2,b.STAR_SIZE,b.STAR_SIZE))}}catch(l){t.e(l)}finally{t.f()}this.batch.end()}}]),a}(l.System),Ye=Object(wt.a)(Fe.prototype,"viewport",[De],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ke=Object(wt.a)(Fe.prototype,"gl",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ze=Object(wt.a)(Fe.prototype,"stars",[We],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ue=Object(wt.a)(Fe.prototype,"assetManager",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Je=Object(wt.a)(Fe.prototype,"playerState",[Ne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fe),zt=(Ve=Object(l.Inject)("physicsWorld"),qe=Object(l.Inject)("stars"),Qe=Object(l.Inject)("eventEmitter"),Xe=Object(l.Inject)("playerState"),$e=function(e){Object(It.a)(a,e);var t=Object(Et.a)(a);function a(){var e;Object(o.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(mt.a)(e,"physicsWorld",et,Object(At.a)(e)),Object(mt.a)(e,"stars",tt,Object(At.a)(e)),Object(mt.a)(e,"eventEmitter",at,Object(At.a)(e)),Object(mt.a)(e,"playerState",it,Object(At.a)(e)),e.subscription=void 0,e}return Object(gt.a)(a,[{key:"initialized",value:function(){var e=this;this.subscription=this.eventEmitter.addListener("beginContact",(function(t){var a,i,r,n,s,c=t.GetFixtureA(),l=t.GetFixtureB();"star"===(null===(a=c.GetBody().GetUserData())||void 0===a?void 0:a.type)?(n=l,s=c):"star"===(null===(i=c.GetBody().GetUserData())||void 0===i?void 0:i.type)&&(n=c,s=l),s&&n&&"user"===(null===(r=n.GetBody().GetUserData())||void 0===r?void 0:r.type)&&e.removeStar(s.GetBody().GetUserData().starObject)}))}},{key:"process",value:function(){}},{key:"removeStar",value:function(e){e.active&&(e.special&&this.playerState.nextState(),e.active=!1)}},{key:"dispose",value:function(){this.subscription.remove()}}]),a}(l.System),et=Object(wt.a)($e.prototype,"physicsWorld",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tt=Object(wt.a)($e.prototype,"stars",[qe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),at=Object(wt.a)($e.prototype,"eventEmitter",[Qe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),it=Object(wt.a)($e.prototype,"playerState",[Xe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e),Nt=(rt=Object(l.Inject)("aliens"),nt=Object(l.Inject)("playerPosition"),st=Object(l.Inject)("playerState"),ct=function(e){Object(It.a)(a,e);var t=Object(Et.a)(a);function a(){var e;Object(o.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(mt.a)(e,"aliens",lt,Object(At.a)(e)),Object(mt.a)(e,"playerPos",ot,Object(At.a)(e)),Object(mt.a)(e,"playerState",bt,Object(At.a)(e)),e}return Object(gt.a)(a,[{key:"process",value:function(){for(var e=this.aliens.length-1;e>=0;e--){var t=this.aliens[e];if(t.time>0)return void(t.time-=this.world.delta);if(!t.hit){var a=this.playerPos.y;t.x<=b.GAP&&t.x+b.ALIEN_WIDTH>=b.GAP&&t.y<=a&&t.y+b.ALIEN_HEIGHT>=a&&(this.playerState.stunnedDuration=.2,this.playerState.changeAction("hurt"),t.hit=!0)}t.x-=b.ALIEN_SPEED*this.world.delta,t.x<=-b.ALIEN_WIDTH&&this.aliens.splice(e,1)}}}]),a}(l.System),lt=Object(wt.a)(ct.prototype,"aliens",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ot=Object(wt.a)(ct.prototype,"playerPos",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bt=Object(wt.a)(ct.prototype,"playerState",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ct),Ft=(ut=Object(l.Inject)("aliens"),ht=Object(l.Inject)("fixedCamera"),pt=Object(l.Inject)("context"),yt=Object(l.Inject)("assetManager"),jt=function(e){Object(It.a)(a,e);var t=Object(Et.a)(a);function a(){var e;Object(o.a)(this,a);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r)),Object(mt.a)(e,"aliens",Ot,Object(At.a)(e)),Object(mt.a)(e,"fixedCamera",dt,Object(At.a)(e)),Object(mt.a)(e,"gl",vt,Object(At.a)(e)),Object(mt.a)(e,"assetManager",ft,Object(At.a)(e)),e.batch=void 0,e.animations=[],e.elapsed=0,e}return Object(gt.a)(a,[{key:"initialized",value:function(){var e=this;this.batch=Object(s.e)(this.gl);var t=this.assetManager.getAtlas("./main-char.atlas");t&&["alien1","alien2","alien3"].forEach((function(a){return e.animations.push(Object(s.d)(.4,t.findRegions(a)))}))}},{key:"process",value:function(){this.batch.setProjection(this.fixedCamera.combined),this.batch.begin(),this.elapsed+=this.world.delta;var e,t=Object(Ht.a)(this.aliens);try{for(t.s();!(e=t.n()).done;){var a=e.value;this.animations[a.type].getKeyFrame(b.ALIEN_SPAWNING_TIME-a.time,s.a.NORMAL).draw(this.batch,a.x,a.y,b.ALIEN_WIDTH,b.ALIEN_HEIGHT)}}catch(i){t.e(i)}finally{t.f()}this.batch.end()}}]),a}(l.System),Ot=Object(wt.a)(jt.prototype,"aliens",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dt=Object(wt.a)(jt.prototype,"fixedCamera",[ht],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vt=Object(wt.a)(jt.prototype,"gl",[pt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ft=Object(wt.a)(jt.prototype,"assetManager",[yt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jt);(function(){var e=Object(n.a)(r.a.mark((function e(){var t,a,i,n,o,u,h,p,y,j,O,d,v;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Bt.EventEmitter,a=Object(s.h)(),i=a.getCanvas(),n=a.getInfo(),o=Object(s.i)(i,b.CAMERA_WIDTH,b.CAMERA_HEIGHT,{pixelRatio:1}),u=o.getContext(),h=Object(s.j)(i,o),p=Object(s.g)(b.CAMERA_WIDTH,b.CAMERA_HEIGHT,i.width,i.height),o.addCamera(p),o.update(),(y=new kt(u)).loadAtlas("./main-char.atlas"),y.loadAtlas("./ground.atlas"),y.loadAtlas("./object.atlas"),["bg","city_01","city_02","cloud_01","cloud_02","smoke_01","smoke_02"].map((function(e){return y.loadTexture("./background/".concat(e,".png"))})),n.innerHTML="Loading...",e.next=18,y.finishLoading();case 18:j=function(){var e=new c.b2World({x:0,y:b.GRAVITY}),a=new l.World,i=new Mt,r=new s.c(0,0);return o.getCamera().setPosition(0,0),a.register("context",u),a.register("physicsWorld",e),a.register("viewport",o),a.register("blocks",[]),a.register("stars",[]),a.register("aliens",[]),a.register("playerPosition",r),a.register("inputHandler",h),a.register("assetManager",y),a.register("playerState",i),a.register("fixedCamera",p),a.register("eventEmitter",t),a.addSystem(new Ct),a.addSystem(new xt),a.addSystem(new Pt),a.addSystem(new zt),a.addSystem(new Nt),a.addSystem(new St),a.addSystem(new _t,!1),a.addSystem(new Gt,!1),a.addSystem(new Rt,!1),a.addSystem(new Wt,!1),a.addSystem(new Ft,!1),a.addSystem(new Lt,!1),a.addSystem(new Dt,!1),a},O=j(),d=!1,t.addListener("gameOver",(function(){d=!0,O.dispose(),setTimeout((function(){O=j(),d=!1}),100)})),u.clearColor(0,0,0,1),v=Object(s.f)((function(e){u.clear(u.COLOR_BUFFER_BIT),O.setDelta(e),!d&&O.processActiveSystem(),O.processPassiveSystem()})),setInterval((function(){return n.innerHTML="FPS: ".concat(v.getFps())}),500);case 25:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}},[[90,1,2]]]);
//# sourceMappingURL=main.32f4a325.chunk.js.map