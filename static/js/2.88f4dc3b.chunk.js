/*! For license information please see 2.88f4dc3b.chunk.js.LICENSE.txt */
(this["webpackJsonpultraman-lienquan"]=this["webpackJsonpultraman-lienquan"]||[]).push([[2],[function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(80);Object.defineProperty(e,"World",{enumerable:!0,get:function(){return n.default}});var r=i(83);Object.defineProperty(e,"Archetype",{enumerable:!0,get:function(){return r.Archetype}});var s=i(84);Object.defineProperty(e,"Component",{enumerable:!0,get:function(){return s.Component}});var o=i(37);Object.defineProperty(e,"ComponentMapper",{enumerable:!0,get:function(){return o.ComponentMapper}});var a=i(38);Object.defineProperty(e,"EntityIteratingSystem",{enumerable:!0,get:function(){return a.EntityIteratingSystem}});var u=i(85);Object.defineProperty(e,"EntitySystem",{enumerable:!0,get:function(){return u.EntitySystem}});var l=i(39);Object.defineProperty(e,"System",{enumerable:!0,get:function(){return l.System}});var h=i(86);Object.defineProperty(e,"InjectMapper",{enumerable:!0,get:function(){return h.InjectMapper}});var c=i(87);Object.defineProperty(e,"Inject",{enumerable:!0,get:function(){return c.Inject}})},function(t,e,i){"use strict";function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}i.d(e,"a",(function(){return n}))},function(t,e,i){"use strict";function n(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}i.d(e,"a",(function(){return n}))},function(t,e,i){"use strict";function n(t,e,i,n,r){var s={};return Object.keys(n).forEach((function(t){s[t]=n[t]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce((function(i,n){return n(t,e,i)||i}),s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(t,e,s),s=null),s}i.d(e,"a",(function(){return n}))},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}i.d(e,"a",(function(){return n}))},function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}i.d(e,"a",(function(){return r}))},function(t,e,i){"use strict";i.d(e,"d",(function(){return s})),i.d(e,"a",(function(){return r})),i.d(e,"e",(function(){return a})),i.d(e,"f",(function(){return u})),i.d(e,"l",(function(){return M})),i.d(e,"m",(function(){return A})),i.d(e,"g",(function(){return Ct})),i.d(e,"b",(function(){return S})),i.d(e,"c",(function(){return Bt})),i.d(e,"i",(function(){return Pt})),i.d(e,"j",(function(){return It})),i.d(e,"k",(function(){return Dt.a})),i.d(e,"h",(function(){return Rt}));var n={};i.r(n),i.d(n,"create",(function(){return T})),i.d(n,"clone",(function(){return D})),i.d(n,"copy",(function(){return G})),i.d(n,"fromValues",(function(){return R})),i.d(n,"set",(function(){return E})),i.d(n,"identity",(function(){return F})),i.d(n,"transpose",(function(){return L})),i.d(n,"invert",(function(){return j})),i.d(n,"adjoint",(function(){return O})),i.d(n,"determinant",(function(){return N})),i.d(n,"multiply",(function(){return q})),i.d(n,"translate",(function(){return z})),i.d(n,"scale",(function(){return U})),i.d(n,"rotate",(function(){return J})),i.d(n,"rotateX",(function(){return X})),i.d(n,"rotateY",(function(){return Y})),i.d(n,"rotateZ",(function(){return W})),i.d(n,"fromTranslation",(function(){return Z})),i.d(n,"fromScaling",(function(){return H})),i.d(n,"fromRotation",(function(){return Q})),i.d(n,"fromXRotation",(function(){return K})),i.d(n,"fromYRotation",(function(){return $})),i.d(n,"fromZRotation",(function(){return tt})),i.d(n,"fromRotationTranslation",(function(){return et})),i.d(n,"fromQuat2",(function(){return it})),i.d(n,"getTranslation",(function(){return nt})),i.d(n,"getScaling",(function(){return rt})),i.d(n,"getRotation",(function(){return st})),i.d(n,"fromRotationTranslationScale",(function(){return ot})),i.d(n,"fromRotationTranslationScaleOrigin",(function(){return at})),i.d(n,"fromQuat",(function(){return ut})),i.d(n,"frustum",(function(){return lt})),i.d(n,"perspective",(function(){return ht})),i.d(n,"perspectiveFromFieldOfView",(function(){return ct})),i.d(n,"ortho",(function(){return mt})),i.d(n,"lookAt",(function(){return _t})),i.d(n,"targetTo",(function(){return ft})),i.d(n,"str",(function(){return dt})),i.d(n,"frob",(function(){return pt})),i.d(n,"add",(function(){return vt})),i.d(n,"subtract",(function(){return yt})),i.d(n,"multiplyScalar",(function(){return gt})),i.d(n,"multiplyScalarAndAdd",(function(){return xt})),i.d(n,"exactEquals",(function(){return bt})),i.d(n,"equals",(function(){return wt})),i.d(n,"mul",(function(){return At})),i.d(n,"sub",(function(){return St}));var r={NORMAL:0,LOOP:1,LOOP_PINGPONG:2,REVERSED:3,LOOP_REVERSED:4},s=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{getKeyFrame:function(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.NORMAL,s=Math.floor(i/t);switch(n){case r.NORMAL:s=Math.min(e.length-1,s);break;case r.LOOP:s%=e.length;break;case r.LOOP_PINGPONG:(s%=2*e.length-2)>=e.length&&(s=e.length-2-(s-e.length));break;case r.REVERSED:s=Math.max(e.length-s-1,0);break;case r.LOOP_REVERSED:s%=e.length,s=e.length-s-1}return e[s]}}},o=i(40),a=i.n(o).a,u=function(t){var e,i=Date.now(),n=0,r=!0,s=0,o=0;return function a(){if(r){var u=Date.now()-i;i=Date.now(),s++,(o+=u)>=1e3&&(n=s,s=0,o-=1e3),t(u/1e3),e=requestAnimationFrame(a)}}(),{isRunning:function(){return r},start:function(){r||(r=!0,loop())},stop:function(){e&&cancelAnimationFrame(e),r=!1},getFps:function(){return n}}},l=i(4),h=i(5),c=i(23),m=function(){function t(e){var i=this;Object(l.a)(this,t),this.canvas=e,this.lastX=0,this.lastY=0,this.touched=!1;var n=this.emitter=new c.EventEmitter;this.mouseDownHandler=function(t){i.touched=!0,i.handleMove(t),n.emit("touchStart",i.getX(),i.getY())},this.mouseUpHandler=function(t){i.touched=!1,n.emit("touchEnd",i.getX(),i.getY())},this.mouseMoveHandler=function(t){i.handleMove(t),n.emit("touchMove",i.getX(),i.getY())},this.touchStartHandler=function(t){t.preventDefault();var e=t.touches[0];i.canvas.dispatchEvent(new MouseEvent("mousedown",{clientX:e.clientX,clientY:e.clientY}))},this.touchEndHandler=function(t){t.preventDefault(),i.canvas.dispatchEvent(new MouseEvent("mouseup"))},this.touchMoveHandler=function(t){t.preventDefault();var e=t.touches[0];i.canvas.dispatchEvent(new MouseEvent("mousemove",{clientX:e.clientX,clientY:e.clientY}))},this.canvas.addEventListener("mousedown",this.mouseDownHandler,!1),this.canvas.addEventListener("mouseup",this.mouseUpHandler,!1),this.canvas.addEventListener("mousemove",this.mouseMoveHandler,!1),this.canvas.addEventListener("touchstart",this.touchStartHandler,!1),this.canvas.addEventListener("touchend",this.touchEndHandler,!1),this.canvas.addEventListener("touchmove",this.touchMoveHandler,!1)}return Object(h.a)(t,[{key:"cleanup",value:function(){this.canvas.removeEventListener("mousedown",this.mouseDownHandler),this.canvas.removeEventListener("mouseup",this.mouseUpHandler),this.canvas.removeEventListener("mousemove",this.mouseMoveHandler),this.canvas.removeEventListener("touchstart",this.touchStartHandler),this.canvas.removeEventListener("touchend",this.touchEndHandler),this.canvas.removeEventListener("touchmove",this.touchMoveHandler)}},{key:"addEventListener",value:function(t,e){this.emitter.addListener(t,e)}},{key:"handleMove",value:function(t){var e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top;this.lastX=i,this.lastY=n}},{key:"getX",value:function(){return this.lastX}},{key:"getY",value:function(){return this.lastY}},{key:"isTouched",value:function(){return this.touched}}]),t}(),_=i(9),f=i.n(_);var d=i(17);function p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var i=[],n=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(u){r=!0,s=u}finally{try{n||null==a.return||a.return()}finally{if(r)throw s}}return i}}(t,e)||Object(d.a)(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var v=i(12);function y(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function g(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function x(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?g(Object(i),!0).forEach((function(e){y(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):g(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var b=i(19),w=i.n(b),A=function(t,e,i){return new Promise((function(n){var r=new Image;r.src=e,r.onload=function(){var e=new w.a(t,x(x({},i),{},{image:r}));e.setFilter(w.a.Filter.LINEAR,w.a.Filter.LINEAR,!1),n(e)}}))},S=(w.a.Filter,function(){function t(e,i,n,r,s,o,a,u,h){Object(l.a)(this,t),a&&u||(a=1/e.width,u=1/e.height);var c=i*a,m=n*u,_=(i+r)*a,f=(n+s)*u;for(var d in this.texture=e,this.x=i,this.y=n,this.width=r,this.height=s,h?(this.u=_,this.v=m,this.u2=c,this.v2=f):(this.u=c,this.v=m,this.u2=_,this.v2=f),o)this[d]=o[d]}return Object(h.a)(t,null,[{key:"splitTexture",value:function(e,i,n){for(var r=e.width/i,s=e.height/n,o=[],a=0;a<i;a++)for(var u=0;u<n;u++)o.push(new t(e,a*r,u*s,r,s,{}));return o}}]),Object(h.a)(t,[{key:"draw",value:function(t,e,i,n,r){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1;t.draw(this.texture,e,i,n,r,s,o,a,u,l,this.u,this.v,this.u2,this.v2)}}]),t}());function B(t,e){for(var i=t.split("/"),n=e.split("/"),r=[],s=0,o=i.length;s<o;s++)if(".."===i[s])r.pop();else{if("."===i[s])continue;r.push(i[s])}for(var a=0,u=n.length;a<u;a++)if(".."===n[a])r.pop();else{if("."===n[a])continue;r.push(n[a])}return r.join("/")}var C=0,V=1,M=function(){var t=Object(v.a)(f.a.mark((function t(e,i,n){var r,s,o,a,u,l,h,c,m,_,d,v,y,g,x,b,w,M,k,P,I,T,D,G,R,E,F,L,j,O,N,q,z,U,J,X,Y,W,Z,H;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(i).then((function(t){return t.text()}));case 2:r=t.sent,s=[],o=[],u=r.split("\n"),l=0;case 7:if(void 0!==(c=u[l])){t.next=11;break}return t.abrupt("break",15);case 11:0===c.trim().length?a=null:null===a?(m=B(i,"../".concat(c)),l++,c=u[l],h=c.split(":")[1].split(",").map((function(t){return t.trim()})),_=parseInt(h[0],10),d=parseInt(h[1],10),l++,c=u[l],h=c.split(":")[1].split(",").map((function(t){return t.trim()})),v=h[0],l++,c=u[l],h=c.split(":")[1].split(",").map((function(t){return t.trim()})),y=p(h,2),g=y[0],x=y[1],l++,c=u[l],h=c.split(":")[1].split(",").map((function(t){return t.trim()})),b=h[0],w=C,M=C,"x"===b?w=V:"y"===b?M=V:"xy"===b&&(w=V,M=V),a={file:m,width:_,height:d,format:v,mipMaps:"Nearest"!==g&&"Linear"!==g,min:g,max:x,direction:b,repeatX:w,repeatY:M},s.push(a)):(k=c,l++,c=u[l],h=c.split(":")[1].split(",").map((function(t){return t.trim()})),P="true"===h[0],l++,c=u[l],h=c.split(":")[1].split(",").map((function(t){return t.trim()})),I=parseInt(h[0],10),T=parseInt(h[1],10),l++,c=u[l],h=c.split(":")[1].split(",").map((function(t){return t.trim()})),D=parseInt(h[0],10),G=parseInt(h[1],10),R={name:k,rotate:P,left:I,top:T,width:D,height:G,page:a},l++,c=u[l],4===(h=c.split(":")[1].split(",").map((function(t){return t.trim()}))).length&&(R.splits=h.map((function(t){return parseInt(t,10)})),l++,c=u[l],4===(h=c.split(":")[1].split(",").map((function(t){return t.trim()}))).length&&(R.pads=h.map((function(t){return parseInt(t,10)})),l++,c=u[l],h=c.split(":")[1].split(",").map((function(t){return t.trim()})))),R.originalWidth=parseInt(h[0],10),R.originalHeight=parseInt(h[1],10),l++,c=u[l],h=c.split(":")[1].split(",").map((function(t){return t.trim()})),R.offsetX=parseInt(h[0],10),R.offsetY=parseInt(h[1],10),l++,c=u[l],h=c.split(":")[1].split(",").map((function(t){return t.trim()})),R.index=parseInt(h[0],10),o.push(R)),l++,t.next=7;break;case 15:E=0,F=s;case 16:if(!(E<F.length)){t.next=26;break}return L=F[E],t.next=20,A(e,L.file,n);case 20:L.texture=t.sent,L.invTexWidth=1/L.texture.width,L.invTexHeight=1/L.texture.height;case 23:E++,t.next=16;break;case 26:for(j=[],O=0,N=o;O<N.length;O++)q=N[O],z=q.left,U=q.top,J=q.rotate?q.height:q.width,X=q.rotate?q.width:q.height,Y=q.page,W=Y.texture,Z=Y.invTexWidth,H=Y.invTexHeight,j.push(new S(W,z,U,J,X,q,Z,H,q.rotate));return t.abrupt("return",{getPages:function(){return s},getRegions:function(){return j},findRegion:function(t,e){for(var i=0;i<j.length;i++){var n=j[i];if(n.name===t&&(void 0===e||n.index===e))return n}return null},findRegions:function(t){return j.filter((function(e){return e.name===t})).sort((function(t,e){return t.index-e.index}))}});case 29:case"end":return t.stop()}}),t)})));return function(e,i,n){return t.apply(this,arguments)}}();var k=function(t,e,i,n,r,s,o){var a=p(e,3),u=a[0],l=a[1],h=a[2];return u-=n,l=o-l-1,l-=r,t[0]=2*u/s-1,t[1]=2*l/o-1,t[2]=2*h-1,function(t,e,i){var n=p(e,3),r=n[0],s=n[1],o=n[2],a=i,u=a[0],l=a[1],h=a[2],c=a[3],m=a[4],_=a[5],f=a[6],d=a[7],v=a[8],y=a[9],g=a[10],x=a[11],b=a[12],w=a[13],A=a[14],S=1/(r*c+s*d+o*x+a[15]);return t[0]=(r*u+s*m+o*v+b)*S,t[1]=(r*l+s*_+o*y+w)*S,t[2]=(r*h+s*f+o*g+A)*S,t}(t,t,i)},P=1e-6,I="undefined"!==typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function T(){var t=new I(16);return I!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function D(t){var e=new I(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function G(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function R(t,e,i,n,r,s,o,a,u,l,h,c,m,_,f,d){var p=new I(16);return p[0]=t,p[1]=e,p[2]=i,p[3]=n,p[4]=r,p[5]=s,p[6]=o,p[7]=a,p[8]=u,p[9]=l,p[10]=h,p[11]=c,p[12]=m,p[13]=_,p[14]=f,p[15]=d,p}function E(t,e,i,n,r,s,o,a,u,l,h,c,m,_,f,d,p){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=s,t[5]=o,t[6]=a,t[7]=u,t[8]=l,t[9]=h,t[10]=c,t[11]=m,t[12]=_,t[13]=f,t[14]=d,t[15]=p,t}function F(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function L(t,e){if(t===e){var i=e[1],n=e[2],r=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=s,t[11]=e[14],t[12]=r,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function j(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],u=e[6],l=e[7],h=e[8],c=e[9],m=e[10],_=e[11],f=e[12],d=e[13],p=e[14],v=e[15],y=i*a-n*o,g=i*u-r*o,x=i*l-s*o,b=n*u-r*a,w=n*l-s*a,A=r*l-s*u,S=h*d-c*f,B=h*p-m*f,C=h*v-_*f,V=c*p-m*d,M=c*v-_*d,k=m*v-_*p,P=y*k-g*M+x*V+b*C-w*B+A*S;return P?(P=1/P,t[0]=(a*k-u*M+l*V)*P,t[1]=(r*M-n*k-s*V)*P,t[2]=(d*A-p*w+v*b)*P,t[3]=(m*w-c*A-_*b)*P,t[4]=(u*C-o*k-l*B)*P,t[5]=(i*k-r*C+s*B)*P,t[6]=(p*x-f*A-v*g)*P,t[7]=(h*A-m*x+_*g)*P,t[8]=(o*M-a*C+l*S)*P,t[9]=(n*C-i*M-s*S)*P,t[10]=(f*w-d*x+v*y)*P,t[11]=(c*x-h*w-_*y)*P,t[12]=(a*B-o*V-u*S)*P,t[13]=(i*V-n*B+r*S)*P,t[14]=(d*g-f*b-p*y)*P,t[15]=(h*b-c*g+m*y)*P,t):null}function O(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],u=e[6],l=e[7],h=e[8],c=e[9],m=e[10],_=e[11],f=e[12],d=e[13],p=e[14],v=e[15];return t[0]=a*(m*v-_*p)-c*(u*v-l*p)+d*(u*_-l*m),t[1]=-(n*(m*v-_*p)-c*(r*v-s*p)+d*(r*_-s*m)),t[2]=n*(u*v-l*p)-a*(r*v-s*p)+d*(r*l-s*u),t[3]=-(n*(u*_-l*m)-a*(r*_-s*m)+c*(r*l-s*u)),t[4]=-(o*(m*v-_*p)-h*(u*v-l*p)+f*(u*_-l*m)),t[5]=i*(m*v-_*p)-h*(r*v-s*p)+f*(r*_-s*m),t[6]=-(i*(u*v-l*p)-o*(r*v-s*p)+f*(r*l-s*u)),t[7]=i*(u*_-l*m)-o*(r*_-s*m)+h*(r*l-s*u),t[8]=o*(c*v-_*d)-h*(a*v-l*d)+f*(a*_-l*c),t[9]=-(i*(c*v-_*d)-h*(n*v-s*d)+f*(n*_-s*c)),t[10]=i*(a*v-l*d)-o*(n*v-s*d)+f*(n*l-s*a),t[11]=-(i*(a*_-l*c)-o*(n*_-s*c)+h*(n*l-s*a)),t[12]=-(o*(c*p-m*d)-h*(a*p-u*d)+f*(a*m-u*c)),t[13]=i*(c*p-m*d)-h*(n*p-r*d)+f*(n*m-r*c),t[14]=-(i*(a*p-u*d)-o*(n*p-r*d)+f*(n*u-r*a)),t[15]=i*(a*m-u*c)-o*(n*m-r*c)+h*(n*u-r*a),t}function N(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],u=t[7],l=t[8],h=t[9],c=t[10],m=t[11],_=t[12],f=t[13],d=t[14],p=t[15];return(e*o-i*s)*(c*p-m*d)-(e*a-n*s)*(h*p-m*f)+(e*u-r*s)*(h*d-c*f)+(i*a-n*o)*(l*p-m*_)-(i*u-r*o)*(l*d-c*_)+(n*u-r*a)*(l*f-h*_)}function q(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=e[8],m=e[9],_=e[10],f=e[11],d=e[12],p=e[13],v=e[14],y=e[15],g=i[0],x=i[1],b=i[2],w=i[3];return t[0]=g*n+x*a+b*c+w*d,t[1]=g*r+x*u+b*m+w*p,t[2]=g*s+x*l+b*_+w*v,t[3]=g*o+x*h+b*f+w*y,g=i[4],x=i[5],b=i[6],w=i[7],t[4]=g*n+x*a+b*c+w*d,t[5]=g*r+x*u+b*m+w*p,t[6]=g*s+x*l+b*_+w*v,t[7]=g*o+x*h+b*f+w*y,g=i[8],x=i[9],b=i[10],w=i[11],t[8]=g*n+x*a+b*c+w*d,t[9]=g*r+x*u+b*m+w*p,t[10]=g*s+x*l+b*_+w*v,t[11]=g*o+x*h+b*f+w*y,g=i[12],x=i[13],b=i[14],w=i[15],t[12]=g*n+x*a+b*c+w*d,t[13]=g*r+x*u+b*m+w*p,t[14]=g*s+x*l+b*_+w*v,t[15]=g*o+x*h+b*f+w*y,t}function z(t,e,i){var n,r,s,o,a,u,l,h,c,m,_,f,d=i[0],p=i[1],v=i[2];return e===t?(t[12]=e[0]*d+e[4]*p+e[8]*v+e[12],t[13]=e[1]*d+e[5]*p+e[9]*v+e[13],t[14]=e[2]*d+e[6]*p+e[10]*v+e[14],t[15]=e[3]*d+e[7]*p+e[11]*v+e[15]):(n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=e[8],m=e[9],_=e[10],f=e[11],t[0]=n,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=l,t[7]=h,t[8]=c,t[9]=m,t[10]=_,t[11]=f,t[12]=n*d+a*p+c*v+e[12],t[13]=r*d+u*p+m*v+e[13],t[14]=s*d+l*p+_*v+e[14],t[15]=o*d+h*p+f*v+e[15]),t}function U(t,e,i){var n=i[0],r=i[1],s=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function J(t,e,i,n){var r,s,o,a,u,l,h,c,m,_,f,d,p,v,y,g,x,b,w,A,S,B,C,V,M=n[0],k=n[1],I=n[2],T=Math.hypot(M,k,I);return T<P?null:(M*=T=1/T,k*=T,I*=T,r=Math.sin(i),o=1-(s=Math.cos(i)),a=e[0],u=e[1],l=e[2],h=e[3],c=e[4],m=e[5],_=e[6],f=e[7],d=e[8],p=e[9],v=e[10],y=e[11],g=M*M*o+s,x=k*M*o+I*r,b=I*M*o-k*r,w=M*k*o-I*r,A=k*k*o+s,S=I*k*o+M*r,B=M*I*o+k*r,C=k*I*o-M*r,V=I*I*o+s,t[0]=a*g+c*x+d*b,t[1]=u*g+m*x+p*b,t[2]=l*g+_*x+v*b,t[3]=h*g+f*x+y*b,t[4]=a*w+c*A+d*S,t[5]=u*w+m*A+p*S,t[6]=l*w+_*A+v*S,t[7]=h*w+f*A+y*S,t[8]=a*B+c*C+d*V,t[9]=u*B+m*C+p*V,t[10]=l*B+_*C+v*V,t[11]=h*B+f*C+y*V,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function X(t,e,i){var n=Math.sin(i),r=Math.cos(i),s=e[4],o=e[5],a=e[6],u=e[7],l=e[8],h=e[9],c=e[10],m=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+l*n,t[5]=o*r+h*n,t[6]=a*r+c*n,t[7]=u*r+m*n,t[8]=l*r-s*n,t[9]=h*r-o*n,t[10]=c*r-a*n,t[11]=m*r-u*n,t}function Y(t,e,i){var n=Math.sin(i),r=Math.cos(i),s=e[0],o=e[1],a=e[2],u=e[3],l=e[8],h=e[9],c=e[10],m=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-l*n,t[1]=o*r-h*n,t[2]=a*r-c*n,t[3]=u*r-m*n,t[8]=s*n+l*r,t[9]=o*n+h*r,t[10]=a*n+c*r,t[11]=u*n+m*r,t}function W(t,e,i){var n=Math.sin(i),r=Math.cos(i),s=e[0],o=e[1],a=e[2],u=e[3],l=e[4],h=e[5],c=e[6],m=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+l*n,t[1]=o*r+h*n,t[2]=a*r+c*n,t[3]=u*r+m*n,t[4]=l*r-s*n,t[5]=h*r-o*n,t[6]=c*r-a*n,t[7]=m*r-u*n,t}function Z(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function H(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Q(t,e,i){var n,r,s,o=i[0],a=i[1],u=i[2],l=Math.hypot(o,a,u);return l<P?null:(o*=l=1/l,a*=l,u*=l,n=Math.sin(e),s=1-(r=Math.cos(e)),t[0]=o*o*s+r,t[1]=a*o*s+u*n,t[2]=u*o*s-a*n,t[3]=0,t[4]=o*a*s-u*n,t[5]=a*a*s+r,t[6]=u*a*s+o*n,t[7]=0,t[8]=o*u*s+a*n,t[9]=a*u*s-o*n,t[10]=u*u*s+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function K(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function $(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function tt(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function et(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=n+n,u=r+r,l=s+s,h=n*a,c=n*u,m=n*l,_=r*u,f=r*l,d=s*l,p=o*a,v=o*u,y=o*l;return t[0]=1-(_+d),t[1]=c+y,t[2]=m-v,t[3]=0,t[4]=c-y,t[5]=1-(h+d),t[6]=f+p,t[7]=0,t[8]=m+v,t[9]=f-p,t[10]=1-(h+_),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function it(t,e){var i=new I(3),n=-e[0],r=-e[1],s=-e[2],o=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=n*n+r*r+s*s+o*o;return c>0?(i[0]=2*(a*o+h*n+u*s-l*r)/c,i[1]=2*(u*o+h*r+l*n-a*s)/c,i[2]=2*(l*o+h*s+a*r-u*n)/c):(i[0]=2*(a*o+h*n+u*s-l*r),i[1]=2*(u*o+h*r+l*n-a*s),i[2]=2*(l*o+h*s+a*r-u*n)),et(t,e,i),t}function nt(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function rt(t,e){var i=e[0],n=e[1],r=e[2],s=e[4],o=e[5],a=e[6],u=e[8],l=e[9],h=e[10];return t[0]=Math.hypot(i,n,r),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(u,l,h),t}function st(t,e){var i=new I(3);rt(i,e);var n=1/i[0],r=1/i[1],s=1/i[2],o=e[0]*n,a=e[1]*r,u=e[2]*s,l=e[4]*n,h=e[5]*r,c=e[6]*s,m=e[8]*n,_=e[9]*r,f=e[10]*s,d=o+h+f,p=0;return d>0?(p=2*Math.sqrt(d+1),t[3]=.25*p,t[0]=(c-_)/p,t[1]=(m-u)/p,t[2]=(a-l)/p):o>h&&o>f?(p=2*Math.sqrt(1+o-h-f),t[3]=(c-_)/p,t[0]=.25*p,t[1]=(a+l)/p,t[2]=(m+u)/p):h>f?(p=2*Math.sqrt(1+h-o-f),t[3]=(m-u)/p,t[0]=(a+l)/p,t[1]=.25*p,t[2]=(c+_)/p):(p=2*Math.sqrt(1+f-o-h),t[3]=(a-l)/p,t[0]=(m+u)/p,t[1]=(c+_)/p,t[2]=.25*p),t}function ot(t,e,i,n){var r=e[0],s=e[1],o=e[2],a=e[3],u=r+r,l=s+s,h=o+o,c=r*u,m=r*l,_=r*h,f=s*l,d=s*h,p=o*h,v=a*u,y=a*l,g=a*h,x=n[0],b=n[1],w=n[2];return t[0]=(1-(f+p))*x,t[1]=(m+g)*x,t[2]=(_-y)*x,t[3]=0,t[4]=(m-g)*b,t[5]=(1-(c+p))*b,t[6]=(d+v)*b,t[7]=0,t[8]=(_+y)*w,t[9]=(d-v)*w,t[10]=(1-(c+f))*w,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function at(t,e,i,n,r){var s=e[0],o=e[1],a=e[2],u=e[3],l=s+s,h=o+o,c=a+a,m=s*l,_=s*h,f=s*c,d=o*h,p=o*c,v=a*c,y=u*l,g=u*h,x=u*c,b=n[0],w=n[1],A=n[2],S=r[0],B=r[1],C=r[2],V=(1-(d+v))*b,M=(_+x)*b,k=(f-g)*b,P=(_-x)*w,I=(1-(m+v))*w,T=(p+y)*w,D=(f+g)*A,G=(p-y)*A,R=(1-(m+d))*A;return t[0]=V,t[1]=M,t[2]=k,t[3]=0,t[4]=P,t[5]=I,t[6]=T,t[7]=0,t[8]=D,t[9]=G,t[10]=R,t[11]=0,t[12]=i[0]+S-(V*S+P*B+D*C),t[13]=i[1]+B-(M*S+I*B+G*C),t[14]=i[2]+C-(k*S+T*B+R*C),t[15]=1,t}function ut(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i+i,a=n+n,u=r+r,l=i*o,h=n*o,c=n*a,m=r*o,_=r*a,f=r*u,d=s*o,p=s*a,v=s*u;return t[0]=1-c-f,t[1]=h+v,t[2]=m-p,t[3]=0,t[4]=h-v,t[5]=1-l-f,t[6]=_+d,t[7]=0,t[8]=m+p,t[9]=_-d,t[10]=1-l-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lt(t,e,i,n,r,s,o){var a=1/(i-e),u=1/(r-n),l=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*u,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(r+n)*u,t[10]=(o+s)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*l,t[15]=0,t}function ht(t,e,i,n,r){var s,o=1/Math.tan(e/2);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(s=1/(n-r),t[10]=(r+n)*s,t[14]=2*r*n*s):(t[10]=-1,t[14]=-2*n),t}function ct(t,e,i,n){var r=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),u=2/(o+a),l=2/(r+s);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(o-a)*u*.5,t[9]=(r-s)*l*.5,t[10]=n/(i-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*i/(i-n),t[15]=0,t}function mt(t,e,i,n,r,s,o){var a=1/(e-i),u=1/(n-r),l=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+i)*a,t[13]=(r+n)*u,t[14]=(o+s)*l,t[15]=1,t}function _t(t,e,i,n){var r,s,o,a,u,l,h,c,m,_,f=e[0],d=e[1],p=e[2],v=n[0],y=n[1],g=n[2],x=i[0],b=i[1],w=i[2];return Math.abs(f-x)<P&&Math.abs(d-b)<P&&Math.abs(p-w)<P?F(t):(h=f-x,c=d-b,m=p-w,r=y*(m*=_=1/Math.hypot(h,c,m))-g*(c*=_),s=g*(h*=_)-v*m,o=v*c-y*h,(_=Math.hypot(r,s,o))?(r*=_=1/_,s*=_,o*=_):(r=0,s=0,o=0),a=c*o-m*s,u=m*r-h*o,l=h*s-c*r,(_=Math.hypot(a,u,l))?(a*=_=1/_,u*=_,l*=_):(a=0,u=0,l=0),t[0]=r,t[1]=a,t[2]=h,t[3]=0,t[4]=s,t[5]=u,t[6]=c,t[7]=0,t[8]=o,t[9]=l,t[10]=m,t[11]=0,t[12]=-(r*f+s*d+o*p),t[13]=-(a*f+u*d+l*p),t[14]=-(h*f+c*d+m*p),t[15]=1,t)}function ft(t,e,i,n){var r=e[0],s=e[1],o=e[2],a=n[0],u=n[1],l=n[2],h=r-i[0],c=s-i[1],m=o-i[2],_=h*h+c*c+m*m;_>0&&(h*=_=1/Math.sqrt(_),c*=_,m*=_);var f=u*m-l*c,d=l*h-a*m,p=a*c-u*h;return(_=f*f+d*d+p*p)>0&&(f*=_=1/Math.sqrt(_),d*=_,p*=_),t[0]=f,t[1]=d,t[2]=p,t[3]=0,t[4]=c*p-m*d,t[5]=m*f-h*p,t[6]=h*d-c*f,t[7]=0,t[8]=h,t[9]=c,t[10]=m,t[11]=0,t[12]=r,t[13]=s,t[14]=o,t[15]=1,t}function dt(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function pt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function vt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function yt(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function gt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function xt(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t[9]=e[9]+i[9]*n,t[10]=e[10]+i[10]*n,t[11]=e[11]+i[11]*n,t[12]=e[12]+i[12]*n,t[13]=e[13]+i[13]*n,t[14]=e[14]+i[14]*n,t[15]=e[15]+i[15]*n,t}function bt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function wt(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],u=t[6],l=t[7],h=t[8],c=t[9],m=t[10],_=t[11],f=t[12],d=t[13],p=t[14],v=t[15],y=e[0],g=e[1],x=e[2],b=e[3],w=e[4],A=e[5],S=e[6],B=e[7],C=e[8],V=e[9],M=e[10],k=e[11],I=e[12],T=e[13],D=e[14],G=e[15];return Math.abs(i-y)<=P*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(n-g)<=P*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(r-x)<=P*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(s-b)<=P*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(o-w)<=P*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(a-A)<=P*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(u-S)<=P*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(l-B)<=P*Math.max(1,Math.abs(l),Math.abs(B))&&Math.abs(h-C)<=P*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(c-V)<=P*Math.max(1,Math.abs(c),Math.abs(V))&&Math.abs(m-M)<=P*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(_-k)<=P*Math.max(1,Math.abs(_),Math.abs(k))&&Math.abs(f-I)<=P*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(d-T)<=P*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(p-D)<=P*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(v-G)<=P*Math.max(1,Math.abs(v),Math.abs(G))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var At=q,St=yt,Bt=function(){function t(e,i){Object(l.a)(this,t),this.x=e,this.y=i}return Object(h.a)(t,[{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"setVector",value:function(t){return this.set(t.x,t.y)}},{key:"add",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"addVector",value:function(t){return this.add(t.x,t.y)}},{key:"sub",value:function(t,e){return this.add(-t,-e)}},{key:"subVector",value:function(t){return this.sub(t.x,t.y)}},{key:"scale",value:function(t){return this.x*=t,this.y*=t,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"distanceSqr",value:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSqr(t))}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"len2",value:function(){return this.x*this.x+this.y*this.y}},{key:"len",value:function(){return Math.sqrt(this.len2())}},{key:"nor",value:function(){var t=this.len();return 0!==t&&(this.x/=t,this.y/=t),this}},{key:"rotateRad",value:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.x*e-this.y*i,r=this.x*i+this.y*e;return this.x=n,this.y=r,this}},{key:"rotate",value:function(t){return this.rotateRad(t*Math.PI/180)}},{key:"cpy",value:function(){return new t(this.x,this.y)}}]),t}(),Ct=function(t,e,i,r){var s=n.create(),o=n.create(),a=n.create(),u=n.create(),l=n.create(),h=new Bt(0,0),c=[0,0,0],m=[0,0,1],_=[0,0,0],f=[0,1,0],d=function(){n.ortho(s,0,t,e,0,0,1);var i=h.x,r=h.y;m[0]=_[0]=i,m[1]=_[1]=r,n.identity(o),n.lookAt(l,m,_,f),n.mul(o,o,l),n.mul(o,o,u),n.mul(s,s,o),n.invert(a,s)};return d(),{combined:s,getPosition:function(){return h},zoomTo:function(t,e,i){n.translate(u,u,[t,e,0]),n.scale(u,u,[i,i,1]),n.translate(u,u,[-t,-e,0]),d()},setMatrix:function(t){n.copy(s,t),n.invert(a,s)},setYUp:function(t){f[1]=t?-1:1,d()},setPosition:function(t,e){h.set(t,e),d()},unprojectVector2:function(t,e){c[0]=e.x,c[1]=e.y,c[2]=0,k(c,c,a,0,0,i,r),t.set(c[0],c[1])},resize:function(n,s,o,a){t=n,e=s,o&&(i=o),a&&(r=a),d()}}},Vt=function(t,e){var i=e||window.devicePixelRatio||1,n=t.clientWidth*i,r=t.clientHeight*i;return t.width===n&&t.height===r||(t.width=n,t.height=r),[n,r]},Mt=(new Bt(0,0),new Bt(0,0),new Bt(0,0),i(11)),kt={autoUpdate:!0,pixelRatio:void 0,crop:!0},Pt=function(t,e,i,n){n=x(x({},kt),n);var r,s=t.getContext("webgl"),o=[],a=n,u=a.autoUpdate,l=a.pixelRatio,h=a.crop,c={pixelRatio:l=l||window.devicePixelRatio||1,x:0,y:0,width:e,height:i,worldWidth:e,worldHeight:i},m=p(Vt(t,l),2),_=m[0],f=m[1],d=Ct(e,i,_,f);u&&(r=function(t){v.update()},window.addEventListener("resize",r));var v={getViewportInfo:function(){return c},getCamera:function(){return d},addCamera:function(t){o.push(t)},getContext:function(){return s},getCanvas:function(){return t},update:function(){var n=p(Vt(t,l),2),r=n[0],a=n[1],u=e/i,m=r/a;if(h){var _,f;u<m?(f=a,_=a*u):(_=r,f=r/u);var v=(r-_)/2,y=(a-f)/2;c.x=v,c.y=y,c.width=_,c.height=f,s.viewport(v,y,_,f),d.resize(e,i,_,f);var g,x=Object(Mt.a)(o);try{for(x.s();!(g=x.n()).done;){g.value.resize(e,i,_,f)}}catch(M){x.e(M)}finally{x.f()}}else{var b,w,A,S;c.x=0,c.y=0,c.width=r,c.height=a,s.viewport(0,0,r,a),u<m?(A=-((b=(w=i)*m)-e)/2,S=0):(A=0,S=-((w=(b=e)/m)-i)/2),d.resize(b,w,r,a),d.setPosition(A,S);var B,C=Object(Mt.a)(o);try{for(C.s();!(B=C.n()).done;){var V=B.value;V.resize(b,w,r,a),V.setPosition(A,S)}}catch(M){C.e(M)}finally{C.f()}}},cleanUp:function(){r&&window.removeEventListener("resize",r)}};return u&&v.update(),v},It=function(t,e){var i=new m(t),n=new Bt,r=new Bt;return{isTouched:function(){return i.isTouched()},cleanup:function(){i.cleanup()},addEventListener:function(t,n){i.addEventListener(t,function(t,e){return function(i,n,r){var s=e.getViewportInfo(),o=s.x,a=s.y,u=s.pixelRatio;t(i=i*u-o,n=n*u-a,r)}}(n,e))},getX:function(){var t=e.getViewportInfo(),n=t.x,r=t.pixelRatio;return i.getX()*r-n},getY:function(){var t=e.getViewportInfo(),n=t.y,r=t.pixelRatio;return i.getY()*r-n},getTouchedWorldCoord:function(){return n.set(this.getX(),this.getY()),e.getCamera().unprojectVector2(r,n),r}}},Tt=i(31),Dt=i.n(Tt),Gt={hidden:!1,info:!0},Rt=function(t){t=x(x({},Gt),t);var e=document.createElement("div");e.style="position:fixed;top:0;left:0;right:0;bottom:0;",t.hidden&&(e.style.display="none");var i=document.createElement("canvas");i.style="width:100%;height:100%;";var n=document.createElement("div");return n.style="position:absolute;top:1em;left:1em;color:white",t.info||(n.style.display="none"),e.appendChild(i),e.appendChild(n),document.body.appendChild(e),{getCanvas:function(){return i},getInfo:function(){return n},show:function(){return e.style.display="block"},hide:function(){return e.style.display="none"},cleanup:function(){return document.body.removeChild(e)}}};i(18)},function(t,e,i){"use strict";function n(t){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}i.d(e,"a",(function(){return a}));var s=i(1);function o(t,e){return!e||"object"!==r(e)&&"function"!==typeof e?Object(s.a)(t):e}function a(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r=n(t);if(e){var s=n(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return o(this,i)}}},function(t,e,i){"use strict";function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function r(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}i.d(e,"a",(function(){return r}))},function(t,e,i){t.exports=i(49)},function(t,e,i){var n=i(34),r=i(22),s=i(24),o=i(25),a=i(14),u=i(16),l=i(79);!function(t){"use strict";function e(t){if(!t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];throw l(Error,i)}}function i(t,e){return void 0!==t?t:e}var h=1e37,c=1e-5,m=c*c,_=3.14159265359,f=2,d=8,p=.1,v=2,y=.008,g=2/180*_,x=2*y,b=8,w=32,A=1,S=.2,B=8/180*_,C=2,V=C*C,M=.5*_,k=M*M,P=.2,I=.75,T=-1,D=2147483647,G=.75,R=1,E=.25,F=.5,L=2,j=L*L,O=256,N=2.5,q=.5,z=.01,U=2/180*_;function J(t){return null}function X(t){}function Y(t){}var W=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;a(this,t),this.major=0,this.minor=0,this.revision=0,this.major=e,this.minor=i,this.revision=n}return u(t,[{key:"toString",value:function(){return this.major+"."+this.minor+"."+this.revision}}]),t}(),Z=new W(2,3,2),H="master",Q="fbf51801d80fc389d43dc46524520e89043b6faf";function K(t){return parseInt(t,10)}function $(t){return Math.abs(parseInt(t,10))}function tt(t,e){for(var i=[],n=0;n<t;++n)i.push(e(n));return i}function et(t){for(var e=[],i=0;i<t;++i)e.push(null);return e}function it(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=[],n=0;n<t;++n)i.push(e);return i}var nt=_/180,rt=180/_,st=2*_,ot=Math.abs,at=Math.min,ut=Math.max;function lt(t,e,i){return t<e?e:t>i?i:t}function ht(t,e){var i=t[0];t[0]=e[0],e[0]=i}var ct=isFinite;function mt(t){return t*t}function _t(t){return 1/Math.sqrt(t)}var ft=Math.sqrt,dt=Math.pow;function pt(t){return t*nt}function vt(t){return t*rt}var yt=Math.cos,gt=Math.sin,xt=Math.acos,bt=Math.asin,wt=Math.atan2;function At(t){return t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,1+(t|=t>>16&65535)}function St(t){return t>0&&0===(t&t-1)}function Bt(){return 2*Math.random()-1}function Ct(t,e){return(e-t)*Math.random()+t}var Vt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;a(this,t),this.x=e,this.y=i}return u(t,[{key:"Clone",value:function(){return new t(this.x,this.y)}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this}},{key:"Set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"Copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"SelfAddXY",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"SelfSubXY",value:function(t,e){return this.x-=t,this.y-=e,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this}},{key:"SelfMulAdd",value:function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}},{key:"SelfMulSub",value:function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}},{key:"Dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"Cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"Length",value:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}},{key:"LengthSquared",value:function(){var t=this.x,e=this.y;return t*t+e*e}},{key:"Normalize",value:function(){var t=this.Length();if(t>=c){var e=1/t;this.x*=e,this.y*=e}return t}},{key:"SelfNormalize",value:function(){var t=this.Length();if(t>=c){var e=1/t;this.x*=e,this.y*=e}return this}},{key:"SelfRotate",value:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.x;return this.x=e*n-i*this.y,this.y=i*n+e*this.y,this}},{key:"IsValid",value:function(){return isFinite(this.x)&&isFinite(this.y)}},{key:"SelfCrossVS",value:function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this}},{key:"SelfCrossSV",value:function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this}},{key:"SelfMinV",value:function(t){return this.x=at(this.x,t.x),this.y=at(this.y,t.y),this}},{key:"SelfMaxV",value:function(t){return this.x=ut(this.x,t.x),this.y=ut(this.y,t.y),this}},{key:"SelfAbs",value:function(){return this.x=ot(this.x),this.y=ot(this.y),this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"SelfSkew",value:function(){var t=this.x;return this.x=-this.y,this.y=t,this}}],[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}},{key:"AbsV",value:function(t,e){return e.x=ot(t.x),e.y=ot(t.y),e}},{key:"MinV",value:function(t,e,i){return i.x=at(t.x,e.x),i.y=at(t.y,e.y),i}},{key:"MaxV",value:function(t,e,i){return i.x=ut(t.x,e.x),i.y=ut(t.y,e.y),i}},{key:"ClampV",value:function(t,e,i,n){return n.x=lt(t.x,e.x,i.x),n.y=lt(t.y,e.y,i.y),n}},{key:"RotateV",value:function(t,e,i){var n=t.x,r=t.y,s=Math.cos(e),o=Math.sin(e);return i.x=s*n-o*r,i.y=o*n+s*r,i}},{key:"DotVV",value:function(t,e){return t.x*e.x+t.y*e.y}},{key:"CrossVV",value:function(t,e){return t.x*e.y-t.y*e.x}},{key:"CrossVS",value:function(t,e,i){var n=t.x;return i.x=e*t.y,i.y=-e*n,i}},{key:"CrossVOne",value:function(t,e){var i=t.x;return e.x=t.y,e.y=-i,e}},{key:"CrossSV",value:function(t,e,i){var n=e.x;return i.x=-t*e.y,i.y=t*n,i}},{key:"CrossOneV",value:function(t,e){var i=t.x;return e.x=-t.y,e.y=i,e}},{key:"AddVV",value:function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i}},{key:"SubVV",value:function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i}},{key:"MulSV",value:function(t,e,i){return i.x=e.x*t,i.y=e.y*t,i}},{key:"MulVS",value:function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i}},{key:"AddVMulSV",value:function(t,e,i,n){return n.x=t.x+e*i.x,n.y=t.y+e*i.y,n}},{key:"SubVMulSV",value:function(t,e,i,n){return n.x=t.x-e*i.x,n.y=t.y-e*i.y,n}},{key:"AddVCrossSV",value:function(t,e,i,n){var r=i.x;return n.x=t.x-e*i.y,n.y=t.y+e*r,n}},{key:"MidVV",value:function(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i}},{key:"ExtVV",value:function(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i}},{key:"IsEqualToV",value:function(t,e){return t.x===e.x&&t.y===e.y}},{key:"DistanceVV",value:function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}},{key:"DistanceSquaredVV",value:function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n}},{key:"NegV",value:function(t,e){return e.x=-t.x,e.y=-t.y,e}}]),t}();Vt.ZERO=new Vt(0,0),Vt.UNITX=new Vt(1,0),Vt.UNITY=new Vt(0,1),Vt.s_t0=new Vt,Vt.s_t1=new Vt,Vt.s_t2=new Vt,Vt.s_t3=new Vt;var Mt=new Vt(0,0),kt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;a(this,t),this.x=e,this.y=i,this.z=n}return u(t,[{key:"Clone",value:function(){return new t(this.x,this.y,this.z)}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this.z=0,this}},{key:"SetXYZ",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"Copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"SelfAddXYZ",value:function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"SelfSubXYZ",value:function(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}}],[{key:"DotV3V3",value:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}},{key:"CrossV3V3",value:function(t,e,i){var n=t.x,r=t.y,s=t.z,o=e.x,a=e.y,u=e.z;return i.x=r*u-s*a,i.y=s*o-n*u,i.z=n*a-r*o,i}}]),t}();kt.ZERO=new kt(0,0,0),kt.s_t0=new kt;var Pt=function(){function t(){a(this,t),this.ex=new Vt(1,0),this.ey=new Vt(0,1)}return u(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"SetSSSS",value:function(t,e,i,n){return this.ex.Set(t,i),this.ey.Set(e,n),this}},{key:"SetVV",value:function(t,e){return this.ex.Copy(t),this.ey.Copy(e),this}},{key:"SetAngle",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.ex.Set(e,i),this.ey.Set(-i,e),this}},{key:"Copy",value:function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this}},{key:"SetIdentity",value:function(){return this.ex.Set(1,0),this.ey.Set(0,1),this}},{key:"SetZero",value:function(){return this.ex.SetZero(),this.ey.SetZero(),this}},{key:"GetAngle",value:function(){return Math.atan2(this.ex.y,this.ex.x)}},{key:"GetInverse",value:function(t){var e=this.ex.x,i=this.ey.x,n=this.ex.y,r=this.ey.y,s=e*r-i*n;return 0!==s&&(s=1/s),t.ex.x=s*r,t.ey.x=-s*i,t.ex.y=-s*n,t.ey.y=s*e,t}},{key:"Solve",value:function(t,e,i){var n=this.ex.x,r=this.ey.x,s=this.ex.y,o=this.ey.y,a=n*o-r*s;return 0!==a&&(a=1/a),i.x=a*(o*t-r*e),i.y=a*(n*e-s*t),i}},{key:"SelfAbs",value:function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this}},{key:"SelfInv",value:function(){return this.GetInverse(this),this}},{key:"SelfAddM",value:function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this}},{key:"SelfSubM",value:function(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this}}],[{key:"FromVV",value:function(e,i){return(new t).SetVV(e,i)}},{key:"FromSSSS",value:function(e,i,n,r){return(new t).SetSSSS(e,i,n,r)}},{key:"FromAngle",value:function(e){return(new t).SetAngle(e)}},{key:"AbsM",value:function(t,e){var i=t.ex,n=t.ey;return e.ex.x=ot(i.x),e.ex.y=ot(i.y),e.ey.x=ot(n.x),e.ey.y=ot(n.y),e}},{key:"MulMV",value:function(t,e,i){var n=t.ex,r=t.ey,s=e.x,o=e.y;return i.x=n.x*s+r.x*o,i.y=n.y*s+r.y*o,i}},{key:"MulTMV",value:function(t,e,i){var n=t.ex,r=t.ey,s=e.x,o=e.y;return i.x=n.x*s+n.y*o,i.y=r.x*s+r.y*o,i}},{key:"AddMM",value:function(t,e,i){var n=t.ex,r=t.ey,s=e.ex,o=e.ey;return i.ex.x=n.x+s.x,i.ex.y=n.y+s.y,i.ey.x=r.x+o.x,i.ey.y=r.y+o.y,i}},{key:"MulMM",value:function(t,e,i){var n=t.ex.x,r=t.ex.y,s=t.ey.x,o=t.ey.y,a=e.ex.x,u=e.ex.y,l=e.ey.x,h=e.ey.y;return i.ex.x=n*a+s*u,i.ex.y=r*a+o*u,i.ey.x=n*l+s*h,i.ey.y=r*l+o*h,i}},{key:"MulTMM",value:function(t,e,i){var n=t.ex.x,r=t.ex.y,s=t.ey.x,o=t.ey.y,a=e.ex.x,u=e.ex.y,l=e.ey.x,h=e.ey.y;return i.ex.x=n*a+r*u,i.ex.y=s*a+o*u,i.ey.x=n*l+r*h,i.ey.y=s*l+o*h,i}}]),t}();Pt.IDENTITY=new Pt;var It=function(){function t(){a(this,t),this.ex=new kt(1,0,0),this.ey=new kt(0,1,0),this.ez=new kt(0,0,1)}return u(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"SetVVV",value:function(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this}},{key:"Copy",value:function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this}},{key:"SetIdentity",value:function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this}},{key:"SetZero",value:function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}},{key:"SelfAddM",value:function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this}},{key:"Solve33",value:function(t,e,i,n){var r=this.ex.x,s=this.ex.y,o=this.ex.z,a=this.ey.x,u=this.ey.y,l=this.ey.z,h=this.ez.x,c=this.ez.y,m=this.ez.z,_=r*(u*m-l*c)+s*(l*h-a*m)+o*(a*c-u*h);return 0!==_&&(_=1/_),n.x=_*(t*(u*m-l*c)+e*(l*h-a*m)+i*(a*c-u*h)),n.y=_*(r*(e*m-i*c)+s*(i*h-t*m)+o*(t*c-e*h)),n.z=_*(r*(u*i-l*e)+s*(l*t-a*i)+o*(a*e-u*t)),n}},{key:"Solve22",value:function(t,e,i){var n=this.ex.x,r=this.ey.x,s=this.ex.y,o=this.ey.y,a=n*o-r*s;return 0!==a&&(a=1/a),i.x=a*(o*t-r*e),i.y=a*(n*e-s*t),i}},{key:"GetInverse22",value:function(t){var e=this.ex.x,i=this.ey.x,n=this.ex.y,r=this.ey.y,s=e*r-i*n;0!==s&&(s=1/s),t.ex.x=s*r,t.ey.x=-s*i,t.ex.z=0,t.ex.y=-s*n,t.ey.y=s*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}},{key:"GetSymInverse33",value:function(t){var e=kt.DotV3V3(this.ex,kt.CrossV3V3(this.ey,this.ez,kt.s_t0));0!==e&&(e=1/e);var i=this.ex.x,n=this.ey.x,r=this.ez.x,s=this.ey.y,o=this.ez.y,a=this.ez.z;t.ex.x=e*(s*a-o*o),t.ex.y=e*(r*o-n*a),t.ex.z=e*(n*o-r*s),t.ey.x=t.ex.y,t.ey.y=e*(i*a-r*r),t.ey.z=e*(r*n-i*o),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*s-n*n)}}],[{key:"MulM33V3",value:function(t,e,i){var n=e.x,r=e.y,s=e.z;return i.x=t.ex.x*n+t.ey.x*r+t.ez.x*s,i.y=t.ex.y*n+t.ey.y*r+t.ez.y*s,i.z=t.ex.z*n+t.ey.z*r+t.ez.z*s,i}},{key:"MulM33XYZ",value:function(t,e,i,n,r){return r.x=t.ex.x*e+t.ey.x*i+t.ez.x*n,r.y=t.ex.y*e+t.ey.y*i+t.ez.y*n,r.z=t.ex.z*e+t.ey.z*i+t.ez.z*n,r}},{key:"MulM33V2",value:function(t,e,i){var n=e.x,r=e.y;return i.x=t.ex.x*n+t.ey.x*r,i.y=t.ex.y*n+t.ey.y*r,i}},{key:"MulM33XY",value:function(t,e,i,n){return n.x=t.ex.x*e+t.ey.x*i,n.y=t.ex.y*e+t.ey.y*i,n}}]),t}();It.IDENTITY=new It;var Tt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;a(this,t),this.s=0,this.c=1,e&&(this.s=Math.sin(e),this.c=Math.cos(e))}return u(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.s=t.s,this.c=t.c,this}},{key:"SetAngle",value:function(t){return this.s=Math.sin(t),this.c=Math.cos(t),this}},{key:"SetIdentity",value:function(){return this.s=0,this.c=1,this}},{key:"GetAngle",value:function(){return Math.atan2(this.s,this.c)}},{key:"GetXAxis",value:function(t){return t.x=this.c,t.y=this.s,t}},{key:"GetYAxis",value:function(t){return t.x=-this.s,t.y=this.c,t}}],[{key:"MulRR",value:function(t,e,i){var n=t.c,r=t.s,s=e.c,o=e.s;return i.s=r*s+n*o,i.c=n*s-r*o,i}},{key:"MulTRR",value:function(t,e,i){var n=t.c,r=t.s,s=e.c,o=e.s;return i.s=n*o-r*s,i.c=n*s+r*o,i}},{key:"MulRV",value:function(t,e,i){var n=t.c,r=t.s,s=e.x,o=e.y;return i.x=n*s-r*o,i.y=r*s+n*o,i}},{key:"MulTRV",value:function(t,e,i){var n=t.c,r=t.s,s=e.x,o=e.y;return i.x=n*s+r*o,i.y=-r*s+n*o,i}}]),t}();Tt.IDENTITY=new Tt;var Dt=function(){function t(){a(this,t),this.p=new Vt,this.q=new Tt}return u(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.p.Copy(t.p),this.q.Copy(t.q),this}},{key:"SetIdentity",value:function(){return this.p.SetZero(),this.q.SetIdentity(),this}},{key:"SetPositionRotation",value:function(t,e){return this.p.Copy(t),this.q.Copy(e),this}},{key:"SetPositionAngle",value:function(t,e){return this.p.Copy(t),this.q.SetAngle(e),this}},{key:"SetPosition",value:function(t){return this.p.Copy(t),this}},{key:"SetPositionXY",value:function(t,e){return this.p.Set(t,e),this}},{key:"SetRotation",value:function(t){return this.q.Copy(t),this}},{key:"SetRotationAngle",value:function(t){return this.q.SetAngle(t),this}},{key:"GetPosition",value:function(){return this.p}},{key:"GetRotation",value:function(){return this.q}},{key:"GetRotationAngle",value:function(){return this.q.GetAngle()}},{key:"GetAngle",value:function(){return this.q.GetAngle()}}],[{key:"MulXV",value:function(t,e,i){var n=t.q.c,r=t.q.s,s=e.x,o=e.y;return i.x=n*s-r*o+t.p.x,i.y=r*s+n*o+t.p.y,i}},{key:"MulTXV",value:function(t,e,i){var n=t.q.c,r=t.q.s,s=e.x-t.p.x,o=e.y-t.p.y;return i.x=n*s+r*o,i.y=-r*s+n*o,i}},{key:"MulXX",value:function(t,e,i){return Tt.MulRR(t.q,e.q,i.q),Vt.AddVV(Tt.MulRV(t.q,e.p,i.p),t.p,i.p),i}},{key:"MulTXX",value:function(t,e,i){return Tt.MulTRR(t.q,e.q,i.q),Tt.MulTRV(t.q,Vt.SubVV(e.p,t.p,i.p),i.p),i}}]),t}();Dt.IDENTITY=new Dt;var Gt,Rt=function(){function t(){a(this,t),this.localCenter=new Vt,this.c0=new Vt,this.c=new Vt,this.a0=0,this.a=0,this.alpha0=0}return u(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this}},{key:"GetTransform",value:function(t,e){var i=1-e;t.p.x=i*this.c0.x+e*this.c.x,t.p.y=i*this.c0.y+e*this.c.y;var n=i*this.a0+e*this.a;return t.q.SetAngle(n),t.p.SelfSub(Tt.MulRV(t.q,this.localCenter,Vt.s_t0)),t}},{key:"Advance",value:function(t){var e=(t-this.alpha0)/(1-this.alpha0),i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t}},{key:"Normalize",value:function(){var t=st*Math.floor(this.a0/st);this.a0-=t,this.a-=t}}]),t}(),Et=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;a(this,t),this.r=e,this.g=i,this.b=n,this.a=r}return u(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"IsEqual",value:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}},{key:"IsZero",value:function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}},{key:"Set",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.a;this.SetRGBA(t,e,i,n)}},{key:"SetByteRGB",value:function(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this}},{key:"SetByteRGBA",value:function(t,e,i,n){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=n/255,this}},{key:"SetRGB",value:function(t,e,i){return this.r=t,this.g=e,this.b=i,this}},{key:"SetRGBA",value:function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this}},{key:"SelfAdd",value:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}},{key:"Add",value:function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e}},{key:"SelfSub",value:function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}},{key:"Sub",value:function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e}},{key:"SelfMul",value:function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}},{key:"Mul",value:function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e}},{key:"Mix",value:function(e,i){t.MixColors(this,e,i)}},{key:"MakeStyleString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.a;return t.MakeStyleString(this.r,this.g,this.b,e)}}],[{key:"MixColors",value:function(t,e,i){var n=i*(e.r-t.r),r=i*(e.g-t.g),s=i*(e.b-t.b),o=i*(e.a-t.a);t.r+=n,t.g+=r,t.b+=s,t.a+=o,e.r-=n,e.g-=r,e.b-=s,e.a-=o}},{key:"MakeStyleString",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return t*=255,e*=255,i*=255,n<1?"rgba(".concat(t,",").concat(e,",").concat(i,",").concat(n,")"):"rgb(".concat(t,",").concat(e,",").concat(i,")")}}]),t}();Et.ZERO=new Et(0,0,0,0),Et.RED=new Et(1,0,0),Et.GREEN=new Et(0,1,0),Et.BLUE=new Et(0,0,1),(Gt=t.b2DrawFlags||(t.b2DrawFlags={}))[Gt.e_none=0]="e_none",Gt[Gt.e_shapeBit=1]="e_shapeBit",Gt[Gt.e_jointBit=2]="e_jointBit",Gt[Gt.e_aabbBit=4]="e_aabbBit",Gt[Gt.e_pairBit=8]="e_pairBit",Gt[Gt.e_centerOfMassBit=16]="e_centerOfMassBit",Gt[Gt.e_particleBit=32]="e_particleBit",Gt[Gt.e_controllerBit=64]="e_controllerBit",Gt[Gt.e_all=63]="e_all";var Ft=function(){function t(){a(this,t),this.m_drawFlags=0}return u(t,[{key:"SetFlags",value:function(t){this.m_drawFlags=t}},{key:"GetFlags",value:function(){return this.m_drawFlags}},{key:"AppendFlags",value:function(t){this.m_drawFlags|=t}},{key:"ClearFlags",value:function(t){this.m_drawFlags&=~t}}]),t}(),Lt=function(){function t(){a(this,t),this.m_start=Date.now()}return u(t,[{key:"Reset",value:function(){return this.m_start=Date.now(),this}},{key:"GetMilliseconds",value:function(){return Date.now()-this.m_start}}]),t}(),jt=function(){function t(){a(this,t),this.m_count=0,this.m_min_count=0,this.m_max_count=0}return u(t,[{key:"GetCount",value:function(){return this.m_count}},{key:"GetMinCount",value:function(){return this.m_min_count}},{key:"GetMaxCount",value:function(){return this.m_max_count}},{key:"ResetCount",value:function(){var t=this.m_count;return this.m_count=0,t}},{key:"ResetMinCount",value:function(){this.m_min_count=0}},{key:"ResetMaxCount",value:function(){this.m_max_count=0}},{key:"Increment",value:function(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)}},{key:"Decrement",value:function(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)}}]),t}(),Ot=function(){function t(e){a(this,t),this.m_stack=[],this.m_count=0,this.m_stack=tt(e,(function(t){return null})),this.m_count=0}return u(t,[{key:"Reset",value:function(){return this.m_count=0,this}},{key:"Push",value:function(t){this.m_stack[this.m_count]=t,this.m_count++}},{key:"Pop",value:function(){this.m_count--;var t=this.m_stack[this.m_count];if(this.m_stack[this.m_count]=null,null===t)throw new Error;return t}},{key:"GetCount",value:function(){return this.m_count}}]),t}(),Nt=function t(){a(this,t)},qt=function t(){a(this,t)},zt=function(){function t(){a(this,t),this.m_buffer=Vt.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}return u(t,[{key:"Copy",value:function(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this}},{key:"Reset",value:function(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}},{key:"SetShape",value:function(t,e){t.SetupDistanceProxy(this,e)}},{key:"SetVerticesRadius",value:function(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i}},{key:"GetSupport",value:function(t){for(var e=0,i=Vt.DotVV(this.m_vertices[0],t),n=1;n<this.m_count;++n){var r=Vt.DotVV(this.m_vertices[n],t);r>i&&(e=n,i=r)}return e}},{key:"GetSupportVertex",value:function(t){for(var e=0,i=Vt.DotVV(this.m_vertices[0],t),n=1;n<this.m_count;++n){var r=Vt.DotVV(this.m_vertices[n],t);r>i&&(e=n,i=r)}return this.m_vertices[e]}},{key:"GetVertexCount",value:function(){return this.m_count}},{key:"GetVertex",value:function(t){return this.m_vertices[t]}}]),t}(),Ut=function(){function t(){a(this,t),this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}return u(t,[{key:"Reset",value:function(){return this.metric=0,this.count=0,this}}]),t}(),Jt=function(){function t(){a(this,t),this.proxyA=new zt,this.proxyB=new zt,this.transformA=new Dt,this.transformB=new Dt,this.useRadii=!1}return u(t,[{key:"Reset",value:function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}}]),t}(),Xt=function(){function t(){a(this,t),this.pointA=new Vt,this.pointB=new Vt,this.distance=0,this.iterations=0}return u(t,[{key:"Reset",value:function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}}]),t}(),Yt=function t(){a(this,t),this.proxyA=new zt,this.proxyB=new zt,this.transformA=new Dt,this.transformB=new Dt,this.translationB=new Vt},Wt=function t(){a(this,t),this.point=new Vt,this.normal=new Vt,this.lambda=0,this.iterations=0};function Zt(){t.b2_gjkCalls=0,t.b2_gjkIters=0,t.b2_gjkMaxIters=0}t.b2_gjkCalls=0,t.b2_gjkIters=0,t.b2_gjkMaxIters=0;var Ht=function(){function t(){a(this,t),this.wA=new Vt,this.wB=new Vt,this.w=new Vt,this.a=0,this.indexA=0,this.indexB=0}return u(t,[{key:"Copy",value:function(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this}}]),t}(),Qt=function(){function t(){a(this,t),this.m_v1=new Ht,this.m_v2=new Ht,this.m_v3=new Ht,this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}return u(t,[{key:"ReadCache",value:function(t,e,i,n,r){this.m_count=t.count;for(var s=this.m_vertices,o=0;o<this.m_count;++o){var a=s[o];a.indexA=t.indexA[o],a.indexB=t.indexB[o];var u=e.GetVertex(a.indexA),l=n.GetVertex(a.indexB);Dt.MulXV(i,u,a.wA),Dt.MulXV(r,l,a.wB),Vt.SubVV(a.wB,a.wA,a.w),a.a=0}if(this.m_count>1){var h=t.metric,m=this.GetMetric();(m<.5*h||2*h<m||m<c)&&(this.m_count=0)}if(0===this.m_count){var _=s[0];_.indexA=0,_.indexB=0;var f=e.GetVertex(0),d=n.GetVertex(0);Dt.MulXV(i,f,_.wA),Dt.MulXV(r,d,_.wB),Vt.SubVV(_.wB,_.wA,_.w),_.a=1,this.m_count=1}}},{key:"WriteCache",value:function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB}},{key:"GetSearchDirection",value:function(t){switch(this.m_count){case 1:return Vt.NegV(this.m_v1.w,t);case 2:var e=Vt.SubVV(this.m_v2.w,this.m_v1.w,t);return Vt.CrossVV(e,Vt.NegV(this.m_v1.w,Vt.s_t0))>0?Vt.CrossOneV(e,t):Vt.CrossVOne(e,t);default:return t.SetZero()}}},{key:"GetClosestPoint",value:function(t){switch(this.m_count){case 0:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:default:return t.SetZero()}}},{key:"GetWitnessPoints",value:function(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}}},{key:"GetMetric",value:function(){switch(this.m_count){case 0:case 1:return 0;case 2:return Vt.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return Vt.CrossVV(Vt.SubVV(this.m_v2.w,this.m_v1.w,Vt.s_t0),Vt.SubVV(this.m_v3.w,this.m_v1.w,Vt.s_t1));default:return 0}}},{key:"Solve2",value:function(){var e=this.m_v1.w,i=this.m_v2.w,n=Vt.SubVV(i,e,t.s_e12),r=-Vt.DotVV(e,n);if(r<=0)return this.m_v1.a=1,void(this.m_count=1);var s=Vt.DotVV(i,n);if(s<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);var o=1/(s+r);this.m_v1.a=s*o,this.m_v2.a=r*o,this.m_count=2}},{key:"Solve3",value:function(){var e=this.m_v1.w,i=this.m_v2.w,n=this.m_v3.w,r=Vt.SubVV(i,e,t.s_e12),s=Vt.DotVV(e,r),o=Vt.DotVV(i,r),a=-s,u=Vt.SubVV(n,e,t.s_e13),l=Vt.DotVV(e,u),h=Vt.DotVV(n,u),c=-l,m=Vt.SubVV(n,i,t.s_e23),_=Vt.DotVV(i,m),f=Vt.DotVV(n,m),d=-_,p=Vt.CrossVV(r,u),v=p*Vt.CrossVV(i,n),y=p*Vt.CrossVV(n,e),g=p*Vt.CrossVV(e,i);if(a<=0&&c<=0)return this.m_v1.a=1,void(this.m_count=1);if(o>0&&a>0&&g<=0){var x=1/(o+a);return this.m_v1.a=o*x,this.m_v2.a=a*x,void(this.m_count=2)}if(h>0&&c>0&&y<=0){var b=1/(h+c);return this.m_v1.a=h*b,this.m_v3.a=c*b,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(o<=0&&d<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(h<=0&&f<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(f>0&&d>0&&v<=0){var w=1/(f+d);return this.m_v2.a=f*w,this.m_v3.a=d*w,this.m_count=2,void this.m_v1.Copy(this.m_v3)}var A=1/(v+y+g);this.m_v1.a=v*A,this.m_v2.a=y*A,this.m_v3.a=g*A,this.m_count=3}}]),t}();Qt.s_e12=new Vt,Qt.s_e13=new Vt,Qt.s_e23=new Vt;var Kt=new Qt,$t=[0,0,0],te=[0,0,0],ee=new Vt,ie=new Vt,ne=new Vt,re=new Vt,se=new Vt;function oe(e,i,n){++t.b2_gjkCalls;var r=n.proxyA,s=n.proxyB,o=n.transformA,a=n.transformB,u=Kt;u.ReadCache(i,r,o,s,a);for(var l=u.m_vertices,h=20,_=$t,f=te,d=0,p=0;p<h;){d=u.m_count;for(var v=0;v<d;++v)_[v]=l[v].indexA,f[v]=l[v].indexB;switch(u.m_count){case 1:break;case 2:u.Solve2();break;case 3:u.Solve3()}if(3===u.m_count)break;var y=u.GetSearchDirection(ie);if(y.LengthSquared()<m)break;var g=l[u.m_count];g.indexA=r.GetSupport(Tt.MulTRV(o.q,Vt.NegV(y,Vt.s_t0),re)),Dt.MulXV(o,r.GetVertex(g.indexA),g.wA),g.indexB=s.GetSupport(Tt.MulTRV(a.q,y,se)),Dt.MulXV(a,s.GetVertex(g.indexB),g.wB),Vt.SubVV(g.wB,g.wA,g.w),++p,++t.b2_gjkIters;for(var x=!1,b=0;b<d;++b)if(g.indexA===_[b]&&g.indexB===f[b]){x=!0;break}if(x)break;++u.m_count}if(t.b2_gjkMaxIters=ut(t.b2_gjkMaxIters,p),u.GetWitnessPoints(e.pointA,e.pointB),e.distance=Vt.DistanceVV(e.pointA,e.pointB),e.iterations=p,u.WriteCache(i),n.useRadii){var w=r.m_radius,A=s.m_radius;if(e.distance>w+A&&e.distance>c){e.distance-=w+A;var S=Vt.SubVV(e.pointB,e.pointA,ne);S.Normalize(),e.pointA.SelfMulAdd(w,S),e.pointB.SelfMulSub(A,S)}else{var B=Vt.MidVV(e.pointA,e.pointB,ee);e.pointA.Copy(B),e.pointB.Copy(B),e.distance=0}}}var ae,ue=new Vt,le=new Qt,he=new Vt,ce=new Vt,me=new Vt,_e=new Vt,fe=new Vt,de=new Vt;function pe(t,e){t.iterations=0,t.lambda=1,t.normal.SetZero(),t.point.SetZero();var i=e.proxyA,n=e.proxyB,r=ut(i.m_radius,x)+ut(n.m_radius,x),s=e.transformA,o=e.transformB,a=e.translationB,u=ue.Set(0,0),l=0,h=le;h.m_count=0;for(var c=h.m_vertices,m=i.GetSupport(Tt.MulTRV(s.q,Vt.NegV(a,Vt.s_t1),Vt.s_t0)),_=Dt.MulXV(s,i.GetVertex(m),he),f=n.GetSupport(Tt.MulTRV(o.q,a,Vt.s_t0)),d=Dt.MulXV(o,n.GetVertex(f),ce),p=Vt.SubVV(_,d,me),v=ut(x,r-x),g=.5*y,b=20,w=0;w<b&&ot(p.Length()-v)>g;){t.iterations+=1,m=i.GetSupport(Tt.MulTRV(s.q,Vt.NegV(p,Vt.s_t1),Vt.s_t0)),_=Dt.MulXV(s,i.GetVertex(m),he),f=n.GetSupport(Tt.MulTRV(o.q,p,Vt.s_t0)),d=Dt.MulXV(o,n.GetVertex(f),ce);var A=Vt.SubVV(_,d,_e);p.Normalize();var S=Vt.DotVV(p,A),B=Vt.DotVV(p,a);if(S-v>l*B){if(B<=0)return!1;if((l=(S-v)/B)>1)return!1;u.Copy(p).SelfNeg(),h.m_count=0}var C=c[h.m_count];switch(C.indexA=f,C.wA.Copy(d).SelfMulAdd(l,a),C.indexB=m,C.wB.Copy(_),C.w.Copy(C.wB).SelfSub(C.wA),C.a=1,h.m_count+=1,h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3()}if(3===h.m_count)return!1;h.GetClosestPoint(p),++w}var V=fe,M=de;return h.GetWitnessPoints(V,M),p.LengthSquared()>0&&(u.Copy(p).SelfNeg(),u.Normalize()),t.normal.Copy(u),t.lambda=l,t.iterations=w,!0}(ae=t.b2ContactFeatureType||(t.b2ContactFeatureType={}))[ae.e_vertex=0]="e_vertex",ae[ae.e_face=1]="e_face";var ve,ye=function(){function t(){a(this,t),this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}return u(t,[{key:"key",get:function(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key},set:function(t){this._key=t,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255}},{key:"indexA",get:function(){return this._indexA},set:function(t){this._indexA=t,this._key_invalid=!0}},{key:"indexB",get:function(){return this._indexB},set:function(t){this._indexB=t,this._key_invalid=!0}},{key:"typeA",get:function(){return this._typeA},set:function(t){this._typeA=t,this._key_invalid=!0}},{key:"typeB",get:function(){return this._typeB},set:function(t){this._typeB=t,this._key_invalid=!0}}]),t}(),ge=function(){function t(){a(this,t),this.cf=new ye}return u(t,[{key:"Copy",value:function(t){return this.key=t.key,this}},{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"key",get:function(){return this.cf.key},set:function(t){this.cf.key=t}}]),t}(),xe=function(){function t(){a(this,t),this.localPoint=new Vt,this.normalImpulse=0,this.tangentImpulse=0,this.id=new ge}return u(t,[{key:"Reset",value:function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}},{key:"Copy",value:function(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}}],[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}();(ve=t.b2ManifoldType||(t.b2ManifoldType={}))[ve.e_unknown=-1]="e_unknown",ve[ve.e_circles=0]="e_circles",ve[ve.e_faceA=1]="e_faceA",ve[ve.e_faceB=2]="e_faceB";var be,we=function(){function e(){a(this,e),this.points=xe.MakeArray(f),this.localNormal=new Vt,this.localPoint=new Vt,this.type=t.b2ManifoldType.e_unknown,this.pointCount=0}return u(e,[{key:"Reset",value:function(){for(var e=0;e<f;++e)this.points[e].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=t.b2ManifoldType.e_unknown,this.pointCount=0}},{key:"Copy",value:function(t){this.pointCount=t.pointCount;for(var e=0;e<f;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}},{key:"Clone",value:function(){return(new e).Copy(this)}}]),e}(),Ae=function(){function e(){a(this,e),this.normal=new Vt,this.points=Vt.MakeArray(f),this.separations=it(f)}return u(e,[{key:"Initialize",value:function(i,n,r,s,o){if(0!==i.pointCount)switch(i.type){case t.b2ManifoldType.e_circles:this.normal.Set(1,0);var a=Dt.MulXV(n,i.localPoint,e.Initialize_s_pointA),u=Dt.MulXV(s,i.points[0].localPoint,e.Initialize_s_pointB);Vt.DistanceSquaredVV(a,u)>m&&Vt.SubVV(u,a,this.normal).SelfNormalize();var l=Vt.AddVMulSV(a,r,this.normal,e.Initialize_s_cA),h=Vt.SubVMulSV(u,o,this.normal,e.Initialize_s_cB);Vt.MidVV(l,h,this.points[0]),this.separations[0]=Vt.DotVV(Vt.SubVV(h,l,Vt.s_t0),this.normal);break;case t.b2ManifoldType.e_faceA:Tt.MulRV(n.q,i.localNormal,this.normal);for(var c=Dt.MulXV(n,i.localPoint,e.Initialize_s_planePoint),_=0;_<i.pointCount;++_){var f=Dt.MulXV(s,i.points[_].localPoint,e.Initialize_s_clipPoint),d=r-Vt.DotVV(Vt.SubVV(f,c,Vt.s_t0),this.normal),p=Vt.AddVMulSV(f,d,this.normal,e.Initialize_s_cA),v=Vt.SubVMulSV(f,o,this.normal,e.Initialize_s_cB);Vt.MidVV(p,v,this.points[_]),this.separations[_]=Vt.DotVV(Vt.SubVV(v,p,Vt.s_t0),this.normal)}break;case t.b2ManifoldType.e_faceB:Tt.MulRV(s.q,i.localNormal,this.normal);for(var y=Dt.MulXV(s,i.localPoint,e.Initialize_s_planePoint),g=0;g<i.pointCount;++g){var x=Dt.MulXV(n,i.points[g].localPoint,e.Initialize_s_clipPoint),b=o-Vt.DotVV(Vt.SubVV(x,y,Vt.s_t0),this.normal),w=Vt.AddVMulSV(x,b,this.normal,e.Initialize_s_cB),A=Vt.SubVMulSV(x,r,this.normal,e.Initialize_s_cA);Vt.MidVV(A,w,this.points[g]),this.separations[g]=Vt.DotVV(Vt.SubVV(A,w,Vt.s_t0),this.normal)}this.normal.SelfNeg()}}}]),e}();function Se(e,i,n,r){var s;for(s=0;s<n.pointCount;++s){var o=n.points[s].id.key;e[s]=t.b2PointState.b2_removeState;for(var a=0,u=r.pointCount;a<u;++a)if(r.points[a].id.key===o){e[s]=t.b2PointState.b2_persistState;break}}for(;s<f;++s)e[s]=t.b2PointState.b2_nullState;for(s=0;s<r.pointCount;++s){var l=r.points[s].id.key;i[s]=t.b2PointState.b2_addState;for(var h=0,c=n.pointCount;h<c;++h)if(n.points[h].id.key===l){i[s]=t.b2PointState.b2_persistState;break}}for(;s<f;++s)i[s]=t.b2PointState.b2_nullState}Ae.Initialize_s_pointA=new Vt,Ae.Initialize_s_pointB=new Vt,Ae.Initialize_s_cA=new Vt,Ae.Initialize_s_cB=new Vt,Ae.Initialize_s_planePoint=new Vt,Ae.Initialize_s_clipPoint=new Vt,(be=t.b2PointState||(t.b2PointState={}))[be.b2_nullState=0]="b2_nullState",be[be.b2_addState=1]="b2_addState",be[be.b2_persistState=2]="b2_persistState",be[be.b2_removeState=3]="b2_removeState";var Be=function(){function t(){a(this,t),this.v=new Vt,this.id=new ge}return u(t,[{key:"Copy",value:function(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}}],[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}(),Ce=function(){function t(){a(this,t),this.p1=new Vt,this.p2=new Vt,this.maxFraction=1}return u(t,[{key:"Copy",value:function(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}}]),t}(),Ve=function(){function t(){a(this,t),this.normal=new Vt,this.fraction=0}return u(t,[{key:"Copy",value:function(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}}]),t}(),Me=function(){function t(){a(this,t),this.lowerBound=new Vt,this.upperBound=new Vt,this.m_cache_center=new Vt,this.m_cache_extent=new Vt}return u(t,[{key:"Copy",value:function(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}},{key:"IsValid",value:function(){var t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y,i=t>=0&&e>=0;return i=i&&this.lowerBound.IsValid()&&this.upperBound.IsValid()}},{key:"GetCenter",value:function(){return Vt.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)}},{key:"GetExtents",value:function(){return Vt.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)}},{key:"GetPerimeter",value:function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))}},{key:"Combine1",value:function(t){return this.lowerBound.x=at(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=at(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=ut(this.upperBound.x,t.upperBound.x),this.upperBound.y=ut(this.upperBound.y,t.upperBound.y),this}},{key:"Combine2",value:function(t,e){return this.lowerBound.x=at(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=at(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=ut(t.upperBound.x,e.upperBound.x),this.upperBound.y=ut(t.upperBound.y,e.upperBound.y),this}},{key:"Contains",value:function(t){var e=!0;return e=(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y}},{key:"RayCast",value:function(t,e){var i=-h,n=h,r=e.p1.x,s=e.p1.y,o=e.p2.x-e.p1.x,a=e.p2.y-e.p1.y,u=ot(o),l=ot(a),m=t.normal;if(u<c){if(r<this.lowerBound.x||this.upperBound.x<r)return!1}else{var _=1/o,f=(this.lowerBound.x-r)*_,d=(this.upperBound.x-r)*_,p=-1;if(f>d){var v=f;f=d,d=v,p=1}if(f>i&&(m.x=p,m.y=0,i=f),i>(n=at(n,d)))return!1}if(l<c){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else{var y=1/a,g=(this.lowerBound.y-s)*y,x=(this.upperBound.y-s)*y,b=-1;if(g>x){var w=g;g=x,x=w,b=1}if(g>i&&(m.x=0,m.y=b,i=g),i>(n=at(n,x)))return!1}return!(i<0||e.maxFraction<i)&&(t.fraction=i,!0)}},{key:"TestContain",value:function(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x)&&!(t.y<this.lowerBound.y||this.upperBound.y<t.y)}},{key:"TestOverlap",value:function(t){var e=t.lowerBound.x-this.upperBound.x,i=t.lowerBound.y-this.upperBound.y,n=this.lowerBound.x-t.upperBound.x,r=this.lowerBound.y-t.upperBound.y;return!(e>0||i>0)&&!(n>0||r>0)}}],[{key:"Combine",value:function(t,e,i){return i.Combine2(t,e),i}}]),t}();function ke(t,e){var i=e.lowerBound.x-t.upperBound.x,n=e.lowerBound.y-t.upperBound.y,r=t.lowerBound.x-e.upperBound.x,s=t.lowerBound.y-e.upperBound.y;return!(i>0||n>0)&&!(r>0||s>0)}function Pe(e,i,n,r,s){var o=0,a=i[0],u=i[1],l=Vt.DotVV(n,a.v)-r,h=Vt.DotVV(n,u.v)-r;if(l<=0&&e[o++].Copy(a),h<=0&&e[o++].Copy(u),l*h<0){var c=l/(l-h),m=e[o].v;m.x=a.v.x+c*(u.v.x-a.v.x),m.y=a.v.y+c*(u.v.y-a.v.y);var _=e[o].id;_.cf.indexA=s,_.cf.indexB=a.id.cf.indexB,_.cf.typeA=t.b2ContactFeatureType.e_vertex,_.cf.typeB=t.b2ContactFeatureType.e_face,++o}return o}var Ie=new Jt,Te=new Ut,De=new Xt;function Ge(t,e,i,n,r,s){var o=Ie.Reset();o.proxyA.SetShape(t,e),o.proxyB.SetShape(i,n),o.transformA.Copy(r),o.transformB.Copy(s),o.useRadii=!0;var a=Te.Reset();a.count=0;var u=De.Reset();return oe(u,a,o),u.distance<10*c}function Re(t){if(null===t)throw new Error;return t}var Ee=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;a(this,t),this.m_id=0,this.aabb=new Me,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.m_id=e}return u(t,[{key:"IsLeaf",value:function(){return null===this.child1}}]),t}(),Fe=function(){function t(){a(this,t),this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0,this.m_stack=new Ot(256)}return u(t,[{key:"Query",value:function(t,e){if(null!==this.m_root){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var n=i.Pop();if(n.aabb.TestOverlap(t))if(n.IsLeaf()){if(!e(n))return}else i.Push(Re(n.child1)),i.Push(Re(n.child2))}}}},{key:"QueryPoint",value:function(t,e){if(null!==this.m_root){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var n=i.Pop();if(n.aabb.TestContain(t))if(n.IsLeaf()){if(!e(n))return}else i.Push(Re(n.child1)),i.Push(Re(n.child2))}}}},{key:"RayCast",value:function(e,i){if(null!==this.m_root){var n=e.p1,r=e.p2,s=Vt.SubVV(r,n,t.s_r);s.Normalize();var o=Vt.CrossOneV(s,t.s_v),a=Vt.AbsV(o,t.s_abs_v),u=e.maxFraction,l=t.s_segmentAABB,h=n.x+u*(r.x-n.x),c=n.y+u*(r.y-n.y);l.lowerBound.x=at(n.x,h),l.lowerBound.y=at(n.y,c),l.upperBound.x=ut(n.x,h),l.upperBound.y=ut(n.y,c);var m=this.m_stack.Reset();for(m.Push(this.m_root);m.GetCount()>0;){var _=m.Pop();if(ke(_.aabb,l)){var f=_.aabb.GetCenter(),d=_.aabb.GetExtents();if(!(ot(Vt.DotVV(o,Vt.SubVV(n,f,Vt.s_t0)))-Vt.DotVV(a,d)>0))if(_.IsLeaf()){var p=t.s_subInput;p.p1.Copy(e.p1),p.p2.Copy(e.p2),p.maxFraction=u;var v=i(p,_);if(0===v)return;v>0&&(u=v,h=n.x+u*(r.x-n.x),c=n.y+u*(r.y-n.y),l.lowerBound.x=at(n.x,h),l.lowerBound.y=at(n.y,c),l.upperBound.x=ut(n.x,h),l.upperBound.y=ut(n.y,c))}else m.Push(Re(_.child1)),m.Push(Re(_.child2))}}}}},{key:"AllocateNode",value:function(){if(this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e.height=0,delete e.userData,e}return new Ee(t.s_node_id++)}},{key:"FreeNode",value:function(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,delete t.userData,this.m_freeList=t}},{key:"CreateProxy",value:function(t,e){var i=this.AllocateNode(),n=p,r=p;return i.aabb.lowerBound.x=t.lowerBound.x-n,i.aabb.lowerBound.y=t.lowerBound.y-r,i.aabb.upperBound.x=t.upperBound.x+n,i.aabb.upperBound.y=t.upperBound.y+r,i.userData=e,i.height=0,this.InsertLeaf(i),i}},{key:"DestroyProxy",value:function(t){this.RemoveLeaf(t),this.FreeNode(t)}},{key:"MoveProxy",value:function(t,e,i){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var n=p+v*(i.x>0?i.x:-i.x),r=p+v*(i.y>0?i.y:-i.y);return t.aabb.lowerBound.x=e.lowerBound.x-n,t.aabb.lowerBound.y=e.lowerBound.y-r,t.aabb.upperBound.x=e.upperBound.x+n,t.aabb.upperBound.y=e.upperBound.y+r,this.InsertLeaf(t),!0}},{key:"InsertLeaf",value:function(e){if(++this.m_insertionCount,null===this.m_root)return this.m_root=e,void(this.m_root.parent=null);for(var i=e.aabb,n=this.m_root;!n.IsLeaf();){var r=Re(n.child1),s=Re(n.child2),o=n.aabb.GetPerimeter(),a=t.s_combinedAABB;a.Combine2(n.aabb,i);var u=a.GetPerimeter(),l=2*u,h=2*(u-o),c=void 0,m=t.s_aabb,_=void 0;r.IsLeaf()?(m.Combine2(i,r.aabb),c=m.GetPerimeter()+h):(m.Combine2(i,r.aabb),_=r.aabb.GetPerimeter(),c=m.GetPerimeter()-_+h);var f=void 0;if(s.IsLeaf()?(m.Combine2(i,s.aabb),f=m.GetPerimeter()+h):(m.Combine2(i,s.aabb),_=s.aabb.GetPerimeter(),f=m.GetPerimeter()-_+h),l<c&&l<f)break;n=c<f?r:s}var d=n,p=d.parent,v=this.AllocateNode();v.parent=p,delete v.userData,v.aabb.Combine2(i,d.aabb),v.height=d.height+1,p?(p.child1===d?p.child1=v:p.child2=v,v.child1=d,v.child2=e,d.parent=v,e.parent=v):(v.child1=d,v.child2=e,d.parent=v,e.parent=v,this.m_root=v);for(var y=e.parent;null!==y;){var g=Re((y=this.Balance(y)).child1),x=Re(y.child2);y.height=1+ut(g.height,x.height),y.aabb.Combine2(g.aabb,x.aabb),y=y.parent}}},{key:"RemoveLeaf",value:function(t){if(t!==this.m_root){var e,i=Re(t.parent),n=i&&i.parent;if(e=i.child1===t?Re(i.child2):Re(i.child1),n){n.child1===i?n.child1=e:n.child2=e,e.parent=n,this.FreeNode(i);for(var r=n;r;){var s=Re((r=this.Balance(r)).child1),o=Re(r.child2);r.aabb.Combine2(s.aabb,o.aabb),r.height=1+ut(s.height,o.height),r=r.parent}}else this.m_root=e,e.parent=null,this.FreeNode(i)}else this.m_root=null}},{key:"Balance",value:function(t){if(t.IsLeaf()||t.height<2)return t;var e=Re(t.child1),i=Re(t.child2),n=i.height-e.height;if(n>1){var r=Re(i.child1),s=Re(i.child2);return i.child1=t,i.parent=t.parent,t.parent=i,null!==i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,r.height>s.height?(i.child2=r,t.child2=s,s.parent=t,t.aabb.Combine2(e.aabb,s.aabb),i.aabb.Combine2(t.aabb,r.aabb),t.height=1+ut(e.height,s.height),i.height=1+ut(t.height,r.height)):(i.child2=s,t.child2=r,r.parent=t,t.aabb.Combine2(e.aabb,r.aabb),i.aabb.Combine2(t.aabb,s.aabb),t.height=1+ut(e.height,r.height),i.height=1+ut(t.height,s.height)),i}if(n<-1){var o=Re(e.child1),a=Re(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,o.height>a.height?(e.child2=o,t.child1=a,a.parent=t,t.aabb.Combine2(i.aabb,a.aabb),e.aabb.Combine2(t.aabb,o.aabb),t.height=1+ut(i.height,a.height),e.height=1+ut(t.height,o.height)):(e.child2=a,t.child1=o,o.parent=t,t.aabb.Combine2(i.aabb,o.aabb),e.aabb.Combine2(t.aabb,a.aabb),t.height=1+ut(i.height,o.height),e.height=1+ut(t.height,a.height)),e}return t}},{key:"GetHeight",value:function(){return null===this.m_root?0:this.m_root.height}},{key:"GetAreaRatio",value:function(){if(null===this.m_root)return 0;var e=this.m_root.aabb.GetPerimeter();return t.GetAreaNode(this.m_root)/e}},{key:"ComputeHeightNode",value:function(t){if(!t||t.IsLeaf())return 0;var e=this.ComputeHeightNode(t.child1),i=this.ComputeHeightNode(t.child2);return 1+ut(e,i)}},{key:"ComputeHeight",value:function(){return this.ComputeHeightNode(this.m_root)}},{key:"ValidateStructure",value:function(t){if(null!==t){this.m_root;var e=t;if(!e.IsLeaf()){var i=Re(e.child1),n=Re(e.child2);this.ValidateStructure(i),this.ValidateStructure(n)}}}},{key:"ValidateMetrics",value:function(e){if(null!==e){var i=e;if(!i.IsLeaf()){var n=Re(i.child1),r=Re(i.child2);t.s_aabb.Combine2(n.aabb,r.aabb),this.ValidateMetrics(n),this.ValidateMetrics(r)}}}},{key:"Validate",value:function(){}},{key:"GetMaxBalance",value:function(){return t.GetMaxBalanceNode(this.m_root,0)}},{key:"RebuildBottomUp",value:function(){this.Validate()}},{key:"ShiftOrigin",value:function(e){t.ShiftOriginNode(this.m_root,e)}}],[{key:"GetAreaNode",value:function(e){if(null===e)return 0;if(e.IsLeaf())return 0;var i=e.aabb.GetPerimeter();return i+=t.GetAreaNode(e.child1),i+=t.GetAreaNode(e.child2)}},{key:"GetMaxBalanceNode",value:function(t,e){if(null===t)return e;if(t.height<=1)return e;var i=Re(t.child1),n=Re(t.child2),r=ot(n.height-i.height);return ut(e,r)}},{key:"ShiftOriginNode",value:function(e,i){if(null!==e&&!(e.height<=1)){var n=e.child1,r=e.child2;t.ShiftOriginNode(n,i),t.ShiftOriginNode(r,i),e.aabb.lowerBound.SelfSub(i),e.aabb.upperBound.SelfSub(i)}}}]),t}();Fe.s_r=new Vt,Fe.s_v=new Vt,Fe.s_abs_v=new Vt,Fe.s_segmentAABB=new Me,Fe.s_subInput=new Ce,Fe.s_combinedAABB=new Me,Fe.s_aabb=new Me,Fe.s_node_id=0;var Le=function t(e,i){a(this,t),this.proxyA=e,this.proxyB=i},je=function(){function t(){a(this,t),this.m_tree=new Fe,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}return u(t,[{key:"CreateProxy",value:function(t,e){var i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i}},{key:"DestroyProxy",value:function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}},{key:"MoveProxy",value:function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)}},{key:"TouchProxy",value:function(t){this.BufferMove(t)}},{key:"GetProxyCount",value:function(){return this.m_proxyCount}},{key:"UpdatePairs",value:function(t){var e=this;this.m_pairCount=0;for(var i=function(t){var i=e.m_moveBuffer[t];if(null===i)return"continue";var n=i.aabb;e.m_tree.Query(n,(function(t){if(t.m_id===i.m_id)return!0;var n,r;if(t.m_id<i.m_id?(n=t,r=i):(n=i,r=t),e.m_pairCount===e.m_pairBuffer.length)e.m_pairBuffer[e.m_pairCount]=new Le(n,r);else{var s=e.m_pairBuffer[e.m_pairCount];s.proxyA=n,s.proxyB=r}return++e.m_pairCount,!0}))},n=0;n<this.m_moveCount;++n)i(n);this.m_moveCount=0,this.m_pairBuffer.length=this.m_pairCount,this.m_pairBuffer.sort(Oe);for(var r=0;r<this.m_pairCount;){var s=this.m_pairBuffer[r];for(t(s.proxyA.userData,s.proxyB.userData),++r;r<this.m_pairCount;){var o=this.m_pairBuffer[r];if(o.proxyA.m_id!==s.proxyA.m_id||o.proxyB.m_id!==s.proxyB.m_id)break;++r}}}},{key:"Query",value:function(t,e){this.m_tree.Query(t,e)}},{key:"QueryPoint",value:function(t,e){this.m_tree.QueryPoint(t,e)}},{key:"RayCast",value:function(t,e){this.m_tree.RayCast(t,e)}},{key:"GetTreeHeight",value:function(){return this.m_tree.GetHeight()}},{key:"GetTreeBalance",value:function(){return this.m_tree.GetMaxBalance()}},{key:"GetTreeQuality",value:function(){return this.m_tree.GetAreaRatio()}},{key:"ShiftOrigin",value:function(t){this.m_tree.ShiftOrigin(t)}},{key:"BufferMove",value:function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount}},{key:"UnBufferMove",value:function(t){var e=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[e]=null}}]),t}();function Oe(t,e){return t.proxyA.m_id===e.proxyA.m_id?t.proxyB.m_id-e.proxyB.m_id:t.proxyA.m_id-e.proxyA.m_id}function Ne(){t.b2_toiTime=0,t.b2_toiMaxTime=0,t.b2_toiCalls=0,t.b2_toiIters=0,t.b2_toiMaxIters=0,t.b2_toiRootIters=0,t.b2_toiMaxRootIters=0}t.b2_toiTime=0,t.b2_toiMaxTime=0,t.b2_toiCalls=0,t.b2_toiIters=0,t.b2_toiMaxIters=0,t.b2_toiRootIters=0,t.b2_toiMaxRootIters=0;var qe,ze=new Dt,Ue=new Dt,Je=new Vt,Xe=new Vt,Ye=new Vt,We=new Vt,Ze=new Vt,He=function t(){a(this,t),this.proxyA=new zt,this.proxyB=new zt,this.sweepA=new Rt,this.sweepB=new Rt,this.tMax=0};(qe=t.b2TOIOutputState||(t.b2TOIOutputState={}))[qe.e_unknown=0]="e_unknown",qe[qe.e_failed=1]="e_failed",qe[qe.e_overlapped=2]="e_overlapped",qe[qe.e_touching=3]="e_touching",qe[qe.e_separated=4]="e_separated";var Qe,Ke=function e(){a(this,e),this.state=t.b2TOIOutputState.e_unknown,this.t=0};(Qe=t.b2SeparationFunctionType||(t.b2SeparationFunctionType={}))[Qe.e_unknown=-1]="e_unknown",Qe[Qe.e_points=0]="e_points",Qe[Qe.e_faceA=1]="e_faceA",Qe[Qe.e_faceB=2]="e_faceB";var $e=function(){function e(){a(this,e),this.m_sweepA=new Rt,this.m_sweepB=new Rt,this.m_type=t.b2SeparationFunctionType.e_unknown,this.m_localPoint=new Vt,this.m_axis=new Vt}return u(e,[{key:"Initialize",value:function(e,i,n,r,s,o){this.m_proxyA=i,this.m_proxyB=r;var a=e.count;this.m_sweepA.Copy(n),this.m_sweepB.Copy(s);var u=ze,l=Ue;if(this.m_sweepA.GetTransform(u,o),this.m_sweepB.GetTransform(l,o),1===a){this.m_type=t.b2SeparationFunctionType.e_points;var h=this.m_proxyA.GetVertex(e.indexA[0]),c=this.m_proxyB.GetVertex(e.indexB[0]),m=Dt.MulXV(u,h,Je),_=Dt.MulXV(l,c,Xe);Vt.SubVV(_,m,this.m_axis);var f=this.m_axis.Normalize();return this.m_localPoint.SetZero(),f}if(e.indexA[0]===e.indexA[1]){this.m_type=t.b2SeparationFunctionType.e_faceB;var d=this.m_proxyB.GetVertex(e.indexB[0]),p=this.m_proxyB.GetVertex(e.indexB[1]);Vt.CrossVOne(Vt.SubVV(p,d,Vt.s_t0),this.m_axis).SelfNormalize();var v=Tt.MulRV(l.q,this.m_axis,Ye);Vt.MidVV(d,p,this.m_localPoint);var y=Dt.MulXV(l,this.m_localPoint,Xe),g=this.m_proxyA.GetVertex(e.indexA[0]),x=Dt.MulXV(u,g,Je),b=Vt.DotVV(Vt.SubVV(x,y,Vt.s_t0),v);return b<0&&(this.m_axis.SelfNeg(),b=-b),b}this.m_type=t.b2SeparationFunctionType.e_faceA;var w=this.m_proxyA.GetVertex(e.indexA[0]),A=this.m_proxyA.GetVertex(e.indexA[1]);Vt.CrossVOne(Vt.SubVV(A,w,Vt.s_t0),this.m_axis).SelfNormalize();var S=Tt.MulRV(u.q,this.m_axis,Ye);Vt.MidVV(w,A,this.m_localPoint);var B=Dt.MulXV(u,this.m_localPoint,Je),C=this.m_proxyB.GetVertex(e.indexB[0]),V=Dt.MulXV(l,C,Xe),M=Vt.DotVV(Vt.SubVV(V,B,Vt.s_t0),S);return M<0&&(this.m_axis.SelfNeg(),M=-M),M}},{key:"FindMinSeparation",value:function(e,i,n){var r=ze,s=Ue;switch(this.m_sweepA.GetTransform(r,n),this.m_sweepB.GetTransform(s,n),this.m_type){case t.b2SeparationFunctionType.e_points:var o=Tt.MulTRV(r.q,this.m_axis,We),a=Tt.MulTRV(s.q,Vt.NegV(this.m_axis,Vt.s_t0),Ze);e[0]=this.m_proxyA.GetSupport(o),i[0]=this.m_proxyB.GetSupport(a);var u=this.m_proxyA.GetVertex(e[0]),l=this.m_proxyB.GetVertex(i[0]),h=Dt.MulXV(r,u,Je),c=Dt.MulXV(s,l,Xe);return Vt.DotVV(Vt.SubVV(c,h,Vt.s_t0),this.m_axis);case t.b2SeparationFunctionType.e_faceA:var m=Tt.MulRV(r.q,this.m_axis,Ye),_=Dt.MulXV(r,this.m_localPoint,Je),f=Tt.MulTRV(s.q,Vt.NegV(m,Vt.s_t0),Ze);e[0]=-1,i[0]=this.m_proxyB.GetSupport(f);var d=this.m_proxyB.GetVertex(i[0]),p=Dt.MulXV(s,d,Xe);return Vt.DotVV(Vt.SubVV(p,_,Vt.s_t0),m);case t.b2SeparationFunctionType.e_faceB:var v=Tt.MulRV(s.q,this.m_axis,Ye),y=Dt.MulXV(s,this.m_localPoint,Xe),g=Tt.MulTRV(r.q,Vt.NegV(v,Vt.s_t0),We);i[0]=-1,e[0]=this.m_proxyA.GetSupport(g);var x=this.m_proxyA.GetVertex(e[0]),b=Dt.MulXV(r,x,Je);return Vt.DotVV(Vt.SubVV(b,y,Vt.s_t0),v);default:return e[0]=-1,i[0]=-1,0}}},{key:"Evaluate",value:function(e,i,n){var r=ze,s=Ue;switch(this.m_sweepA.GetTransform(r,n),this.m_sweepB.GetTransform(s,n),this.m_type){case t.b2SeparationFunctionType.e_points:var o=this.m_proxyA.GetVertex(e),a=this.m_proxyB.GetVertex(i),u=Dt.MulXV(r,o,Je),l=Dt.MulXV(s,a,Xe);return Vt.DotVV(Vt.SubVV(l,u,Vt.s_t0),this.m_axis);case t.b2SeparationFunctionType.e_faceA:var h=Tt.MulRV(r.q,this.m_axis,Ye),c=Dt.MulXV(r,this.m_localPoint,Je),m=this.m_proxyB.GetVertex(i),_=Dt.MulXV(s,m,Xe);return Vt.DotVV(Vt.SubVV(_,c,Vt.s_t0),h);case t.b2SeparationFunctionType.e_faceB:var f=Tt.MulRV(s.q,this.m_axis,Ye),d=Dt.MulXV(s,this.m_localPoint,Xe),p=this.m_proxyA.GetVertex(e),v=Dt.MulXV(r,p,Je);return Vt.DotVV(Vt.SubVV(v,d,Vt.s_t0),f);default:return 0}}}]),e}(),ti=new Lt,ei=new Ut,ii=new Jt,ni=new Xt,ri=new $e,si=[0],oi=[0],ai=new Rt,ui=new Rt;function li(e,i){var n=ti.Reset();++t.b2_toiCalls,e.state=t.b2TOIOutputState.e_unknown,e.t=i.tMax;var r=i.proxyA,s=i.proxyB,o=ut(d,r.m_count,s.m_count),a=ai.Copy(i.sweepA),u=ui.Copy(i.sweepB);a.Normalize(),u.Normalize();var l=i.tMax,h=r.m_radius+s.m_radius,c=ut(y,h-3*y),m=.25*y,_=0,f=20,p=0,v=ei;v.count=0;var g=ii;for(g.proxyA.Copy(i.proxyA),g.proxyB.Copy(i.proxyB),g.useRadii=!1;;){var x=ze,b=Ue;a.GetTransform(x,_),u.GetTransform(b,_),g.transformA.Copy(x),g.transformB.Copy(b);var w=ni;if(oe(w,v,g),w.distance<=0){e.state=t.b2TOIOutputState.e_overlapped,e.t=0;break}if(w.distance<c+m){e.state=t.b2TOIOutputState.e_touching,e.t=_;break}var A=ri;A.Initialize(v,r,a,s,u,_);for(var S=!1,B=l,C=0;;){var V=si,M=oi,k=A.FindMinSeparation(V,M,B);if(k>c+m){e.state=t.b2TOIOutputState.e_separated,e.t=l,S=!0;break}if(k>c-m){_=B;break}var P=A.Evaluate(V[0],M[0],_);if(P<c-m){e.state=t.b2TOIOutputState.e_failed,e.t=_,S=!0;break}if(P<=c+m){e.state=t.b2TOIOutputState.e_touching,e.t=_,S=!0;break}for(var I=0,T=_,D=B;;){var G=0;G=1&I?T+(c-P)*(D-T)/(k-P):.5*(T+D),++I,++t.b2_toiRootIters;var R=A.Evaluate(V[0],M[0],G);if(ot(R-c)<m){B=G;break}if(R>c?(T=G,P=R):(D=G,k=R),50===I)break}if(t.b2_toiMaxRootIters=ut(t.b2_toiMaxRootIters,I),++C===o)break}if(++p,++t.b2_toiIters,S)break;if(p===f){e.state=t.b2TOIOutputState.e_failed,e.t=_;break}}t.b2_toiMaxIters=ut(t.b2_toiMaxIters,p);var E=n.GetMilliseconds();t.b2_toiMaxTime=ut(t.b2_toiMaxTime,E),t.b2_toiTime+=E}var hi=new Vt,ci=new Vt;function mi(e,i,n,r,s){e.pointCount=0;var o=Dt.MulXV(n,i.m_p,hi),a=Dt.MulXV(s,r.m_p,ci),u=Vt.DistanceSquaredVV(o,a),l=i.m_radius+r.m_radius;u>l*l||(e.type=t.b2ManifoldType.e_circles,e.localPoint.Copy(i.m_p),e.localNormal.SetZero(),e.pointCount=1,e.points[0].localPoint.Copy(r.m_p),e.points[0].id.key=0)}var _i=new Vt,fi=new Vt,di=new Vt;function pi(e,i,n,r,s){e.pointCount=0;for(var o=Dt.MulXV(s,r.m_p,_i),a=Dt.MulTXV(n,o,fi),u=0,l=-h,m=i.m_radius+r.m_radius,_=i.m_count,f=i.m_vertices,d=i.m_normals,p=0;p<_;++p){var v=Vt.DotVV(d[p],Vt.SubVV(a,f[p],Vt.s_t0));if(v>m)return;v>l&&(l=v,u=p)}var y=u,g=(y+1)%_,x=f[y],b=f[g];if(l<c)return e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(d[u]),Vt.MidVV(x,b,e.localPoint),e.points[0].localPoint.Copy(r.m_p),void(e.points[0].id.key=0);var w=Vt.DotVV(Vt.SubVV(a,x,Vt.s_t0),Vt.SubVV(b,x,Vt.s_t1)),A=Vt.DotVV(Vt.SubVV(a,b,Vt.s_t0),Vt.SubVV(x,b,Vt.s_t1));if(w<=0){if(Vt.DistanceSquaredVV(a,x)>m*m)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,Vt.SubVV(a,x,e.localNormal).SelfNormalize(),e.localPoint.Copy(x),e.points[0].localPoint.Copy(r.m_p),e.points[0].id.key=0}else if(A<=0){if(Vt.DistanceSquaredVV(a,b)>m*m)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,Vt.SubVV(a,b,e.localNormal).SelfNormalize(),e.localPoint.Copy(b),e.points[0].localPoint.Copy(r.m_p),e.points[0].id.key=0}else{var S=Vt.MidVV(x,b,di);if(Vt.DotVV(Vt.SubVV(a,S,Vt.s_t1),d[y])>m)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(d[y]).SelfNormalize(),e.localPoint.Copy(S),e.points[0].localPoint.Copy(r.m_p),e.points[0].id.key=0}}var vi=new Vt,yi=new Vt,gi=new Vt,xi=new Vt;function bi(t,e,i,n,r){for(var s=t.m_vertices,o=t.m_normals,a=n.m_count,u=n.m_vertices,l=Tt.MulRV(e.q,o[i],vi),c=Tt.MulTRV(r.q,l,yi),m=0,_=h,f=0;f<a;++f){var d=Vt.DotVV(u[f],c);d<_&&(_=d,m=f)}var p=Dt.MulXV(e,s[i],gi),v=Dt.MulXV(r,u[m],xi);return Vt.DotVV(Vt.SubVV(v,p,Vt.s_t0),l)}var wi=new Vt,Ai=new Vt;function Si(t,e,i,n,r){for(var s=e.m_count,o=e.m_normals,a=Vt.SubVV(Dt.MulXV(r,n.m_centroid,Vt.s_t0),Dt.MulXV(i,e.m_centroid,Vt.s_t1),wi),u=Tt.MulTRV(i.q,a,Ai),l=0,c=-h,m=0;m<s;++m){var _=Vt.DotVV(o[m],u);_>c&&(c=_,l=m)}var f=bi(e,i,l,n,r),d=(l+s-1)%s,p=bi(e,i,d,n,r),v=(l+1)%s,y=bi(e,i,v,n,r),g=0,x=0,b=0;if(p>f&&p>y)b=-1,g=d,x=p;else{if(!(y>f))return t[0]=l,f;b=1,g=v,x=y}for(;(f=bi(e,i,l=-1===b?(g+s-1)%s:(g+1)%s,n,r))>x;)g=l,x=f;return t[0]=g,x}var Bi=new Vt;function Ci(e,i,n,r,s,o){for(var a=i.m_normals,u=s.m_count,l=s.m_vertices,c=s.m_normals,m=Tt.MulTRV(o.q,Tt.MulRV(n.q,a[r],Vt.s_t0),Bi),_=0,f=h,d=0;d<u;++d){var p=Vt.DotVV(m,c[d]);p<f&&(f=p,_=d)}var v=_,y=(v+1)%u,g=e[0];Dt.MulXV(o,l[v],g.v);var x=g.id.cf;x.indexA=r,x.indexB=v,x.typeA=t.b2ContactFeatureType.e_face,x.typeB=t.b2ContactFeatureType.e_vertex;var b=e[1];Dt.MulXV(o,l[y],b.v);var w=b.id.cf;w.indexA=r,w.indexB=y,w.typeA=t.b2ContactFeatureType.e_face,w.typeB=t.b2ContactFeatureType.e_vertex}var Vi=Be.MakeArray(2),Mi=Be.MakeArray(2),ki=Be.MakeArray(2),Pi=[0],Ii=[0],Ti=new Vt,Di=new Vt,Gi=new Vt,Ri=new Vt,Ei=new Vt,Fi=new Vt,Li=new Vt,ji=new Vt;function Oi(e,i,n,r,s){e.pointCount=0;var o=i.m_radius+r.m_radius,a=Pi;a[0]=0;var u=Si(a,i,n,r,s);if(!(u>o)){var l=Ii;l[0]=0;var h=Si(l,r,s,i,n);if(!(h>o)){var c,m,_,d,p=0,v=0;h>.98*u+.001?(c=r,m=i,_=s,d=n,p=l[0],e.type=t.b2ManifoldType.e_faceB,v=1):(c=i,m=r,_=n,d=s,p=a[0],e.type=t.b2ManifoldType.e_faceA,v=0);var y=Vi;Ci(y,c,_,p,m,d);var g=c.m_count,x=c.m_vertices,b=p,w=(p+1)%g,A=x[b],S=x[w],B=Vt.SubVV(S,A,Ti);B.Normalize();var C=Vt.CrossVOne(B,Di),V=Vt.MidVV(A,S,Gi),M=Tt.MulRV(_.q,B,Ei),k=Vt.CrossVOne(M,Ri),P=Dt.MulXV(_,A,Li),I=Dt.MulXV(_,S,ji),T=Vt.DotVV(k,P),D=-Vt.DotVV(M,P)+o,G=Vt.DotVV(M,I)+o,R=Mi,E=ki;if(!(Pe(R,y,Vt.NegV(M,Fi),D,b)<2)&&!(Pe(E,R,M,G,w)<2)){e.localNormal.Copy(C),e.localPoint.Copy(V);for(var F=0,L=0;L<f;++L){var j=E[L];if(Vt.DotVV(k,j.v)-T<=o){var O=e.points[F];if(Dt.MulTXV(d,j.v,O.localPoint),O.id.Copy(j.id),v){var N=O.id.cf;O.id.cf.indexA=N.indexB,O.id.cf.indexB=N.indexA,O.id.cf.typeA=N.typeB,O.id.cf.typeB=N.typeA}++F}}e.pointCount=F}}}}var Ni=new Vt,qi=new Vt,zi=new Vt,Ui=new Vt,Ji=new Vt,Xi=new Vt,Yi=new Vt,Wi=new ge;function Zi(e,i,n,r,s){e.pointCount=0;var o=Dt.MulTXV(n,Dt.MulXV(s,r.m_p,Vt.s_t0),Ni),a=i.m_vertex1,u=i.m_vertex2,l=Vt.SubVV(u,a,qi),h=Vt.DotVV(l,Vt.SubVV(u,o,Vt.s_t0)),c=Vt.DotVV(l,Vt.SubVV(o,a,Vt.s_t0)),m=i.m_radius+r.m_radius,_=Wi;if(_.cf.indexB=0,_.cf.typeB=t.b2ContactFeatureType.e_vertex,c<=0){var f=a,d=Vt.SubVV(o,f,zi);if(Vt.DotVV(d,d)>m*m)return;if(i.m_hasVertex0){var p=i.m_vertex0,v=a,y=Vt.SubVV(v,p,Ui);if(Vt.DotVV(y,Vt.SubVV(v,o,Vt.s_t0))>0)return}return _.cf.indexA=0,_.cf.typeA=t.b2ContactFeatureType.e_vertex,e.pointCount=1,e.type=t.b2ManifoldType.e_circles,e.localNormal.SetZero(),e.localPoint.Copy(f),e.points[0].id.Copy(_),void e.points[0].localPoint.Copy(r.m_p)}if(h<=0){var g=u,x=Vt.SubVV(o,g,zi);if(Vt.DotVV(x,x)>m*m)return;if(i.m_hasVertex3){var b=i.m_vertex3,w=u,A=Vt.SubVV(b,w,Ji);if(Vt.DotVV(A,Vt.SubVV(o,w,Vt.s_t0))>0)return}return _.cf.indexA=1,_.cf.typeA=t.b2ContactFeatureType.e_vertex,e.pointCount=1,e.type=t.b2ManifoldType.e_circles,e.localNormal.SetZero(),e.localPoint.Copy(g),e.points[0].id.Copy(_),void e.points[0].localPoint.Copy(r.m_p)}var S=Vt.DotVV(l,l),B=Xi;B.x=1/S*(h*a.x+c*u.x),B.y=1/S*(h*a.y+c*u.y);var C=Vt.SubVV(o,B,zi);if(!(Vt.DotVV(C,C)>m*m)){var V=Yi.Set(-l.y,l.x);Vt.DotVV(V,Vt.SubVV(o,a,Vt.s_t0))<0&&V.Set(-V.x,-V.y),V.Normalize(),_.cf.indexA=0,_.cf.typeA=t.b2ContactFeatureType.e_face,e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(V),e.localPoint.Copy(a),e.points[0].id.Copy(_),e.points[0].localPoint.Copy(r.m_p)}}var Hi=function t(){a(this,t),this.type=0,this.index=0,this.separation=0},Qi=function t(){a(this,t),this.vertices=[],this.normals=[],this.count=0},Ki=function t(){a(this,t),this.i1=0,this.i2=0,this.v1=new Vt,this.v2=new Vt,this.normal=new Vt,this.sideNormal1=new Vt,this.sideOffset1=0,this.sideNormal2=new Vt,this.sideOffset2=0},$i=function(){function e(){a(this,e),this.m_polygonB=new Qi,this.m_xf=new Dt,this.m_centroidB=new Vt,this.m_v0=new Vt,this.m_v1=new Vt,this.m_v2=new Vt,this.m_v3=new Vt,this.m_normal0=new Vt,this.m_normal1=new Vt,this.m_normal2=new Vt,this.m_normal=new Vt,this.m_type1=0,this.m_type2=0,this.m_lowerLimit=new Vt,this.m_upperLimit=new Vt,this.m_radius=0,this.m_front=!1}return u(e,[{key:"Collide",value:function(i,n,r,s,o){Dt.MulTXX(r,o,this.m_xf),Dt.MulXV(this.m_xf,s.m_centroid,this.m_centroidB),this.m_v0.Copy(n.m_vertex0),this.m_v1.Copy(n.m_vertex1),this.m_v2.Copy(n.m_vertex2),this.m_v3.Copy(n.m_vertex3);var a=n.m_hasVertex0,u=n.m_hasVertex3,l=Vt.SubVV(this.m_v2,this.m_v1,e.s_edge1);l.Normalize(),this.m_normal1.Set(l.y,-l.x);var h=Vt.DotVV(this.m_normal1,Vt.SubVV(this.m_centroidB,this.m_v1,Vt.s_t0)),c=0,m=0,_=!1,d=!1;if(a){var p=Vt.SubVV(this.m_v1,this.m_v0,e.s_edge0);p.Normalize(),this.m_normal0.Set(p.y,-p.x),_=Vt.CrossVV(p,l)>=0,c=Vt.DotVV(this.m_normal0,Vt.SubVV(this.m_centroidB,this.m_v0,Vt.s_t0))}if(u){var v=Vt.SubVV(this.m_v3,this.m_v2,e.s_edge2);v.Normalize(),this.m_normal2.Set(v.y,-v.x),d=Vt.CrossVV(l,v)>0,m=Vt.DotVV(this.m_normal2,Vt.SubVV(this.m_centroidB,this.m_v2,Vt.s_t0))}a&&u?_&&d?(this.m_front=c>=0||h>=0||m>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):_?(this.m_front=c>=0||h>=0&&m>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):d?(this.m_front=m>=0||c>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=c>=0&&h>=0&&m>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):a?_?(this.m_front=c>=0||h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=c>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):u?d?(this.m_front=h>=0||m>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=h>=0&&m>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=s.m_count;for(var y=0;y<s.m_count;++y)this.m_polygonB.vertices.length<=y&&this.m_polygonB.vertices.push(new Vt),this.m_polygonB.normals.length<=y&&this.m_polygonB.normals.push(new Vt),Dt.MulXV(this.m_xf,s.m_vertices[y],this.m_polygonB.vertices[y]),Tt.MulRV(this.m_xf.q,s.m_normals[y],this.m_polygonB.normals[y]);this.m_radius=s.m_radius+n.m_radius,i.pointCount=0;var g=this.ComputeEdgeSeparation(e.s_edgeAxis);if(0!==g.type&&!(g.separation>this.m_radius)){var x=this.ComputePolygonSeparation(e.s_polygonAxis);if(!(0!==x.type&&x.separation>this.m_radius)){var b,w=.98,A=.001;b=0===x.type?g:x.separation>w*g.separation+A?x:g;var S=e.s_ie,B=e.s_rf;if(1===b.type){i.type=t.b2ManifoldType.e_faceA;for(var C=0,V=Vt.DotVV(this.m_normal,this.m_polygonB.normals[0]),M=1;M<this.m_polygonB.count;++M){var k=Vt.DotVV(this.m_normal,this.m_polygonB.normals[M]);k<V&&(V=k,C=M)}var P=C,I=(P+1)%this.m_polygonB.count,T=S[0];T.v.Copy(this.m_polygonB.vertices[P]),T.id.cf.indexA=0,T.id.cf.indexB=P,T.id.cf.typeA=t.b2ContactFeatureType.e_face,T.id.cf.typeB=t.b2ContactFeatureType.e_vertex;var D=S[1];D.v.Copy(this.m_polygonB.vertices[I]),D.id.cf.indexA=0,D.id.cf.indexB=I,D.id.cf.typeA=t.b2ContactFeatureType.e_face,D.id.cf.typeB=t.b2ContactFeatureType.e_vertex,this.m_front?(B.i1=0,B.i2=1,B.v1.Copy(this.m_v1),B.v2.Copy(this.m_v2),B.normal.Copy(this.m_normal1)):(B.i1=1,B.i2=0,B.v1.Copy(this.m_v2),B.v2.Copy(this.m_v1),B.normal.Copy(this.m_normal1).SelfNeg())}else{i.type=t.b2ManifoldType.e_faceB;var G=S[0];G.v.Copy(this.m_v1),G.id.cf.indexA=0,G.id.cf.indexB=b.index,G.id.cf.typeA=t.b2ContactFeatureType.e_vertex,G.id.cf.typeB=t.b2ContactFeatureType.e_face;var R=S[1];R.v.Copy(this.m_v2),R.id.cf.indexA=0,R.id.cf.indexB=b.index,R.id.cf.typeA=t.b2ContactFeatureType.e_vertex,R.id.cf.typeB=t.b2ContactFeatureType.e_face,B.i1=b.index,B.i2=(B.i1+1)%this.m_polygonB.count,B.v1.Copy(this.m_polygonB.vertices[B.i1]),B.v2.Copy(this.m_polygonB.vertices[B.i2]),B.normal.Copy(this.m_polygonB.normals[B.i1])}B.sideNormal1.Set(B.normal.y,-B.normal.x),B.sideNormal2.Copy(B.sideNormal1).SelfNeg(),B.sideOffset1=Vt.DotVV(B.sideNormal1,B.v1),B.sideOffset2=Vt.DotVV(B.sideNormal2,B.v2);var E=e.s_clipPoints1,F=e.s_clipPoints2;if(!(Pe(E,S,B.sideNormal1,B.sideOffset1,B.i1)<f)&&!(Pe(F,E,B.sideNormal2,B.sideOffset2,B.i2)<f)){1===b.type?(i.localNormal.Copy(B.normal),i.localPoint.Copy(B.v1)):(i.localNormal.Copy(s.m_normals[B.i1]),i.localPoint.Copy(s.m_vertices[B.i1]));for(var L=0,j=0;j<f;++j)if(Vt.DotVV(B.normal,Vt.SubVV(F[j].v,B.v1,Vt.s_t0))<=this.m_radius){var O=i.points[L];1===b.type?(Dt.MulTXV(this.m_xf,F[j].v,O.localPoint),O.id=F[j].id):(O.localPoint.Copy(F[j].v),O.id.cf.typeA=F[j].id.cf.typeB,O.id.cf.typeB=F[j].id.cf.typeA,O.id.cf.indexA=F[j].id.cf.indexB,O.id.cf.indexB=F[j].id.cf.indexA),++L}i.pointCount=L}}}}},{key:"ComputeEdgeSeparation",value:function(t){var e=t;e.type=1,e.index=this.m_front?0:1,e.separation=h;for(var i=0;i<this.m_polygonB.count;++i){var n=Vt.DotVV(this.m_normal,Vt.SubVV(this.m_polygonB.vertices[i],this.m_v1,Vt.s_t0));n<e.separation&&(e.separation=n)}return e}},{key:"ComputePolygonSeparation",value:function(t){var i=t;i.type=0,i.index=-1,i.separation=-h;for(var n=e.s_perp.Set(-this.m_normal.y,this.m_normal.x),r=0;r<this.m_polygonB.count;++r){var s=Vt.NegV(this.m_polygonB.normals[r],e.s_n),o=Vt.DotVV(s,Vt.SubVV(this.m_polygonB.vertices[r],this.m_v1,Vt.s_t0)),a=Vt.DotVV(s,Vt.SubVV(this.m_polygonB.vertices[r],this.m_v2,Vt.s_t0)),u=at(o,a);if(u>this.m_radius)return i.type=2,i.index=r,i.separation=u,i;if(Vt.DotVV(s,n)>=0){if(Vt.DotVV(Vt.SubVV(s,this.m_upperLimit,Vt.s_t0),this.m_normal)<-g)continue}else if(Vt.DotVV(Vt.SubVV(s,this.m_lowerLimit,Vt.s_t0),this.m_normal)<-g)continue;u>i.separation&&(i.type=2,i.index=r,i.separation=u)}return i}}]),e}();$i.s_edge1=new Vt,$i.s_edge0=new Vt,$i.s_edge2=new Vt,$i.s_ie=Be.MakeArray(2),$i.s_rf=new Ki,$i.s_clipPoints1=Be.MakeArray(2),$i.s_clipPoints2=Be.MakeArray(2),$i.s_edgeAxis=new Hi,$i.s_polygonAxis=new Hi,$i.s_n=new Vt,$i.s_perp=new Vt;var tn=new $i;function en(t,e,i,n,r){tn.Collide(t,e,i,n,r)}var nn,rn=function t(){a(this,t),this.mass=0,this.center=new Vt(0,0),this.I=0};(nn=t.b2ShapeType||(t.b2ShapeType={}))[nn.e_unknown=-1]="e_unknown",nn[nn.e_circleShape=0]="e_circleShape",nn[nn.e_edgeShape=1]="e_edgeShape",nn[nn.e_polygonShape=2]="e_polygonShape",nn[nn.e_chainShape=3]="e_chainShape",nn[nn.e_shapeTypeCount=4]="e_shapeTypeCount";var sn=function(){function e(i,n){a(this,e),this.m_type=t.b2ShapeType.e_unknown,this.m_radius=0,this.m_type=i,this.m_radius=n}return u(e,[{key:"Copy",value:function(t){return this.m_radius=t.m_radius,this}},{key:"GetType",value:function(){return this.m_type}}]),e}(),on=function(e){s(l,e);var i=o(l);function l(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return a(this,l),(e=i.call(this,t.b2ShapeType.e_circleShape,n)).m_p=new Vt,e}return u(l,[{key:"Set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.m_radius;return this.m_p.Copy(t),this.m_radius=e,this}},{key:"Clone",value:function(){return(new l).Copy(this)}},{key:"Copy",value:function(t){return n(r(l.prototype),"Copy",this).call(this,t),this.m_p.Copy(t.m_p),this}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){var i=Dt.MulXV(t,this.m_p,l.TestPoint_s_center),n=Vt.SubVV(e,i,l.TestPoint_s_d);return Vt.DotVV(n,n)<=mt(this.m_radius)}},{key:"ComputeDistance",value:function(t,e,i,n){var r=Dt.MulXV(t,this.m_p,l.ComputeDistance_s_center);return Vt.SubVV(e,r,i),i.Normalize()-this.m_radius}},{key:"RayCast",value:function(t,e,i,n){var r=Dt.MulXV(i,this.m_p,l.RayCast_s_position),s=Vt.SubVV(e.p1,r,l.RayCast_s_s),o=Vt.DotVV(s,s)-mt(this.m_radius),a=Vt.SubVV(e.p2,e.p1,l.RayCast_s_r),u=Vt.DotVV(s,a),h=Vt.DotVV(a,a),m=u*u-h*o;if(m<0||h<c)return!1;var _=-(u+ft(m));return 0<=_&&_<=e.maxFraction*h&&(_/=h,t.fraction=_,Vt.AddVMulSV(s,_,a,t.normal).SelfNormalize(),!0)}},{key:"ComputeAABB",value:function(t,e,i){var n=Dt.MulXV(e,this.m_p,l.ComputeAABB_s_p);t.lowerBound.Set(n.x-this.m_radius,n.y-this.m_radius),t.upperBound.Set(n.x+this.m_radius,n.y+this.m_radius)}},{key:"ComputeMass",value:function(t,e){var i=mt(this.m_radius);t.mass=e*_*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+Vt.DotVV(this.m_p,this.m_p))}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,n){var r=Dt.MulXV(i,this.m_p,new Vt),s=-(Vt.DotVV(t,r)-e);if(s<-this.m_radius+c)return 0;if(s>this.m_radius)return n.Copy(r),_*this.m_radius*this.m_radius;var o=this.m_radius*this.m_radius,a=s*s,u=o*(bt(s/this.m_radius)+_/2)+s*ft(o-a),l=-2/3*dt(o-a,1.5)/u;return n.x=r.x+t.x*l,n.y=r.y+t.y*l,u}},{key:"Dump",value:function(t){t("    const shape: b2CircleShape = new b2CircleShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)}}]),l}(sn);on.TestPoint_s_center=new Vt,on.TestPoint_s_d=new Vt,on.ComputeDistance_s_center=new Vt,on.RayCast_s_position=new Vt,on.RayCast_s_s=new Vt,on.RayCast_s_r=new Vt,on.ComputeAABB_s_p=new Vt;var an=function(e){s(l,e);var i=o(l);function l(){var e;return a(this,l),(e=i.call(this,t.b2ShapeType.e_polygonShape,x)).m_centroid=new Vt(0,0),e.m_vertices=[],e.m_normals=[],e.m_count=0,e}return u(l,[{key:"Clone",value:function(){return(new l).Copy(this)}},{key:"Copy",value:function(t){n(r(l.prototype),"Copy",this).call(this,t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=Vt.MakeArray(this.m_count),this.m_normals=Vt.MakeArray(this.m_count);for(var e=0;e<this.m_count;++e)this.m_vertices[e].Copy(t.m_vertices[e]),this.m_normals[e].Copy(t.m_normals[e]);return this}},{key:"GetChildCount",value:function(){return 1}},{key:"Set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e<3)return this.SetAsBox(1,1);for(var n=e,r=[],s=0;s<n;++s){for(var o=t[i+s],a=!0,u=0;u<r.length;++u)if(Vt.DistanceSquaredVV(o,r[u])<.5*y*(.5*y)){a=!1;break}a&&r.push(o)}if((n=r.length)<3)return this.SetAsBox(1,1);for(var h=0,c=r[0].x,m=1;m<n;++m){var _=r[m].x;(_>c||_===c&&r[m].y<r[h].y)&&(h=m,c=_)}for(var f=[],d=0,p=h;;){f[d]=p;for(var v=0,g=1;g<n;++g)if(v!==p){var x=Vt.SubVV(r[v],r[f[d]],l.Set_s_r),b=Vt.SubVV(r[g],r[f[d]],l.Set_s_v),w=Vt.CrossVV(x,b);w<0&&(v=g),0===w&&b.LengthSquared()>x.LengthSquared()&&(v=g)}else v=g;if(++d,p=v,v===h)break}this.m_count=d,this.m_vertices=Vt.MakeArray(this.m_count),this.m_normals=Vt.MakeArray(this.m_count);for(var A=0;A<d;++A)this.m_vertices[A].Copy(r[f[A]]);for(var S=0;S<d;++S){var B=this.m_vertices[S],C=this.m_vertices[(S+1)%d],V=Vt.SubVV(C,B,Vt.s_t0);Vt.CrossVOne(V,this.m_normals[S]).SelfNormalize()}return l.ComputeCentroid(this.m_vertices,d,this.m_centroid),this}},{key:"SetAsArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length;return this.Set(t,e)}},{key:"SetAsBox",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(this.m_count=4,this.m_vertices=Vt.MakeArray(this.m_count),this.m_normals=Vt.MakeArray(this.m_count),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i){this.m_centroid.Copy(i);var r=new Dt;r.SetPosition(i),r.SetRotationAngle(n);for(var s=0;s<this.m_count;++s)Dt.MulXV(r,this.m_vertices[s],this.m_vertices[s]),Tt.MulRV(r.q,this.m_normals[s],this.m_normals[s])}return this}},{key:"TestPoint",value:function(t,e){for(var i=Dt.MulTXV(t,e,l.TestPoint_s_pLocal),n=0;n<this.m_count;++n)if(Vt.DotVV(this.m_normals[n],Vt.SubVV(i,this.m_vertices[n],Vt.s_t0))>0)return!1;return!0}},{key:"ComputeDistance",value:function(t,e,i,n){for(var r=Dt.MulTXV(t,e,l.ComputeDistance_s_pLocal),s=-h,o=l.ComputeDistance_s_normalForMaxDistance.Copy(r),a=0;a<this.m_count;++a){var u=Vt.DotVV(this.m_normals[a],Vt.SubVV(r,this.m_vertices[a],Vt.s_t0));u>s&&(s=u,o.Copy(this.m_normals[a]))}if(s>0){for(var c=l.ComputeDistance_s_minDistance.Copy(o),m=s*s,_=0;_<this.m_count;++_){var f=Vt.SubVV(r,this.m_vertices[_],l.ComputeDistance_s_distance),d=f.LengthSquared();m>d&&(c.Copy(f),m=d)}return Tt.MulRV(t.q,c,i),i.Normalize(),Math.sqrt(m)}return Tt.MulRV(t.q,o,i),s}},{key:"RayCast",value:function(t,e,i,n){for(var r=Dt.MulTXV(i,e.p1,l.RayCast_s_p1),s=Dt.MulTXV(i,e.p2,l.RayCast_s_p2),o=Vt.SubVV(s,r,l.RayCast_s_d),a=0,u=e.maxFraction,h=-1,c=0;c<this.m_count;++c){var m=Vt.DotVV(this.m_normals[c],Vt.SubVV(this.m_vertices[c],r,Vt.s_t0)),_=Vt.DotVV(this.m_normals[c],o);if(0===_){if(m<0)return!1}else _<0&&m<a*_?(a=m/_,h=c):_>0&&m<u*_&&(u=m/_);if(u<a)return!1}return h>=0&&(t.fraction=a,Tt.MulRV(i.q,this.m_normals[h],t.normal),!0)}},{key:"ComputeAABB",value:function(t,e,i){for(var n=Dt.MulXV(e,this.m_vertices[0],t.lowerBound),r=t.upperBound.Copy(n),s=0;s<this.m_count;++s){var o=Dt.MulXV(e,this.m_vertices[s],l.ComputeAABB_s_v);Vt.MinV(o,n,n),Vt.MaxV(o,r,r)}var a=this.m_radius;n.SelfSubXY(a,a),r.SelfAddXY(a,a)}},{key:"ComputeMass",value:function(t,e){for(var i=l.ComputeMass_s_center.SetZero(),n=0,r=0,s=l.ComputeMass_s_s.SetZero(),o=0;o<this.m_count;++o)s.SelfAdd(this.m_vertices[o]);s.SelfMul(1/this.m_count);for(var a=1/3,u=0;u<this.m_count;++u){var h=Vt.SubVV(this.m_vertices[u],s,l.ComputeMass_s_e1),c=Vt.SubVV(this.m_vertices[(u+1)%this.m_count],s,l.ComputeMass_s_e2),m=Vt.CrossVV(h,c),_=.5*m;n+=_,i.SelfAdd(Vt.MulSV(_*a,Vt.AddVV(h,c,Vt.s_t0),Vt.s_t1));var f=h.x,d=h.y,p=c.x,v=c.y;r+=.25*a*m*(f*f+p*f+p*p+(d*d+v*d+v*v))}t.mass=e*n,i.SelfMul(1/n),Vt.AddVV(i,s,t.center),t.I=e*r,t.I+=t.mass*(Vt.DotVV(t.center,t.center)-Vt.DotVV(i,i))}},{key:"Validate",value:function(){for(var t=0;t<this.m_count;++t)for(var e=t,i=(t+1)%this.m_count,n=this.m_vertices[e],r=Vt.SubVV(this.m_vertices[i],n,l.Validate_s_e),s=0;s<this.m_count;++s)if(s!==e&&s!==i){var o=Vt.SubVV(this.m_vertices[s],n,l.Validate_s_v);if(Vt.CrossVV(r,o)<0)return!1}return!0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,n){for(var r=Tt.MulTRV(i.q,t,l.ComputeSubmergedArea_s_normalL),s=e-Vt.DotVV(t,i.p),o=[],a=0,u=-1,h=-1,m=!1,_=0;_<this.m_count;++_){o[_]=Vt.DotVV(r,this.m_vertices[_])-s;var f=o[_]<-c;_>0&&(f?m||(u=_-1,a++):m&&(h=_-1,a++)),m=f}switch(a){case 0:if(m){var d=l.ComputeSubmergedArea_s_md;return this.ComputeMass(d,1),Dt.MulXV(i,d.center,n),d.mass}return 0;case 1:-1===u?u=this.m_count-1:h=this.m_count-1}for(var p,v=(u+1)%this.m_count,y=(h+1)%this.m_count,g=(0-o[u])/(o[v]-o[u]),x=(0-o[h])/(o[y]-o[h]),b=l.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[u].x*(1-g)+this.m_vertices[v].x*g,this.m_vertices[u].y*(1-g)+this.m_vertices[v].y*g),w=l.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[h].x*(1-x)+this.m_vertices[y].x*x,this.m_vertices[h].y*(1-x)+this.m_vertices[y].y*x),A=0,S=l.ComputeSubmergedArea_s_center.SetZero(),B=this.m_vertices[v],C=v;C!==y;){p=(C=(C+1)%this.m_count)===y?w:this.m_vertices[C];var V=.5*((B.x-b.x)*(p.y-b.y)-(B.y-b.y)*(p.x-b.x));A+=V,S.x+=V*(b.x+B.x+p.x)/3,S.y+=V*(b.y+B.y+p.y)/3,B=p}return S.SelfMul(1/A),Dt.MulXV(i,S,n),A}},{key:"Dump",value:function(t){t("    const shape: b2PolygonShape = new b2PolygonShape();\n"),t("    const vs: b2Vec2[] = [];\n");for(var e=0;e<this.m_count;++e)t("    vs[%d] = new b2Vec2(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.Set(vs, %d);\n",this.m_count)}}],[{key:"ComputeCentroid",value:function(t,e,i){var n=i;n.SetZero();for(var r=0,s=l.ComputeCentroid_s_pRef.SetZero(),o=1/3,a=0;a<e;++a){var u=s,h=t[a],c=t[(a+1)%e],m=Vt.SubVV(h,u,l.ComputeCentroid_s_e1),_=Vt.SubVV(c,u,l.ComputeCentroid_s_e2),f=.5*Vt.CrossVV(m,_);r+=f,n.x+=f*o*(u.x+h.x+c.x),n.y+=f*o*(u.y+h.y+c.y)}return n.SelfMul(1/r),n}}]),l}(sn);an.Set_s_r=new Vt,an.Set_s_v=new Vt,an.TestPoint_s_pLocal=new Vt,an.ComputeDistance_s_pLocal=new Vt,an.ComputeDistance_s_normalForMaxDistance=new Vt,an.ComputeDistance_s_minDistance=new Vt,an.ComputeDistance_s_distance=new Vt,an.RayCast_s_p1=new Vt,an.RayCast_s_p2=new Vt,an.RayCast_s_d=new Vt,an.ComputeAABB_s_v=new Vt,an.ComputeMass_s_center=new Vt,an.ComputeMass_s_s=new Vt,an.ComputeMass_s_e1=new Vt,an.ComputeMass_s_e2=new Vt,an.Validate_s_e=new Vt,an.Validate_s_v=new Vt,an.ComputeSubmergedArea_s_normalL=new Vt,an.ComputeSubmergedArea_s_md=new rn,an.ComputeSubmergedArea_s_intoVec=new Vt,an.ComputeSubmergedArea_s_outoVec=new Vt,an.ComputeSubmergedArea_s_center=new Vt,an.ComputeCentroid_s_pRef=new Vt,an.ComputeCentroid_s_e1=new Vt,an.ComputeCentroid_s_e2=new Vt;var un=function(e){s(l,e);var i=o(l);function l(){var e;return a(this,l),(e=i.call(this,t.b2ShapeType.e_edgeShape,x)).m_vertex1=new Vt,e.m_vertex2=new Vt,e.m_vertex0=new Vt,e.m_vertex3=new Vt,e.m_hasVertex0=!1,e.m_hasVertex3=!1,e}return u(l,[{key:"Set",value:function(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this}},{key:"Clone",value:function(){return(new l).Copy(this)}},{key:"Copy",value:function(t){return n(r(l.prototype),"Copy",this).call(this,t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex3=t.m_hasVertex3,this}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){return!1}},{key:"ComputeDistance",value:function(t,e,i,n){var r=Dt.MulXV(t,this.m_vertex1,l.ComputeDistance_s_v1),s=Dt.MulXV(t,this.m_vertex2,l.ComputeDistance_s_v2),o=Vt.SubVV(e,r,l.ComputeDistance_s_d),a=Vt.SubVV(s,r,l.ComputeDistance_s_s),u=Vt.DotVV(o,a);if(u>0){var h=Vt.DotVV(a,a);u>h?Vt.SubVV(e,s,o):o.SelfMulSub(u/h,a)}return i.Copy(o),i.Normalize()}},{key:"RayCast",value:function(t,e,i,n){var r=Dt.MulTXV(i,e.p1,l.RayCast_s_p1),s=Dt.MulTXV(i,e.p2,l.RayCast_s_p2),o=Vt.SubVV(s,r,l.RayCast_s_d),a=this.m_vertex1,u=this.m_vertex2,h=Vt.SubVV(u,a,l.RayCast_s_e),c=t.normal.Set(h.y,-h.x).SelfNormalize(),m=Vt.DotVV(c,Vt.SubVV(a,r,Vt.s_t0)),_=Vt.DotVV(c,o);if(0===_)return!1;var f=m/_;if(f<0||e.maxFraction<f)return!1;var d=Vt.AddVMulSV(r,f,o,l.RayCast_s_q),p=Vt.SubVV(u,a,l.RayCast_s_r),v=Vt.DotVV(p,p);if(0===v)return!1;var y=Vt.DotVV(Vt.SubVV(d,a,Vt.s_t0),p)/v;return!(y<0||1<y)&&(t.fraction=f,Tt.MulRV(i.q,t.normal,t.normal),m>0&&t.normal.SelfNeg(),!0)}},{key:"ComputeAABB",value:function(t,e,i){var n=Dt.MulXV(e,this.m_vertex1,l.ComputeAABB_s_v1),r=Dt.MulXV(e,this.m_vertex2,l.ComputeAABB_s_v2);Vt.MinV(n,r,t.lowerBound),Vt.MaxV(n,r,t.upperBound);var s=this.m_radius;t.lowerBound.SelfSubXY(s,s),t.upperBound.SelfAddXY(s,s)}},{key:"ComputeMass",value:function(t,e){t.mass=0,Vt.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,n){return n.SetZero(),0}},{key:"Dump",value:function(t){t("    const shape: b2EdgeShape = new b2EdgeShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),t("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)}}]),l}(sn);un.ComputeDistance_s_v1=new Vt,un.ComputeDistance_s_v2=new Vt,un.ComputeDistance_s_d=new Vt,un.ComputeDistance_s_s=new Vt,un.RayCast_s_p1=new Vt,un.RayCast_s_p2=new Vt,un.RayCast_s_d=new Vt,un.RayCast_s_e=new Vt,un.RayCast_s_q=new Vt,un.RayCast_s_r=new Vt,un.ComputeAABB_s_v1=new Vt,un.ComputeAABB_s_v2=new Vt;var ln=function(e){s(l,e);var i=o(l);function l(){var e;return a(this,l),(e=i.call(this,t.b2ShapeType.e_chainShape,x)).m_vertices=[],e.m_count=0,e.m_prevVertex=new Vt,e.m_nextVertex=new Vt,e.m_hasPrevVertex=!1,e.m_hasNextVertex=!1,e}return u(l,[{key:"CreateLoop",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e<3)return this;this.m_count=e+1,this.m_vertices=Vt.MakeArray(this.m_count);for(var n=0;n<e;++n)this.m_vertices[n].Copy(t[i+n]);return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}},{key:"CreateChain",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.m_count=e,this.m_vertices=Vt.MakeArray(e);for(var n=0;n<e;++n)this.m_vertices[n].Copy(t[i+n]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this}},{key:"SetPrevVertex",value:function(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this}},{key:"SetNextVertex",value:function(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this}},{key:"Clone",value:function(){return(new l).Copy(this)}},{key:"Copy",value:function(t){return n(r(l.prototype),"Copy",this).call(this,t),this.CreateChain(t.m_vertices,t.m_count),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasNextVertex=t.m_hasNextVertex,this}},{key:"GetChildCount",value:function(){return this.m_count-1}},{key:"GetChildEdge",value:function(e,i){e.m_type=t.b2ShapeType.e_edgeShape,e.m_radius=this.m_radius,e.m_vertex1.Copy(this.m_vertices[i]),e.m_vertex2.Copy(this.m_vertices[i+1]),i>0?(e.m_vertex0.Copy(this.m_vertices[i-1]),e.m_hasVertex0=!0):(e.m_vertex0.Copy(this.m_prevVertex),e.m_hasVertex0=this.m_hasPrevVertex),i<this.m_count-2?(e.m_vertex3.Copy(this.m_vertices[i+2]),e.m_hasVertex3=!0):(e.m_vertex3.Copy(this.m_nextVertex),e.m_hasVertex3=this.m_hasNextVertex)}},{key:"TestPoint",value:function(t,e){return!1}},{key:"ComputeDistance",value:function(t,e,i,n){var r=l.ComputeDistance_s_edgeShape;return this.GetChildEdge(r,n),r.ComputeDistance(t,e,i,0)}},{key:"RayCast",value:function(t,e,i,n){var r=l.RayCast_s_edgeShape;return r.m_vertex1.Copy(this.m_vertices[n]),r.m_vertex2.Copy(this.m_vertices[(n+1)%this.m_count]),r.RayCast(t,e,i,0)}},{key:"ComputeAABB",value:function(t,e,i){var n=this.m_vertices[i],r=this.m_vertices[(i+1)%this.m_count],s=Dt.MulXV(e,n,l.ComputeAABB_s_v1),o=Dt.MulXV(e,r,l.ComputeAABB_s_v2);Vt.MinV(s,o,t.lowerBound),Vt.MaxV(s,o,t.upperBound)}},{key:"ComputeMass",value:function(t,e){t.mass=0,t.center.SetZero(),t.I=0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,n){return n.SetZero(),0}},{key:"Dump",value:function(t){t("    const shape: b2ChainShape = new b2ChainShape();\n"),t("    const vs: b2Vec2[] = [];\n");for(var e=0;e<this.m_count;++e)t("    vs[%d] = new bVec2(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.CreateChain(vs, %d);\n",this.m_count),t("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),t("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),t("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")}}]),l}(sn);ln.ComputeDistance_s_edgeShape=new un,ln.RayCast_s_edgeShape=new un,ln.ComputeAABB_s_v1=new Vt,ln.ComputeAABB_s_v2=new Vt;var hn=function(){function t(){a(this,t),this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}return u(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex||0,this}}]),t}();hn.DEFAULT=new hn;var cn,mn=function t(){a(this,t),this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new hn},_n=function t(e){a(this,t),this.aabb=new Me,this.childIndex=0,this.fixture=e},fn=function(){function t(e,i){a(this,t),this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_proxies=[],this.m_proxyCount=0,this.m_filter=new hn,this.m_isSensor=!1,this.m_userData=null,this.m_body=i,this.m_shape=e.shape.Clone()}return u(t,[{key:"GetType",value:function(){return this.m_shape.GetType()}},{key:"GetShape",value:function(){return this.m_shape}},{key:"SetSensor",value:function(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)}},{key:"IsSensor",value:function(){return this.m_isSensor}},{key:"SetFilterData",value:function(t){this.m_filter.Copy(t),this.Refilter()}},{key:"GetFilterData",value:function(){return this.m_filter}},{key:"Refilter",value:function(){for(var t=this.m_body.GetContactList();t;){var e=t.contact,i=e.GetFixtureA(),n=e.GetFixtureB();i!==this&&n!==this||e.FlagForFiltering(),t=t.next}var r=this.m_body.GetWorld();if(null!==r)for(var s=r.m_contactManager.m_broadPhase,o=0;o<this.m_proxyCount;++o)s.TouchProxy(this.m_proxies[o].treeNode)}},{key:"GetBody",value:function(){return this.m_body}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"TestPoint",value:function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)}},{key:"ComputeDistance",value:function(t,e,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,i)}},{key:"RayCast",value:function(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)}},{key:"GetMassData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new rn;return this.m_shape.ComputeMass(t,this.m_density),t}},{key:"SetDensity",value:function(t){this.m_density=t}},{key:"GetDensity",value:function(){return this.m_density}},{key:"GetFriction",value:function(){return this.m_friction}},{key:"SetFriction",value:function(t){this.m_friction=t}},{key:"GetRestitution",value:function(){return this.m_restitution}},{key:"SetRestitution",value:function(t){this.m_restitution=t}},{key:"GetAABB",value:function(t){return this.m_proxies[t].aabb}},{key:"Dump",value:function(t,e){t("    const fd: b2FixtureDef = new b2FixtureDef();\n"),t("    fd.friction = %.15f;\n",this.m_friction),t("    fd.restitution = %.15f;\n",this.m_restitution),t("    fd.density = %.15f;\n",this.m_density),t("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(t),t("\n"),t("    fd.shape = shape;\n"),t("\n"),t("    bodies[%d].CreateFixture(fd);\n",e)}},{key:"Create",value:function(t){var e=this;this.m_userData=t.userData,this.m_friction=i(t.friction,.2),this.m_restitution=i(t.restitution,0),this.m_next=null,this.m_filter.Copy(i(t.filter,hn.DEFAULT)),this.m_isSensor=i(t.isSensor,!1),this.m_proxies=tt(this.m_shape.GetChildCount(),(function(t){return new _n(e)})),this.m_proxyCount=0,this.m_density=i(t.density,0)}},{key:"Destroy",value:function(){}},{key:"CreateProxies",value:function(t){var e=this.m_body.m_world.m_contactManager.m_broadPhase;this.m_proxyCount=this.m_shape.GetChildCount();for(var i=0;i<this.m_proxyCount;++i){var n=this.m_proxies[i]=new _n(this);this.m_shape.ComputeAABB(n.aabb,t,i),n.treeNode=e.CreateProxy(n.aabb,n),n.childIndex=i}}},{key:"DestroyProxies",value:function(){for(var t=this.m_body.m_world.m_contactManager.m_broadPhase,e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];delete i.treeNode.userData,t.DestroyProxy(i.treeNode),delete i.treeNode}this.m_proxyCount=0}},{key:"TouchProxies",value:function(){for(var t=this.m_body.m_world.m_contactManager.m_broadPhase,e=this.m_proxyCount,i=0;i<e;++i)t.TouchProxy(this.m_proxies[i].treeNode)}},{key:"Synchronize",value:function(e,i){if(0!==this.m_proxyCount)for(var n=this.m_body.m_world.m_contactManager.m_broadPhase,r=0;r<this.m_proxyCount;++r){var s=this.m_proxies[r],o=t.Synchronize_s_aabb1,a=t.Synchronize_s_aabb2;this.m_shape.ComputeAABB(o,e,r),this.m_shape.ComputeAABB(a,i,r),s.aabb.Combine2(o,a);var u=Vt.SubVV(i.p,e.p,t.Synchronize_s_displacement);n.MoveProxy(s.treeNode,s.aabb,u)}}}]),t}();fn.Synchronize_s_aabb1=new Me,fn.Synchronize_s_aabb2=new Me,fn.Synchronize_s_displacement=new Vt,(cn=t.b2BodyType||(t.b2BodyType={}))[cn.b2_unknown=-1]="b2_unknown",cn[cn.b2_staticBody=0]="b2_staticBody",cn[cn.b2_kinematicBody=1]="b2_kinematicBody",cn[cn.b2_dynamicBody=2]="b2_dynamicBody";var dn,pn,vn=function e(){a(this,e),this.type=t.b2BodyType.b2_staticBody,this.position=new Vt(0,0),this.angle=0,this.linearVelocity=new Vt(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1},yn=function(){function e(n,r){a(this,e),this.m_type=t.b2BodyType.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new Dt,this.m_xf0=new Dt,this.m_sweep=new Rt,this.m_linearVelocity=new Vt,this.m_angularVelocity=0,this.m_force=new Vt,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,this.m_bulletFlag=i(n.bullet,!1),this.m_fixedRotationFlag=i(n.fixedRotation,!1),this.m_autoSleepFlag=i(n.allowSleep,!0),this.m_awakeFlag=i(n.awake,!0),this.m_activeFlag=i(n.active,!0),this.m_world=r,this.m_xf.p.Copy(i(n.position,Vt.ZERO)),this.m_xf.q.SetAngle(i(n.angle,0)),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(i(n.linearVelocity,Vt.ZERO)),this.m_angularVelocity=i(n.angularVelocity,0),this.m_linearDamping=i(n.linearDamping,0),this.m_angularDamping=i(n.angularDamping,0),this.m_gravityScale=i(n.gravityScale,1),this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=i(n.type,t.b2BodyType.b2_staticBody),n.type===t.b2BodyType.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=n.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0}return u(e,[{key:"CreateFixture",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t instanceof sn?this.CreateFixtureShapeDensity(t,e):this.CreateFixtureDef(t)}},{key:"CreateFixtureDef",value:function(t){if(this.m_world.IsLocked())throw new Error;var e=new fn(t,this);return e.Create(t),this.m_activeFlag&&e.CreateProxies(this.m_xf),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newFixture=!0,e}},{key:"CreateFixtureShapeDensity",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.CreateFixtureShapeDensity_s_def;return n.shape=t,n.density=i,this.CreateFixtureDef(n)}},{key:"DestroyFixture",value:function(t){if(this.m_world.IsLocked())throw new Error;for(var e=this.m_fixtureList,i=null;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}i=e,e=e.m_next}for(var n=this.m_contactList;n;){var r=n.contact;n=n.next;var s=r.GetFixtureA(),o=r.GetFixtureB();t!==s&&t!==o||this.m_world.m_contactManager.Destroy(r)}this.m_activeFlag&&t.DestroyProxies(),t.m_next=null,t.Destroy(),--this.m_fixtureCount,this.ResetMassData()}},{key:"SetTransformVec",value:function(t,e){this.SetTransformXY(t.x,t.y,e)}},{key:"SetTransformXY",value:function(t,e,i){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),Dt.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(var n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},{key:"SetTransform",value:function(t){this.SetTransformVec(t.p,t.GetAngle())}},{key:"GetTransform",value:function(){return this.m_xf}},{key:"GetPosition",value:function(){return this.m_xf.p}},{key:"SetPosition",value:function(t){this.SetTransformVec(t,this.GetAngle())}},{key:"SetPositionXY",value:function(t,e){this.SetTransformXY(t,e,this.GetAngle())}},{key:"GetAngle",value:function(){return this.m_sweep.a}},{key:"SetAngle",value:function(t){this.SetTransformVec(this.GetPosition(),t)}},{key:"GetWorldCenter",value:function(){return this.m_sweep.c}},{key:"GetLocalCenter",value:function(){return this.m_sweep.localCenter}},{key:"SetLinearVelocity",value:function(e){this.m_type!==t.b2BodyType.b2_staticBody&&(Vt.DotVV(e,e)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(e))}},{key:"GetLinearVelocity",value:function(){return this.m_linearVelocity}},{key:"SetAngularVelocity",value:function(e){this.m_type!==t.b2BodyType.b2_staticBody&&(e*e>0&&this.SetAwake(!0),this.m_angularVelocity=e)}},{key:"GetAngularVelocity",value:function(){return this.m_angularVelocity}},{key:"GetDefinition",value:function(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t}},{key:"ApplyForce",value:function(e,i){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.m_type===t.b2BodyType.b2_dynamicBody&&(n&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(i.x-this.m_sweep.c.x)*e.y-(i.y-this.m_sweep.c.y)*e.x))}},{key:"ApplyForceToCenter",value:function(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=e.x,this.m_force.y+=e.y))}},{key:"ApplyTorque",value:function(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=e))}},{key:"ApplyLinearImpulse",value:function(e,i){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.m_type===t.b2BodyType.b2_dynamicBody&&(n&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((i.x-this.m_sweep.c.x)*e.y-(i.y-this.m_sweep.c.y)*e.x)))}},{key:"ApplyLinearImpulseToCenter",value:function(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y))}},{key:"ApplyAngularImpulse",value:function(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*e))}},{key:"GetMass",value:function(){return this.m_mass}},{key:"GetInertia",value:function(){return this.m_I+this.m_mass*Vt.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)}},{key:"GetMassData",value:function(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*Vt.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}},{key:"SetMassData",value:function(i){if(this.m_world.IsLocked())throw new Error;if(this.m_type===t.b2BodyType.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=i.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,i.I>0&&!this.m_fixedRotationFlag&&(this.m_I=i.I-this.m_mass*Vt.DotVV(i.center,i.center),this.m_invI=1/this.m_I);var n=e.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(i.center),Dt.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),Vt.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,Vt.SubVV(this.m_sweep.c,n,Vt.s_t0),this.m_linearVelocity)}}},{key:"ResetMassData",value:function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===t.b2BodyType.b2_staticBody||this.m_type===t.b2BodyType.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var i=e.ResetMassData_s_localCenter.SetZero(),n=this.m_fixtureList;n;n=n.m_next)if(0!==n.m_density){var r=n.GetMassData(e.ResetMassData_s_massData);this.m_mass+=r.mass,i.x+=r.center.x*r.mass,i.y+=r.center.y*r.mass,this.m_I+=r.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,i.x*=this.m_invMass,i.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*Vt.DotVV(i,i),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var s=e.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(i),Dt.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),Vt.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,Vt.SubVV(this.m_sweep.c,s,Vt.s_t0),this.m_linearVelocity)}},{key:"GetWorldPoint",value:function(t,e){return Dt.MulXV(this.m_xf,t,e)}},{key:"GetWorldVector",value:function(t,e){return Tt.MulRV(this.m_xf.q,t,e)}},{key:"GetLocalPoint",value:function(t,e){return Dt.MulTXV(this.m_xf,t,e)}},{key:"GetLocalVector",value:function(t,e){return Tt.MulTRV(this.m_xf.q,t,e)}},{key:"GetLinearVelocityFromWorldPoint",value:function(t,e){return Vt.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,Vt.SubVV(t,this.m_sweep.c,Vt.s_t0),e)}},{key:"GetLinearVelocityFromLocalPoint",value:function(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)}},{key:"GetLinearDamping",value:function(){return this.m_linearDamping}},{key:"SetLinearDamping",value:function(t){this.m_linearDamping=t}},{key:"GetAngularDamping",value:function(){return this.m_angularDamping}},{key:"SetAngularDamping",value:function(t){this.m_angularDamping=t}},{key:"GetGravityScale",value:function(){return this.m_gravityScale}},{key:"SetGravityScale",value:function(t){this.m_gravityScale=t}},{key:"SetType",value:function(e){if(this.m_world.IsLocked())throw new Error;if(this.m_type!==e){this.m_type=e,this.ResetMassData(),this.m_type===t.b2BodyType.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var i=this.m_contactList;i;){var n=i;i=i.next,this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null;for(var r=this.m_fixtureList;r;r=r.m_next)r.TouchProxies()}}},{key:"GetType",value:function(){return this.m_type}},{key:"SetBullet",value:function(t){this.m_bulletFlag=t}},{key:"IsBullet",value:function(){return this.m_bulletFlag}},{key:"SetSleepingAllowed",value:function(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}},{key:"IsSleepingAllowed",value:function(){return this.m_autoSleepFlag}},{key:"SetAwake",value:function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)}},{key:"IsAwake",value:function(){return this.m_awakeFlag}},{key:"SetActive",value:function(t){if(this.m_world.IsLocked())throw new Error;if(t!==this.IsActive())if(this.m_activeFlag=t,t)for(var e=this.m_fixtureList;e;e=e.m_next)e.CreateProxies(this.m_xf);else{for(var i=this.m_fixtureList;i;i=i.m_next)i.DestroyProxies();for(var n=this.m_contactList;n;){var r=n;n=n.next,this.m_world.m_contactManager.Destroy(r.contact)}this.m_contactList=null}}},{key:"IsActive",value:function(){return this.m_activeFlag}},{key:"SetFixedRotation",value:function(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}},{key:"IsFixedRotation",value:function(){return this.m_fixedRotationFlag}},{key:"GetFixtureList",value:function(){return this.m_fixtureList}},{key:"GetJointList",value:function(){return this.m_jointList}},{key:"GetContactList",value:function(){return this.m_contactList}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"GetWorld",value:function(){return this.m_world}},{key:"Dump",value:function(e){var i=this.m_islandIndex;e("{\n"),e("  const bd: b2BodyDef = new b2BodyDef();\n");var n="";switch(this.m_type){case t.b2BodyType.b2_staticBody:n="b2BodyType.b2_staticBody";break;case t.b2BodyType.b2_kinematicBody:n="b2BodyType.b2_kinematicBody";break;case t.b2BodyType.b2_dynamicBody:n="b2BodyType.b2_dynamicBody"}e("  bd.type = %s;\n",n),e("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),e("  bd.angle = %.15f;\n",this.m_sweep.a),e("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),e("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),e("  bd.linearDamping = %.15f;\n",this.m_linearDamping),e("  bd.angularDamping = %.15f;\n",this.m_angularDamping),e("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),e("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),e("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),e("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),e("  bd.active = %s;\n",this.m_activeFlag?"true":"false"),e("  bd.gravityScale = %.15f;\n",this.m_gravityScale),e("\n"),e("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),e("\n");for(var r=this.m_fixtureList;r;r=r.m_next)e("  {\n"),r.Dump(e,i),e("  }\n");e("}\n")}},{key:"SynchronizeFixtures",value:function(){var t=e.SynchronizeFixtures_s_xf1;t.q.SetAngle(this.m_sweep.a0),Tt.MulRV(t.q,this.m_sweep.localCenter,t.p),Vt.SubVV(this.m_sweep.c0,t.p,t.p);for(var i=this.m_fixtureList;i;i=i.m_next)i.Synchronize(t,this.m_xf)}},{key:"SynchronizeTransform",value:function(){this.m_xf.q.SetAngle(this.m_sweep.a),Tt.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),Vt.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}},{key:"ShouldCollide",value:function(e){return(this.m_type!==t.b2BodyType.b2_staticBody||e.m_type!==t.b2BodyType.b2_staticBody)&&this.ShouldCollideConnected(e)}},{key:"ShouldCollideConnected",value:function(t){for(var e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0}},{key:"Advance",value:function(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),Tt.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),Vt.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}},{key:"GetControllerList",value:function(){return this.m_controllerList}},{key:"GetControllerCount",value:function(){return this.m_controllerCount}}]),e}();yn.CreateFixtureShapeDensity_s_def=new mn,yn.SetMassData_s_oldCenter=new Vt,yn.ResetMassData_s_localCenter=new Vt,yn.ResetMassData_s_oldCenter=new Vt,yn.ResetMassData_s_massData=new rn,yn.SynchronizeFixtures_s_xf1=new Dt,(pn=t.b2JointType||(t.b2JointType={}))[pn.e_unknownJoint=0]="e_unknownJoint",pn[pn.e_revoluteJoint=1]="e_revoluteJoint",pn[pn.e_prismaticJoint=2]="e_prismaticJoint",pn[pn.e_distanceJoint=3]="e_distanceJoint",pn[pn.e_pulleyJoint=4]="e_pulleyJoint",pn[pn.e_mouseJoint=5]="e_mouseJoint",pn[pn.e_gearJoint=6]="e_gearJoint",pn[pn.e_wheelJoint=7]="e_wheelJoint",pn[pn.e_weldJoint=8]="e_weldJoint",pn[pn.e_frictionJoint=9]="e_frictionJoint",pn[pn.e_ropeJoint=10]="e_ropeJoint",pn[pn.e_motorJoint=11]="e_motorJoint",pn[pn.e_areaJoint=12]="e_areaJoint",(dn=t.b2LimitState||(t.b2LimitState={}))[dn.e_inactiveLimit=0]="e_inactiveLimit",dn[dn.e_atLowerLimit=1]="e_atLowerLimit",dn[dn.e_atUpperLimit=2]="e_atUpperLimit",dn[dn.e_equalLimits=3]="e_equalLimits";var gn=function(){function t(){a(this,t),this.linear=new Vt,this.angularA=0,this.angularB=0}return u(t,[{key:"SetZero",value:function(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this}},{key:"Set",value:function(t,e,i){return this.linear.Copy(t),this.angularA=e,this.angularB=i,this}}]),t}(),xn=function t(e,i){a(this,t),this.prev=null,this.next=null,this.joint=e,this.other=i},bn=function e(i){a(this,e),this.type=t.b2JointType.e_unknownJoint,this.userData=null,this.collideConnected=!1,this.type=i},wn=function(){function e(n){a(this,e),this.m_type=t.b2JointType.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=n.type,this.m_edgeA=new xn(this,n.bodyB),this.m_edgeB=new xn(this,n.bodyA),this.m_bodyA=n.bodyA,this.m_bodyB=n.bodyB,this.m_collideConnected=i(n.collideConnected,!1),this.m_userData=n.userData}return u(e,[{key:"GetType",value:function(){return this.m_type}},{key:"GetBodyA",value:function(){return this.m_bodyA}},{key:"GetBodyB",value:function(){return this.m_bodyB}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"IsActive",value:function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()}},{key:"GetCollideConnected",value:function(){return this.m_collideConnected}},{key:"Dump",value:function(t){t("// Dump is not supported for this joint type.\n")}},{key:"ShiftOrigin",value:function(t){}}]),e}(),An=function(e){s(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_distanceJoint)).localAnchorA=new Vt,e.localAnchorB=new Vt,e.length=1,e.frequencyHz=0,e.dampingRatio=0,e}return u(n,[{key:"Initialize",value:function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.length=Vt.DistanceVV(i,n),this.frequencyHz=0,this.dampingRatio=0}}]),n}(bn),Sn=function(t){s(n,t);var e=o(n);function n(t){var r;return a(this,n),(r=e.call(this,t)).m_frequencyHz=0,r.m_dampingRatio=0,r.m_bias=0,r.m_localAnchorA=new Vt,r.m_localAnchorB=new Vt,r.m_gamma=0,r.m_impulse=0,r.m_length=0,r.m_indexA=0,r.m_indexB=0,r.m_u=new Vt,r.m_rA=new Vt,r.m_rB=new Vt,r.m_localCenterA=new Vt,r.m_localCenterB=new Vt,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_mass=0,r.m_qA=new Tt,r.m_qB=new Tt,r.m_lalcA=new Vt,r.m_lalcB=new Vt,r.m_frequencyHz=i(t.frequencyHz,0),r.m_dampingRatio=i(t.dampingRatio,0),r.m_localAnchorA.Copy(t.localAnchorA),r.m_localAnchorB.Copy(t.localAnchorB),r.m_length=t.length,r}return u(n,[{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse*this.m_u.x,e.y=t*this.m_impulse*this.m_u.y,e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetLength",value:function(t){this.m_length=t}},{key:"Length",value:function(){return this.m_length}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.length = %.15f;\n",this.m_length),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(i),c=this.m_qB.SetAngle(a);Vt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Tt.MulRV(h,this.m_lalcA,this.m_rA),Vt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Tt.MulRV(c,this.m_lalcB,this.m_rB),this.m_u.x=o.x+this.m_rB.x-e.x-this.m_rA.x,this.m_u.y=o.y+this.m_rB.y-e.y-this.m_rA.y;var m=this.m_u.Length();m>y?this.m_u.SelfMul(1/m):this.m_u.SetZero();var f=Vt.CrossVV(this.m_rA,this.m_u),d=Vt.CrossVV(this.m_rB,this.m_u),p=this.m_invMassA+this.m_invIA*f*f+this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=0!==p?1/p:0,this.m_frequencyHz>0){var v=m-this.m_length,g=2*_*this.m_frequencyHz,x=2*this.m_mass*this.m_dampingRatio*g,b=this.m_mass*g*g,w=t.step.dt;this.m_gamma=w*(x+w*b),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=v*w*b*this.m_gamma,p+=this.m_gamma,this.m_mass=0!==p?1/p:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var A=Vt.MulSV(this.m_impulse,this.m_u,n.InitVelocityConstraints_s_P);r.SelfMulSub(this.m_invMassA,A),s-=this.m_invIA*Vt.CrossVV(this.m_rA,A),u.SelfMulAdd(this.m_invMassB,A),l+=this.m_invIB*Vt.CrossVV(this.m_rB,A)}else this.m_impulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=l}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=Vt.AddVCrossSV(e,i,this.m_rA,n.SolveVelocityConstraints_s_vpA),a=Vt.AddVCrossSV(r,s,this.m_rB,n.SolveVelocityConstraints_s_vpB),u=Vt.DotVV(this.m_u,Vt.SubVV(a,o,Vt.s_t0)),l=-this.m_mass*(u+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=l;var h=Vt.MulSV(l,this.m_u,n.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,h),i-=this.m_invIA*Vt.CrossVV(this.m_rA,h),r.SelfMulAdd(this.m_invMassB,h),s+=this.m_invIB*Vt.CrossVV(this.m_rB,h),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){if(this.m_frequencyHz>0)return!0;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(s),u=Tt.MulRV(o,this.m_lalcA,this.m_rA),l=Tt.MulRV(a,this.m_lalcB,this.m_rB),h=this.m_u;h.x=r.x+l.x-e.x-u.x,h.y=r.y+l.y-e.y-u.y;var c=this.m_u.Normalize()-this.m_length;c=lt(c,-S,S);var m=-this.m_mass*c,_=Vt.MulSV(m,h,n.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,_),i-=this.m_invIA*Vt.CrossVV(u,_),r.SelfMulAdd(this.m_invMassB,_),s+=this.m_invIB*Vt.CrossVV(l,_),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,ot(c)<y}}]),n}(wn);Sn.InitVelocityConstraints_s_P=new Vt,Sn.SolveVelocityConstraints_s_vpA=new Vt,Sn.SolveVelocityConstraints_s_vpB=new Vt,Sn.SolveVelocityConstraints_s_P=new Vt,Sn.SolvePositionConstraints_s_P=new Vt;var Bn=function(e){s(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_areaJoint)).bodies=[],e.frequencyHz=0,e.dampingRatio=0,e}return u(n,[{key:"AddBody",value:function(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)}}]),n}(bn),Cn=function(t){s(n,t);var e=o(n);function n(t){var r;a(this,n),(r=e.call(this,t)).m_frequencyHz=0,r.m_dampingRatio=0,r.m_impulse=0,r.m_targetArea=0,r.m_bodies=t.bodies,r.m_frequencyHz=i(t.frequencyHz,0),r.m_dampingRatio=i(t.dampingRatio,0),r.m_targetLengths=it(t.bodies.length),r.m_normals=Vt.MakeArray(t.bodies.length),r.m_joints=[],r.m_deltas=Vt.MakeArray(t.bodies.length),r.m_delta=new Vt;var s=new An;s.frequencyHz=r.m_frequencyHz,s.dampingRatio=r.m_dampingRatio,r.m_targetArea=0;for(var o=0;o<r.m_bodies.length;++o){var u=r.m_bodies[o],l=r.m_bodies[(o+1)%r.m_bodies.length],h=u.GetWorldCenter(),c=l.GetWorldCenter();r.m_targetLengths[o]=Vt.DistanceVV(h,c),r.m_targetArea+=Vt.CrossVV(h,c),s.Initialize(u,l,h,c),r.m_joints[o]=u.GetWorld().CreateJoint(s)}return r.m_targetArea*=.5,r}return u(n,[{key:"GetAnchorA",value:function(t){return t}},{key:"GetAnchorB",value:function(t){return t}},{key:"GetReactionForce",value:function(t,e){return e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetFrequency(t)}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDampingRatio(t)}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"Dump",value:function(t){t("Area joint dumping is not supported.\n")}},{key:"InitVelocityConstraints",value:function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],n=this.m_bodies[(e+1)%this.m_bodies.length],r=t.positions[i.m_islandIndex].c,s=t.positions[n.m_islandIndex].c,o=this.m_deltas[e];Vt.SubVV(s,r,o)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(var a=0;a<this.m_bodies.length;++a){var u=this.m_bodies[a],l=t.velocities[u.m_islandIndex].v,h=this.m_deltas[a];l.x+=u.m_invMass*h.y*.5*this.m_impulse,l.y+=u.m_invMass*-h.x*.5*this.m_impulse}}else this.m_impulse=0}},{key:"SolveVelocityConstraints",value:function(t){for(var e=0,i=0,n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n],s=t.velocities[r.m_islandIndex].v,o=this.m_deltas[n];e+=o.LengthSquared()/r.GetMass(),i+=Vt.CrossVV(s,o)}var a=-2*i/e;this.m_impulse+=a;for(var u=0;u<this.m_bodies.length;++u){var l=this.m_bodies[u],h=t.velocities[l.m_islandIndex].v,c=this.m_deltas[u];h.x+=l.m_invMass*c.y*.5*a,h.y+=l.m_invMass*-c.x*.5*a}}},{key:"SolvePositionConstraints",value:function(t){for(var e=0,i=0,n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n],s=this.m_bodies[(n+1)%this.m_bodies.length],o=t.positions[r.m_islandIndex].c,a=t.positions[s.m_islandIndex].c,u=Vt.SubVV(a,o,this.m_delta),l=u.Length();l<c&&(l=1),this.m_normals[n].x=u.y/l,this.m_normals[n].y=-u.x/l,e+=l,i+=Vt.CrossVV(o,a)}i*=.5;for(var h=.5*(this.m_targetArea-i)/e,m=!0,_=0;_<this.m_bodies.length;++_){var f=this.m_bodies[_],d=t.positions[f.m_islandIndex].c,p=(_+1)%this.m_bodies.length,v=Vt.AddVV(this.m_normals[_],this.m_normals[p],this.m_delta);v.SelfMul(h);var g=v.LengthSquared();g>mt(S)&&v.SelfMul(S/ft(g)),g>mt(y)&&(m=!1),d.x+=v.x,d.y+=v.y}return m}}]),n}(wn),Vn=function(e){s(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_frictionJoint)).localAnchorA=new Vt,e.localAnchorB=new Vt,e.maxForce=0,e.maxTorque=0,e}return u(n,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB)}}]),n}(bn),Mn=function(t){s(n,t);var e=o(n);function n(t){var r;return a(this,n),(r=e.call(this,t)).m_localAnchorA=new Vt,r.m_localAnchorB=new Vt,r.m_linearImpulse=new Vt,r.m_angularImpulse=0,r.m_maxForce=0,r.m_maxTorque=0,r.m_indexA=0,r.m_indexB=0,r.m_rA=new Vt,r.m_rB=new Vt,r.m_localCenterA=new Vt,r.m_localCenterB=new Vt,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_linearMass=new Pt,r.m_angularMass=0,r.m_qA=new Tt,r.m_qB=new Tt,r.m_lalcA=new Vt,r.m_lalcB=new Vt,r.m_K=new Pt,r.m_localAnchorA.Copy(t.localAnchorA),r.m_localAnchorB.Copy(t.localAnchorB),r.m_linearImpulse.SetZero(),r.m_maxForce=i(t.maxForce,0),r.m_maxTorque=i(t.maxTorque,0),r.m_linearMass.SetZero(),r}return u(n,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,a=this.m_qA.SetAngle(e),u=this.m_qB.SetAngle(r);Vt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=Tt.MulRV(a,this.m_lalcA,this.m_rA);Vt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var h=Tt.MulRV(u,this.m_lalcB,this.m_rB),c=this.m_invMassA,m=this.m_invMassB,_=this.m_invIA,f=this.m_invIB,d=this.m_K;if(d.ex.x=c+m+_*l.y*l.y+f*h.y*h.y,d.ex.y=-_*l.x*l.y-f*h.x*h.y,d.ey.x=d.ex.y,d.ey.y=c+m+_*l.x*l.x+f*h.x*h.x,d.GetInverse(this.m_linearMass),this.m_angularMass=_+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var p=this.m_linearImpulse;i.SelfMulSub(c,p),n-=_*(Vt.CrossVV(this.m_rA,p)+this.m_angularImpulse),s.SelfMulAdd(m,p),o+=f*(Vt.CrossVV(this.m_rB,p)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=o}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,u=this.m_invIA,l=this.m_invIB,h=t.step.dt,c=s-i,m=-this.m_angularMass*c,_=this.m_angularImpulse,f=h*this.m_maxTorque;this.m_angularImpulse=lt(this.m_angularImpulse+m,-f,f),i-=u*(m=this.m_angularImpulse-_),s+=l*m;var d=Vt.SubVV(Vt.AddVCrossSV(r,s,this.m_rB,Vt.s_t0),Vt.AddVCrossSV(e,i,this.m_rA,Vt.s_t1),n.SolveVelocityConstraints_s_Cdot_v2),p=Pt.MulMV(this.m_linearMass,d,n.SolveVelocityConstraints_s_impulseV).SelfNeg(),v=n.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(p);var y=h*this.m_maxForce;this.m_linearImpulse.LengthSquared()>y*y&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(y)),Vt.SubVV(this.m_linearImpulse,v,p),e.SelfMulSub(o,p),i-=u*Vt.CrossVV(this.m_rA,p),r.SelfMulAdd(a,p),s+=l*Vt.CrossVV(this.m_rB,p),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_angularImpulse}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetMaxTorque",value:function(t){this.m_maxTorque=t}},{key:"GetMaxTorque",value:function(){return this.m_maxTorque}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),n}(wn);Mn.SolveVelocityConstraints_s_Cdot_v2=new Vt,Mn.SolveVelocityConstraints_s_impulseV=new Vt,Mn.SolveVelocityConstraints_s_oldImpulseV=new Vt;var kn=function(e){s(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_gearJoint)).ratio=1,e}return n}(bn),Pn=function(e){s(r,e);var n=o(r);function r(e){var s,o,u;a(this,r),(s=n.call(this,e)).m_typeA=t.b2JointType.e_unknownJoint,s.m_typeB=t.b2JointType.e_unknownJoint,s.m_localAnchorA=new Vt,s.m_localAnchorB=new Vt,s.m_localAnchorC=new Vt,s.m_localAnchorD=new Vt,s.m_localAxisC=new Vt,s.m_localAxisD=new Vt,s.m_referenceAngleA=0,s.m_referenceAngleB=0,s.m_constant=0,s.m_ratio=0,s.m_impulse=0,s.m_indexA=0,s.m_indexB=0,s.m_indexC=0,s.m_indexD=0,s.m_lcA=new Vt,s.m_lcB=new Vt,s.m_lcC=new Vt,s.m_lcD=new Vt,s.m_mA=0,s.m_mB=0,s.m_mC=0,s.m_mD=0,s.m_iA=0,s.m_iB=0,s.m_iC=0,s.m_iD=0,s.m_JvAC=new Vt,s.m_JvBD=new Vt,s.m_JwA=0,s.m_JwB=0,s.m_JwC=0,s.m_JwD=0,s.m_mass=0,s.m_qA=new Tt,s.m_qB=new Tt,s.m_qC=new Tt,s.m_qD=new Tt,s.m_lalcA=new Vt,s.m_lalcB=new Vt,s.m_lalcC=new Vt,s.m_lalcD=new Vt,s.m_joint1=e.joint1,s.m_joint2=e.joint2,s.m_typeA=s.m_joint1.GetType(),s.m_typeB=s.m_joint2.GetType(),s.m_bodyC=s.m_joint1.GetBodyA(),s.m_bodyA=s.m_joint1.GetBodyB();var l=s.m_bodyA.m_xf,h=s.m_bodyA.m_sweep.a,c=s.m_bodyC.m_xf,m=s.m_bodyC.m_sweep.a;if(s.m_typeA===t.b2JointType.e_revoluteJoint){var _=e.joint1;s.m_localAnchorC.Copy(_.m_localAnchorA),s.m_localAnchorA.Copy(_.m_localAnchorB),s.m_referenceAngleA=_.m_referenceAngle,s.m_localAxisC.SetZero(),o=h-m-s.m_referenceAngleA}else{var f=e.joint1;s.m_localAnchorC.Copy(f.m_localAnchorA),s.m_localAnchorA.Copy(f.m_localAnchorB),s.m_referenceAngleA=f.m_referenceAngle,s.m_localAxisC.Copy(f.m_localXAxisA);var d=s.m_localAnchorC,p=Tt.MulTRV(c.q,Vt.AddVV(Tt.MulRV(l.q,s.m_localAnchorA,Vt.s_t0),Vt.SubVV(l.p,c.p,Vt.s_t1),Vt.s_t0),Vt.s_t0);o=Vt.DotVV(Vt.SubVV(p,d,Vt.s_t0),s.m_localAxisC)}s.m_bodyD=s.m_joint2.GetBodyA(),s.m_bodyB=s.m_joint2.GetBodyB();var v=s.m_bodyB.m_xf,y=s.m_bodyB.m_sweep.a,g=s.m_bodyD.m_xf,x=s.m_bodyD.m_sweep.a;if(s.m_typeB===t.b2JointType.e_revoluteJoint){var b=e.joint2;s.m_localAnchorD.Copy(b.m_localAnchorA),s.m_localAnchorB.Copy(b.m_localAnchorB),s.m_referenceAngleB=b.m_referenceAngle,s.m_localAxisD.SetZero(),u=y-x-s.m_referenceAngleB}else{var w=e.joint2;s.m_localAnchorD.Copy(w.m_localAnchorA),s.m_localAnchorB.Copy(w.m_localAnchorB),s.m_referenceAngleB=w.m_referenceAngle,s.m_localAxisD.Copy(w.m_localXAxisA);var A=s.m_localAnchorD,S=Tt.MulTRV(g.q,Vt.AddVV(Tt.MulRV(v.q,s.m_localAnchorB,Vt.s_t0),Vt.SubVV(v.p,g.p,Vt.s_t1),Vt.s_t0),Vt.s_t0);u=Vt.DotVV(Vt.SubVV(S,A,Vt.s_t0),s.m_localAxisD)}return s.m_ratio=i(e.ratio,1),s.m_constant=o+s.m_ratio*u,s.m_impulse=0,s}return u(r,[{key:"InitVelocityConstraints",value:function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var i=e.positions[this.m_indexA].a,n=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,o=e.positions[this.m_indexB].a,a=e.velocities[this.m_indexB].v,u=e.velocities[this.m_indexB].w,l=e.positions[this.m_indexC].a,h=e.velocities[this.m_indexC].v,c=e.velocities[this.m_indexC].w,m=e.positions[this.m_indexD].a,_=e.velocities[this.m_indexD].v,f=e.velocities[this.m_indexD].w,d=this.m_qA.SetAngle(i),p=this.m_qB.SetAngle(o),v=this.m_qC.SetAngle(l),y=this.m_qD.SetAngle(m);if(this.m_mass=0,this.m_typeA===t.b2JointType.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var g=Tt.MulRV(v,this.m_localAxisC,r.InitVelocityConstraints_s_u);Vt.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var x=Tt.MulRV(v,this.m_lalcC,r.InitVelocityConstraints_s_rC);Vt.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var b=Tt.MulRV(d,this.m_lalcA,r.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(g),this.m_JwC=Vt.CrossVV(x,g),this.m_JwA=Vt.CrossVV(b,g),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===t.b2JointType.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var w=Tt.MulRV(y,this.m_localAxisD,r.InitVelocityConstraints_s_u);Vt.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var A=Tt.MulRV(y,this.m_lalcD,r.InitVelocityConstraints_s_rD);Vt.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var S=Tt.MulRV(p,this.m_lalcB,r.InitVelocityConstraints_s_rB);Vt.MulSV(this.m_ratio,w,this.m_JvBD),this.m_JwD=this.m_ratio*Vt.CrossVV(A,w),this.m_JwB=this.m_ratio*Vt.CrossVV(S,w),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,e.step.warmStarting?(n.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),s+=this.m_iA*this.m_impulse*this.m_JwA,a.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),u+=this.m_iB*this.m_impulse*this.m_JwB,h.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),c-=this.m_iC*this.m_impulse*this.m_JwC,_.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),f-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=u,e.velocities[this.m_indexC].w=c,e.velocities[this.m_indexD].w=f}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,s=t.velocities[this.m_indexC].v,o=t.velocities[this.m_indexC].w,a=t.velocities[this.m_indexD].v,u=t.velocities[this.m_indexD].w,l=Vt.DotVV(this.m_JvAC,Vt.SubVV(e,s,Vt.s_t0))+Vt.DotVV(this.m_JvBD,Vt.SubVV(n,a,Vt.s_t0));l+=this.m_JwA*i-this.m_JwC*o+(this.m_JwB*r-this.m_JwD*u);var h=-this.m_mass*l;this.m_impulse+=h,e.SelfMulAdd(this.m_mA*h,this.m_JvAC),i+=this.m_iA*h*this.m_JwA,n.SelfMulAdd(this.m_mB*h,this.m_JvBD),r+=this.m_iB*h*this.m_JwB,s.SelfMulSub(this.m_mC*h,this.m_JvAC),o-=this.m_iC*h*this.m_JwC,a.SelfMulSub(this.m_mD*h,this.m_JvBD),u-=this.m_iD*h*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r,t.velocities[this.m_indexC].w=o,t.velocities[this.m_indexD].w=u}},{key:"SolvePositionConstraints",value:function(e){var i,n,s,o,a,u,l=e.positions[this.m_indexA].c,h=e.positions[this.m_indexA].a,c=e.positions[this.m_indexB].c,m=e.positions[this.m_indexB].a,_=e.positions[this.m_indexC].c,f=e.positions[this.m_indexC].a,d=e.positions[this.m_indexD].c,p=e.positions[this.m_indexD].a,v=this.m_qA.SetAngle(h),g=this.m_qB.SetAngle(m),x=this.m_qC.SetAngle(f),b=this.m_qD.SetAngle(p),w=0,A=this.m_JvAC,S=this.m_JvBD,B=0;if(this.m_typeA===t.b2JointType.e_revoluteJoint)A.SetZero(),s=1,a=1,B+=this.m_iA+this.m_iC,i=h-f-this.m_referenceAngleA;else{var C=Tt.MulRV(x,this.m_localAxisC,r.SolvePositionConstraints_s_u),V=Tt.MulRV(x,this.m_lalcC,r.SolvePositionConstraints_s_rC),M=Tt.MulRV(v,this.m_lalcA,r.SolvePositionConstraints_s_rA);A.Copy(C),a=Vt.CrossVV(V,C),s=Vt.CrossVV(M,C),B+=this.m_mC+this.m_mA+this.m_iC*a*a+this.m_iA*s*s;var k=this.m_lalcC,P=Tt.MulTRV(x,Vt.AddVV(M,Vt.SubVV(l,_,Vt.s_t0),Vt.s_t0),Vt.s_t0);i=Vt.DotVV(Vt.SubVV(P,k,Vt.s_t0),this.m_localAxisC)}if(this.m_typeB===t.b2JointType.e_revoluteJoint)S.SetZero(),o=this.m_ratio,u=this.m_ratio,B+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),n=m-p-this.m_referenceAngleB;else{var I=Tt.MulRV(b,this.m_localAxisD,r.SolvePositionConstraints_s_u),T=Tt.MulRV(b,this.m_lalcD,r.SolvePositionConstraints_s_rD),D=Tt.MulRV(g,this.m_lalcB,r.SolvePositionConstraints_s_rB);Vt.MulSV(this.m_ratio,I,S),u=this.m_ratio*Vt.CrossVV(T,I),o=this.m_ratio*Vt.CrossVV(D,I),B+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*u*u+this.m_iB*o*o;var G=this.m_lalcD,R=Tt.MulTRV(b,Vt.AddVV(D,Vt.SubVV(c,d,Vt.s_t0),Vt.s_t0),Vt.s_t0);n=Vt.DotVV(Vt.SubVV(R,G,Vt.s_t0),this.m_localAxisD)}var E=i+this.m_ratio*n-this.m_constant,F=0;return B>0&&(F=-E/B),l.SelfMulAdd(this.m_mA*F,A),h+=this.m_iA*F*s,c.SelfMulAdd(this.m_mB*F,S),m+=this.m_iB*F*o,_.SelfMulSub(this.m_mC*F,A),f-=this.m_iC*F*a,d.SelfMulSub(this.m_mD*F,S),p-=this.m_iD*F*u,e.positions[this.m_indexA].a=h,e.positions[this.m_indexB].a=m,e.positions[this.m_indexC].a=f,e.positions[this.m_indexD].a=p,w<y}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return Vt.MulSV(t*this.m_impulse,this.m_JvAC,e)}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse*this.m_JwA}},{key:"GetJoint1",value:function(){return this.m_joint1}},{key:"GetJoint2",value:function(){return this.m_joint2}},{key:"GetRatio",value:function(){return this.m_ratio}},{key:"SetRatio",value:function(t){this.m_ratio=t}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex,n=this.m_joint1.m_index,r=this.m_joint2.m_index;t("  const jd: b2GearJointDef = new b2GearJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.joint1 = joints[%d];\n",n),t("  jd.joint2 = joints[%d];\n",r),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),r}(wn);Pn.InitVelocityConstraints_s_u=new Vt,Pn.InitVelocityConstraints_s_rA=new Vt,Pn.InitVelocityConstraints_s_rB=new Vt,Pn.InitVelocityConstraints_s_rC=new Vt,Pn.InitVelocityConstraints_s_rD=new Vt,Pn.SolvePositionConstraints_s_u=new Vt,Pn.SolvePositionConstraints_s_rA=new Vt,Pn.SolvePositionConstraints_s_rB=new Vt,Pn.SolvePositionConstraints_s_rC=new Vt,Pn.SolvePositionConstraints_s_rD=new Vt;var In=function(e){s(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_motorJoint)).linearOffset=new Vt(0,0),e.angularOffset=0,e.maxForce=1,e.maxTorque=1,e.correctionFactor=.3,e}return u(n,[{key:"Initialize",value:function(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var i=this.bodyA.GetAngle(),n=this.bodyB.GetAngle();this.angularOffset=n-i}}]),n}(bn),Tn=function(t){s(n,t);var e=o(n);function n(t){var r;return a(this,n),(r=e.call(this,t)).m_linearOffset=new Vt,r.m_angularOffset=0,r.m_linearImpulse=new Vt,r.m_angularImpulse=0,r.m_maxForce=0,r.m_maxTorque=0,r.m_correctionFactor=.3,r.m_indexA=0,r.m_indexB=0,r.m_rA=new Vt,r.m_rB=new Vt,r.m_localCenterA=new Vt,r.m_localCenterB=new Vt,r.m_linearError=new Vt,r.m_angularError=0,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_linearMass=new Pt,r.m_angularMass=0,r.m_qA=new Tt,r.m_qB=new Tt,r.m_K=new Pt,r.m_linearOffset.Copy(i(t.linearOffset,Vt.ZERO)),r.m_linearImpulse.SetZero(),r.m_maxForce=i(t.maxForce,0),r.m_maxTorque=i(t.maxTorque,0),r.m_correctionFactor=i(t.correctionFactor,.3),r}return u(n,[{key:"GetAnchorA",value:function(t){var e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t}},{key:"GetAnchorB",value:function(t){var e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t}},{key:"GetReactionForce",value:function(t,e){return Vt.MulSV(t,this.m_linearImpulse,e)}},{key:"GetReactionTorque",value:function(t){return t*this.m_angularImpulse}},{key:"SetLinearOffset",value:function(t){Vt.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))}},{key:"GetLinearOffset",value:function(){return this.m_linearOffset}},{key:"SetAngularOffset",value:function(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)}},{key:"GetAngularOffset",value:function(){return this.m_angularOffset}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetMaxTorque",value:function(t){this.m_maxTorque=t}},{key:"GetMaxTorque",value:function(){return this.m_maxTorque}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngle(i),h=this.m_qB.SetAngle(o),c=Tt.MulRV(l,Vt.SubVV(this.m_linearOffset,this.m_localCenterA,Vt.s_t0),this.m_rA),m=Tt.MulRV(h,Vt.NegV(this.m_localCenterB,Vt.s_t0),this.m_rB),_=this.m_invMassA,f=this.m_invMassB,d=this.m_invIA,p=this.m_invIB,v=this.m_K;if(v.ex.x=_+f+d*c.y*c.y+p*m.y*m.y,v.ex.y=-d*c.x*c.y-p*m.x*m.y,v.ey.x=v.ex.y,v.ey.y=_+f+d*c.x*c.x+p*m.x*m.x,v.GetInverse(this.m_linearMass),this.m_angularMass=d+p,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),Vt.SubVV(Vt.AddVV(s,m,Vt.s_t0),Vt.AddVV(e,c,Vt.s_t1),this.m_linearError),this.m_angularError=o-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var y=this.m_linearImpulse;n.SelfMulSub(_,y),r-=d*(Vt.CrossVV(c,y)+this.m_angularImpulse),a.SelfMulAdd(f,y),u+=p*(Vt.CrossVV(m,y)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,u=this.m_invIA,l=this.m_invIB,h=t.step.dt,c=t.step.inv_dt,m=s-i+c*this.m_correctionFactor*this.m_angularError,_=-this.m_angularMass*m,f=this.m_angularImpulse,d=h*this.m_maxTorque;this.m_angularImpulse=lt(this.m_angularImpulse+_,-d,d),i-=u*(_=this.m_angularImpulse-f),s+=l*_;var p=this.m_rA,v=this.m_rB,y=Vt.AddVV(Vt.SubVV(Vt.AddVV(r,Vt.CrossSV(s,v,Vt.s_t0),Vt.s_t0),Vt.AddVV(e,Vt.CrossSV(i,p,Vt.s_t1),Vt.s_t1),Vt.s_t2),Vt.MulSV(c*this.m_correctionFactor,this.m_linearError,Vt.s_t3),n.SolveVelocityConstraints_s_Cdot_v2),g=Pt.MulMV(this.m_linearMass,y,n.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),x=n.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(g);var b=h*this.m_maxForce;this.m_linearImpulse.LengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(b)),Vt.SubVV(this.m_linearImpulse,x,g),e.SelfMulSub(o,g),i-=u*Vt.CrossVV(p,g),r.SelfMulAdd(a,g),s+=l*Vt.CrossVV(v,g),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2MotorJointDef = new b2MotorJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),n}(wn);Tn.SolveVelocityConstraints_s_Cdot_v2=new Vt,Tn.SolveVelocityConstraints_s_impulse_v2=new Vt,Tn.SolveVelocityConstraints_s_oldImpulse_v2=new Vt;var Dn=function(e){s(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_mouseJoint)).target=new Vt,e.maxForce=0,e.frequencyHz=5,e.dampingRatio=.7,e}return n}(bn),Gn=function(t){s(n,t);var e=o(n);function n(t){var r;return a(this,n),(r=e.call(this,t)).m_localAnchorB=new Vt,r.m_targetA=new Vt,r.m_frequencyHz=0,r.m_dampingRatio=0,r.m_beta=0,r.m_impulse=new Vt,r.m_maxForce=0,r.m_gamma=0,r.m_indexA=0,r.m_indexB=0,r.m_rB=new Vt,r.m_localCenterB=new Vt,r.m_invMassB=0,r.m_invIB=0,r.m_mass=new Pt,r.m_C=new Vt,r.m_qB=new Tt,r.m_lalcB=new Vt,r.m_K=new Pt,r.m_targetA.Copy(i(t.target,Vt.ZERO)),Dt.MulTXV(r.m_bodyB.GetTransform(),r.m_targetA,r.m_localAnchorB),r.m_maxForce=i(t.maxForce,0),r.m_impulse.SetZero(),r.m_frequencyHz=i(t.frequencyHz,0),r.m_dampingRatio=i(t.dampingRatio,0),r.m_beta=0,r.m_gamma=0,r}return u(n,[{key:"SetTarget",value:function(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)}},{key:"GetTarget",value:function(){return this.m_targetA}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,s=this.m_qB.SetAngle(i),o=this.m_bodyB.GetMass(),a=2*_*this.m_frequencyHz,u=2*o*this.m_dampingRatio*a,l=o*(a*a),h=t.step.dt;this.m_gamma=h*(u+h*l),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=h*l*this.m_gamma,Vt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Tt.MulRV(s,this.m_lalcB,this.m_rB);var c=this.m_K;c.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,c.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,c.ey.x=c.ex.y,c.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,c.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),r*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),n.x+=this.m_invMassB*this.m_impulse.x,n.y+=this.m_invMassB*this.m_impulse.y,r+=this.m_invIB*Vt.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=r}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexB].v,i=t.velocities[this.m_indexB].w,r=Vt.AddVCrossSV(e,i,this.m_rB,n.SolveVelocityConstraints_s_Cdot),s=Pt.MulMV(this.m_mass,Vt.AddVV(r,Vt.AddVV(this.m_C,Vt.MulSV(this.m_gamma,this.m_impulse,Vt.s_t0),Vt.s_t0),Vt.s_t0).SelfNeg(),n.SolveVelocityConstraints_s_impulse),o=n.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(s);var a=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.SelfMul(a/this.m_impulse.Length()),Vt.SubVV(this.m_impulse,o,s),e.SelfMulAdd(this.m_invMassB,s),i+=this.m_invIB*Vt.CrossVV(this.m_rB,s),t.velocities[this.m_indexB].w=i}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"GetAnchorA",value:function(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return Vt.MulSV(t,this.m_impulse,e)}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"Dump",value:function(t){t("Mouse joint dumping is not supported.\n")}},{key:"ShiftOrigin",value:function(t){this.m_targetA.SelfSub(t)}}]),n}(wn);Gn.SolveVelocityConstraints_s_Cdot=new Vt,Gn.SolveVelocityConstraints_s_impulse=new Vt,Gn.SolveVelocityConstraints_s_oldImpulse=new Vt;var Rn=function(e){s(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_prismaticJoint)).localAnchorA=new Vt,e.localAnchorB=new Vt,e.localAxisA=new Vt(1,0),e.referenceAngle=0,e.enableLimit=!1,e.lowerTranslation=0,e.upperTranslation=0,e.enableMotor=!1,e.maxMotorForce=0,e.motorSpeed=0,e}return u(n,[{key:"Initialize",value:function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(n,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),n}(bn),En=function(e){s(r,e);var n=o(r);function r(e){var s;return a(this,r),(s=n.call(this,e)).m_localAnchorA=new Vt,s.m_localAnchorB=new Vt,s.m_localXAxisA=new Vt,s.m_localYAxisA=new Vt,s.m_referenceAngle=0,s.m_impulse=new kt(0,0,0),s.m_motorImpulse=0,s.m_lowerTranslation=0,s.m_upperTranslation=0,s.m_maxMotorForce=0,s.m_motorSpeed=0,s.m_enableLimit=!1,s.m_enableMotor=!1,s.m_limitState=t.b2LimitState.e_inactiveLimit,s.m_indexA=0,s.m_indexB=0,s.m_localCenterA=new Vt,s.m_localCenterB=new Vt,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_axis=new Vt(0,0),s.m_perp=new Vt(0,0),s.m_s1=0,s.m_s2=0,s.m_a1=0,s.m_a2=0,s.m_K=new It,s.m_K3=new It,s.m_K2=new Pt,s.m_motorMass=0,s.m_qA=new Tt,s.m_qB=new Tt,s.m_lalcA=new Vt,s.m_lalcB=new Vt,s.m_rA=new Vt,s.m_rB=new Vt,s.m_localAnchorA.Copy(i(e.localAnchorA,Vt.ZERO)),s.m_localAnchorB.Copy(i(e.localAnchorB,Vt.ZERO)),s.m_localXAxisA.Copy(i(e.localAxisA,new Vt(1,0))).SelfNormalize(),Vt.CrossOneV(s.m_localXAxisA,s.m_localYAxisA),s.m_referenceAngle=i(e.referenceAngle,0),s.m_lowerTranslation=i(e.lowerTranslation,0),s.m_upperTranslation=i(e.upperTranslation,0),s.m_maxMotorForce=i(e.maxMotorForce,0),s.m_motorSpeed=i(e.motorSpeed,0),s.m_enableLimit=i(e.enableLimit,!1),s.m_enableMotor=i(e.enableMotor,!1),s}return u(r,[{key:"InitVelocityConstraints",value:function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=e.positions[this.m_indexA].c,n=e.positions[this.m_indexA].a,s=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,a=e.positions[this.m_indexB].c,u=e.positions[this.m_indexB].a,l=e.velocities[this.m_indexB].v,h=e.velocities[this.m_indexB].w,c=this.m_qA.SetAngle(n),m=this.m_qB.SetAngle(u);Vt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var _=Tt.MulRV(c,this.m_lalcA,this.m_rA);Vt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var f=Tt.MulRV(m,this.m_lalcB,this.m_rB),d=Vt.AddVV(Vt.SubVV(a,i,Vt.s_t0),Vt.SubVV(f,_,Vt.s_t1),r.InitVelocityConstraints_s_d),p=this.m_invMassA,v=this.m_invMassB,g=this.m_invIA,x=this.m_invIB;if(Tt.MulRV(c,this.m_localXAxisA,this.m_axis),this.m_a1=Vt.CrossVV(Vt.AddVV(d,_,Vt.s_t0),this.m_axis),this.m_a2=Vt.CrossVV(f,this.m_axis),this.m_motorMass=p+v+g*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),Tt.MulRV(c,this.m_localYAxisA,this.m_perp),this.m_s1=Vt.CrossVV(Vt.AddVV(d,_,Vt.s_t0),this.m_perp),this.m_s2=Vt.CrossVV(f,this.m_perp),this.m_K.ex.x=p+v+g*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,this.m_K.ex.y=g*this.m_s1+x*this.m_s2,this.m_K.ex.z=g*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=g+x,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=g*this.m_a1+x*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=p+v+g*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_enableLimit){var b=Vt.DotVV(this.m_axis,d);ot(this.m_upperTranslation-this.m_lowerTranslation)<2*y?this.m_limitState=t.b2LimitState.e_equalLimits:b<=this.m_lowerTranslation?this.m_limitState!==t.b2LimitState.e_atLowerLimit&&(this.m_limitState=t.b2LimitState.e_atLowerLimit,this.m_impulse.z=0):b>=this.m_upperTranslation?this.m_limitState!==t.b2LimitState.e_atUpperLimit&&(this.m_limitState=t.b2LimitState.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0;if(this.m_enableMotor||(this.m_motorImpulse=0),e.step.warmStarting){this.m_impulse.SelfMul(e.step.dtRatio),this.m_motorImpulse*=e.step.dtRatio;var w=Vt.AddVV(Vt.MulSV(this.m_impulse.x,this.m_perp,Vt.s_t0),Vt.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,Vt.s_t1),r.InitVelocityConstraints_s_P),A=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,S=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;s.SelfMulSub(p,w),o-=g*A,l.SelfMulAdd(v,w),h+=x*S}else this.m_impulse.SetZero(),this.m_motorImpulse=0;e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=h}},{key:"SolveVelocityConstraints",value:function(e){var i=e.velocities[this.m_indexA].v,n=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,o=e.velocities[this.m_indexB].w,a=this.m_invMassA,u=this.m_invMassB,l=this.m_invIA,h=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!==t.b2LimitState.e_equalLimits){var c=Vt.DotVV(this.m_axis,Vt.SubVV(s,i,Vt.s_t0))+this.m_a2*o-this.m_a1*n,m=this.m_motorMass*(this.m_motorSpeed-c),_=this.m_motorImpulse,f=e.step.dt*this.m_maxMotorForce;this.m_motorImpulse=lt(this.m_motorImpulse+m,-f,f),m=this.m_motorImpulse-_;var d=Vt.MulSV(m,this.m_axis,r.SolveVelocityConstraints_s_P),p=m*this.m_a1,v=m*this.m_a2;i.SelfMulSub(a,d),n-=l*p,s.SelfMulAdd(u,d),o+=h*v}var y=Vt.DotVV(this.m_perp,Vt.SubVV(s,i,Vt.s_t0))+this.m_s2*o-this.m_s1*n,g=o-n;if(this.m_enableLimit&&this.m_limitState!==t.b2LimitState.e_inactiveLimit){var x=Vt.DotVV(this.m_axis,Vt.SubVV(s,i,Vt.s_t0))+this.m_a2*o-this.m_a1*n,b=r.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),w=this.m_K.Solve33(-y,-g,-x,r.SolveVelocityConstraints_s_df3);this.m_impulse.SelfAdd(w),this.m_limitState===t.b2LimitState.e_atLowerLimit?this.m_impulse.z=ut(this.m_impulse.z,0):this.m_limitState===t.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=at(this.m_impulse.z,0));var A=-y-(this.m_impulse.z-b.z)*this.m_K.ez.x,S=-g-(this.m_impulse.z-b.z)*this.m_K.ez.y,B=this.m_K.Solve22(A,S,r.SolveVelocityConstraints_s_f2r);B.x+=b.x,B.y+=b.y,this.m_impulse.x=B.x,this.m_impulse.y=B.y,w.x=this.m_impulse.x-b.x,w.y=this.m_impulse.y-b.y,w.z=this.m_impulse.z-b.z;var C=Vt.AddVV(Vt.MulSV(w.x,this.m_perp,Vt.s_t0),Vt.MulSV(w.z,this.m_axis,Vt.s_t1),r.SolveVelocityConstraints_s_P),V=w.x*this.m_s1+w.y+w.z*this.m_a1,M=w.x*this.m_s2+w.y+w.z*this.m_a2;i.SelfMulSub(a,C),n-=l*V,s.SelfMulAdd(u,C),o+=h*M}else{var k=this.m_K.Solve22(-y,-g,r.SolveVelocityConstraints_s_df2);this.m_impulse.x+=k.x,this.m_impulse.y+=k.y;var P=Vt.MulSV(k.x,this.m_perp,r.SolveVelocityConstraints_s_P),I=k.x*this.m_s1+k.y,T=k.x*this.m_s2+k.y;i.SelfMulSub(a,P),n-=l*I,s.SelfMulAdd(u,P),o+=h*T}e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].w=o}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(s),u=this.m_invMassA,l=this.m_invMassB,h=this.m_invIA,c=this.m_invIB,m=Tt.MulRV(o,this.m_lalcA,this.m_rA),_=Tt.MulRV(a,this.m_lalcB,this.m_rB),f=Vt.SubVV(Vt.AddVV(n,_,Vt.s_t0),Vt.AddVV(e,m,Vt.s_t1),r.SolvePositionConstraints_s_d),d=Tt.MulRV(o,this.m_localXAxisA,this.m_axis),p=Vt.CrossVV(Vt.AddVV(f,m,Vt.s_t0),d),v=Vt.CrossVV(_,d),x=Tt.MulRV(o,this.m_localYAxisA,this.m_perp),b=Vt.CrossVV(Vt.AddVV(f,m,Vt.s_t0),x),w=Vt.CrossVV(_,x),A=r.SolvePositionConstraints_s_impulse,B=Vt.DotVV(x,f),C=s-i-this.m_referenceAngle,V=ot(B),M=ot(C),k=!1,P=0;if(this.m_enableLimit){var I=Vt.DotVV(d,f);ot(this.m_upperTranslation-this.m_lowerTranslation)<2*y?(P=lt(I,-S,S),V=ut(V,ot(I)),k=!0):I<=this.m_lowerTranslation?(P=lt(I-this.m_lowerTranslation+y,-S,0),V=ut(V,this.m_lowerTranslation-I),k=!0):I>=this.m_upperTranslation&&(P=lt(I-this.m_upperTranslation-y,0,S),V=ut(V,I-this.m_upperTranslation),k=!0)}if(k){var T=u+l+h*b*b+c*w*w,D=h*b+c*w,G=h*b*p+c*w*v,R=h+c;0===R&&(R=1);var E=h*p+c*v,F=u+l+h*p*p+c*v*v,L=this.m_K3;L.ex.SetXYZ(T,D,G),L.ey.SetXYZ(D,R,E),L.ez.SetXYZ(G,E,F),A=L.Solve33(-B,-C,-P,A)}else{var j=u+l+h*b*b+c*w*w,O=h*b+c*w,N=h+c;0===N&&(N=1);var q=this.m_K2;q.ex.Set(j,O),q.ey.Set(O,N);var z=q.Solve(-B,-C,r.SolvePositionConstraints_s_impulse1);A.x=z.x,A.y=z.y,A.z=0}var U=Vt.AddVV(Vt.MulSV(A.x,x,Vt.s_t0),Vt.MulSV(A.z,d,Vt.s_t1),r.SolvePositionConstraints_s_P),J=A.x*b+A.y+A.z*p,X=A.x*w+A.y+A.z*v;return e.SelfMulSub(u,U),i-=h*J,n.SelfMulAdd(l,U),s+=c*X,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,V<=y&&M<=g}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e.y=t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y),e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.y}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetLocalAxisA",value:function(){return this.m_localXAxisA}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"GetJointTranslation",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,r.GetJointTranslation_s_pA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,r.GetJointTranslation_s_pB),i=Vt.SubVV(e,t,r.GetJointTranslation_s_d),n=this.m_bodyA.GetWorldVector(this.m_localXAxisA,r.GetJointTranslation_s_axis);return Vt.DotVV(i,n)}},{key:"GetJointSpeed",value:function(){var t=this.m_bodyA,e=this.m_bodyB;Vt.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=Tt.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);Vt.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var n=Tt.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),r=Vt.AddVV(t.m_sweep.c,i,Vt.s_t0),s=Vt.AddVV(e.m_sweep.c,n,Vt.s_t1),o=Vt.SubVV(s,r,Vt.s_t2),a=t.GetWorldVector(this.m_localXAxisA,this.m_axis),u=t.m_linearVelocity,l=e.m_linearVelocity,h=t.m_angularVelocity,c=e.m_angularVelocity;return Vt.DotVV(o,Vt.CrossSV(h,a,Vt.s_t0))+Vt.DotVV(a,Vt.SubVV(Vt.AddVCrossSV(l,c,n,Vt.s_t0),Vt.AddVCrossSV(u,h,i,Vt.s_t1),Vt.s_t0))}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerTranslation}},{key:"GetUpperLimit",value:function(){return this.m_upperTranslation}},{key:"SetLimits",value:function(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"SetMaxMotorForce",value:function(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)}},{key:"GetMaxMotorForce",value:function(){return this.m_maxMotorForce}},{key:"GetMotorForce",value:function(t){return t*this.m_motorImpulse}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),r}(wn);En.InitVelocityConstraints_s_d=new Vt,En.InitVelocityConstraints_s_P=new Vt,En.SolveVelocityConstraints_s_P=new Vt,En.SolveVelocityConstraints_s_f2r=new Vt,En.SolveVelocityConstraints_s_f1=new kt,En.SolveVelocityConstraints_s_df3=new kt,En.SolveVelocityConstraints_s_df2=new Vt,En.SolvePositionConstraints_s_d=new Vt,En.SolvePositionConstraints_s_impulse=new kt,En.SolvePositionConstraints_s_impulse1=new Vt,En.SolvePositionConstraints_s_P=new Vt,En.GetJointTranslation_s_pA=new Vt,En.GetJointTranslation_s_pB=new Vt,En.GetJointTranslation_s_d=new Vt,En.GetJointTranslation_s_axis=new Vt;var Fn=2,Ln=function(e){s(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_pulleyJoint)).groundAnchorA=new Vt(-1,1),e.groundAnchorB=new Vt(1,1),e.localAnchorA=new Vt(-1,0),e.localAnchorB=new Vt(1,0),e.lengthA=0,e.lengthB=0,e.ratio=1,e.collideConnected=!0,e}return u(n,[{key:"Initialize",value:function(t,e,i,n,r,s,o){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(n),this.bodyA.GetLocalPoint(r,this.localAnchorA),this.bodyB.GetLocalPoint(s,this.localAnchorB),this.lengthA=Vt.DistanceVV(r,i),this.lengthB=Vt.DistanceVV(s,n),this.ratio=o}}]),n}(bn),jn=function(t){s(n,t);var e=o(n);function n(t){var r;return a(this,n),(r=e.call(this,t)).m_groundAnchorA=new Vt,r.m_groundAnchorB=new Vt,r.m_lengthA=0,r.m_lengthB=0,r.m_localAnchorA=new Vt,r.m_localAnchorB=new Vt,r.m_constant=0,r.m_ratio=0,r.m_impulse=0,r.m_indexA=0,r.m_indexB=0,r.m_uA=new Vt,r.m_uB=new Vt,r.m_rA=new Vt,r.m_rB=new Vt,r.m_localCenterA=new Vt,r.m_localCenterB=new Vt,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_mass=0,r.m_qA=new Tt,r.m_qB=new Tt,r.m_lalcA=new Vt,r.m_lalcB=new Vt,r.m_groundAnchorA.Copy(i(t.groundAnchorA,new Vt(-1,1))),r.m_groundAnchorB.Copy(i(t.groundAnchorB,new Vt(1,0))),r.m_localAnchorA.Copy(i(t.localAnchorA,new Vt(-1,0))),r.m_localAnchorB.Copy(i(t.localAnchorB,new Vt(1,0))),r.m_lengthA=i(t.lengthA,0),r.m_lengthB=i(t.lengthB,0),r.m_ratio=i(t.ratio,1),r.m_constant=i(t.lengthA,0)+r.m_ratio*i(t.lengthB,0),r.m_impulse=0,r}return u(n,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(i),c=this.m_qB.SetAngle(a);Vt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Tt.MulRV(h,this.m_lalcA,this.m_rA),Vt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Tt.MulRV(c,this.m_lalcB,this.m_rB),this.m_uA.Copy(e).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(o).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var m=this.m_uA.Length(),_=this.m_uB.Length();m>10*y?this.m_uA.SelfMul(1/m):this.m_uA.SetZero(),_>10*y?this.m_uB.SelfMul(1/_):this.m_uB.SetZero();var f=Vt.CrossVV(this.m_rA,this.m_uA),d=Vt.CrossVV(this.m_rB,this.m_uB),p=this.m_invMassA+this.m_invIA*f*f,v=this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=p+this.m_ratio*this.m_ratio*v,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var g=Vt.MulSV(-this.m_impulse,this.m_uA,n.InitVelocityConstraints_s_PA),x=Vt.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,n.InitVelocityConstraints_s_PB);r.SelfMulAdd(this.m_invMassA,g),s+=this.m_invIA*Vt.CrossVV(this.m_rA,g),u.SelfMulAdd(this.m_invMassB,x),l+=this.m_invIB*Vt.CrossVV(this.m_rB,x)}else this.m_impulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=l}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=Vt.AddVCrossSV(e,i,this.m_rA,n.SolveVelocityConstraints_s_vpA),a=Vt.AddVCrossSV(r,s,this.m_rB,n.SolveVelocityConstraints_s_vpB),u=-Vt.DotVV(this.m_uA,o)-this.m_ratio*Vt.DotVV(this.m_uB,a),l=-this.m_mass*u;this.m_impulse+=l;var h=Vt.MulSV(-l,this.m_uA,n.SolveVelocityConstraints_s_PA),c=Vt.MulSV(-this.m_ratio*l,this.m_uB,n.SolveVelocityConstraints_s_PB);e.SelfMulAdd(this.m_invMassA,h),i+=this.m_invIA*Vt.CrossVV(this.m_rA,h),r.SelfMulAdd(this.m_invMassB,c),s+=this.m_invIB*Vt.CrossVV(this.m_rB,c),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(s);Vt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var u=Tt.MulRV(o,this.m_lalcA,this.m_rA);Vt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var l=Tt.MulRV(a,this.m_lalcB,this.m_rB),h=this.m_uA.Copy(e).SelfAdd(u).SelfSub(this.m_groundAnchorA),c=this.m_uB.Copy(r).SelfAdd(l).SelfSub(this.m_groundAnchorB),m=h.Length(),_=c.Length();m>10*y?h.SelfMul(1/m):h.SetZero(),_>10*y?c.SelfMul(1/_):c.SetZero();var f=Vt.CrossVV(u,h),d=Vt.CrossVV(l,c),p=this.m_invMassA+this.m_invIA*f*f,v=this.m_invMassB+this.m_invIB*d*d,g=p+this.m_ratio*this.m_ratio*v;g>0&&(g=1/g);var x=this.m_constant-m-this.m_ratio*_,b=ot(x),w=-g*x,A=Vt.MulSV(-w,h,n.SolvePositionConstraints_s_PA),S=Vt.MulSV(-this.m_ratio*w,c,n.SolvePositionConstraints_s_PB);return e.SelfMulAdd(this.m_invMassA,A),i+=this.m_invIA*Vt.CrossVV(u,A),r.SelfMulAdd(this.m_invMassB,S),s+=this.m_invIB*Vt.CrossVV(l,S),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,b<y}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetGroundAnchorA",value:function(){return this.m_groundAnchorA}},{key:"GetGroundAnchorB",value:function(){return this.m_groundAnchorB}},{key:"GetLengthA",value:function(){return this.m_lengthA}},{key:"GetLengthB",value:function(){return this.m_lengthB}},{key:"GetRatio",value:function(){return this.m_ratio}},{key:"GetCurrentLengthA",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,n.GetCurrentLengthA_s_p),e=this.m_groundAnchorA;return Vt.DistanceVV(t,e)}},{key:"GetCurrentLengthB",value:function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,n.GetCurrentLengthB_s_p),e=this.m_groundAnchorB;return Vt.DistanceVV(t,e)}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.lengthA = %.15f;\n",this.m_lengthA),t("  jd.lengthB = %.15f;\n",this.m_lengthB),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},{key:"ShiftOrigin",value:function(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)}}]),n}(wn);jn.InitVelocityConstraints_s_PA=new Vt,jn.InitVelocityConstraints_s_PB=new Vt,jn.SolveVelocityConstraints_s_vpA=new Vt,jn.SolveVelocityConstraints_s_vpB=new Vt,jn.SolveVelocityConstraints_s_PA=new Vt,jn.SolveVelocityConstraints_s_PB=new Vt,jn.SolvePositionConstraints_s_PA=new Vt,jn.SolvePositionConstraints_s_PB=new Vt,jn.GetCurrentLengthA_s_p=new Vt,jn.GetCurrentLengthB_s_p=new Vt;var On=function(e){s(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_revoluteJoint)).localAnchorA=new Vt(0,0),e.localAnchorB=new Vt(0,0),e.referenceAngle=0,e.enableLimit=!1,e.lowerAngle=0,e.upperAngle=0,e.enableMotor=!1,e.motorSpeed=0,e.maxMotorTorque=0,e}return u(n,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),n}(bn),Nn=function(e){s(r,e);var n=o(r);function r(e){var s;return a(this,r),(s=n.call(this,e)).m_localAnchorA=new Vt,s.m_localAnchorB=new Vt,s.m_impulse=new kt,s.m_motorImpulse=0,s.m_enableMotor=!1,s.m_maxMotorTorque=0,s.m_motorSpeed=0,s.m_enableLimit=!1,s.m_referenceAngle=0,s.m_lowerAngle=0,s.m_upperAngle=0,s.m_indexA=0,s.m_indexB=0,s.m_rA=new Vt,s.m_rB=new Vt,s.m_localCenterA=new Vt,s.m_localCenterB=new Vt,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_mass=new It,s.m_motorMass=0,s.m_limitState=t.b2LimitState.e_inactiveLimit,s.m_qA=new Tt,s.m_qB=new Tt,s.m_lalcA=new Vt,s.m_lalcB=new Vt,s.m_K=new Pt,s.m_localAnchorA.Copy(i(e.localAnchorA,Vt.ZERO)),s.m_localAnchorB.Copy(i(e.localAnchorB,Vt.ZERO)),s.m_referenceAngle=i(e.referenceAngle,0),s.m_impulse.SetZero(),s.m_motorImpulse=0,s.m_lowerAngle=i(e.lowerAngle,0),s.m_upperAngle=i(e.upperAngle,0),s.m_maxMotorTorque=i(e.maxMotorTorque,0),s.m_motorSpeed=i(e.motorSpeed,0),s.m_enableLimit=i(e.enableLimit,!1),s.m_enableMotor=i(e.enableMotor,!1),s.m_limitState=t.b2LimitState.e_inactiveLimit,s}return u(r,[{key:"InitVelocityConstraints",value:function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=e.positions[this.m_indexA].a,n=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,o=e.positions[this.m_indexB].a,a=e.velocities[this.m_indexB].v,u=e.velocities[this.m_indexB].w,l=this.m_qA.SetAngle(i),h=this.m_qB.SetAngle(o);Vt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Tt.MulRV(l,this.m_lalcA,this.m_rA),Vt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Tt.MulRV(h,this.m_lalcB,this.m_rB);var c=this.m_invMassA,m=this.m_invMassB,_=this.m_invIA,f=this.m_invIB,d=_+f===0;if(this.m_mass.ex.x=c+m+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*f,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*f,this.m_mass.ez.x=-this.m_rA.y*_-this.m_rB.y*f,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=c+m+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*f,this.m_mass.ez.y=this.m_rA.x*_+this.m_rB.x*f,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=_+f,this.m_motorMass=_+f,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!d||(this.m_motorImpulse=0),this.m_enableLimit&&!d){var p=o-i-this.m_referenceAngle;ot(this.m_upperAngle-this.m_lowerAngle)<2*g?this.m_limitState=t.b2LimitState.e_equalLimits:p<=this.m_lowerAngle?(this.m_limitState!==t.b2LimitState.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=t.b2LimitState.e_atLowerLimit):p>=this.m_upperAngle?(this.m_limitState!==t.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=t.b2LimitState.e_atUpperLimit):(this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=t.b2LimitState.e_inactiveLimit;if(e.step.warmStarting){this.m_impulse.SelfMul(e.step.dtRatio),this.m_motorImpulse*=e.step.dtRatio;var v=r.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);n.SelfMulSub(c,v),s-=_*(Vt.CrossVV(this.m_rA,v)+this.m_motorImpulse+this.m_impulse.z),a.SelfMulAdd(m,v),u+=f*(Vt.CrossVV(this.m_rB,v)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(e){var i=e.velocities[this.m_indexA].v,n=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,o=e.velocities[this.m_indexB].w,a=this.m_invMassA,u=this.m_invMassB,l=this.m_invIA,h=this.m_invIB,c=l+h===0;if(this.m_enableMotor&&this.m_limitState!==t.b2LimitState.e_equalLimits&&!c){var m=o-n-this.m_motorSpeed,_=-this.m_motorMass*m,f=this.m_motorImpulse,d=e.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=lt(this.m_motorImpulse+_,-d,d),n-=l*(_=this.m_motorImpulse-f),o+=h*_}if(this.m_enableLimit&&this.m_limitState!==t.b2LimitState.e_inactiveLimit&&!c){var p=Vt.SubVV(Vt.AddVCrossSV(s,o,this.m_rB,Vt.s_t0),Vt.AddVCrossSV(i,n,this.m_rA,Vt.s_t1),r.SolveVelocityConstraints_s_Cdot1),v=o-n,y=this.m_mass.Solve33(p.x,p.y,v,r.SolveVelocityConstraints_s_impulse_v3).SelfNeg();if(this.m_limitState===t.b2LimitState.e_equalLimits)this.m_impulse.SelfAdd(y);else if(this.m_limitState===t.b2LimitState.e_atLowerLimit)if(this.m_impulse.z+y.z<0){var g=-p.x+this.m_impulse.z*this.m_mass.ez.x,x=-p.y+this.m_impulse.z*this.m_mass.ez.y,b=this.m_mass.Solve22(g,x,r.SolveVelocityConstraints_s_reduced_v2);y.x=b.x,y.y=b.y,y.z=-this.m_impulse.z,this.m_impulse.x+=b.x,this.m_impulse.y+=b.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(y);else if(this.m_limitState===t.b2LimitState.e_atUpperLimit)if(this.m_impulse.z+y.z>0){var w=-p.x+this.m_impulse.z*this.m_mass.ez.x,A=-p.y+this.m_impulse.z*this.m_mass.ez.y,S=this.m_mass.Solve22(w,A,r.SolveVelocityConstraints_s_reduced_v2);y.x=S.x,y.y=S.y,y.z=-this.m_impulse.z,this.m_impulse.x+=S.x,this.m_impulse.y+=S.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(y);var B=r.SolveVelocityConstraints_s_P.Set(y.x,y.y);i.SelfMulSub(a,B),n-=l*(Vt.CrossVV(this.m_rA,B)+y.z),s.SelfMulAdd(u,B),o+=h*(Vt.CrossVV(this.m_rB,B)+y.z)}else{var C=Vt.SubVV(Vt.AddVCrossSV(s,o,this.m_rB,Vt.s_t0),Vt.AddVCrossSV(i,n,this.m_rA,Vt.s_t1),r.SolveVelocityConstraints_s_Cdot_v2),V=this.m_mass.Solve22(-C.x,-C.y,r.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=V.x,this.m_impulse.y+=V.y,i.SelfMulSub(a,V),n-=l*Vt.CrossVV(this.m_rA,V),s.SelfMulAdd(u,V),o+=h*Vt.CrossVV(this.m_rB,V)}e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].w=o}},{key:"SolvePositionConstraints",value:function(e){var i=e.positions[this.m_indexA].c,n=e.positions[this.m_indexA].a,s=e.positions[this.m_indexB].c,o=e.positions[this.m_indexB].a,a=this.m_qA.SetAngle(n),u=this.m_qB.SetAngle(o),l=0,h=0,c=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&this.m_limitState!==t.b2LimitState.e_inactiveLimit&&!c){var m=o-n-this.m_referenceAngle,_=0;if(this.m_limitState===t.b2LimitState.e_equalLimits){var f=lt(m-this.m_lowerAngle,-B,B);_=-this.m_motorMass*f,l=ot(f)}else if(this.m_limitState===t.b2LimitState.e_atLowerLimit){var d=m-this.m_lowerAngle;l=-d,d=lt(d+g,-B,0),_=-this.m_motorMass*d}else if(this.m_limitState===t.b2LimitState.e_atUpperLimit){var p=m-this.m_upperAngle;l=p,p=lt(p-g,0,B),_=-this.m_motorMass*p}n-=this.m_invIA*_,o+=this.m_invIB*_}a.SetAngle(n),u.SetAngle(o),Vt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var v=Tt.MulRV(a,this.m_lalcA,this.m_rA);Vt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var x=Tt.MulRV(u,this.m_lalcB,this.m_rB),b=Vt.SubVV(Vt.AddVV(s,x,Vt.s_t0),Vt.AddVV(i,v,Vt.s_t1),r.SolvePositionConstraints_s_C_v2);h=b.Length();var w=this.m_invMassA,A=this.m_invMassB,S=this.m_invIA,C=this.m_invIB,V=this.m_K;V.ex.x=w+A+S*v.y*v.y+C*x.y*x.y,V.ex.y=-S*v.x*v.y-C*x.x*x.y,V.ey.x=V.ex.y,V.ey.y=w+A+S*v.x*v.x+C*x.x*x.x;var M=V.Solve(b.x,b.y,r.SolvePositionConstraints_s_impulse).SelfNeg();return i.SelfMulSub(w,M),n-=S*Vt.CrossVV(v,M),s.SelfMulAdd(A,M),o+=C*Vt.CrossVV(x,M),e.positions[this.m_indexA].a=n,e.positions[this.m_indexB].a=o,h<=y&&l<=g}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.z}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"GetJointAngle",value:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}},{key:"GetJointSpeed",value:function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"GetMotorTorque",value:function(t){return t*this.m_motorImpulse}},{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"SetMaxMotorTorque",value:function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}},{key:"GetMaxMotorTorque",value:function(){return this.m_maxMotorTorque}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerAngle}},{key:"GetUpperLimit",value:function(){return this.m_upperAngle}},{key:"SetLimits",value:function(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),r}(wn);Nn.InitVelocityConstraints_s_P=new Vt,Nn.SolveVelocityConstraints_s_P=new Vt,Nn.SolveVelocityConstraints_s_Cdot_v2=new Vt,Nn.SolveVelocityConstraints_s_Cdot1=new Vt,Nn.SolveVelocityConstraints_s_impulse_v3=new kt,Nn.SolveVelocityConstraints_s_reduced_v2=new Vt,Nn.SolveVelocityConstraints_s_impulse_v2=new Vt,Nn.SolvePositionConstraints_s_C_v2=new Vt,Nn.SolvePositionConstraints_s_impulse=new Vt;var qn=function(e){s(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_ropeJoint)).localAnchorA=new Vt(-1,0),e.localAnchorB=new Vt(1,0),e.maxLength=0,e}return n}(bn),zn=function(e){s(r,e);var n=o(r);function r(e){var s;return a(this,r),(s=n.call(this,e)).m_localAnchorA=new Vt,s.m_localAnchorB=new Vt,s.m_maxLength=0,s.m_length=0,s.m_impulse=0,s.m_indexA=0,s.m_indexB=0,s.m_u=new Vt,s.m_rA=new Vt,s.m_rB=new Vt,s.m_localCenterA=new Vt,s.m_localCenterB=new Vt,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_mass=0,s.m_state=t.b2LimitState.e_inactiveLimit,s.m_qA=new Tt,s.m_qB=new Tt,s.m_lalcA=new Vt,s.m_lalcB=new Vt,s.m_localAnchorA.Copy(i(e.localAnchorA,new Vt(-1,0))),s.m_localAnchorB.Copy(i(e.localAnchorB,new Vt(1,0))),s.m_maxLength=i(e.maxLength,0),s}return u(r,[{key:"InitVelocityConstraints",value:function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=e.positions[this.m_indexA].c,n=e.positions[this.m_indexA].a,s=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,a=e.positions[this.m_indexB].c,u=e.positions[this.m_indexB].a,l=e.velocities[this.m_indexB].v,h=e.velocities[this.m_indexB].w,c=this.m_qA.SetAngle(n),m=this.m_qB.SetAngle(u);Vt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Tt.MulRV(c,this.m_lalcA,this.m_rA),Vt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Tt.MulRV(m,this.m_lalcB,this.m_rB),this.m_u.Copy(a).SelfAdd(this.m_rB).SelfSub(i).SelfSub(this.m_rA),this.m_length=this.m_u.Length();var _=this.m_length-this.m_maxLength;if(this.m_state=_>0?t.b2LimitState.e_atUpperLimit:t.b2LimitState.e_inactiveLimit,!(this.m_length>y))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);var f=Vt.CrossVV(this.m_rA,this.m_u),d=Vt.CrossVV(this.m_rB,this.m_u),p=this.m_invMassA+this.m_invIA*f*f+this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=0!==p?1/p:0,e.step.warmStarting){this.m_impulse*=e.step.dtRatio;var v=Vt.MulSV(this.m_impulse,this.m_u,r.InitVelocityConstraints_s_P);s.SelfMulSub(this.m_invMassA,v),o-=this.m_invIA*Vt.CrossVV(this.m_rA,v),l.SelfMulAdd(this.m_invMassB,v),h+=this.m_invIB*Vt.CrossVV(this.m_rB,v)}else this.m_impulse=0;e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=h}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=Vt.AddVCrossSV(e,i,this.m_rA,r.SolveVelocityConstraints_s_vpA),a=Vt.AddVCrossSV(n,s,this.m_rB,r.SolveVelocityConstraints_s_vpB),u=this.m_length-this.m_maxLength,l=Vt.DotVV(this.m_u,Vt.SubVV(a,o,Vt.s_t0));u<0&&(l+=t.step.inv_dt*u);var h=-this.m_mass*l,c=this.m_impulse;this.m_impulse=at(0,this.m_impulse+h),h=this.m_impulse-c;var m=Vt.MulSV(h,this.m_u,r.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,m),i-=this.m_invIA*Vt.CrossVV(this.m_rA,m),n.SelfMulAdd(this.m_invMassB,m),s+=this.m_invIB*Vt.CrossVV(this.m_rB,m),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(s);Vt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var u=Tt.MulRV(o,this.m_lalcA,this.m_rA);Vt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var l=Tt.MulRV(a,this.m_lalcB,this.m_rB),h=this.m_u.Copy(n).SelfAdd(l).SelfSub(e).SelfSub(u),c=h.Normalize(),m=c-this.m_maxLength;m=lt(m,0,S);var _=-this.m_mass*m,f=Vt.MulSV(_,h,r.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,f),i-=this.m_invIA*Vt.CrossVV(u,f),n.SelfMulAdd(this.m_invMassB,f),s+=this.m_invIB*Vt.CrossVV(l,f),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,c-this.m_maxLength<y}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return Vt.MulSV(t*this.m_impulse,this.m_u,e)}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetMaxLength",value:function(t){this.m_maxLength=t}},{key:"GetMaxLength",value:function(){return this.m_maxLength}},{key:"GetLimitState",value:function(){return this.m_state}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RopeJointDef = new b2RopeJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxLength = %.15f;\n",this.m_maxLength),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),r}(wn);zn.InitVelocityConstraints_s_P=new Vt,zn.SolveVelocityConstraints_s_vpA=new Vt,zn.SolveVelocityConstraints_s_vpB=new Vt,zn.SolveVelocityConstraints_s_P=new Vt,zn.SolvePositionConstraints_s_P=new Vt;var Un=function(e){s(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_weldJoint)).localAnchorA=new Vt,e.localAnchorB=new Vt,e.referenceAngle=0,e.frequencyHz=0,e.dampingRatio=0,e}return u(n,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),n}(bn),Jn=function(t){s(n,t);var e=o(n);function n(t){var r;return a(this,n),(r=e.call(this,t)).m_frequencyHz=0,r.m_dampingRatio=0,r.m_bias=0,r.m_localAnchorA=new Vt,r.m_localAnchorB=new Vt,r.m_referenceAngle=0,r.m_gamma=0,r.m_impulse=new kt(0,0,0),r.m_indexA=0,r.m_indexB=0,r.m_rA=new Vt,r.m_rB=new Vt,r.m_localCenterA=new Vt,r.m_localCenterB=new Vt,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_mass=new It,r.m_qA=new Tt,r.m_qB=new Tt,r.m_lalcA=new Vt,r.m_lalcB=new Vt,r.m_K=new It,r.m_frequencyHz=i(t.frequencyHz,0),r.m_dampingRatio=i(t.dampingRatio,0),r.m_localAnchorA.Copy(i(t.localAnchorA,Vt.ZERO)),r.m_localAnchorB.Copy(i(t.localAnchorB,Vt.ZERO)),r.m_referenceAngle=i(t.referenceAngle,0),r.m_impulse.SetZero(),r}return u(n,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,u=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(s);Vt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Tt.MulRV(u,this.m_lalcA,this.m_rA),Vt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Tt.MulRV(l,this.m_lalcB,this.m_rB);var h=this.m_invMassA,c=this.m_invMassB,m=this.m_invIA,f=this.m_invIB,d=this.m_K;if(d.ex.x=h+c+this.m_rA.y*this.m_rA.y*m+this.m_rB.y*this.m_rB.y*f,d.ey.x=-this.m_rA.y*this.m_rA.x*m-this.m_rB.y*this.m_rB.x*f,d.ez.x=-this.m_rA.y*m-this.m_rB.y*f,d.ex.y=d.ey.x,d.ey.y=h+c+this.m_rA.x*this.m_rA.x*m+this.m_rB.x*this.m_rB.x*f,d.ez.y=this.m_rA.x*m+this.m_rB.x*f,d.ex.z=d.ez.x,d.ey.z=d.ez.y,d.ez.z=m+f,this.m_frequencyHz>0){d.GetInverse22(this.m_mass);var p=m+f,v=p>0?1/p:0,y=s-e-this.m_referenceAngle,g=2*_*this.m_frequencyHz,x=2*v*this.m_dampingRatio*g,b=v*g*g,w=t.step.dt;this.m_gamma=w*(x+w*b),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=y*w*b*this.m_gamma,p+=this.m_gamma,this.m_mass.ez.z=0!==p?1/p:0}else d.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);var A=n.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(h,A),r-=m*(Vt.CrossVV(this.m_rA,A)+this.m_impulse.z),o.SelfMulAdd(c,A),a+=f*(Vt.CrossVV(this.m_rB,A)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=a}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,u=this.m_invIA,l=this.m_invIB;if(this.m_frequencyHz>0){var h=s-i,c=-this.m_mass.ez.z*(h+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=c,i-=u*c,s+=l*c;var m=Vt.SubVV(Vt.AddVCrossSV(r,s,this.m_rB,Vt.s_t0),Vt.AddVCrossSV(e,i,this.m_rA,Vt.s_t1),n.SolveVelocityConstraints_s_Cdot1),_=It.MulM33XY(this.m_mass,m.x,m.y,n.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=_.x,this.m_impulse.y+=_.y;var f=_;e.SelfMulSub(o,f),i-=u*Vt.CrossVV(this.m_rA,f),r.SelfMulAdd(a,f),s+=l*Vt.CrossVV(this.m_rB,f)}else{var d=Vt.SubVV(Vt.AddVCrossSV(r,s,this.m_rB,Vt.s_t0),Vt.AddVCrossSV(e,i,this.m_rA,Vt.s_t1),n.SolveVelocityConstraints_s_Cdot1),p=s-i,v=It.MulM33XYZ(this.m_mass,d.x,d.y,p,n.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(v);var y=n.SolveVelocityConstraints_s_P.Set(v.x,v.y);e.SelfMulSub(o,y),i-=u*(Vt.CrossVV(this.m_rA,y)+v.z),r.SelfMulAdd(a,y),s+=l*(Vt.CrossVV(this.m_rB,y)+v.z)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(s),u=this.m_invMassA,l=this.m_invMassB,h=this.m_invIA,c=this.m_invIB;Vt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var m=Tt.MulRV(o,this.m_lalcA,this.m_rA);Vt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var _,f,d=Tt.MulRV(a,this.m_lalcB,this.m_rB),p=this.m_K;if(p.ex.x=u+l+m.y*m.y*h+d.y*d.y*c,p.ey.x=-m.y*m.x*h-d.y*d.x*c,p.ez.x=-m.y*h-d.y*c,p.ex.y=p.ey.x,p.ey.y=u+l+m.x*m.x*h+d.x*d.x*c,p.ez.y=m.x*h+d.x*c,p.ex.z=p.ez.x,p.ey.z=p.ez.y,p.ez.z=h+c,this.m_frequencyHz>0){var v=Vt.SubVV(Vt.AddVV(r,d,Vt.s_t0),Vt.AddVV(e,m,Vt.s_t1),n.SolvePositionConstraints_s_C1);_=v.Length(),f=0;var x=p.Solve22(v.x,v.y,n.SolvePositionConstraints_s_P).SelfNeg();e.SelfMulSub(u,x),i-=h*Vt.CrossVV(m,x),r.SelfMulAdd(l,x),s+=c*Vt.CrossVV(d,x)}else{var b=Vt.SubVV(Vt.AddVV(r,d,Vt.s_t0),Vt.AddVV(e,m,Vt.s_t1),n.SolvePositionConstraints_s_C1),w=s-i-this.m_referenceAngle;_=b.Length(),f=ot(w);var A=p.Solve33(b.x,b.y,w,n.SolvePositionConstraints_s_impulse).SelfNeg(),S=n.SolvePositionConstraints_s_P.Set(A.x,A.y);e.SelfMulSub(u,S),i-=h*(Vt.CrossVV(this.m_rA,S)+A.z),r.SelfMulAdd(l,S),s+=c*(Vt.CrossVV(this.m_rB,S)+A.z)}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,_<=y&&f<=g}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.z}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WeldJointDef = new b2WeldJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),n}(wn);Jn.InitVelocityConstraints_s_P=new Vt,Jn.SolveVelocityConstraints_s_Cdot1=new Vt,Jn.SolveVelocityConstraints_s_impulse1=new Vt,Jn.SolveVelocityConstraints_s_impulse=new kt,Jn.SolveVelocityConstraints_s_P=new Vt,Jn.SolvePositionConstraints_s_C1=new Vt,Jn.SolvePositionConstraints_s_P=new Vt,Jn.SolvePositionConstraints_s_impulse=new kt;var Xn=function(e){s(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_wheelJoint)).localAnchorA=new Vt(0,0),e.localAnchorB=new Vt(0,0),e.localAxisA=new Vt(1,0),e.enableMotor=!1,e.maxMotorTorque=0,e.motorSpeed=0,e.frequencyHz=2,e.dampingRatio=.7,e}return u(n,[{key:"Initialize",value:function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(n,this.localAxisA)}}]),n}(bn),Yn=function(t){s(n,t);var e=o(n);function n(t){var r;return a(this,n),(r=e.call(this,t)).m_frequencyHz=0,r.m_dampingRatio=0,r.m_localAnchorA=new Vt,r.m_localAnchorB=new Vt,r.m_localXAxisA=new Vt,r.m_localYAxisA=new Vt,r.m_impulse=0,r.m_motorImpulse=0,r.m_springImpulse=0,r.m_maxMotorTorque=0,r.m_motorSpeed=0,r.m_enableMotor=!1,r.m_indexA=0,r.m_indexB=0,r.m_localCenterA=new Vt,r.m_localCenterB=new Vt,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_ax=new Vt,r.m_ay=new Vt,r.m_sAx=0,r.m_sBx=0,r.m_sAy=0,r.m_sBy=0,r.m_mass=0,r.m_motorMass=0,r.m_springMass=0,r.m_bias=0,r.m_gamma=0,r.m_qA=new Tt,r.m_qB=new Tt,r.m_lalcA=new Vt,r.m_lalcB=new Vt,r.m_rA=new Vt,r.m_rB=new Vt,r.m_frequencyHz=i(t.frequencyHz,2),r.m_dampingRatio=i(t.dampingRatio,.7),r.m_localAnchorA.Copy(i(t.localAnchorA,Vt.ZERO)),r.m_localAnchorB.Copy(i(t.localAnchorB,Vt.ZERO)),r.m_localXAxisA.Copy(i(t.localAxisA,Vt.UNITX)),Vt.CrossOneV(r.m_localXAxisA,r.m_localYAxisA),r.m_maxMotorTorque=i(t.maxMotorTorque,0),r.m_motorSpeed=i(t.motorSpeed,0),r.m_enableMotor=i(t.enableMotor,!1),r.m_ax.SetZero(),r.m_ay.SetZero(),r}return u(n,[{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"GetMaxMotorTorque",value:function(){return this.m_maxMotorTorque}},{key:"SetSpringFrequencyHz",value:function(t){this.m_frequencyHz=t}},{key:"GetSpringFrequencyHz",value:function(){return this.m_frequencyHz}},{key:"SetSpringDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetSpringDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB,r=this.m_invIA,s=this.m_invIB,o=t.positions[this.m_indexA].c,a=t.positions[this.m_indexA].a,u=t.velocities[this.m_indexA].v,l=t.velocities[this.m_indexA].w,h=t.positions[this.m_indexB].c,c=t.positions[this.m_indexB].a,m=t.velocities[this.m_indexB].v,f=t.velocities[this.m_indexB].w,d=this.m_qA.SetAngle(a),p=this.m_qB.SetAngle(c);Vt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var v=Tt.MulRV(d,this.m_lalcA,this.m_rA);Vt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var y=Tt.MulRV(p,this.m_lalcB,this.m_rB),g=Vt.SubVV(Vt.AddVV(h,y,Vt.s_t0),Vt.AddVV(o,v,Vt.s_t1),n.InitVelocityConstraints_s_d);if(Tt.MulRV(d,this.m_localYAxisA,this.m_ay),this.m_sAy=Vt.CrossVV(Vt.AddVV(g,v,Vt.s_t0),this.m_ay),this.m_sBy=Vt.CrossVV(y,this.m_ay),this.m_mass=e+i+r*this.m_sAy*this.m_sAy+s*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){Tt.MulRV(d,this.m_localXAxisA,this.m_ax),this.m_sAx=Vt.CrossVV(Vt.AddVV(g,v,Vt.s_t0),this.m_ax),this.m_sBx=Vt.CrossVV(y,this.m_ax);var x=e+i+r*this.m_sAx*this.m_sAx+s*this.m_sBx*this.m_sBx;if(x>0){this.m_springMass=1/x;var b=Vt.DotVV(g,this.m_ax),w=2*_*this.m_frequencyHz,A=2*this.m_springMass*this.m_dampingRatio*w,S=this.m_springMass*w*w,B=t.step.dt;this.m_gamma=B*(A+B*S),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=b*B*S*this.m_gamma,this.m_springMass=x+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=r+s,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;var C=Vt.AddVV(Vt.MulSV(this.m_impulse,this.m_ay,Vt.s_t0),Vt.MulSV(this.m_springImpulse,this.m_ax,Vt.s_t1),n.InitVelocityConstraints_s_P),V=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,M=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;u.SelfMulSub(this.m_invMassA,C),l-=this.m_invIA*V,m.SelfMulAdd(this.m_invMassB,C),f+=this.m_invIB*M}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].w=l,t.velocities[this.m_indexB].w=f}},{key:"SolveVelocityConstraints",value:function(t){var e=this.m_invMassA,i=this.m_invMassB,r=this.m_invIA,s=this.m_invIB,o=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,u=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,h=Vt.DotVV(this.m_ax,Vt.SubVV(u,o,Vt.s_t0))+this.m_sBx*l-this.m_sAx*a,c=-this.m_springMass*(h+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=c;var m=Vt.MulSV(c,this.m_ax,n.SolveVelocityConstraints_s_P),_=c*this.m_sAx,f=c*this.m_sBx;o.SelfMulSub(e,m),a-=r*_,u.SelfMulAdd(i,m);var d=(l+=s*f)-a-this.m_motorSpeed,p=-this.m_motorMass*d,v=this.m_motorImpulse,y=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=lt(this.m_motorImpulse+p,-y,y),a-=r*(p=this.m_motorImpulse-v),l+=s*p;var g=Vt.DotVV(this.m_ay,Vt.SubVV(u,o,Vt.s_t0))+this.m_sBy*l-this.m_sAy*a,x=-this.m_mass*g;this.m_impulse+=x;var b=Vt.MulSV(x,this.m_ay,n.SolveVelocityConstraints_s_P),w=x*this.m_sAy,A=x*this.m_sBy;o.SelfMulSub(e,b),a-=r*w,u.SelfMulAdd(i,b),l+=s*A,t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=l}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(s);Vt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var u=Tt.MulRV(o,this.m_lalcA,this.m_rA);Vt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var l,h=Tt.MulRV(a,this.m_lalcB,this.m_rB),c=Vt.AddVV(Vt.SubVV(r,e,Vt.s_t0),Vt.SubVV(h,u,Vt.s_t1),n.SolvePositionConstraints_s_d),m=Tt.MulRV(o,this.m_localYAxisA,this.m_ay),_=Vt.CrossVV(Vt.AddVV(c,u,Vt.s_t0),m),f=Vt.CrossVV(h,m),d=Vt.DotVV(c,this.m_ay),p=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;l=0!==p?-d/p:0;var v=Vt.MulSV(l,m,n.SolvePositionConstraints_s_P),g=l*_,x=l*f;return e.SelfMulSub(this.m_invMassA,v),i-=this.m_invIA*g,r.SelfMulAdd(this.m_invMassB,v),s+=this.m_invIB*x,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,ot(d)<=y}},{key:"GetDefinition",value:function(t){return t}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e}},{key:"GetReactionTorque",value:function(t){return t*this.m_motorImpulse}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetLocalAxisA",value:function(){return this.m_localXAxisA}},{key:"GetJointTranslation",value:function(){return this.GetPrismaticJointTranslation()}},{key:"GetJointLinearSpeed",value:function(){return this.GetPrismaticJointSpeed()}},{key:"GetJointAngle",value:function(){return this.GetRevoluteJointAngle()}},{key:"GetJointAngularSpeed",value:function(){return this.GetRevoluteJointSpeed()}},{key:"GetPrismaticJointTranslation",value:function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new Vt),n=e.GetWorldPoint(this.m_localAnchorB,new Vt),r=Vt.SubVV(n,i,new Vt),s=t.GetWorldVector(this.m_localXAxisA,new Vt);return Vt.DotVV(r,s)}},{key:"GetPrismaticJointSpeed",value:function(){var t=this.m_bodyA,e=this.m_bodyB;Vt.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=Tt.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);Vt.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var n=Tt.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),r=Vt.AddVV(t.m_sweep.c,i,Vt.s_t0),s=Vt.AddVV(e.m_sweep.c,n,Vt.s_t1),o=Vt.SubVV(s,r,Vt.s_t2),a=t.GetWorldVector(this.m_localXAxisA,new Vt),u=t.m_linearVelocity,l=e.m_linearVelocity,h=t.m_angularVelocity,c=e.m_angularVelocity;return Vt.DotVV(o,Vt.CrossSV(h,a,Vt.s_t0))+Vt.DotVV(a,Vt.SubVV(Vt.AddVCrossSV(l,c,n,Vt.s_t0),Vt.AddVCrossSV(u,h,i,Vt.s_t1),Vt.s_t0))}},{key:"GetRevoluteJointAngle",value:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}},{key:"GetRevoluteJointSpeed",value:function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"SetMaxMotorTorque",value:function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}},{key:"GetMotorTorque",value:function(t){return t*this.m_motorImpulse}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WheelJointDef = new b2WheelJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),n}(wn);function Wn(t,e){return ft(t*e)}function Zn(t,e){return t>e?t:e}Yn.InitVelocityConstraints_s_d=new Vt,Yn.InitVelocityConstraints_s_P=new Vt,Yn.SolveVelocityConstraints_s_P=new Vt,Yn.SolvePositionConstraints_s_d=new Vt,Yn.SolvePositionConstraints_s_P=new Vt;var Hn=function t(e){a(this,t),this.prev=null,this.next=null,this.contact=e},Qn=function(){function t(){a(this,t),this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_indexA=0,this.m_indexB=0,this.m_manifold=new we,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_oldManifold=new we,this.m_nodeA=new Hn(this),this.m_nodeB=new Hn(this)}return u(t,[{key:"GetManifold",value:function(){return this.m_manifold}},{key:"GetWorldManifold",value:function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),n=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),n.m_radius,i.GetTransform(),r.m_radius)}},{key:"IsTouching",value:function(){return this.m_touchingFlag}},{key:"SetEnabled",value:function(t){this.m_enabledFlag=t}},{key:"IsEnabled",value:function(){return this.m_enabledFlag}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetFixtureA",value:function(){return this.m_fixtureA}},{key:"GetChildIndexA",value:function(){return this.m_indexA}},{key:"GetFixtureB",value:function(){return this.m_fixtureB}},{key:"GetChildIndexB",value:function(){return this.m_indexB}},{key:"FlagForFiltering",value:function(){this.m_filterFlag=!0}},{key:"SetFriction",value:function(t){this.m_friction=t}},{key:"GetFriction",value:function(){return this.m_friction}},{key:"ResetFriction",value:function(){this.m_friction=Wn(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}},{key:"SetRestitution",value:function(t){this.m_restitution=t}},{key:"GetRestitution",value:function(){return this.m_restitution}},{key:"ResetRestitution",value:function(){this.m_restitution=Zn(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}},{key:"SetTangentSpeed",value:function(t){this.m_tangentSpeed=t}},{key:"GetTangentSpeed",value:function(){return this.m_tangentSpeed}},{key:"Reset",value:function(t,e,i,n){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=n,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,delete this.m_nodeA.contact,this.m_nodeA.prev=null,this.m_nodeA.next=null,delete this.m_nodeA.other,delete this.m_nodeB.contact,this.m_nodeB.prev=null,this.m_nodeB.next=null,delete this.m_nodeB.other,this.m_toiCount=0,this.m_friction=Wn(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Zn(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}},{key:"Update",value:function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;var i=!1,n=this.m_touchingFlag,r=this.m_fixtureA.IsSensor(),s=this.m_fixtureB.IsSensor(),o=r||s,a=this.m_fixtureA.GetBody(),u=this.m_fixtureB.GetBody(),l=a.GetTransform(),h=u.GetTransform();if(o){var c=this.m_fixtureA.GetShape(),m=this.m_fixtureB.GetShape();i=Ge(c,this.m_indexA,m,this.m_indexB,l,h),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,l,h),i=this.m_manifold.pointCount>0;for(var _=0;_<this.m_manifold.pointCount;++_){var f=this.m_manifold.points[_];f.normalImpulse=0,f.tangentImpulse=0;for(var d=f.id,p=0;p<this.m_oldManifold.pointCount;++p){var v=this.m_oldManifold.points[p];if(v.id.key===d.key){f.normalImpulse=v.normalImpulse,f.tangentImpulse=v.tangentImpulse;break}}}i!==n&&(a.SetAwake(!0),u.SetAwake(!0))}this.m_touchingFlag=i,!n&&i&&t&&t.BeginContact(this),n&&!i&&t&&t.EndContact(this),!o&&i&&t&&t.PreSolve(this,this.m_oldManifold)}},{key:"ComputeTOI",value:function(e,i){var n=t.ComputeTOI_s_input;n.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA),n.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB),n.sweepA.Copy(e),n.sweepB.Copy(i),n.tMax=y;var r=t.ComputeTOI_s_output;return li(r,n),r.t}}]),t}();Qn.ComputeTOI_s_input=new He,Qn.ComputeTOI_s_output=new Ke;var Kn=function(t){s(i,t);var e=o(i);function i(){return a(this,i),e.call(this)}return u(i,[{key:"Reset",value:function(t,e,s,o){n(r(i.prototype),"Reset",this).call(this,t,e,s,o)}},{key:"Evaluate",value:function(t,e,i){mi(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Qn),$n=function(t){s(i,t);var e=o(i);function i(){return a(this,i),e.call(this)}return u(i,[{key:"Reset",value:function(t,e,s,o){n(r(i.prototype),"Reset",this).call(this,t,e,s,o)}},{key:"Evaluate",value:function(t,e,i){Oi(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Qn),tr=function(t){s(i,t);var e=o(i);function i(){return a(this,i),e.call(this)}return u(i,[{key:"Reset",value:function(t,e,s,o){n(r(i.prototype),"Reset",this).call(this,t,e,s,o)}},{key:"Evaluate",value:function(t,e,i){pi(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Qn),er=function(t){s(i,t);var e=o(i);function i(){return a(this,i),e.call(this)}return u(i,[{key:"Reset",value:function(t,e,s,o){n(r(i.prototype),"Reset",this).call(this,t,e,s,o)}},{key:"Evaluate",value:function(t,e,i){Zi(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Qn),ir=function(t){s(i,t);var e=o(i);function i(){return a(this,i),e.call(this)}return u(i,[{key:"Reset",value:function(t,e,s,o){n(r(i.prototype),"Reset",this).call(this,t,e,s,o)}},{key:"Evaluate",value:function(t,e,i){en(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Qn),nr=function(t){s(i,t);var e=o(i);function i(){return a(this,i),e.call(this)}return u(i,[{key:"Reset",value:function(t,e,s,o){n(r(i.prototype),"Reset",this).call(this,t,e,s,o)}},{key:"Evaluate",value:function(t,e,n){var r=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape(),o=r,a=i.Evaluate_s_edge;o.GetChildEdge(a,this.m_indexA),Zi(t,a,e,s,n)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Qn);nr.Evaluate_s_edge=new un;var rr=function(t){s(i,t);var e=o(i);function i(){return a(this,i),e.call(this)}return u(i,[{key:"Reset",value:function(t,e,s,o){n(r(i.prototype),"Reset",this).call(this,t,e,s,o)}},{key:"Evaluate",value:function(t,e,n){var r=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape(),o=r,a=i.Evaluate_s_edge;o.GetChildEdge(a,this.m_indexA),en(t,a,e,s,n)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Qn);rr.Evaluate_s_edge=new un;var sr=function t(){a(this,t),this.createFcn=null,this.destroyFcn=null,this.primary=!1},or=function(){function e(t){a(this,e),this.m_allocator=null,this.m_allocator=t,this.InitializeRegisters()}return u(e,[{key:"AddType",value:function(t,e,i,n){var r=this,s=tt(256,(function(e){return t(r.m_allocator)}));function o(e){return s.pop()||t(e)}function a(t,e){s.push(t)}this.m_registers[i][n].createFcn=o,this.m_registers[i][n].destroyFcn=a,this.m_registers[i][n].primary=!0,i!==n&&(this.m_registers[n][i].createFcn=o,this.m_registers[n][i].destroyFcn=a,this.m_registers[n][i].primary=!1)}},{key:"InitializeRegisters",value:function(){this.m_registers=[];for(var e=0;e<t.b2ShapeType.e_shapeTypeCount;e++){this.m_registers[e]=[];for(var i=0;i<t.b2ShapeType.e_shapeTypeCount;i++)this.m_registers[e][i]=new sr}this.AddType(Kn.Create,Kn.Destroy,t.b2ShapeType.e_circleShape,t.b2ShapeType.e_circleShape),this.AddType(tr.Create,tr.Destroy,t.b2ShapeType.e_polygonShape,t.b2ShapeType.e_circleShape),this.AddType($n.Create,$n.Destroy,t.b2ShapeType.e_polygonShape,t.b2ShapeType.e_polygonShape),this.AddType(er.Create,er.Destroy,t.b2ShapeType.e_edgeShape,t.b2ShapeType.e_circleShape),this.AddType(ir.Create,ir.Destroy,t.b2ShapeType.e_edgeShape,t.b2ShapeType.e_polygonShape),this.AddType(nr.Create,nr.Destroy,t.b2ShapeType.e_chainShape,t.b2ShapeType.e_circleShape),this.AddType(rr.Create,rr.Destroy,t.b2ShapeType.e_chainShape,t.b2ShapeType.e_polygonShape)}},{key:"Create",value:function(t,e,i,n){var r=t.GetType(),s=i.GetType(),o=this.m_registers[r][s];if(o.createFcn){var a=o.createFcn(this.m_allocator);return o.primary?a.Reset(t,e,i,n):a.Reset(i,n,t,e),a}return null}},{key:"Destroy",value:function(t){var e=t.m_fixtureA,i=t.m_fixtureB;t.m_manifold.pointCount>0&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0));var n=e.GetType(),r=i.GetType(),s=this.m_registers[n][r];s.destroyFcn&&s.destroyFcn(t,this.m_allocator)}}]),e}(),ar=function(){function t(){a(this,t)}return u(t,[{key:"SayGoodbyeJoint",value:function(t){}},{key:"SayGoodbyeFixture",value:function(t){}},{key:"SayGoodbyeParticleGroup",value:function(t){}},{key:"SayGoodbyeParticle",value:function(t,e){}}]),t}(),ur=function(){function e(){a(this,e)}return u(e,[{key:"ShouldCollide",value:function(e,i){var n=e.GetBody(),r=i.GetBody();if(r.GetType()===t.b2BodyType.b2_staticBody&&n.GetType()===t.b2BodyType.b2_staticBody)return!1;if(!r.ShouldCollideConnected(n))return!1;var s=e.GetFilterData(),o=i.GetFilterData();return s.groupIndex===o.groupIndex&&0!==s.groupIndex?s.groupIndex>0:0!==(s.maskBits&o.categoryBits)&&0!==(s.categoryBits&o.maskBits)}},{key:"ShouldCollideFixtureParticle",value:function(t,e,i){return!0}},{key:"ShouldCollideParticleParticle",value:function(t,e,i){return!0}}]),e}();ur.b2_defaultFilter=new ur;var lr=function t(){a(this,t),this.normalImpulses=it(f),this.tangentImpulses=it(f),this.count=0},hr=function(){function t(){a(this,t)}return u(t,[{key:"BeginContact",value:function(t){}},{key:"EndContact",value:function(t){}},{key:"BeginContactFixtureParticle",value:function(t,e){}},{key:"EndContactFixtureParticle",value:function(t,e){}},{key:"BeginContactParticleParticle",value:function(t,e){}},{key:"EndContactParticleParticle",value:function(t,e){}},{key:"PreSolve",value:function(t,e){}},{key:"PostSolve",value:function(t,e){}}]),t}();hr.b2_defaultListener=new hr;var cr=function(){function t(){a(this,t)}return u(t,[{key:"ReportFixture",value:function(t){return!0}},{key:"ReportParticle",value:function(t,e){return!1}},{key:"ShouldQueryParticleSystem",value:function(t){return!0}}]),t}(),mr=function(){function t(){a(this,t)}return u(t,[{key:"ReportFixture",value:function(t,e,i,n){return n}},{key:"ReportParticle",value:function(t,e,i,n,r){return 0}},{key:"ShouldQueryParticleSystem",value:function(t){return!0}}]),t}(),_r=function(){function e(){a(this,e),this.m_broadPhase=new je,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=ur.b2_defaultFilter,this.m_contactListener=hr.b2_defaultListener,this.m_allocator=null,this.m_contactFactory=new or(this.m_allocator)}return u(e,[{key:"AddPair",value:function(t,e){var i=t.fixture,n=e.fixture,r=t.childIndex,s=e.childIndex,o=i.GetBody(),a=n.GetBody();if(o!==a){for(var u=a.GetContactList();u;){if(u.other===o){var l=u.contact.GetFixtureA(),h=u.contact.GetFixtureB(),c=u.contact.GetChildIndexA(),m=u.contact.GetChildIndexB();if(l===i&&h===n&&c===r&&m===s)return;if(l===n&&h===i&&c===s&&m===r)return}u=u.next}if(!this.m_contactFilter||this.m_contactFilter.ShouldCollide(i,n)){var _=this.m_contactFactory.Create(i,r,n,s);null!==_&&(i=_.GetFixtureA(),n=_.GetFixtureB(),r=_.GetChildIndexA(),s=_.GetChildIndexB(),o=i.m_body,a=n.m_body,_.m_prev=null,_.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=_),this.m_contactList=_,_.m_nodeA.contact=_,_.m_nodeA.other=a,_.m_nodeA.prev=null,_.m_nodeA.next=o.m_contactList,null!==o.m_contactList&&(o.m_contactList.prev=_.m_nodeA),o.m_contactList=_.m_nodeA,_.m_nodeB.contact=_,_.m_nodeB.other=o,_.m_nodeB.prev=null,_.m_nodeB.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=_.m_nodeB),a.m_contactList=_.m_nodeB,i.IsSensor()||n.IsSensor()||(o.SetAwake(!0),a.SetAwake(!0)),++this.m_contactCount)}}}},{key:"FindNewContacts",value:function(){var t=this;this.m_broadPhase.UpdatePairs((function(e,i){t.AddPair(e,i)}))}},{key:"Destroy",value:function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),n=e.GetBody(),r=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===n.m_contactList&&(n.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===r.m_contactList&&(r.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount}},{key:"Collide",value:function(){for(var e=this.m_contactList;e;){var i=e.GetFixtureA(),n=e.GetFixtureB(),r=e.GetChildIndexA(),s=e.GetChildIndexB(),o=i.GetBody(),a=n.GetBody();if(e.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(i,n)){var u=e;e=u.m_next,this.Destroy(u);continue}e.m_filterFlag=!1}var l=o.IsAwake()&&o.m_type!==t.b2BodyType.b2_staticBody,h=a.IsAwake()&&a.m_type!==t.b2BodyType.b2_staticBody;if(l||h){var c=i.m_proxies[r].treeNode,m=n.m_proxies[s].treeNode;if(ke(c.aabb,m.aabb))e.Update(this.m_contactListener),e=e.m_next;else{var _=e;e=_.m_next,this.Destroy(_)}}else e=e.m_next}}}]),e}(),fr=function(){function t(){a(this,t),this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}return u(t,[{key:"Reset",value:function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}}]),t}(),dr=function(){function t(){a(this,t),this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1}return u(t,[{key:"Copy",value:function(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this}}]),t}(),pr=function(){function t(){a(this,t),this.c=new Vt,this.a=0}return u(t,null,[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}(),vr=function(){function t(){a(this,t),this.v=new Vt,this.w=0}return u(t,null,[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}(),yr=function t(){a(this,t),this.step=new dr},gr=!1,xr=function(){function t(){a(this,t),this.rA=new Vt,this.rB=new Vt,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return u(t,null,[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}(),br=function(){function t(){a(this,t),this.points=xr.MakeArray(f),this.normal=new Vt,this.tangent=new Vt,this.normalMass=new Pt,this.K=new Pt,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}return u(t,null,[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}(),wr=function(){function e(){a(this,e),this.localPoints=Vt.MakeArray(f),this.localNormal=new Vt,this.localPoint=new Vt,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new Vt,this.localCenterB=new Vt,this.invIA=0,this.invIB=0,this.type=t.b2ManifoldType.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}return u(e,null,[{key:"MakeArray",value:function(t){return tt(t,(function(t){return new e}))}}]),e}(),Ar=function t(){a(this,t),this.step=new dr,this.count=0,this.allocator=null},Sr=function(){function e(){a(this,e),this.normal=new Vt,this.point=new Vt,this.separation=0}return u(e,[{key:"Initialize",value:function(i,n,r,s){var o=e.Initialize_s_pointA,a=e.Initialize_s_pointB,u=e.Initialize_s_planePoint,l=e.Initialize_s_clipPoint;switch(i.type){case t.b2ManifoldType.e_circles:Dt.MulXV(n,i.localPoint,o),Dt.MulXV(r,i.localPoints[0],a),Vt.SubVV(a,o,this.normal).SelfNormalize(),Vt.MidVV(o,a,this.point),this.separation=Vt.DotVV(Vt.SubVV(a,o,Vt.s_t0),this.normal)-i.radiusA-i.radiusB;break;case t.b2ManifoldType.e_faceA:Tt.MulRV(n.q,i.localNormal,this.normal),Dt.MulXV(n,i.localPoint,u),Dt.MulXV(r,i.localPoints[s],l),this.separation=Vt.DotVV(Vt.SubVV(l,u,Vt.s_t0),this.normal)-i.radiusA-i.radiusB,this.point.Copy(l);break;case t.b2ManifoldType.e_faceB:Tt.MulRV(r.q,i.localNormal,this.normal),Dt.MulXV(r,i.localPoint,u),Dt.MulXV(n,i.localPoints[s],l),this.separation=Vt.DotVV(Vt.SubVV(l,u,Vt.s_t0),this.normal)-i.radiusA-i.radiusB,this.point.Copy(l),this.normal.SelfNeg()}}}]),e}();Sr.Initialize_s_pointA=new Vt,Sr.Initialize_s_pointB=new Vt,Sr.Initialize_s_planePoint=new Vt,Sr.Initialize_s_clipPoint=new Vt;var Br=function(){function t(){a(this,t),this.m_step=new dr,this.m_allocator=null,this.m_positionConstraints=wr.MakeArray(1024),this.m_velocityConstraints=br.MakeArray(1024),this.m_count=0}return u(t,[{key:"Initialize",value:function(t){if(this.m_step.Copy(t.step),this.m_allocator=t.allocator,this.m_count=t.count,this.m_positionConstraints.length<this.m_count)for(var e=ut(2*this.m_positionConstraints.length,this.m_count);this.m_positionConstraints.length<e;)this.m_positionConstraints[this.m_positionConstraints.length]=new wr;if(this.m_velocityConstraints.length<this.m_count)for(var i=ut(2*this.m_velocityConstraints.length,this.m_count);this.m_velocityConstraints.length<i;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new br;this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(var n=0;n<this.m_count;++n){var r=this.m_contacts[n],s=r.m_fixtureA,o=r.m_fixtureB,a=s.GetShape(),u=o.GetShape(),l=a.m_radius,h=u.m_radius,c=s.GetBody(),m=o.GetBody(),_=r.GetManifold(),f=_.pointCount,d=this.m_velocityConstraints[n];d.friction=r.m_friction,d.restitution=r.m_restitution,d.tangentSpeed=r.m_tangentSpeed,d.indexA=c.m_islandIndex,d.indexB=m.m_islandIndex,d.invMassA=c.m_invMass,d.invMassB=m.m_invMass,d.invIA=c.m_invI,d.invIB=m.m_invI,d.contactIndex=n,d.pointCount=f,d.K.SetZero(),d.normalMass.SetZero();var p=this.m_positionConstraints[n];p.indexA=c.m_islandIndex,p.indexB=m.m_islandIndex,p.invMassA=c.m_invMass,p.invMassB=m.m_invMass,p.localCenterA.Copy(c.m_sweep.localCenter),p.localCenterB.Copy(m.m_sweep.localCenter),p.invIA=c.m_invI,p.invIB=m.m_invI,p.localNormal.Copy(_.localNormal),p.localPoint.Copy(_.localPoint),p.pointCount=f,p.radiusA=l,p.radiusB=h,p.type=_.type;for(var v=0;v<f;++v){var y=_.points[v],g=d.points[v];this.m_step.warmStarting?(g.normalImpulse=this.m_step.dtRatio*y.normalImpulse,g.tangentImpulse=this.m_step.dtRatio*y.tangentImpulse):(g.normalImpulse=0,g.tangentImpulse=0),g.rA.SetZero(),g.rB.SetZero(),g.normalMass=0,g.tangentMass=0,g.velocityBias=0,p.localPoints[v].Copy(y.localPoint)}}return this}},{key:"InitializeVelocityConstraints",value:function(){for(var e=t.InitializeVelocityConstraints_s_xfA,i=t.InitializeVelocityConstraints_s_xfB,n=t.InitializeVelocityConstraints_s_worldManifold,r=1e3,s=0;s<this.m_count;++s){var o=this.m_velocityConstraints[s],a=this.m_positionConstraints[s],u=a.radiusA,l=a.radiusB,h=this.m_contacts[o.contactIndex].GetManifold(),c=o.indexA,m=o.indexB,_=o.invMassA,f=o.invMassB,d=o.invIA,p=o.invIB,v=a.localCenterA,y=a.localCenterB,g=this.m_positions[c].c,x=this.m_positions[c].a,b=this.m_velocities[c].v,w=this.m_velocities[c].w,S=this.m_positions[m].c,B=this.m_positions[m].a,C=this.m_velocities[m].v,V=this.m_velocities[m].w;e.q.SetAngle(x),i.q.SetAngle(B),Vt.SubVV(g,Tt.MulRV(e.q,v,Vt.s_t0),e.p),Vt.SubVV(S,Tt.MulRV(i.q,y,Vt.s_t0),i.p),n.Initialize(h,e,u,i,l),o.normal.Copy(n.normal),Vt.CrossVOne(o.normal,o.tangent);for(var M=o.pointCount,k=0;k<M;++k){var P=o.points[k];Vt.SubVV(n.points[k],g,P.rA),Vt.SubVV(n.points[k],S,P.rB);var I=Vt.CrossVV(P.rA,o.normal),T=Vt.CrossVV(P.rB,o.normal),D=_+f+d*I*I+p*T*T;P.normalMass=D>0?1/D:0;var G=o.tangent,R=Vt.CrossVV(P.rA,G),E=Vt.CrossVV(P.rB,G),F=_+f+d*R*R+p*E*E;P.tangentMass=F>0?1/F:0,P.velocityBias=0;var L=Vt.DotVV(o.normal,Vt.SubVV(Vt.AddVCrossSV(C,V,P.rB,Vt.s_t0),Vt.AddVCrossSV(b,w,P.rA,Vt.s_t1),Vt.s_t0));L<-A&&(P.velocityBias+=-o.restitution*L)}if(2===o.pointCount&&gr){var j=o.points[0],O=o.points[1],N=Vt.CrossVV(j.rA,o.normal),q=Vt.CrossVV(j.rB,o.normal),z=Vt.CrossVV(O.rA,o.normal),U=Vt.CrossVV(O.rB,o.normal),J=_+f+d*N*N+p*q*q,X=_+f+d*z*z+p*U*U,Y=_+f+d*N*z+p*q*U;J*J<r*(J*X-Y*Y)?(o.K.ex.Set(J,Y),o.K.ey.Set(Y,X),o.K.GetInverse(o.normalMass)):o.pointCount=1}}}},{key:"WarmStart",value:function(){for(var e=t.WarmStart_s_P,i=0;i<this.m_count;++i){for(var n=this.m_velocityConstraints[i],r=n.indexA,s=n.indexB,o=n.invMassA,a=n.invIA,u=n.invMassB,l=n.invIB,h=n.pointCount,c=this.m_velocities[r].v,m=this.m_velocities[r].w,_=this.m_velocities[s].v,f=this.m_velocities[s].w,d=n.normal,p=n.tangent,v=0;v<h;++v){var y=n.points[v];Vt.AddVV(Vt.MulSV(y.normalImpulse,d,Vt.s_t0),Vt.MulSV(y.tangentImpulse,p,Vt.s_t1),e),m-=a*Vt.CrossVV(y.rA,e),c.SelfMulSub(o,e),f+=l*Vt.CrossVV(y.rB,e),_.SelfMulAdd(u,e)}this.m_velocities[r].w=m,this.m_velocities[s].w=f}}},{key:"SolveVelocityConstraints",value:function(){for(var e=t.SolveVelocityConstraints_s_dv,i=t.SolveVelocityConstraints_s_dv1,n=t.SolveVelocityConstraints_s_dv2,r=t.SolveVelocityConstraints_s_P,s=t.SolveVelocityConstraints_s_a,o=t.SolveVelocityConstraints_s_b,a=t.SolveVelocityConstraints_s_x,u=t.SolveVelocityConstraints_s_d,l=t.SolveVelocityConstraints_s_P1,h=t.SolveVelocityConstraints_s_P2,c=t.SolveVelocityConstraints_s_P1P2,m=0;m<this.m_count;++m){for(var _=this.m_velocityConstraints[m],f=_.indexA,d=_.indexB,p=_.invMassA,v=_.invIA,y=_.invMassB,g=_.invIB,x=_.pointCount,b=this.m_velocities[f].v,w=this.m_velocities[f].w,A=this.m_velocities[d].v,S=this.m_velocities[d].w,B=_.normal,C=_.tangent,V=_.friction,M=0;M<x;++M){var k=_.points[M];Vt.SubVV(Vt.AddVCrossSV(A,S,k.rB,Vt.s_t0),Vt.AddVCrossSV(b,w,k.rA,Vt.s_t1),e);var P=Vt.DotVV(e,C)-_.tangentSpeed,I=k.tangentMass*-P,T=V*k.normalImpulse,D=lt(k.tangentImpulse+I,-T,T);I=D-k.tangentImpulse,k.tangentImpulse=D,Vt.MulSV(I,C,r),b.SelfMulSub(p,r),w-=v*Vt.CrossVV(k.rA,r),A.SelfMulAdd(y,r),S+=g*Vt.CrossVV(k.rB,r)}if(1===_.pointCount||!1===gr)for(var G=0;G<x;++G){var R=_.points[G];Vt.SubVV(Vt.AddVCrossSV(A,S,R.rB,Vt.s_t0),Vt.AddVCrossSV(b,w,R.rA,Vt.s_t1),e);var E=Vt.DotVV(e,B),F=-R.normalMass*(E-R.velocityBias),L=ut(R.normalImpulse+F,0);F=L-R.normalImpulse,R.normalImpulse=L,Vt.MulSV(F,B,r),b.SelfMulSub(p,r),w-=v*Vt.CrossVV(R.rA,r),A.SelfMulAdd(y,r),S+=g*Vt.CrossVV(R.rB,r)}else{var j=_.points[0],O=_.points[1];s.Set(j.normalImpulse,O.normalImpulse),Vt.SubVV(Vt.AddVCrossSV(A,S,j.rB,Vt.s_t0),Vt.AddVCrossSV(b,w,j.rA,Vt.s_t1),i),Vt.SubVV(Vt.AddVCrossSV(A,S,O.rB,Vt.s_t0),Vt.AddVCrossSV(b,w,O.rA,Vt.s_t1),n);var N=Vt.DotVV(i,B),q=Vt.DotVV(n,B);for(o.x=N-j.velocityBias,o.y=q-O.velocityBias,o.SelfSub(Pt.MulMV(_.K,s,Vt.s_t0));;){if(Pt.MulMV(_.normalMass,o,a).SelfNeg(),a.x>=0&&a.y>=0){Vt.SubVV(a,s,u),Vt.MulSV(u.x,B,l),Vt.MulSV(u.y,B,h),Vt.AddVV(l,h,c),b.SelfMulSub(p,c),w-=v*(Vt.CrossVV(j.rA,l)+Vt.CrossVV(O.rA,h)),A.SelfMulAdd(y,c),S+=g*(Vt.CrossVV(j.rB,l)+Vt.CrossVV(O.rB,h)),j.normalImpulse=a.x,O.normalImpulse=a.y;break}if(a.x=-j.normalMass*o.x,a.y=0,N=0,q=_.K.ex.y*a.x+o.y,a.x>=0&&q>=0){Vt.SubVV(a,s,u),Vt.MulSV(u.x,B,l),Vt.MulSV(u.y,B,h),Vt.AddVV(l,h,c),b.SelfMulSub(p,c),w-=v*(Vt.CrossVV(j.rA,l)+Vt.CrossVV(O.rA,h)),A.SelfMulAdd(y,c),S+=g*(Vt.CrossVV(j.rB,l)+Vt.CrossVV(O.rB,h)),j.normalImpulse=a.x,O.normalImpulse=a.y;break}if(a.x=0,a.y=-O.normalMass*o.y,N=_.K.ey.x*a.y+o.x,q=0,a.y>=0&&N>=0){Vt.SubVV(a,s,u),Vt.MulSV(u.x,B,l),Vt.MulSV(u.y,B,h),Vt.AddVV(l,h,c),b.SelfMulSub(p,c),w-=v*(Vt.CrossVV(j.rA,l)+Vt.CrossVV(O.rA,h)),A.SelfMulAdd(y,c),S+=g*(Vt.CrossVV(j.rB,l)+Vt.CrossVV(O.rB,h)),j.normalImpulse=a.x,O.normalImpulse=a.y;break}if(a.x=0,a.y=0,N=o.x,q=o.y,N>=0&&q>=0){Vt.SubVV(a,s,u),Vt.MulSV(u.x,B,l),Vt.MulSV(u.y,B,h),Vt.AddVV(l,h,c),b.SelfMulSub(p,c),w-=v*(Vt.CrossVV(j.rA,l)+Vt.CrossVV(O.rA,h)),A.SelfMulAdd(y,c),S+=g*(Vt.CrossVV(j.rB,l)+Vt.CrossVV(O.rB,h)),j.normalImpulse=a.x,O.normalImpulse=a.y;break}break}}this.m_velocities[f].w=w,this.m_velocities[d].w=S}}},{key:"StoreImpulses",value:function(){for(var t=0;t<this.m_count;++t)for(var e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold(),n=0;n<e.pointCount;++n)i.points[n].normalImpulse=e.points[n].normalImpulse,i.points[n].tangentImpulse=e.points[n].tangentImpulse}},{key:"SolvePositionConstraints",value:function(){for(var e=t.SolvePositionConstraints_s_xfA,i=t.SolvePositionConstraints_s_xfB,n=t.SolvePositionConstraints_s_psm,r=t.SolvePositionConstraints_s_rA,s=t.SolvePositionConstraints_s_rB,o=t.SolvePositionConstraints_s_P,a=0,u=0;u<this.m_count;++u){for(var l=this.m_positionConstraints[u],h=l.indexA,c=l.indexB,m=l.localCenterA,_=l.invMassA,f=l.invIA,d=l.localCenterB,p=l.invMassB,v=l.invIB,g=l.pointCount,x=this.m_positions[h].c,b=this.m_positions[h].a,w=this.m_positions[c].c,A=this.m_positions[c].a,B=0;B<g;++B){e.q.SetAngle(b),i.q.SetAngle(A),Vt.SubVV(x,Tt.MulRV(e.q,m,Vt.s_t0),e.p),Vt.SubVV(w,Tt.MulRV(i.q,d,Vt.s_t0),i.p),n.Initialize(l,e,i,B);var C=n.normal,V=n.point,M=n.separation;Vt.SubVV(V,x,r),Vt.SubVV(V,w,s),a=at(a,M);var k=lt(P*(M+y),-S,0),I=Vt.CrossVV(r,C),T=Vt.CrossVV(s,C),D=_+p+f*I*I+v*T*T,G=D>0?-k/D:0;Vt.MulSV(G,C,o),x.SelfMulSub(_,o),b-=f*Vt.CrossVV(r,o),w.SelfMulAdd(p,o),A+=v*Vt.CrossVV(s,o)}this.m_positions[h].a=b,this.m_positions[c].a=A}return a>-3*y}},{key:"SolveTOIPositionConstraints",value:function(e,i){for(var n=t.SolveTOIPositionConstraints_s_xfA,r=t.SolveTOIPositionConstraints_s_xfB,s=t.SolveTOIPositionConstraints_s_psm,o=t.SolveTOIPositionConstraints_s_rA,a=t.SolveTOIPositionConstraints_s_rB,u=t.SolveTOIPositionConstraints_s_P,l=0,h=0;h<this.m_count;++h){var c=this.m_positionConstraints[h],m=c.indexA,_=c.indexB,f=c.localCenterA,d=c.localCenterB,p=c.pointCount,v=0,g=0;m!==e&&m!==i||(v=c.invMassA,g=c.invIA);var x=0,b=0;_!==e&&_!==i||(x=c.invMassB,b=c.invIB);for(var w=this.m_positions[m].c,A=this.m_positions[m].a,B=this.m_positions[_].c,C=this.m_positions[_].a,V=0;V<p;++V){n.q.SetAngle(A),r.q.SetAngle(C),Vt.SubVV(w,Tt.MulRV(n.q,f,Vt.s_t0),n.p),Vt.SubVV(B,Tt.MulRV(r.q,d,Vt.s_t0),r.p),s.Initialize(c,n,r,V);var M=s.normal,k=s.point,P=s.separation;Vt.SubVV(k,w,o),Vt.SubVV(k,B,a),l=at(l,P);var T=lt(I*(P+y),-S,0),D=Vt.CrossVV(o,M),G=Vt.CrossVV(a,M),R=v+x+g*D*D+b*G*G,E=R>0?-T/R:0;Vt.MulSV(E,M,u),w.SelfMulSub(v,u),A-=g*Vt.CrossVV(o,u),B.SelfMulAdd(x,u),C+=b*Vt.CrossVV(a,u)}this.m_positions[m].a=A,this.m_positions[_].a=C}return l>=-1.5*y}}]),t}();Br.InitializeVelocityConstraints_s_xfA=new Dt,Br.InitializeVelocityConstraints_s_xfB=new Dt,Br.InitializeVelocityConstraints_s_worldManifold=new Ae,Br.WarmStart_s_P=new Vt,Br.SolveVelocityConstraints_s_dv=new Vt,Br.SolveVelocityConstraints_s_dv1=new Vt,Br.SolveVelocityConstraints_s_dv2=new Vt,Br.SolveVelocityConstraints_s_P=new Vt,Br.SolveVelocityConstraints_s_a=new Vt,Br.SolveVelocityConstraints_s_b=new Vt,Br.SolveVelocityConstraints_s_x=new Vt,Br.SolveVelocityConstraints_s_d=new Vt,Br.SolveVelocityConstraints_s_P1=new Vt,Br.SolveVelocityConstraints_s_P2=new Vt,Br.SolveVelocityConstraints_s_P1P2=new Vt,Br.SolvePositionConstraints_s_xfA=new Dt,Br.SolvePositionConstraints_s_xfB=new Dt,Br.SolvePositionConstraints_s_psm=new Sr,Br.SolvePositionConstraints_s_rA=new Vt,Br.SolvePositionConstraints_s_rB=new Vt,Br.SolvePositionConstraints_s_P=new Vt,Br.SolveTOIPositionConstraints_s_xfA=new Dt,Br.SolveTOIPositionConstraints_s_xfB=new Dt,Br.SolveTOIPositionConstraints_s_psm=new Sr,Br.SolveTOIPositionConstraints_s_rA=new Vt,Br.SolveTOIPositionConstraints_s_rB=new Vt,Br.SolveTOIPositionConstraints_s_P=new Vt;var Cr,Vr=function(){function e(){a(this,e),this.m_allocator=null,this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=pr.MakeArray(1024),this.m_velocities=vr.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}return u(e,[{key:"Initialize",value:function(t,e,i,n,r){if(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=n,this.m_listener=r,this.m_positions.length<t)for(var s=ut(2*this.m_positions.length,t);this.m_positions.length<s;)this.m_positions[this.m_positions.length]=new pr;if(this.m_velocities.length<t)for(var o=ut(2*this.m_velocities.length,t);this.m_velocities.length<o;)this.m_velocities[this.m_velocities.length]=new vr}},{key:"Clear",value:function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}},{key:"AddBody",value:function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t}},{key:"AddContact",value:function(t){this.m_contacts[this.m_contactCount++]=t}},{key:"AddJoint",value:function(t){this.m_joints[this.m_jointCount++]=t}},{key:"Solve",value:function(i,n,r,s){for(var o=e.s_timer.Reset(),a=n.dt,u=0;u<this.m_bodyCount;++u){var l=this.m_bodies[u];this.m_positions[u].c.Copy(l.m_sweep.c);var c=l.m_sweep.a,m=this.m_velocities[u].v.Copy(l.m_linearVelocity),_=l.m_angularVelocity;l.m_sweep.c0.Copy(l.m_sweep.c),l.m_sweep.a0=l.m_sweep.a,l.m_type===t.b2BodyType.b2_dynamicBody&&(m.x+=a*(l.m_gravityScale*r.x+l.m_invMass*l.m_force.x),m.y+=a*(l.m_gravityScale*r.y+l.m_invMass*l.m_force.y),_+=a*l.m_invI*l.m_torque,m.SelfMul(1/(1+a*l.m_linearDamping)),_*=1/(1+a*l.m_angularDamping)),this.m_positions[u].a=c,this.m_velocities[u].w=_}o.Reset();var f=e.s_solverData;f.step.Copy(n),f.positions=this.m_positions,f.velocities=this.m_velocities;var d=e.s_contactSolverDef;d.step.Copy(n),d.contacts=this.m_contacts,d.count=this.m_contactCount,d.positions=this.m_positions,d.velocities=this.m_velocities,d.allocator=this.m_allocator;var p=e.s_contactSolver.Initialize(d);p.InitializeVelocityConstraints(),n.warmStarting&&p.WarmStart();for(var v=0;v<this.m_jointCount;++v)this.m_joints[v].InitVelocityConstraints(f);i.solveInit=o.GetMilliseconds(),o.Reset();for(var y=0;y<n.velocityIterations;++y){for(var g=0;g<this.m_jointCount;++g)this.m_joints[g].SolveVelocityConstraints(f);p.SolveVelocityConstraints()}p.StoreImpulses(),i.solveVelocity=o.GetMilliseconds();for(var x=0;x<this.m_bodyCount;++x){var b=this.m_positions[x].c,w=this.m_positions[x].a,A=this.m_velocities[x].v,S=this.m_velocities[x].w,B=Vt.MulSV(a,A,e.s_translation);if(Vt.DotVV(B,B)>V){var P=C/B.Length();A.SelfMul(P)}var I=a*S;I*I>k&&(S*=M/ot(I)),b.x+=a*A.x,b.y+=a*A.y,w+=a*S,this.m_positions[x].a=w,this.m_velocities[x].w=S}o.Reset();for(var T=!1,D=0;D<n.positionIterations;++D){for(var G=p.SolvePositionConstraints(),R=!0,E=0;E<this.m_jointCount;++E){var F=this.m_joints[E].SolvePositionConstraints(f);R=R&&F}if(G&&R){T=!0;break}}for(var L=0;L<this.m_bodyCount;++L){var j=this.m_bodies[L];j.m_sweep.c.Copy(this.m_positions[L].c),j.m_sweep.a=this.m_positions[L].a,j.m_linearVelocity.Copy(this.m_velocities[L].v),j.m_angularVelocity=this.m_velocities[L].w,j.SynchronizeTransform()}if(i.solvePosition=o.GetMilliseconds(),this.Report(p.m_velocityConstraints),s){for(var O=h,N=z*z,J=U*U,X=0;X<this.m_bodyCount;++X){var Y=this.m_bodies[X];Y.GetType()!==t.b2BodyType.b2_staticBody&&(!Y.m_autoSleepFlag||Y.m_angularVelocity*Y.m_angularVelocity>J||Vt.DotVV(Y.m_linearVelocity,Y.m_linearVelocity)>N?(Y.m_sleepTime=0,O=0):(Y.m_sleepTime+=a,O=at(O,Y.m_sleepTime)))}if(O>=q&&T)for(var W=0;W<this.m_bodyCount;++W)this.m_bodies[W].SetAwake(!1)}}},{key:"SolveTOI",value:function(t,i,n){for(var r=0;r<this.m_bodyCount;++r){var s=this.m_bodies[r];this.m_positions[r].c.Copy(s.m_sweep.c),this.m_positions[r].a=s.m_sweep.a,this.m_velocities[r].v.Copy(s.m_linearVelocity),this.m_velocities[r].w=s.m_angularVelocity}var o=e.s_contactSolverDef;o.contacts=this.m_contacts,o.count=this.m_contactCount,o.allocator=this.m_allocator,o.step.Copy(t),o.positions=this.m_positions,o.velocities=this.m_velocities;for(var a=e.s_contactSolver.Initialize(o),u=0;u<t.positionIterations&&!a.SolveTOIPositionConstraints(i,n);++u);this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,this.m_bodies[n].m_sweep.c0.Copy(this.m_positions[n].c),this.m_bodies[n].m_sweep.a0=this.m_positions[n].a,a.InitializeVelocityConstraints();for(var l=0;l<t.velocityIterations;++l)a.SolveVelocityConstraints();for(var h=t.dt,c=0;c<this.m_bodyCount;++c){var m=this.m_positions[c].c,_=this.m_positions[c].a,f=this.m_velocities[c].v,d=this.m_velocities[c].w,p=Vt.MulSV(h,f,e.s_translation);if(Vt.DotVV(p,p)>V){var v=C/p.Length();f.SelfMul(v)}var y=h*d;y*y>k&&(d*=M/ot(y)),m.SelfMulAdd(h,f),_+=h*d,this.m_positions[c].a=_,this.m_velocities[c].w=d;var g=this.m_bodies[c];g.m_sweep.c.Copy(m),g.m_sweep.a=_,g.m_linearVelocity.Copy(f),g.m_angularVelocity=d,g.SynchronizeTransform()}this.Report(a.m_velocityConstraints)}},{key:"Report",value:function(t){if(null!==this.m_listener)for(var i=0;i<this.m_contactCount;++i){var n=this.m_contacts[i];if(n){var r=t[i],s=e.s_impulse;s.count=r.pointCount;for(var o=0;o<r.pointCount;++o)s.normalImpulses[o]=r.points[o].normalImpulse,s.tangentImpulses[o]=r.points[o].tangentImpulse;this.m_listener.PostSolve(n,s)}}}}]),e}();Vr.s_timer=new Lt,Vr.s_solverData=new yr,Vr.s_contactSolverDef=new Ar,Vr.s_contactSolver=new Br,Vr.s_translation=new Vt,Vr.s_impulse=new lr,(Cr=t.b2ParticleFlag||(t.b2ParticleFlag={}))[Cr.b2_waterParticle=0]="b2_waterParticle",Cr[Cr.b2_zombieParticle=2]="b2_zombieParticle",Cr[Cr.b2_wallParticle=4]="b2_wallParticle",Cr[Cr.b2_springParticle=8]="b2_springParticle",Cr[Cr.b2_elasticParticle=16]="b2_elasticParticle",Cr[Cr.b2_viscousParticle=32]="b2_viscousParticle",Cr[Cr.b2_powderParticle=64]="b2_powderParticle",Cr[Cr.b2_tensileParticle=128]="b2_tensileParticle",Cr[Cr.b2_colorMixingParticle=256]="b2_colorMixingParticle",Cr[Cr.b2_destructionListenerParticle=512]="b2_destructionListenerParticle",Cr[Cr.b2_barrierParticle=1024]="b2_barrierParticle",Cr[Cr.b2_staticPressureParticle=2048]="b2_staticPressureParticle",Cr[Cr.b2_reactiveParticle=4096]="b2_reactiveParticle",Cr[Cr.b2_repulsiveParticle=8192]="b2_repulsiveParticle",Cr[Cr.b2_fixtureContactListenerParticle=16384]="b2_fixtureContactListenerParticle",Cr[Cr.b2_particleContactListenerParticle=32768]="b2_particleContactListenerParticle",Cr[Cr.b2_fixtureContactFilterParticle=65536]="b2_fixtureContactFilterParticle",Cr[Cr.b2_particleContactFilterParticle=131072]="b2_particleContactFilterParticle";var Mr=function t(){a(this,t),this.flags=0,this.position=new Vt,this.velocity=new Vt,this.color=new Et(0,0,0,0),this.lifetime=0,this.userData=null,this.group=null};function kr(t,e,i){var n=8,r=.01;return lt(Math.ceil(Math.sqrt(t/(r*e))*i),1,n)}var Pr,Ir=function(){function t(){a(this,t),this.m_index=T}return u(t,[{key:"GetIndex",value:function(){return this.m_index}},{key:"SetIndex",value:function(t){this.m_index=t}}]),t}();(Pr=t.b2ParticleGroupFlag||(t.b2ParticleGroupFlag={}))[Pr.b2_solidParticleGroup=1]="b2_solidParticleGroup",Pr[Pr.b2_rigidParticleGroup=2]="b2_rigidParticleGroup",Pr[Pr.b2_particleGroupCanBeEmpty=4]="b2_particleGroupCanBeEmpty",Pr[Pr.b2_particleGroupWillBeDestroyed=8]="b2_particleGroupWillBeDestroyed",Pr[Pr.b2_particleGroupNeedsUpdateDepth=16]="b2_particleGroupNeedsUpdateDepth",Pr[Pr.b2_particleGroupInternalMask=24]="b2_particleGroupInternalMask";var Tr=function t(){a(this,t),this.flags=0,this.groupFlags=0,this.position=new Vt,this.angle=0,this.linearVelocity=new Vt,this.angularVelocity=0,this.color=new Et,this.strength=1,this.shapeCount=0,this.stride=0,this.particleCount=0,this.lifetime=0,this.userData=null,this.group=null},Dr=function(){function e(t){a(this,e),this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new Vt,this.m_linearVelocity=new Vt,this.m_angularVelocity=0,this.m_transform=new Dt,this.m_userData=null,this.m_system=t}return u(e,[{key:"GetNext",value:function(){return this.m_next}},{key:"GetParticleSystem",value:function(){return this.m_system}},{key:"GetParticleCount",value:function(){return this.m_lastIndex-this.m_firstIndex}},{key:"GetBufferIndex",value:function(){return this.m_firstIndex}},{key:"ContainsParticle",value:function(t){return this.m_firstIndex<=t&&t<this.m_lastIndex}},{key:"GetAllParticleFlags",value:function(){if(!this.m_system.m_flagsBuffer.data)throw new Error;for(var t=0,e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t}},{key:"GetGroupFlags",value:function(){return this.m_groupFlags}},{key:"SetGroupFlags",value:function(e){e|=this.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupInternalMask,this.m_system.SetGroupFlags(this,e)}},{key:"GetMass",value:function(){return this.UpdateStatistics(),this.m_mass}},{key:"GetInertia",value:function(){return this.UpdateStatistics(),this.m_inertia}},{key:"GetCenter",value:function(){return this.UpdateStatistics(),this.m_center}},{key:"GetLinearVelocity",value:function(){return this.UpdateStatistics(),this.m_linearVelocity}},{key:"GetAngularVelocity",value:function(){return this.UpdateStatistics(),this.m_angularVelocity}},{key:"GetTransform",value:function(){return this.m_transform}},{key:"GetPosition",value:function(){return this.m_transform.p}},{key:"GetAngle",value:function(){return this.m_transform.q.GetAngle()}},{key:"GetLinearVelocityFromWorldPoint",value:function(t,i){var n=e.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),Vt.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,Vt.SubVV(t,this.m_center,n),i)}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"ApplyForce",value:function(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)}},{key:"ApplyLinearImpulse",value:function(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)}},{key:"DestroyParticles",value:function(t){if(this.m_system.m_world.IsLocked())throw new Error;for(var e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)}},{key:"UpdateStatistics",value:function(){if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var t=new Vt,e=new Vt;if(this.m_timestamp!==this.m_system.m_timestamp){var i=this.m_system.GetParticleMass();this.m_mass=i*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(var n=this.m_firstIndex;n<this.m_lastIndex;n++)this.m_center.SelfMulAdd(i,this.m_system.m_positionBuffer.data[n]),this.m_linearVelocity.SelfMulAdd(i,this.m_system.m_velocityBuffer.data[n]);if(this.m_mass>0){var r=1/this.m_mass;this.m_center.SelfMul(r),this.m_linearVelocity.SelfMul(r)}this.m_inertia=0,this.m_angularVelocity=0;for(var s=this.m_firstIndex;s<this.m_lastIndex;s++)Vt.SubVV(this.m_system.m_positionBuffer.data[s],this.m_center,t),Vt.SubVV(this.m_system.m_velocityBuffer.data[s],this.m_linearVelocity,e),this.m_inertia+=i*Vt.DotVV(t,t),this.m_angularVelocity+=i*Vt.CrossVV(t,e);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}}}]),e}();Dr.GetLinearVelocityFromWorldPoint_s_t0=new Vt;var Gr=function(){function t(e){a(this,t),this.m_front=0,this.m_back=0,this.m_capacity=0,this.m_buffer=tt(e,(function(t){return null})),this.m_capacity=e}return u(t,[{key:"Push",value:function(t){if(this.m_back>=this.m_capacity){for(var e=this.m_front;e<this.m_back;e++)this.m_buffer[e-this.m_front]=this.m_buffer[e];this.m_back-=this.m_front,this.m_front=0,this.m_back>=this.m_capacity&&(this.m_capacity>0?(this.m_buffer.concat(tt(this.m_capacity,(function(t){return null}))),this.m_capacity*=2):(this.m_buffer.concat(tt(1,(function(t){return null}))),this.m_capacity=1))}this.m_buffer[this.m_back]=t,this.m_back++}},{key:"Pop",value:function(){this.m_buffer[this.m_front]=null,this.m_front++}},{key:"Empty",value:function(){return this.m_front===this.m_back}},{key:"Front",value:function(){var t=this.m_buffer[this.m_front];if(!t)throw new Error;return t}}]),t}(),Rr=function(){function t(e){a(this,t),this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=[],this.m_generatorBuffer=tt(e,(function(e){return new t.Generator})),this.m_generatorCapacity=e}return u(t,[{key:"AddGenerator",value:function(t,e,i){var n=this.m_generatorBuffer[this.m_generatorCount++];n.center.Copy(t),n.tag=e,n.necessary=i}},{key:"Generate",value:function(e,i){for(var n=1/e,r=new Vt(+h,+h),s=new Vt(-h,-h),o=0,a=0;a<this.m_generatorCount;a++){var u=this.m_generatorBuffer[a];u.necessary&&(Vt.MinV(r,u.center,r),Vt.MaxV(s,u.center,s),++o)}if(0===o)return this.m_countX=0,void(this.m_countY=0);r.x-=i,r.y-=i,s.x+=i,s.y+=i,this.m_countX=1+Math.floor(n*(s.x-r.x)),this.m_countY=1+Math.floor(n*(s.y-r.y)),this.m_diagram=[];for(var l=new Gr(4*this.m_countX*this.m_countY),c=0;c<this.m_generatorCount;c++){var m=this.m_generatorBuffer[c];m.center.SelfSub(r).SelfMul(n);var _=Math.floor(m.center.x),f=Math.floor(m.center.y);_>=0&&f>=0&&_<this.m_countX&&f<this.m_countY&&l.Push(new t.Task(_,f,_+f*this.m_countX,m))}for(;!l.Empty();){var d=l.Front(),p=d.m_x,v=d.m_y,y=d.m_i,g=d.m_generator;l.Pop(),this.m_diagram[y]||(this.m_diagram[y]=g,p>0&&l.Push(new t.Task(p-1,v,y-1,g)),v>0&&l.Push(new t.Task(p,v-1,y-this.m_countX,g)),p<this.m_countX-1&&l.Push(new t.Task(p+1,v,y+1,g)),v<this.m_countY-1&&l.Push(new t.Task(p,v+1,y+this.m_countX,g)))}for(var x=0;x<this.m_countY;x++)for(var b=0;b<this.m_countX-1;b++){var w=b+x*this.m_countX,A=this.m_diagram[w],S=this.m_diagram[w+1];A!==S&&(l.Push(new t.Task(b,x,w,S)),l.Push(new t.Task(b+1,x,w+1,A)))}for(var B=0;B<this.m_countY-1;B++)for(var C=0;C<this.m_countX;C++){var V=C+B*this.m_countX,M=this.m_diagram[V],k=this.m_diagram[V+this.m_countX];M!==k&&(l.Push(new t.Task(C,B,V,k)),l.Push(new t.Task(C,B+1,V+this.m_countX,M)))}for(;!l.Empty();){var P=l.Front(),I=P.m_x,T=P.m_y,D=P.m_i,G=P.m_generator;l.Pop();var R=this.m_diagram[D],E=G;if(R!==E){var F=R.center.x-I,L=R.center.y-T,j=E.center.x-I,O=E.center.y-T;F*F+L*L>j*j+O*O&&(this.m_diagram[D]=E,I>0&&l.Push(new t.Task(I-1,T,D-1,E)),T>0&&l.Push(new t.Task(I,T-1,D-this.m_countX,E)),I<this.m_countX-1&&l.Push(new t.Task(I+1,T,D+1,E)),T<this.m_countY-1&&l.Push(new t.Task(I,T+1,D+this.m_countX,E)))}}}},{key:"GetNodes",value:function(t){for(var e=0;e<this.m_countY-1;e++)for(var i=0;i<this.m_countX-1;i++){var n=i+e*this.m_countX,r=this.m_diagram[n],s=this.m_diagram[n+1],o=this.m_diagram[n+this.m_countX],a=this.m_diagram[n+1+this.m_countX];s!==o&&(r!==s&&r!==o&&(r.necessary||s.necessary||o.necessary)&&t(r.tag,s.tag,o.tag),a!==s&&a!==o&&(r.necessary||s.necessary||o.necessary)&&t(s.tag,a.tag,o.tag))}}}]),t}();function Er(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function Fr(t,e){return t<e}function Lr(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Fr,r=e,s=[],o=0;;){for(;r+1<i;i++){var a=t[r+Math.floor(Math.random()*(i-r))];s[o++]=i;for(var u=r-1;;){for(;n(t[++u],a););for(;n(a,t[--i]););if(u>=i)break;Er(t,u,i)}}if(0===o)break;r=i,i=s[--o]}return t}function jr(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Lr(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:Fr)}function Or(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length,n=0,r=0;r<i;++r)e(t[r])||(r!==n?Er(t,n++,r):++n);return n}function Nr(t,e,i,n){for(var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Fr,s=i-e;s>0;){var o=Math.floor(s/2),a=e+o;r(t[a],n)?(e=++a,s-=o+1):s=o}return e}function qr(t,e,i,n){for(var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Fr,s=i-e;s>0;){var o=Math.floor(s/2),a=e+o;r(n,t[a])?s=o:(e=++a,s-=o+1)}return e}function zr(t,e,i,n){for(var r=i;e!==r;)Er(t,e++,r++),r===n?r=i:e===i&&(i=r)}function Ur(t,e,i,n){if(e===i)return i;for(var r=e;++e!==i;)n(t[r],t[e])||Er(t,++r,e);return++r}!function(t){var e=function t(){a(this,t),this.center=new Vt,this.tag=0,this.necessary=!1};t.Generator=e;var i=function t(e,i,n,r){a(this,t),this.m_x=e,this.m_y=i,this.m_i=n,this.m_generator=r};t.Task=i}(Rr||(Rr={}));var Jr=function(){function t(e){a(this,t),this.data=[],this.count=0,this.capacity=0,this.allocator=e}return u(t,[{key:"Append",value:function(){return this.count>=this.capacity&&this.Grow(),this.count++}},{key:"Reserve",value:function(t){if(!(this.capacity>=t)){for(var e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}}},{key:"Grow",value:function(){var t=this.capacity?2*this.capacity:O;this.Reserve(t)}},{key:"Free",value:function(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)}},{key:"Shorten",value:function(t){}},{key:"Data",value:function(){return this.data}},{key:"GetCount",value:function(){return this.count}},{key:"SetCount",value:function(t){this.count=t}},{key:"GetCapacity",value:function(){return this.capacity}},{key:"RemoveIf",value:function(t){this.count=Or(this.data,t,this.count)}},{key:"Unique",value:function(t){this.count=Ur(this.data,0,this.count,t)}}]),t}(),Xr=function(t){s(i,t);var e=o(i);function i(t){var n;return a(this,i),(n=e.call(this)).m_system=t,n}return u(i,[{key:"ShouldQueryParticleSystem",value:function(t){return!1}},{key:"ReportFixture",value:function(t){if(t.IsSensor())return!0;for(var e=t.GetShape().GetChildCount(),i=0;i<e;i++)for(var n=t.GetAABB(i),r=this.m_system.GetInsideBoundsEnumerator(n),s=void 0;(s=r.GetNext())>=0;)this.ReportFixtureAndParticle(t,i,s);return!0}},{key:"ReportParticle",value:function(t,e){return!1}},{key:"ReportFixtureAndParticle",value:function(t,e,i){}}]),i}(cr),Yr=function(){function t(){a(this,t),this.indexA=0,this.indexB=0,this.weight=0,this.normal=new Vt,this.flags=0}return u(t,[{key:"SetIndices",value:function(t,e){this.indexA=t,this.indexB=e}},{key:"SetWeight",value:function(t){this.weight=t}},{key:"SetNormal",value:function(t){this.normal.Copy(t)}},{key:"SetFlags",value:function(t){this.flags=t}},{key:"GetIndexA",value:function(){return this.indexA}},{key:"GetIndexB",value:function(){return this.indexB}},{key:"GetWeight",value:function(){return this.weight}},{key:"GetNormal",value:function(){return this.normal}},{key:"GetFlags",value:function(){return this.flags}},{key:"IsEqual",value:function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y}},{key:"IsNotEqual",value:function(t){return!this.IsEqual(t)}},{key:"ApproximatelyEqual",value:function(t){var e=.01,i=1e-4;return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&ot(this.weight-t.weight)<e&&Vt.DistanceSquaredVV(this.normal,t.normal)<i}}]),t}(),Wr=function t(){a(this,t),this.index=0,this.weight=0,this.normal=new Vt,this.mass=0},Zr=function t(){a(this,t),this.indexA=0,this.indexB=0,this.flags=0,this.strength=0,this.distance=0},Hr=function t(){a(this,t),this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=0,this.pa=new Vt(0,0),this.pb=new Vt(0,0),this.pc=new Vt(0,0),this.ka=0,this.kb=0,this.kc=0,this.s=0},Qr=function(){function t(){a(this,t),this.strictContactCheck=!1,this.density=1,this.gravityScale=1,this.radius=1,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=1,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=1,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60}return u(t,[{key:"Copy",value:function(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this}},{key:"Clone",value:function(){return(new t).Copy(this)}}]),t}(),Kr=function(){function e(t,i){a(this,e),this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new e.UserOverridableBuffer,this.m_flagsBuffer=new e.UserOverridableBuffer,this.m_positionBuffer=new e.UserOverridableBuffer,this.m_velocityBuffer=new e.UserOverridableBuffer,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new e.UserOverridableBuffer,this.m_groupBuffer=[],this.m_userDataBuffer=new e.UserOverridableBuffer,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new e.UserOverridableBuffer,this.m_bodyContactCountBuffer=new e.UserOverridableBuffer,this.m_consecutiveContactStepsBuffer=new e.UserOverridableBuffer,this.m_stuckParticleBuffer=new Jr((function(){return 0})),this.m_proxyBuffer=new Jr((function(){return new e.Proxy})),this.m_contactBuffer=new Jr((function(){return new Yr})),this.m_bodyContactBuffer=new Jr((function(){return new Wr})),this.m_pairBuffer=new Jr((function(){return new Zr})),this.m_triadBuffer=new Jr((function(){return new Hr})),this.m_expirationTimeBuffer=new e.UserOverridableBuffer,this.m_indexByExpirationTimeBuffer=new e.UserOverridableBuffer,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new Qr,this.m_prev=null,this.m_next=null,this.SetStrictContactCheck(t.strictContactCheck),this.SetDensity(t.density),this.SetGravityScale(t.gravityScale),this.SetRadius(t.radius),this.SetMaxParticleCount(t.maxCount),this.m_def=t.Clone(),this.m_world=i,this.SetDestructionByAge(this.m_def.destroyByAge)}return u(e,[{key:"Drop",value:function(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)}},{key:"CreateParticle",value:function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_count>=this.m_internalAllocatedCapacity){var e=this.m_count?2*this.m_count:O;this.ReallocateInternalAllocatedBuffers(e)}if(this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return T;this.DestroyOldestParticle(0,!1),this.SolveZombie()}var n=this.m_count++;if(!this.m_flagsBuffer.data)throw new Error;if(this.m_flagsBuffer.data[n]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[n]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[n]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[n]=0),!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;this.m_positionBuffer.data[n]=(this.m_positionBuffer.data[n]||new Vt).Copy(i(t.position,Vt.ZERO)),this.m_velocityBuffer.data[n]=(this.m_velocityBuffer.data[n]||new Vt).Copy(i(t.velocity,Vt.ZERO)),this.m_weightBuffer[n]=0,this.m_forceBuffer[n]=(this.m_forceBuffer[n]||new Vt).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[n]=0),this.m_depthBuffer&&(this.m_depthBuffer[n]=0);var r=(new Et).Copy(i(t.color,Et.ZERO));!this.m_colorBuffer.data&&r.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[n]=(this.m_colorBuffer.data[n]||new Et).Copy(r)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[n]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[n]=null);var s=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],o=i(t.lifetime,0),a=o>0;if(this.m_expirationTimeBuffer.data||a){if(this.SetParticleLifetime(n,a?o:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),!this.m_indexByExpirationTimeBuffer.data)throw new Error;this.m_indexByExpirationTimeBuffer.data[n]=n}s.index=n;var u=i(t.group,null);return this.m_groupBuffer[n]=u,u&&(u.m_firstIndex<u.m_lastIndex?(this.RotateBuffer(u.m_firstIndex,u.m_lastIndex,n),u.m_lastIndex=n+1):(u.m_firstIndex=n,u.m_lastIndex=n+1)),this.SetParticleFlags(n,i(t.flags,0)),n}},{key:"GetParticleHandleFromIndex",value:function(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);var e=this.m_handleIndexBuffer.data[t];return e||((e=new Ir).SetIndex(t),this.m_handleIndexBuffer.data[t]=e,e)}},{key:"DestroyParticle",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.m_flagsBuffer.data)throw new Error;var n=t.b2ParticleFlag.b2_zombieParticle;i&&(n|=t.b2ParticleFlag.b2_destructionListenerParticle),this.SetParticleFlags(e,this.m_flagsBuffer.data[e]|n)}},{key:"DestroyOldestParticle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.GetParticleCount();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;if(!this.m_expirationTimeBuffer.data)throw new Error;var n=this.m_indexByExpirationTimeBuffer.data[i-(t+1)],r=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[n]>0?n:r,e)}},{key:"DestroyParticlesInShape",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw new Error;var s=new e.DestroyParticlesInShapeCallback(this,t,i,n),o=r;return t.ComputeAABB(o,i,0),this.m_world.QueryAABB(s,o),s.Destroyed()}},{key:"CreateParticleGroup",value:function(t){var n=e.CreateParticleGroup_s_transform;if(this.m_world.IsLocked())throw new Error;var r=n;r.SetPositionAngle(i(t.position,Vt.ZERO),i(t.angle,0));var s=this.m_count;if(t.shape&&this.CreateParticlesWithShapeForGroup(t.shape,t,r),t.shapes&&this.CreateParticlesWithShapesForGroup(t.shapes,i(t.shapeCount,t.shapes.length),t,r),t.positionData)for(var o=i(t.particleCount,t.positionData.length),a=0;a<o;a++){var u=t.positionData[a];this.CreateParticleForGroup(t,r,u)}var l=this.m_count,h=new Dr(this);h.m_firstIndex=s,h.m_lastIndex=l,h.m_strength=i(t.strength,1),h.m_userData=t.userData,h.m_transform.Copy(r),h.m_prev=null,h.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=h),this.m_groupList=h,++this.m_groupCount;for(var c=s;c<l;c++)this.m_groupBuffer[c]=h;this.SetGroupFlags(h,i(t.groupFlags,0));var m=new e.ConnectionFilter;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(s,l,m),t.group&&(this.JoinParticleGroups(t.group,h),h=t.group),h}},{key:"JoinParticleGroups",value:function(t,i){if(this.m_world.IsLocked())throw new Error;this.RotateBuffer(i.m_firstIndex,i.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,i.m_firstIndex);var n=new e.JoinParticleGroupsFilter(i.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,i.m_lastIndex,n);for(var r=i.m_firstIndex;r<i.m_lastIndex;r++)this.m_groupBuffer[r]=t;var s=t.m_groupFlags|i.m_groupFlags;this.SetGroupFlags(t,s),t.m_lastIndex=i.m_lastIndex,i.m_firstIndex=i.m_lastIndex,this.DestroyParticleGroup(i)}},{key:"SplitParticleGroup",value:function(t){this.UpdateContacts(!0);var i=tt(t.GetParticleCount(),(function(t){return new e.ParticleListNode}));e.InitializeParticleLists(t,i),this.MergeParticleListsInContact(t,i);var n=e.FindLongestParticleList(t,i);this.MergeZombieParticleListNodes(t,i,n),this.CreateParticleGroupsFromParticleList(t,i,n),this.UpdatePairsAndTriadsWithParticleList(t,i)}},{key:"GetParticleGroupList",value:function(){return this.m_groupList}},{key:"GetParticleGroupCount",value:function(){return this.m_groupCount}},{key:"GetParticleCount",value:function(){return this.m_count}},{key:"GetMaxParticleCount",value:function(){return this.m_def.maxCount}},{key:"SetMaxParticleCount",value:function(t){this.m_def.maxCount=t}},{key:"GetAllParticleFlags",value:function(){return this.m_allParticleFlags}},{key:"GetAllGroupFlags",value:function(){return this.m_allGroupFlags}},{key:"SetPaused",value:function(t){this.m_paused=t}},{key:"GetPaused",value:function(){return this.m_paused}},{key:"SetDensity",value:function(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density}},{key:"GetDensity",value:function(){return this.m_def.density}},{key:"SetGravityScale",value:function(t){this.m_def.gravityScale=t}},{key:"GetGravityScale",value:function(){return this.m_def.gravityScale}},{key:"SetDamping",value:function(t){this.m_def.dampingStrength=t}},{key:"GetDamping",value:function(){return this.m_def.dampingStrength}},{key:"SetStaticPressureIterations",value:function(t){this.m_def.staticPressureIterations=t}},{key:"GetStaticPressureIterations",value:function(){return this.m_def.staticPressureIterations}},{key:"SetRadius",value:function(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter}},{key:"GetRadius",value:function(){return this.m_particleDiameter/2}},{key:"GetPositionBuffer",value:function(){if(!this.m_positionBuffer.data)throw new Error;return this.m_positionBuffer.data}},{key:"GetVelocityBuffer",value:function(){if(!this.m_velocityBuffer.data)throw new Error;return this.m_velocityBuffer.data}},{key:"GetColorBuffer",value:function(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data}},{key:"GetGroupBuffer",value:function(){return this.m_groupBuffer}},{key:"GetWeightBuffer",value:function(){return this.m_weightBuffer}},{key:"GetUserDataBuffer",value:function(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data}},{key:"GetFlagsBuffer",value:function(){if(!this.m_flagsBuffer.data)throw new Error;return this.m_flagsBuffer.data}},{key:"SetParticleFlags",value:function(e,i){if(!this.m_flagsBuffer.data)throw new Error;this.m_flagsBuffer.data[e]&~i&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&i&&(i&t.b2ParticleFlag.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),i&t.b2ParticleFlag.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=i),this.m_flagsBuffer.data[e]=i}},{key:"GetParticleFlags",value:function(t){if(!this.m_flagsBuffer.data)throw new Error;return this.m_flagsBuffer.data[t]}},{key:"SetFlagsBuffer",value:function(t,e){this.SetUserOverridableBuffer(this.m_flagsBuffer,t,e)}},{key:"SetPositionBuffer",value:function(t,e){this.SetUserOverridableBuffer(this.m_positionBuffer,t,e)}},{key:"SetVelocityBuffer",value:function(t,e){this.SetUserOverridableBuffer(this.m_velocityBuffer,t,e)}},{key:"SetColorBuffer",value:function(t,e){this.SetUserOverridableBuffer(this.m_colorBuffer,t,e)}},{key:"SetUserDataBuffer",value:function(t,e){this.SetUserOverridableBuffer(this.m_userDataBuffer,t,e)}},{key:"GetContacts",value:function(){return this.m_contactBuffer.data}},{key:"GetContactCount",value:function(){return this.m_contactBuffer.count}},{key:"GetBodyContacts",value:function(){return this.m_bodyContactBuffer.data}},{key:"GetBodyContactCount",value:function(){return this.m_bodyContactBuffer.count}},{key:"GetPairs",value:function(){return this.m_pairBuffer.data}},{key:"GetPairCount",value:function(){return this.m_pairBuffer.count}},{key:"GetTriads",value:function(){return this.m_triadBuffer.data}},{key:"GetTriadCount",value:function(){return this.m_triadBuffer.count}},{key:"SetStuckThreshold",value:function(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))}},{key:"GetStuckCandidates",value:function(){return this.m_stuckParticleBuffer.Data()}},{key:"GetStuckCandidateCount",value:function(){return this.m_stuckParticleBuffer.GetCount()}},{key:"ComputeCollisionEnergy",value:function(){if(!this.m_velocityBuffer.data)throw new Error;for(var t=e.ComputeCollisionEnergy_s_v,i=this.m_velocityBuffer.data,n=0,r=0;r<this.m_contactBuffer.count;r++){var s=this.m_contactBuffer.data[r],o=s.indexA,a=s.indexB,u=s.normal,l=Vt.SubVV(i[a],i[o],t),h=Vt.DotVV(l,u);h<0&&(n+=h*h)}return.5*this.GetParticleMass()*n}},{key:"SetStrictContactCheck",value:function(t){this.m_def.strictContactCheck=t}},{key:"GetStrictContactCheck",value:function(){return this.m_def.strictContactCheck}},{key:"SetParticleLifetime",value:function(t,e){var i=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),i)for(var n=this.GetParticleCount(),r=0;r<n;++r)this.m_indexByExpirationTimeBuffer.data[r]=r;var s=e/this.m_def.lifetimeGranularity,o=s>0?this.GetQuantizedTimeElapsed()+s:s;o!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=o,this.m_expirationTimeBufferRequiresSorting=!0)}},{key:"GetParticleLifetime",value:function(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])}},{key:"SetDestructionByAge",value:function(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t}},{key:"GetDestructionByAge",value:function(){return this.m_def.destroyByAge}},{key:"GetExpirationTimeBuffer",value:function(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data}},{key:"ExpirationTimeToLifetime",value:function(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity}},{key:"GetIndexByExpirationTimeBuffer",value:function(){if(this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),!this.m_indexByExpirationTimeBuffer.data)throw new Error;return this.m_indexByExpirationTimeBuffer.data}},{key:"ParticleApplyLinearImpulse",value:function(t,e){this.ApplyLinearImpulse(t,t+1,e)}},{key:"ApplyLinearImpulse",value:function(t,e,i){if(!this.m_velocityBuffer.data)throw new Error;for(var n=this.m_velocityBuffer.data,r=(e-t)*this.GetParticleMass(),s=(new Vt).Copy(i).SelfMul(1/r),o=t;o<e;o++)n[o].SelfAdd(s)}},{key:"ParticleApplyForce",value:function(t,i){if(!this.m_flagsBuffer.data)throw new Error;e.IsSignificantForce(i)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[t])&&(this.PrepareForceBuffer(),this.m_forceBuffer[t].SelfAdd(i))}},{key:"ApplyForce",value:function(t,i,n){var r=(new Vt).Copy(n).SelfMul(1/(i-t));if(e.IsSignificantForce(r)){this.PrepareForceBuffer();for(var s=t;s<i;s++)this.m_forceBuffer[s].SelfAdd(r)}}},{key:"GetNext",value:function(){return this.m_next}},{key:"QueryAABB",value:function(t,i){if(0!==this.m_proxyBuffer.count){var n=0,r=this.m_proxyBuffer.count,s=Nr(this.m_proxyBuffer.data,n,r,e.computeTag(this.m_inverseDiameter*i.lowerBound.x,this.m_inverseDiameter*i.lowerBound.y),e.Proxy.CompareProxyTag),o=qr(this.m_proxyBuffer.data,s,r,e.computeTag(this.m_inverseDiameter*i.upperBound.x,this.m_inverseDiameter*i.upperBound.y),e.Proxy.CompareTagProxy);if(!this.m_positionBuffer.data)throw new Error;for(var a=this.m_positionBuffer.data,u=s;u<o;++u){var l=this.m_proxyBuffer.data[u].index,h=a[l];if(i.lowerBound.x<h.x&&h.x<i.upperBound.x&&i.lowerBound.y<h.y&&h.y<i.upperBound.y&&!t.ReportParticle(this,l))break}}}},{key:"QueryShapeAABB",value:function(t,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=e.QueryShapeAABB_s_aabb;i.ComputeAABB(s,n,r),this.QueryAABB(t,s)}},{key:"QueryPointAABB",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y,r=e.QueryPointAABB_s_aabb;r.lowerBound.Set(i.x-n,i.y-n),r.upperBound.Set(i.x+n,i.y+n),this.QueryAABB(t,r)}},{key:"RayCast",value:function(t,i,n){var r=e.RayCast_s_aabb,s=e.RayCast_s_p,o=e.RayCast_s_v,a=e.RayCast_s_n,u=e.RayCast_s_point;if(0!==this.m_proxyBuffer.count){if(!this.m_positionBuffer.data)throw new Error;var l=this.m_positionBuffer.data,h=r;Vt.MinV(i,n,h.lowerBound),Vt.MaxV(i,n,h.upperBound);for(var c,m=1,_=Vt.SubVV(n,i,o),f=Vt.DotVV(_,_),d=this.GetInsideBoundsEnumerator(h);(c=d.GetNext())>=0;){var p=Vt.SubVV(i,l[c],s),v=Vt.DotVV(p,_),y=v*v-f*(Vt.DotVV(p,p)-this.m_squaredDiameter);if(y>=0){var g=ft(y),x=(-v-g)/f;if(x>m)continue;if(x<0&&((x=(-v+g)/f)<0||x>m))continue;var b=Vt.AddVMulSV(p,x,_,a);b.Normalize();var w=t.ReportParticle(this,c,Vt.AddVMulSV(i,x,_,u),b,x);if((m=at(m,w))<=0)break}}}}},{key:"ComputeAABB",value:function(t){var e=this.GetParticleCount();if(t.lowerBound.x=+h,t.lowerBound.y=+h,t.upperBound.x=-h,t.upperBound.y=-h,!this.m_positionBuffer.data)throw new Error;for(var i=this.m_positionBuffer.data,n=0;n<e;n++){var r=i[n];Vt.MinV(t.lowerBound,r,t.lowerBound),Vt.MaxV(t.upperBound,r,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter}},{key:"FreeBuffer",value:function(t,e){null!==t&&(t.length=0)}},{key:"FreeUserOverridableBuffer",value:function(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)}},{key:"ReallocateBuffer3",value:function(t,e,i){if(i<=e)throw new Error;var n=t?t.slice():[];return n.length=i,n}},{key:"ReallocateBuffer5",value:function(t,e,i,n,r){if(n<=i)throw new Error;if(e&&!(n<=e))throw new Error;return r&&!t||e||(t=this.ReallocateBuffer3(t,i,n)),t}},{key:"ReallocateBuffer4",value:function(t,e,i,n){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,i,n)}},{key:"RequestBuffer",value:function(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(O),(t=[]).length=this.m_internalAllocatedCapacity),t}},{key:"ReallocateHandleBuffers",value:function(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)}},{key:"ReallocateInternalAllocatedBuffers",value:function(t){function e(t,e){return e&&t>e?e:t}if(t=e(t,this.m_def.maxCount),t=e(t,this.m_flagsBuffer.userSuppliedCapacity),t=e(t,this.m_positionBuffer.userSuppliedCapacity),t=e(t,this.m_velocityBuffer.userSuppliedCapacity),t=e(t,this.m_colorBuffer.userSuppliedCapacity),t=e(t,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);var i=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,i),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,i),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,i),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}}},{key:"CreateParticleForGroup",value:function(t,e,n){var r=new Mr;r.flags=i(t.flags,0),Dt.MulXV(e,n,r.position),Vt.AddVV(i(t.linearVelocity,Vt.ZERO),Vt.CrossSV(i(t.angularVelocity,0),Vt.SubVV(r.position,i(t.position,Vt.ZERO),Vt.s_t0),Vt.s_t0),r.velocity),r.color.Copy(i(t.color,Et.ZERO)),r.lifetime=i(t.lifetime,0),r.userData=t.userData,this.CreateParticle(r)}},{key:"CreateParticlesStrokeShapeForGroup",value:function(n,r,s){var o=e.CreateParticlesStrokeShapeForGroup_s_edge,a=e.CreateParticlesStrokeShapeForGroup_s_d,u=e.CreateParticlesStrokeShapeForGroup_s_p,l=i(r.stride,0);0===l&&(l=this.GetParticleStride());for(var h=0,c=n.GetChildCount(),m=0;m<c;m++){var _=null;n.GetType()===t.b2ShapeType.e_edgeShape?_=n:(_=o,n.GetChildEdge(_,m));for(var f=Vt.SubVV(_.m_vertex2,_.m_vertex1,a),d=f.Length();h<d;){var p=Vt.AddVMulSV(_.m_vertex1,h/d,f,u);this.CreateParticleForGroup(r,s,p),h+=l}h-=d}}},{key:"CreateParticlesFillShapeForGroup",value:function(t,n,r){var s=e.CreateParticlesFillShapeForGroup_s_aabb,o=e.CreateParticlesFillShapeForGroup_s_p,a=i(n.stride,0);0===a&&(a=this.GetParticleStride());var u=Dt.IDENTITY,l=s;t.ComputeAABB(l,u,0);for(var h=Math.floor(l.lowerBound.y/a)*a;h<l.upperBound.y;h+=a)for(var c=Math.floor(l.lowerBound.x/a)*a;c<l.upperBound.x;c+=a){var m=o.Set(c,h);t.TestPoint(u,m)&&this.CreateParticleForGroup(n,r,m)}}},{key:"CreateParticlesWithShapeForGroup",value:function(e,i,n){switch(e.GetType()){case t.b2ShapeType.e_edgeShape:case t.b2ShapeType.e_chainShape:this.CreateParticlesStrokeShapeForGroup(e,i,n);break;case t.b2ShapeType.e_polygonShape:case t.b2ShapeType.e_circleShape:this.CreateParticlesFillShapeForGroup(e,i,n)}}},{key:"CreateParticlesWithShapesForGroup",value:function(t,i,n,r){var s=new e.CompositeShape(t,i);this.CreateParticlesFillShapeForGroup(s,n,r)}},{key:"CloneParticle",value:function(t,e){var i=new Mr;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;i.flags=this.m_flagsBuffer.data[t],i.position.Copy(this.m_positionBuffer.data[t]),i.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&i.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(i.userData=this.m_userDataBuffer.data[t]),i.group=e;var n=this.CreateParticle(i);if(this.m_handleIndexBuffer.data){var r=this.m_handleIndexBuffer.data[t];r&&r.SetIndex(n),this.m_handleIndexBuffer.data[n]=r,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[n]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[n]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[n]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[n].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[n]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[n]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[n]=this.m_expirationTimeBuffer.data[t]),n}},{key:"DestroyParticlesInGroup",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.m_firstIndex;i<t.m_lastIndex;i++)this.DestroyParticle(i,e)}},{key:"DestroyParticleGroup",value:function(t){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(var e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount}},{key:"UpdatePairsAndTriads",value:function(i,n,r){var s=e.UpdatePairsAndTriads_s_dab,o=e.UpdatePairsAndTriads_s_dbc,a=e.UpdatePairsAndTriads_s_dca;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var u=this.m_positionBuffer.data,l=0,h=i;h<n;h++)l|=this.m_flagsBuffer.data[h];if(l&e.k_pairFlags)for(var c=0;c<this.m_contactBuffer.count;c++){var m=this.m_contactBuffer.data[c],_=m.indexA,f=m.indexB,d=this.m_flagsBuffer.data[_],p=this.m_flagsBuffer.data[f],v=this.m_groupBuffer[_],y=this.m_groupBuffer[f];if(_>=i&&_<n&&f>=i&&f<n&&!((d|p)&t.b2ParticleFlag.b2_zombieParticle)&&(d|p)&e.k_pairFlags&&(r.IsNecessary(_)||r.IsNecessary(f))&&e.ParticleCanBeConnected(d,v)&&e.ParticleCanBeConnected(p,y)&&r.ShouldCreatePair(_,f)){var g=this.m_pairBuffer.data[this.m_pairBuffer.Append()];g.indexA=_,g.indexB=f,g.flags=m.flags,g.strength=at(v?v.m_strength:1,y?y.m_strength:1),g.distance=Vt.DistanceVV(u[_],u[f])}jr(this.m_pairBuffer.data,0,this.m_pairBuffer.count,e.ComparePairIndices),this.m_pairBuffer.Unique(e.MatchPairIndices)}if(l&e.k_triadFlags){for(var x=new Rr(n-i),b=i;b<n;b++){var w=this.m_flagsBuffer.data[b],A=this.m_groupBuffer[b];w&t.b2ParticleFlag.b2_zombieParticle||!e.ParticleCanBeConnected(w,A)||x.AddGenerator(u[b],b,r.IsNecessary(b))}var S=this.GetParticleStride();x.Generate(S/2,2*S);var B=this,C=function(t,i,n){if(!B.m_flagsBuffer.data)throw new Error;var l=B.m_flagsBuffer.data[t],h=B.m_flagsBuffer.data[i],c=B.m_flagsBuffer.data[n];if((l|h|c)&e.k_triadFlags&&r.ShouldCreateTriad(t,i,n)){var m=u[t],_=u[i],f=u[n],d=Vt.SubVV(m,_,s),p=Vt.SubVV(_,f,o),v=Vt.SubVV(f,m,a),y=j*B.m_squaredDiameter;if(Vt.DotVV(d,d)>y||Vt.DotVV(p,p)>y||Vt.DotVV(v,v)>y)return;var g=B.m_groupBuffer[t],x=B.m_groupBuffer[i],b=B.m_groupBuffer[n],w=B.m_triadBuffer.data[B.m_triadBuffer.Append()];w.indexA=t,w.indexB=i,w.indexC=n,w.flags=l|h|c,w.strength=at(at(g?g.m_strength:1,x?x.m_strength:1),b?b.m_strength:1);var A=(m.x+_.x+f.x)/3,S=(m.y+_.y+f.y)/3;w.pa.x=m.x-A,w.pa.y=m.y-S,w.pb.x=_.x-A,w.pb.y=_.y-S,w.pc.x=f.x-A,w.pc.y=f.y-S,w.ka=-Vt.DotVV(v,d),w.kb=-Vt.DotVV(d,p),w.kc=-Vt.DotVV(p,v),w.s=Vt.CrossVV(m,_)+Vt.CrossVV(_,f)+Vt.CrossVV(f,m)}};x.GetNodes(C),jr(this.m_triadBuffer.data,0,this.m_triadBuffer.count,e.CompareTriadIndices),this.m_triadBuffer.Unique(e.MatchTriadIndices)}}},{key:"UpdatePairsAndTriadsWithReactiveParticles",value:function(){var i=new e.ReactiveFilter(this.m_flagsBuffer);if(this.UpdatePairsAndTriads(0,this.m_count,i),!this.m_flagsBuffer.data)throw new Error;for(var n=0;n<this.m_count;n++)this.m_flagsBuffer.data[n]&=~t.b2ParticleFlag.b2_reactiveParticle;this.m_allParticleFlags&=~t.b2ParticleFlag.b2_reactiveParticle}},{key:"MergeParticleListsInContact",value:function(t,i){for(var n=t.GetBufferIndex(),r=0;r<this.m_contactBuffer.count;r++){var s=this.m_contactBuffer.data[r],o=s.indexA,a=s.indexB;if(t.ContainsParticle(o)&&t.ContainsParticle(a)){var u=i[o-n].list,l=i[a-n].list;if(u!==l){if(u.count<l.count){var h=u;u=l,l=h}e.MergeParticleLists(u,l)}}}}},{key:"MergeZombieParticleListNodes",value:function(i,n,r){if(!this.m_flagsBuffer.data)throw new Error;for(var s=i.GetParticleCount(),o=0;o<s;o++){var a=n[o];a!==r&&this.m_flagsBuffer.data[a.index]&t.b2ParticleFlag.b2_zombieParticle&&e.MergeParticleListAndNode(r,a)}}},{key:"CreateParticleGroupsFromParticleList",value:function(e,i,n){if(!this.m_flagsBuffer.data)throw new Error;var r=e.GetParticleCount(),s=new Tr;s.groupFlags=e.GetGroupFlags(),s.userData=e.GetUserData();for(var o=0;o<r;o++){var a=i[o];if(a.count&&a!==n)for(var u=this.CreateParticleGroup(s),l=a;l;l=l.next){var h=l.index,c=this.CloneParticle(h,u);this.m_flagsBuffer.data[h]|=t.b2ParticleFlag.b2_zombieParticle,l.index=c}}}},{key:"UpdatePairsAndTriadsWithParticleList",value:function(t,e){for(var i=t.GetBufferIndex(),n=0;n<this.m_pairBuffer.count;n++){var r=this.m_pairBuffer.data[n],s=r.indexA,o=r.indexB;t.ContainsParticle(s)&&(r.indexA=e[s-i].index),t.ContainsParticle(o)&&(r.indexB=e[o-i].index)}for(var a=0;a<this.m_triadBuffer.count;a++){var u=this.m_triadBuffer.data[a],l=u.indexA,h=u.indexB,c=u.indexC;t.ContainsParticle(l)&&(u.indexA=e[l-i].index),t.ContainsParticle(h)&&(u.indexB=e[h-i].index),t.ContainsParticle(c)&&(u.indexC=e[c-i].index)}}},{key:"ComputeDepth",value:function(){for(var e=[],i=0,n=0;n<this.m_contactBuffer.count;n++){var r=this.m_contactBuffer.data[n],s=r.indexA,o=r.indexB,a=this.m_groupBuffer[s],u=this.m_groupBuffer[o];a&&a===u&&a.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&(e[i++]=r)}for(var l=[],c=0,m=this.m_groupList;m;m=m.GetNext())if(m.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth){l[c++]=m,this.SetGroupFlags(m,m.m_groupFlags&~t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth);for(var _=m.m_firstIndex;_<m.m_lastIndex;_++)this.m_accumulationBuffer[_]=0}for(var f=0;f<i;f++){var d=e[f],p=d.indexA,v=d.indexB,y=d.weight;this.m_accumulationBuffer[p]+=y,this.m_accumulationBuffer[v]+=y}for(var g=0;g<c;g++)for(var x=l[g],b=x.m_firstIndex;b<x.m_lastIndex;b++){var w=this.m_accumulationBuffer[b];this.m_depthBuffer[b]=w<.8?0:h}for(var A=ft(this.m_count)>>0,S=0;S<A;S++){for(var B=!1,C=0;C<i;C++){var V=e[C],M=V.indexA,k=V.indexB,P=1-V.weight,I=this.m_depthBuffer[M],T=this.m_depthBuffer[k],D=T+P,G=I+P;I>D&&(this.m_depthBuffer[M]=D,B=!0),T>G&&(this.m_depthBuffer[k]=G,B=!0)}if(!B)break}for(var R=0;R<c;R++)for(var E=l[R],F=E.m_firstIndex;F<E.m_lastIndex;F++)this.m_depthBuffer[F]<h?this.m_depthBuffer[F]*=this.m_particleDiameter:this.m_depthBuffer[F]=0}},{key:"GetInsideBoundsEnumerator",value:function(t){var i=e.computeTag(this.m_inverseDiameter*t.lowerBound.x-1,this.m_inverseDiameter*t.lowerBound.y-1),n=e.computeTag(this.m_inverseDiameter*t.upperBound.x+1,this.m_inverseDiameter*t.upperBound.y+1),r=0,s=this.m_proxyBuffer.count,o=Nr(this.m_proxyBuffer.data,r,s,i,e.Proxy.CompareProxyTag),a=qr(this.m_proxyBuffer.data,r,s,n,e.Proxy.CompareTagProxy);return new e.InsideBoundsEnumerator(this,i,n,o,a)}},{key:"UpdateAllParticleFlags",value:function(){if(!this.m_flagsBuffer.data)throw new Error;this.m_allParticleFlags=0;for(var t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1}},{key:"UpdateAllGroupFlags",value:function(){this.m_allGroupFlags=0;for(var t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1}},{key:"AddContact",value:function(t,i,n){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;var r=e.AddContact_s_d,s=this.m_positionBuffer.data,o=Vt.SubVV(s[i],s[t],r),a=Vt.DotVV(o,o);if(a<this.m_squaredDiameter){var u=_t(a);isFinite(u)||(u=198177537e11);var l=this.m_contactBuffer.data[this.m_contactBuffer.Append()];l.indexA=t,l.indexB=i,l.flags=this.m_flagsBuffer.data[t]|this.m_flagsBuffer.data[i],l.weight=1-a*u*this.m_inverseDiameter,Vt.MulSV(u,o,l.normal)}}},{key:"FindContacts_Reference",value:function(t){var i=0,n=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(var r=i,s=i;r<n;r++){for(var o=e.computeRelativeTag(this.m_proxyBuffer.data[r].tag,1,0),a=r+1;a<n&&!(o<this.m_proxyBuffer.data[a].tag);a++)this.AddContact(this.m_proxyBuffer.data[r].index,this.m_proxyBuffer.data[a].index,this.m_contactBuffer);for(var u=e.computeRelativeTag(this.m_proxyBuffer.data[r].tag,-1,1);s<n&&!(u<=this.m_proxyBuffer.data[s].tag);s++);for(var l=e.computeRelativeTag(this.m_proxyBuffer.data[r].tag,1,1),h=s;h<n&&!(l<this.m_proxyBuffer.data[h].tag);h++)this.AddContact(this.m_proxyBuffer.data[r].index,this.m_proxyBuffer.data[h].index,this.m_contactBuffer)}}},{key:"FindContacts",value:function(t){this.FindContacts_Reference(t)}},{key:"UpdateProxies_Reference",value:function(t){if(!this.m_positionBuffer.data)throw new Error;for(var i=this.m_positionBuffer.data,n=this.m_inverseDiameter,r=0;r<this.m_proxyBuffer.count;++r){var s=this.m_proxyBuffer.data[r],o=i[s.index];s.tag=e.computeTag(n*o.x,n*o.y)}}},{key:"UpdateProxies",value:function(t){this.UpdateProxies_Reference(t)}},{key:"SortProxies",value:function(t){Lr(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,e.Proxy.CompareProxyProxy)}},{key:"FilterContacts",value:function(e){var i=this.GetParticleContactFilter();if(null!==i){var n=this,r=function(e){return 0!==(e.flags&t.b2ParticleFlag.b2_particleContactFilterParticle)&&!i.ShouldCollideParticleParticle(n,e.indexA,e.indexB)};this.m_contactBuffer.RemoveIf(r)}}},{key:"NotifyContactListenerPreContact",value:function(t){if(null!==this.GetParticleContactListener())throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error}},{key:"NotifyContactListenerPostContact",value:function(t){var e=this.GetParticleContactListener();if(null!==e){for(var i=0;i<this.m_contactBuffer.count;++i){var n=this.m_contactBuffer.data[i];e.BeginContactParticleParticle(this,n)}throw new Error}}},{key:"UpdateContacts",value:function(t){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);var i=new e.b2ParticlePairSet;this.NotifyContactListenerPreContact(i),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(i),t&&this.m_contactBuffer.RemoveIf(e.b2ParticleContactIsZombie)}},{key:"NotifyBodyContactListenerPreContact",value:function(t){if(null!==this.GetFixtureContactListener())throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error}},{key:"NotifyBodyContactListenerPostContact",value:function(t){var e=this.GetFixtureContactListener();if(null!==e){for(var i=0;i<this.m_bodyContactBuffer.count;i++){var n=this.m_bodyContactBuffer.data[i];e.BeginContactFixtureParticle(this,n)}throw new Error}}},{key:"UpdateBodyContacts",value:function(){var t=e.UpdateBodyContacts_s_aabb,i=new e.FixtureParticleSet;if(this.NotifyBodyContactListenerPreContact(i),this.m_stuckThreshold>0){if(!this.m_bodyContactCountBuffer.data)throw new Error;if(!this.m_lastBodyContactStepBuffer.data)throw new Error;if(!this.m_consecutiveContactStepsBuffer.data)throw new Error;for(var n=this.GetParticleCount(),r=0;r<n;r++)this.m_bodyContactCountBuffer.data[r]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[r]+1&&(this.m_consecutiveContactStepsBuffer.data[r]=0)}this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);var s=t;this.ComputeAABB(s);var o=new e.UpdateBodyContactsCallback(this,this.GetFixtureContactFilter());this.m_world.QueryAABB(o,s),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(i)}},{key:"Solve",value:function(i){var n=e.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(i),this.m_allParticleFlags&t.b2ParticleFlag.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<i.particleIterations;this.m_iterationIndex++){++this.m_timestamp;var r=n.Copy(i);if(r.dt/=i.particleIterations,r.inv_dt*=i.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&t.b2ParticleFlag.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(r),this.m_allParticleFlags&t.b2ParticleFlag.b2_viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&t.b2ParticleFlag.b2_repulsiveParticle&&this.SolveRepulsive(r),this.m_allParticleFlags&t.b2ParticleFlag.b2_powderParticle&&this.SolvePowder(r),this.m_allParticleFlags&t.b2ParticleFlag.b2_tensileParticle&&this.SolveTensile(r),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SolveSolid(r),this.m_allParticleFlags&t.b2ParticleFlag.b2_colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(r),this.m_allParticleFlags&t.b2ParticleFlag.b2_staticPressureParticle&&this.SolveStaticPressure(r),this.SolvePressure(r),this.SolveDamping(r),this.m_allParticleFlags&e.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&t.b2ParticleFlag.b2_elasticParticle&&this.SolveElastic(r),this.m_allParticleFlags&t.b2ParticleFlag.b2_springParticle&&this.SolveSpring(r),this.LimitVelocity(r),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&t.b2ParticleFlag.b2_barrierParticle&&this.SolveBarrier(r),this.SolveCollision(r),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigid(r),this.m_allParticleFlags&t.b2ParticleFlag.b2_wallParticle&&this.SolveWall(),!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var s=0;s<this.m_count;s++)this.m_positionBuffer.data[s].SelfMulAdd(r.dt,this.m_velocityBuffer.data[s])}}},{key:"SolveCollision",value:function(t){var i=e.SolveCollision_s_aabb;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;var n=this.m_positionBuffer.data,r=this.m_velocityBuffer.data,s=i;s.lowerBound.x=+h,s.lowerBound.y=+h,s.upperBound.x=-h,s.upperBound.y=-h;for(var o=0;o<this.m_count;o++){var a=r[o],u=n[o],l=u.x+t.dt*a.x,c=u.y+t.dt*a.y;s.lowerBound.x=at(s.lowerBound.x,at(u.x,l)),s.lowerBound.y=at(s.lowerBound.y,at(u.y,c)),s.upperBound.x=ut(s.upperBound.x,ut(u.x,l)),s.upperBound.y=ut(s.upperBound.y,ut(u.y,c))}var m=new e.SolveCollisionCallback(this,t);this.m_world.QueryAABB(m,s)}},{key:"LimitVelocity",value:function(t){if(!this.m_velocityBuffer.data)throw new Error;for(var e=this.m_velocityBuffer.data,i=this.GetCriticalVelocitySquared(t),n=0;n<this.m_count;n++){var r=e[n],s=Vt.DotVV(r,r);s>i&&r.SelfMul(ft(i/s))}}},{key:"SolveGravity",value:function(t){if(!this.m_velocityBuffer.data)throw new Error;for(var i=e.SolveGravity_s_gravity,n=this.m_velocityBuffer.data,r=Vt.MulSV(t.dt*this.m_def.gravityScale,this.m_world.GetGravity(),i),s=0;s<this.m_count;s++)n[s].SelfAdd(r)}},{key:"SolveBarrier",value:function(i){var n=e.SolveBarrier_s_aabb,r=e.SolveBarrier_s_va,s=e.SolveBarrier_s_vb,o=e.SolveBarrier_s_pba,a=e.SolveBarrier_s_vba,u=e.SolveBarrier_s_vc,l=e.SolveBarrier_s_pca,h=e.SolveBarrier_s_vca,c=e.SolveBarrier_s_qba,m=e.SolveBarrier_s_qca,_=e.SolveBarrier_s_dv,f=e.SolveBarrier_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var d=this.m_positionBuffer.data,p=this.m_velocityBuffer.data,v=0;v<this.m_count;v++)0!==(this.m_flagsBuffer.data[v]&e.k_barrierWallFlags)&&p[v].SetZero();for(var y=N*i.dt,g=this.GetParticleMass(),x=0;x<this.m_pairBuffer.count;x++){var b=this.m_pairBuffer.data[x];if(b.flags&t.b2ParticleFlag.b2_barrierParticle){var w=b.indexA,A=b.indexB,S=d[w],B=d[A],C=n;Vt.MinV(S,B,C.lowerBound),Vt.MaxV(S,B,C.upperBound);for(var V=this.m_groupBuffer[w],M=this.m_groupBuffer[A],k=this.GetLinearVelocity(V,w,S,r),P=this.GetLinearVelocity(M,A,B,s),I=Vt.SubVV(B,S,o),T=Vt.SubVV(P,k,a),D=this.GetInsideBoundsEnumerator(C),G=void 0;(G=D.GetNext())>=0;){var R=d[G],E=this.m_groupBuffer[G];if(V!==E&&M!==E){var F=this.GetLinearVelocity(E,G,R,u),L=Vt.SubVV(R,S,l),j=Vt.SubVV(F,k,h),O=Vt.CrossVV(T,j),q=Vt.CrossVV(I,j)-Vt.CrossVV(L,T),z=Vt.CrossVV(I,L),U=void 0,J=void 0,X=c,Y=m;if(0===O){if(0===q)continue;if(!((J=-z/q)>=0&&J<y))continue;if(Vt.AddVMulSV(I,J,T,X),Vt.AddVMulSV(L,J,j,Y),!((U=Vt.DotVV(X,Y)/Vt.DotVV(X,X))>=0&&U<=1))continue}else{var W=q*q-4*z*O;if(W<0)continue;var Z=ft(W),H=(-q-Z)/(2*O),Q=(-q+Z)/(2*O);if(H>Q){var K=H;H=Q,Q=K}if(J=H,Vt.AddVMulSV(I,J,T,X),Vt.AddVMulSV(L,J,j,Y),U=Vt.DotVV(X,Y)/Vt.DotVV(X,X),!(J>=0&&J<y&&U>=0&&U<=1)){if(!((J=Q)>=0&&J<y))continue;if(Vt.AddVMulSV(I,J,T,X),Vt.AddVMulSV(L,J,j,Y),!((U=Vt.DotVV(X,Y)/Vt.DotVV(X,X))>=0&&U<=1))continue}}var $=_;$.x=k.x+U*T.x-F.x,$.y=k.y+U*T.y-F.y;var tt=Vt.MulSV(g,$,f);if(E&&this.IsRigidGroup(E)){var et=E.GetMass(),it=E.GetInertia();et>0&&E.m_linearVelocity.SelfMulAdd(1/et,tt),it>0&&(E.m_angularVelocity+=Vt.CrossVV(Vt.SubVV(R,E.GetCenter(),Vt.s_t0),tt)/it)}else p[G].SelfAdd($);this.ParticleApplyForce(G,tt.SelfMul(-i.inv_dt))}}}}}},{key:"SolveStaticPressure",value:function(e){if(!this.m_flagsBuffer.data)throw new Error;this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);for(var i=this.GetCriticalPressure(e),n=this.m_def.staticPressureStrength*i,r=E*i,s=this.m_def.staticPressureRelaxation,o=0;o<this.m_def.staticPressureIterations;o++){for(var a=0;a<this.m_count;a++)this.m_accumulationBuffer[a]=0;for(var u=0;u<this.m_contactBuffer.count;u++){var l=this.m_contactBuffer.data[u];if(l.flags&t.b2ParticleFlag.b2_staticPressureParticle){var h=l.indexA,c=l.indexB,m=l.weight;this.m_accumulationBuffer[h]+=m*this.m_staticPressureBuffer[c],this.m_accumulationBuffer[c]+=m*this.m_staticPressureBuffer[h]}}for(var _=0;_<this.m_count;_++){var f=this.m_weightBuffer[_];if(this.m_flagsBuffer.data[_]&t.b2ParticleFlag.b2_staticPressureParticle){var d=(this.m_accumulationBuffer[_]+n*(f-R))/(f+s);this.m_staticPressureBuffer[_]=lt(d,0,r)}else this.m_staticPressureBuffer[_]=0}}}},{key:"ComputeWeight",value:function(){for(var t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(var e=0;e<this.m_bodyContactBuffer.count;e++){var i=this.m_bodyContactBuffer.data[e],n=i.index,r=i.weight;this.m_weightBuffer[n]+=r}for(var s=0;s<this.m_contactBuffer.count;s++){var o=this.m_contactBuffer.data[s],a=o.indexA,u=o.indexB,l=o.weight;this.m_weightBuffer[a]+=l,this.m_weightBuffer[u]+=l}}},{key:"SolvePressure",value:function(i){var n=e.SolvePressure_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var r=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,o=this.GetCriticalPressure(i),a=this.m_def.pressureStrength*o,u=E*o,l=0;l<this.m_count;l++){var h=this.m_weightBuffer[l],c=a*ut(0,h-R);this.m_accumulationBuffer[l]=at(c,u)}if(this.m_allParticleFlags&e.k_noPressureFlags)for(var m=0;m<this.m_count;m++)this.m_flagsBuffer.data[m]&e.k_noPressureFlags&&(this.m_accumulationBuffer[m]=0);if(this.m_allParticleFlags&t.b2ParticleFlag.b2_staticPressureParticle)for(var _=0;_<this.m_count;_++)this.m_flagsBuffer.data[_]&t.b2ParticleFlag.b2_staticPressureParticle&&(this.m_accumulationBuffer[_]+=this.m_staticPressureBuffer[_]);for(var f=i.dt/(this.m_def.density*this.m_particleDiameter),d=this.GetParticleInvMass(),p=0;p<this.m_bodyContactBuffer.count;p++){var v=this.m_bodyContactBuffer.data[p],y=v.index,g=v.body,x=v.weight,b=v.mass,w=v.normal,A=r[y],S=this.m_accumulationBuffer[y]+a*x,B=Vt.MulSV(f*x*b*S,w,n);s[y].SelfMulSub(d,B),g.ApplyLinearImpulse(B,A,!0)}for(var C=0;C<this.m_contactBuffer.count;C++){var V=this.m_contactBuffer.data[C],M=V.indexA,k=V.indexB,P=V.weight,I=V.normal,T=this.m_accumulationBuffer[M]+this.m_accumulationBuffer[k],D=Vt.MulSV(f*P*T,I,n);s[M].SelfSub(D),s[k].SelfAdd(D)}}},{key:"SolveDamping",value:function(t){var i=e.SolveDamping_s_v,n=e.SolveDamping_s_f;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var r=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,o=this.m_def.dampingStrength,a=1/this.GetCriticalVelocity(t),u=this.GetParticleInvMass(),l=0;l<this.m_bodyContactBuffer.count;l++){var h=this.m_bodyContactBuffer.data[l],c=h.index,m=h.body,_=h.weight,f=h.mass,d=h.normal,p=r[c],v=Vt.SubVV(m.GetLinearVelocityFromWorldPoint(p,Vt.s_t0),s[c],i),y=Vt.DotVV(v,d);if(y<0){var g=ut(o*_,at(-a*y,.5)),x=Vt.MulSV(g*f*y,d,n);s[c].SelfMulAdd(u,x),m.ApplyLinearImpulse(x.SelfNeg(),p,!0)}}for(var b=0;b<this.m_contactBuffer.count;b++){var w=this.m_contactBuffer.data[b],A=w.indexA,S=w.indexB,B=w.weight,C=w.normal,V=Vt.SubVV(s[S],s[A],i),M=Vt.DotVV(V,C);if(M<0){var k=ut(o*B,at(-a*M,.5)),P=Vt.MulSV(k*M,C,n);s[A].SelfAdd(P),s[S].SelfSub(P)}}}},{key:"SolveRigidDamping",value:function(){var t=e.SolveRigidDamping_s_t0,i=e.SolveRigidDamping_s_t1,n=e.SolveRigidDamping_s_p,r=e.SolveRigidDamping_s_v,s=[0],o=[0],a=[0],u=[0],l=[0],h=[0];if(!this.m_positionBuffer.data)throw new Error;for(var c=this.m_positionBuffer.data,m=this.m_def.dampingStrength,_=0;_<this.m_bodyContactBuffer.count;_++){var f=this.m_bodyContactBuffer.data[_],d=f.index,p=this.m_groupBuffer[d];if(p&&this.IsRigidGroup(p)){var v=f.body,y=f.normal,g=f.weight,x=c[d],b=Vt.SubVV(v.GetLinearVelocityFromWorldPoint(x,t),p.GetLinearVelocityFromWorldPoint(x,i),r),w=Vt.DotVV(b,y);if(w<0){this.InitDampingParameterWithRigidGroupOrParticle(s,o,a,!0,p,d,x,y),this.InitDampingParameter(u,l,h,v.GetMass(),v.GetInertia()-v.GetMass()*v.GetLocalCenter().LengthSquared(),v.GetWorldCenter(),x,y);var A=m*at(g,1)*this.ComputeDampingImpulse(s[0],o[0],a[0],u[0],l[0],h[0],w);this.ApplyDamping(s[0],o[0],a[0],!0,p,d,A,y),v.ApplyLinearImpulse(Vt.MulSV(-A,y,Vt.s_t0),x,!0)}}}for(var S=0;S<this.m_contactBuffer.count;S++){var B=this.m_contactBuffer.data[S],C=B.indexA,V=B.indexB,M=B.normal,k=B.weight,P=this.m_groupBuffer[C],I=this.m_groupBuffer[V],T=this.IsRigidGroup(P),D=this.IsRigidGroup(I);if(P!==I&&(T||D)){var G=Vt.MidVV(c[C],c[V],n),R=Vt.SubVV(this.GetLinearVelocity(I,V,G,t),this.GetLinearVelocity(P,C,G,i),r),E=Vt.DotVV(R,M);if(E<0){this.InitDampingParameterWithRigidGroupOrParticle(s,o,a,T,P,C,G,M),this.InitDampingParameterWithRigidGroupOrParticle(u,l,h,D,I,V,G,M);var F=m*k*this.ComputeDampingImpulse(s[0],o[0],a[0],u[0],l[0],h[0],E);this.ApplyDamping(s[0],o[0],a[0],T,P,C,F,M),this.ApplyDamping(u[0],l[0],h[0],D,I,V,-F,M)}}}}},{key:"SolveExtraDamping",value:function(){var t=e.SolveExtraDamping_s_v,i=e.SolveExtraDamping_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var n=this.m_velocityBuffer.data,r=this.m_positionBuffer.data,s=this.GetParticleInvMass(),o=0;o<this.m_bodyContactBuffer.count;o++){var a=this.m_bodyContactBuffer.data[o],u=a.index;if(this.m_flagsBuffer.data[u]&e.k_extraDampingFlags){var l=a.body,h=a.mass,c=a.normal,m=r[u],_=Vt.SubVV(l.GetLinearVelocityFromWorldPoint(m,Vt.s_t0),n[u],t),f=Vt.DotVV(_,c);if(f<0){var d=Vt.MulSV(.5*h*f,c,i);n[u].SelfMulAdd(s,d),l.ApplyLinearImpulse(d.SelfNeg(),m,!0)}}}}},{key:"SolveWall",value:function(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var e=this.m_velocityBuffer.data,i=0;i<this.m_count;i++)this.m_flagsBuffer.data[i]&t.b2ParticleFlag.b2_wallParticle&&e[i].SetZero()}},{key:"SolveRigid",value:function(i){var n=e.SolveRigid_s_position,r=e.SolveRigid_s_rotation,s=e.SolveRigid_s_transform,o=e.SolveRigid_s_velocityTransform;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var a=this.m_positionBuffer.data,u=this.m_velocityBuffer.data,l=this.m_groupList;l;l=l.GetNext())if(l.m_groupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup){l.UpdateStatistics();var h=r;h.SetAngle(i.dt*l.m_angularVelocity);var c=Vt.AddVV(l.m_center,Vt.SubVV(Vt.MulSV(i.dt,l.m_linearVelocity,Vt.s_t0),Tt.MulRV(h,l.m_center,Vt.s_t1),Vt.s_t0),n),m=s;m.SetPositionRotation(c,h),Dt.MulXX(m,l.m_transform,l.m_transform);var _=o;_.p.x=i.inv_dt*m.p.x,_.p.y=i.inv_dt*m.p.y,_.q.s=i.inv_dt*m.q.s,_.q.c=i.inv_dt*(m.q.c-1);for(var f=l.m_firstIndex;f<l.m_lastIndex;f++)Dt.MulXV(_,a[f],u[f])}}},{key:"SolveElastic",value:function(i){var n=e.SolveElastic_s_pa,r=e.SolveElastic_s_pb,s=e.SolveElastic_s_pc,o=e.SolveElastic_s_r,a=e.SolveElastic_s_t0;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var u=this.m_positionBuffer.data,l=this.m_velocityBuffer.data,h=i.inv_dt*this.m_def.elasticStrength,c=0;c<this.m_triadBuffer.count;c++){var m=this.m_triadBuffer.data[c];if(m.flags&t.b2ParticleFlag.b2_elasticParticle){var _=m.indexA,f=m.indexB,d=m.indexC,p=m.pa,v=m.pb,y=m.pc,g=n.Copy(u[_]),x=r.Copy(u[f]),b=s.Copy(u[d]),w=l[_],A=l[f],S=l[d];g.SelfMulAdd(i.dt,w),x.SelfMulAdd(i.dt,A),b.SelfMulAdd(i.dt,S);var B=(g.x+x.x+b.x)/3,C=(g.y+x.y+b.y)/3;g.x-=B,g.y-=C,x.x-=B,x.y-=C,b.x-=B,b.y-=C;var V=o;V.s=Vt.CrossVV(p,g)+Vt.CrossVV(v,x)+Vt.CrossVV(y,b),V.c=Vt.DotVV(p,g)+Vt.DotVV(v,x)+Vt.DotVV(y,b);var M=_t(V.s*V.s+V.c*V.c);isFinite(M)||(M=198177537e11),V.s*=M,V.c*=M;var k=h*m.strength;Tt.MulRV(V,p,a),Vt.SubVV(a,g,a),Vt.MulSV(k,a,a),w.SelfAdd(a),Tt.MulRV(V,v,a),Vt.SubVV(a,x,a),Vt.MulSV(k,a,a),A.SelfAdd(a),Tt.MulRV(V,y,a),Vt.SubVV(a,b,a),Vt.MulSV(k,a,a),S.SelfAdd(a)}}}},{key:"SolveSpring",value:function(i){var n=e.SolveSpring_s_pa,r=e.SolveSpring_s_pb,s=e.SolveSpring_s_d,o=e.SolveSpring_s_f;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var a=this.m_positionBuffer.data,u=this.m_velocityBuffer.data,l=i.inv_dt*this.m_def.springStrength,h=0;h<this.m_pairBuffer.count;h++){var c=this.m_pairBuffer.data[h];if(c.flags&t.b2ParticleFlag.b2_springParticle){var m=c.indexA,_=c.indexB,f=n.Copy(a[m]),d=r.Copy(a[_]),p=u[m],v=u[_];f.SelfMulAdd(i.dt,p),d.SelfMulAdd(i.dt,v);var y=Vt.SubVV(d,f,s),g=c.distance,x=y.Length(),b=l*c.strength,w=Vt.MulSV(b*(g-x)/x,y,o);p.SelfSub(w),v.SelfAdd(w)}}}},{key:"SolveTensile",value:function(i){var n=e.SolveTensile_s_weightedNormal,r=e.SolveTensile_s_s,s=e.SolveTensile_s_f;if(!this.m_velocityBuffer.data)throw new Error;for(var o=this.m_velocityBuffer.data,a=0;a<this.m_count;a++)this.m_accumulation2Buffer[a]=new Vt,this.m_accumulation2Buffer[a].SetZero();for(var u=0;u<this.m_contactBuffer.count;u++){var l=this.m_contactBuffer.data[u];if(l.flags&t.b2ParticleFlag.b2_tensileParticle){var h=l.indexA,c=l.indexB,m=l.weight,_=l.normal,f=Vt.MulSV((1-m)*m,_,n);this.m_accumulation2Buffer[h].SelfSub(f),this.m_accumulation2Buffer[c].SelfAdd(f)}}for(var d=this.GetCriticalVelocity(i),p=this.m_def.surfaceTensionPressureStrength*d,v=this.m_def.surfaceTensionNormalStrength*d,y=F*d,g=0;g<this.m_contactBuffer.count;g++){var x=this.m_contactBuffer.data[g];if(x.flags&t.b2ParticleFlag.b2_tensileParticle){var b=x.indexA,w=x.indexB,A=x.weight,S=x.normal,B=this.m_weightBuffer[b]+this.m_weightBuffer[w],C=Vt.SubVV(this.m_accumulation2Buffer[w],this.m_accumulation2Buffer[b],r),V=at(p*(B-2)+v*Vt.DotVV(C,S),y)*A,M=Vt.MulSV(V,S,s);o[b].SelfSub(M),o[w].SelfAdd(M)}}}},{key:"SolveViscous",value:function(){var i=e.SolveViscous_s_v,n=e.SolveViscous_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var r=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,o=this.m_def.viscousStrength,a=this.GetParticleInvMass(),u=0;u<this.m_bodyContactBuffer.count;u++){var l=this.m_bodyContactBuffer.data[u],h=l.index;if(this.m_flagsBuffer.data[h]&t.b2ParticleFlag.b2_viscousParticle){var c=l.body,m=l.weight,_=l.mass,f=r[h],d=Vt.SubVV(c.GetLinearVelocityFromWorldPoint(f,Vt.s_t0),s[h],i),p=Vt.MulSV(o*_*m,d,n);s[h].SelfMulAdd(a,p),c.ApplyLinearImpulse(p.SelfNeg(),f,!0)}}for(var v=0;v<this.m_contactBuffer.count;v++){var y=this.m_contactBuffer.data[v];if(y.flags&t.b2ParticleFlag.b2_viscousParticle){var g=y.indexA,x=y.indexB,b=y.weight,w=Vt.SubVV(s[x],s[g],i),A=Vt.MulSV(o*b,w,n);s[g].SelfAdd(A),s[x].SelfSub(A)}}}},{key:"SolveRepulsive",value:function(i){var n=e.SolveRepulsive_s_f;if(!this.m_velocityBuffer.data)throw new Error;for(var r=this.m_velocityBuffer.data,s=this.m_def.repulsiveStrength*this.GetCriticalVelocity(i),o=0;o<this.m_contactBuffer.count;o++){var a=this.m_contactBuffer.data[o];if(a.flags&t.b2ParticleFlag.b2_repulsiveParticle){var u=a.indexA,l=a.indexB;if(this.m_groupBuffer[u]!==this.m_groupBuffer[l]){var h=a.weight,c=a.normal,m=Vt.MulSV(s*h,c,n);r[u].SelfSub(m),r[l].SelfAdd(m)}}}}},{key:"SolvePowder",value:function(i){var n=e.SolvePowder_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var r=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,o=this.m_def.powderStrength*this.GetCriticalVelocity(i),a=1-G,u=this.GetParticleInvMass(),l=0;l<this.m_bodyContactBuffer.count;l++){var h=this.m_bodyContactBuffer.data[l],c=h.index;if(this.m_flagsBuffer.data[c]&t.b2ParticleFlag.b2_powderParticle){var m=h.weight;if(m>a){var _=h.body,f=h.mass,d=r[c],p=h.normal,v=Vt.MulSV(o*f*(m-a),p,n);s[c].SelfMulSub(u,v),_.ApplyLinearImpulse(v,d,!0)}}}for(var y=0;y<this.m_contactBuffer.count;y++){var g=this.m_contactBuffer.data[y];if(g.flags&t.b2ParticleFlag.b2_powderParticle){var x=g.weight;if(x>a){var b=g.indexA,w=g.indexB,A=g.normal,S=Vt.MulSV(o*(x-a),A,n);s[b].SelfSub(S),s[w].SelfAdd(S)}}}}},{key:"SolveSolid",value:function(t){var i=e.SolveSolid_s_f;if(!this.m_velocityBuffer.data)throw new Error;var n=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);for(var r=t.inv_dt*this.m_def.ejectionStrength,s=0;s<this.m_contactBuffer.count;s++){var o=this.m_contactBuffer.data[s],a=o.indexA,u=o.indexB;if(this.m_groupBuffer[a]!==this.m_groupBuffer[u]){var l=o.weight,h=o.normal,c=this.m_depthBuffer[a]+this.m_depthBuffer[u],m=Vt.MulSV(r*c*l,h,i);n[a].SelfSub(m),n[u].SelfAdd(m)}}}},{key:"SolveForce",value:function(t){if(!this.m_velocityBuffer.data)throw new Error;for(var e=this.m_velocityBuffer.data,i=t.dt*this.GetParticleInvMass(),n=0;n<this.m_count;n++)e[n].SelfMulAdd(i,this.m_forceBuffer[n]);this.m_hasForce=!1}},{key:"SolveColorMixing",value:function(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_colorBuffer.data)throw new Error;var e=.5*this.m_def.colorMixingStrength;if(e)for(var i=0;i<this.m_contactBuffer.count;i++){var n=this.m_contactBuffer.data[i],r=n.indexA,s=n.indexB;if(this.m_flagsBuffer.data[r]&this.m_flagsBuffer.data[s]&t.b2ParticleFlag.b2_colorMixingParticle){var o=this.m_colorBuffer.data[r],a=this.m_colorBuffer.data[s];Et.MixColors(o,a,e)}}}},{key:"SolveZombie",value:function(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var e=0,i=[],n=0;n<this.m_count;n++)i[n]=T;for(var r=0,s=0;s<this.m_count;s++){var o=this.m_flagsBuffer.data[s];if(o&t.b2ParticleFlag.b2_zombieParticle){var a=this.m_world.m_destructionListener;if(o&t.b2ParticleFlag.b2_destructionListenerParticle&&a&&a.SayGoodbyeParticle(this,s),this.m_handleIndexBuffer.data){var u=this.m_handleIndexBuffer.data[s];u&&(u.SetIndex(T),this.m_handleIndexBuffer.data[s]=null)}i[s]=T}else{if(i[s]=e,s!==e){if(this.m_handleIndexBuffer.data){var l=this.m_handleIndexBuffer.data[s];l&&l.SetIndex(e),this.m_handleIndexBuffer.data[e]=l}this.m_flagsBuffer.data[e]=this.m_flagsBuffer.data[s],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=this.m_lastBodyContactStepBuffer.data[s]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=this.m_bodyContactCountBuffer.data[s]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=this.m_consecutiveContactStepsBuffer.data[s]),this.m_positionBuffer.data[e].Copy(this.m_positionBuffer.data[s]),this.m_velocityBuffer.data[e].Copy(this.m_velocityBuffer.data[s]),this.m_groupBuffer[e]=this.m_groupBuffer[s],this.m_hasForce&&this.m_forceBuffer[e].Copy(this.m_forceBuffer[s]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=this.m_staticPressureBuffer[s]),this.m_depthBuffer&&(this.m_depthBuffer[e]=this.m_depthBuffer[s]),this.m_colorBuffer.data&&this.m_colorBuffer.data[e].Copy(this.m_colorBuffer.data[s]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[e]=this.m_userDataBuffer.data[s]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[e]=this.m_expirationTimeBuffer.data[s])}e++,r|=o}}for(var h={IsProxyInvalid:function(t){return t.index<0},IsContactInvalid:function(t){return t.indexA<0||t.indexB<0},IsBodyContactInvalid:function(t){return t.index<0},IsPairInvalid:function(t){return t.indexA<0||t.indexB<0},IsTriadInvalid:function(t){return t.indexA<0||t.indexB<0||t.indexC<0}},c=0;c<this.m_proxyBuffer.count;c++){var m=this.m_proxyBuffer.data[c];m.index=i[m.index]}this.m_proxyBuffer.RemoveIf(h.IsProxyInvalid);for(var _=0;_<this.m_contactBuffer.count;_++){var f=this.m_contactBuffer.data[_];f.indexA=i[f.indexA],f.indexB=i[f.indexB]}this.m_contactBuffer.RemoveIf(h.IsContactInvalid);for(var d=0;d<this.m_bodyContactBuffer.count;d++){var p=this.m_bodyContactBuffer.data[d];p.index=i[p.index]}this.m_bodyContactBuffer.RemoveIf(h.IsBodyContactInvalid);for(var v=0;v<this.m_pairBuffer.count;v++){var y=this.m_pairBuffer.data[v];y.indexA=i[y.indexA],y.indexB=i[y.indexB]}this.m_pairBuffer.RemoveIf(h.IsPairInvalid);for(var g=0;g<this.m_triadBuffer.count;g++){var x=this.m_triadBuffer.data[g];x.indexA=i[x.indexA],x.indexB=i[x.indexB],x.indexC=i[x.indexC]}if(this.m_triadBuffer.RemoveIf(h.IsTriadInvalid),this.m_indexByExpirationTimeBuffer.data)for(var b=0,w=0;w<this.m_count;w++){var A=i[this.m_indexByExpirationTimeBuffer.data[w]];A!==T&&(this.m_indexByExpirationTimeBuffer.data[b++]=A)}for(var S=this.m_groupList;S;S=S.GetNext()){for(var B=e,C=0,V=!1,M=S.m_firstIndex;M<S.m_lastIndex;M++){var k=i[M];k>=0?(B=at(B,k),C=ut(C,k+1)):V=!0}B<C?(S.m_firstIndex=B,S.m_lastIndex=C,V&&S.m_groupFlags&t.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SetGroupFlags(S,S.m_groupFlags|t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth)):(S.m_firstIndex=0,S.m_lastIndex=0,S.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupCanBeEmpty||this.SetGroupFlags(S,S.m_groupFlags|t.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed))}this.m_count=e,this.m_allParticleFlags=r,this.m_needsUpdateAllParticleFlags=!1;for(var P=this.m_groupList;P;){var I=P.GetNext();P.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(P),P=I}}},{key:"SolveLifetimes",value:function(t){if(!this.m_expirationTimeBuffer.data)throw new Error;if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);var e=this.GetQuantizedTimeElapsed(),i=this.m_expirationTimeBuffer.data,n=this.m_indexByExpirationTimeBuffer.data,r=this.GetParticleCount();this.m_expirationTimeBufferRequiresSorting&&(Lr(n,0,r,(function(t,e){var n=i[t],r=i[e],s=n<=0;return s===r<=0?n>r:s})),this.m_expirationTimeBufferRequiresSorting=!1);for(var s=r-1;s>=0;--s){var o=n[s],a=i[o];if(e<a||a<=0)break;this.DestroyParticle(o)}}},{key:"RotateBuffer",value:function(t,e,i){if(t!==e&&e!==i){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;if(zr(this.m_flagsBuffer.data,t,e,i),this.m_lastBodyContactStepBuffer.data&&zr(this.m_lastBodyContactStepBuffer.data,t,e,i),this.m_bodyContactCountBuffer.data&&zr(this.m_bodyContactCountBuffer.data,t,e,i),this.m_consecutiveContactStepsBuffer.data&&zr(this.m_consecutiveContactStepsBuffer.data,t,e,i),zr(this.m_positionBuffer.data,t,e,i),zr(this.m_velocityBuffer.data,t,e,i),zr(this.m_groupBuffer,t,e,i),this.m_hasForce&&zr(this.m_forceBuffer,t,e,i),this.m_staticPressureBuffer&&zr(this.m_staticPressureBuffer,t,e,i),this.m_depthBuffer&&zr(this.m_depthBuffer,t,e,i),this.m_colorBuffer.data&&zr(this.m_colorBuffer.data,t,e,i),this.m_userDataBuffer.data&&zr(this.m_userDataBuffer.data,t,e,i),this.m_handleIndexBuffer.data){zr(this.m_handleIndexBuffer.data,t,e,i);for(var n=t;n<i;++n){var r=this.m_handleIndexBuffer.data[n];r&&r.SetIndex(g(r.GetIndex()))}}if(this.m_expirationTimeBuffer.data){zr(this.m_expirationTimeBuffer.data,t,e,i);var s=this.GetParticleCount();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;for(var o=this.m_indexByExpirationTimeBuffer.data,a=0;a<s;++a)o[a]=g(o[a])}for(var u=0;u<this.m_proxyBuffer.count;u++){var l=this.m_proxyBuffer.data[u];l.index=g(l.index)}for(var h=0;h<this.m_contactBuffer.count;h++){var c=this.m_contactBuffer.data[h];c.indexA=g(c.indexA),c.indexB=g(c.indexB)}for(var m=0;m<this.m_bodyContactBuffer.count;m++){var _=this.m_bodyContactBuffer.data[m];_.index=g(_.index)}for(var f=0;f<this.m_pairBuffer.count;f++){var d=this.m_pairBuffer.data[f];d.indexA=g(d.indexA),d.indexB=g(d.indexB)}for(var p=0;p<this.m_triadBuffer.count;p++){var v=this.m_triadBuffer.data[p];v.indexA=g(v.indexA),v.indexB=g(v.indexB),v.indexC=g(v.indexC)}for(var y=this.m_groupList;y;y=y.GetNext())y.m_firstIndex=g(y.m_firstIndex),y.m_lastIndex=g(y.m_lastIndex-1)+1}function g(n){return n<t?n:n<e?n+i-e:n<i?n+t-e:n}}},{key:"GetCriticalVelocity",value:function(t){return this.m_particleDiameter*t.inv_dt}},{key:"GetCriticalVelocitySquared",value:function(t){var e=this.GetCriticalVelocity(t);return e*e}},{key:"GetCriticalPressure",value:function(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)}},{key:"GetParticleStride",value:function(){return G*this.m_particleDiameter}},{key:"GetParticleMass",value:function(){var t=this.GetParticleStride();return this.m_def.density*t*t}},{key:"GetParticleInvMass",value:function(){var t=this.m_inverseDiameter*(1/G);return this.m_inverseDensity*t*t}},{key:"GetFixtureContactFilter",value:function(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}},{key:"GetParticleContactFilter",value:function(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}},{key:"GetFixtureContactListener",value:function(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}},{key:"GetParticleContactListener",value:function(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}},{key:"SetUserOverridableBuffer",value:function(t,e,i){t.data=e,t.userSuppliedCapacity=i}},{key:"SetGroupFlags",value:function(e,i){var n=e.m_groupFlags;(n^i)&t.b2ParticleGroupFlag.b2_solidParticleGroup&&(i|=t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth),n&~i&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&i&&(i&t.b2ParticleGroupFlag.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=i),e.m_groupFlags=i}},{key:"RemoveSpuriousBodyContacts",value:function(){Lr(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,e.BodyContactCompare);var t=e.RemoveSpuriousBodyContacts_s_n,i=e.RemoveSpuriousBodyContacts_s_pos,n=e.RemoveSpuriousBodyContacts_s_normal,r=3,s=this,o=-1,a=0,u=function(e){if(e.index!==o&&(a=0,o=e.index),a++>r)return!0;var u=t.Copy(e.normal);if(u.SelfMul(s.m_particleDiameter*(1-e.weight)),!s.m_positionBuffer.data)throw new Error;var l=Vt.AddVV(s.m_positionBuffer.data[e.index],u,i);if(!e.fixture.TestPoint(l)){for(var h=e.fixture.GetShape().GetChildCount(),c=0;c<h;c++){var m=n;if(e.fixture.ComputeDistance(l,m,c)<y)return!1}return!0}return!1};this.m_bodyContactBuffer.count=Or(this.m_bodyContactBuffer.data,u,this.m_bodyContactBuffer.count)}},{key:"DetectStuckParticle",value:function(t){if(!(this.m_stuckThreshold<=0)){if(!this.m_bodyContactCountBuffer.data)throw new Error;if(!this.m_consecutiveContactStepsBuffer.data)throw new Error;if(!this.m_lastBodyContactStepBuffer.data)throw new Error;++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp}}},{key:"ValidateParticleIndex",value:function(t){return t>=0&&t<this.GetParticleCount()&&t!==T}},{key:"GetQuantizedTimeElapsed",value:function(){return Math.floor(this.m_timeElapsed/4294967296)}},{key:"LifetimeToExpirationTime",value:function(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)}},{key:"ForceCanBeApplied",value:function(e){return!(e&t.b2ParticleFlag.b2_wallParticle)}},{key:"PrepareForceBuffer",value:function(){if(!this.m_hasForce){for(var t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}}},{key:"IsRigidGroup",value:function(e){return null!==e&&0!==(e.m_groupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup)}},{key:"GetLinearVelocity",value:function(t,e,i,n){if(t&&this.IsRigidGroup(t))return t.GetLinearVelocityFromWorldPoint(i,n);if(!this.m_velocityBuffer.data)throw new Error;return n.Copy(this.m_velocityBuffer.data[e])}},{key:"InitDampingParameter",value:function(t,e,i,n,r,s,o,a){t[0]=n>0?1/n:0,e[0]=r>0?1/r:0,i[0]=Vt.CrossVV(Vt.SubVV(o,s,Vt.s_t0),a)}},{key:"InitDampingParameterWithRigidGroupOrParticle",value:function(e,i,n,r,s,o,a,u){if(s&&r)this.InitDampingParameter(e,i,n,s.GetMass(),s.GetInertia(),s.GetCenter(),a,u);else{if(!this.m_flagsBuffer.data)throw new Error;var l=this.m_flagsBuffer.data[o];this.InitDampingParameter(e,i,n,l&t.b2ParticleFlag.b2_wallParticle?0:this.GetParticleMass(),0,a,a,u)}}},{key:"ComputeDampingImpulse",value:function(t,e,i,n,r,s,o){var a=t+e*i*i+n+r*s*s;return a>0?o/a:0}},{key:"ApplyDamping",value:function(t,e,i,n,r,s,o,a){if(r&&n)r.m_linearVelocity.SelfMulAdd(o*t,a),r.m_angularVelocity+=o*i*e;else{if(!this.m_velocityBuffer.data)throw new Error;this.m_velocityBuffer.data[s].SelfMulAdd(o*t,a)}}}],[{key:"computeTag",value:function(t,i){return(i+e.yOffset>>>0<<e.yShift)+(e.xScale*t+e.xOffset>>>0)>>>0}},{key:"computeRelativeTag",value:function(t,i,n){return t+(n<<e.yShift)+(i<<e.xShift)>>>0}},{key:"IsSignificantForce",value:function(t){return 0!==t.x||0!==t.y}},{key:"ParticleCanBeConnected",value:function(e,i){return 0!==(e&(t.b2ParticleFlag.b2_wallParticle|t.b2ParticleFlag.b2_springParticle|t.b2ParticleFlag.b2_elasticParticle))||null!==i&&0!==(i.GetGroupFlags()&t.b2ParticleGroupFlag.b2_rigidParticleGroup)}},{key:"ComparePairIndices",value:function(t,e){var i=t.indexA-e.indexA;return 0!==i?i<0:t.indexB<e.indexB}},{key:"MatchPairIndices",value:function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB}},{key:"CompareTriadIndices",value:function(t,e){var i=t.indexA-e.indexA;if(0!==i)return i<0;var n=t.indexB-e.indexB;return 0!==n?n<0:t.indexC<e.indexC}},{key:"MatchTriadIndices",value:function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC}},{key:"InitializeParticleLists",value:function(t,e){for(var i=t.GetBufferIndex(),n=t.GetParticleCount(),r=0;r<n;r++){var s=e[r];s.list=s,s.next=null,s.count=1,s.index=r+i}}},{key:"MergeParticleLists",value:function(t,e){for(var i=e;;){i.list=t;var n=i.next;if(!n){i.next=t.next;break}i=n}t.next=e,t.count+=e.count,e.count=0}},{key:"FindLongestParticleList",value:function(t,e){for(var i=t.GetParticleCount(),n=e[0],r=0;r<i;r++){var s=e[r];n.count<s.count&&(n=s)}return n}},{key:"MergeParticleListAndNode",value:function(t,e){e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0}},{key:"b2ParticleContactIsZombie",value:function(e){return(e.flags&t.b2ParticleFlag.b2_zombieParticle)===t.b2ParticleFlag.b2_zombieParticle}},{key:"BodyContactCompare",value:function(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index}}]),e}();Kr.xTruncBits=12,Kr.yTruncBits=12,Kr.tagBits=32,Kr.yOffset=1<<Kr.yTruncBits-1,Kr.yShift=Kr.tagBits-Kr.yTruncBits,Kr.xShift=Kr.tagBits-Kr.yTruncBits-Kr.xTruncBits,Kr.xScale=1<<Kr.xShift,Kr.xOffset=Kr.xScale*(1<<Kr.xTruncBits-1),Kr.yMask=(1<<Kr.yTruncBits)-1<<Kr.yShift,Kr.xMask=~Kr.yMask,Kr.DestroyParticlesInShape_s_aabb=new Me,Kr.CreateParticleGroup_s_transform=new Dt,Kr.ComputeCollisionEnergy_s_v=new Vt,Kr.QueryShapeAABB_s_aabb=new Me,Kr.QueryPointAABB_s_aabb=new Me,Kr.RayCast_s_aabb=new Me,Kr.RayCast_s_p=new Vt,Kr.RayCast_s_v=new Vt,Kr.RayCast_s_n=new Vt,Kr.RayCast_s_point=new Vt,Kr.k_pairFlags=t.b2ParticleFlag.b2_springParticle,Kr.k_triadFlags=t.b2ParticleFlag.b2_elasticParticle,Kr.k_noPressureFlags=t.b2ParticleFlag.b2_powderParticle|t.b2ParticleFlag.b2_tensileParticle,Kr.k_extraDampingFlags=t.b2ParticleFlag.b2_staticPressureParticle,Kr.k_barrierWallFlags=t.b2ParticleFlag.b2_barrierParticle|t.b2ParticleFlag.b2_wallParticle,Kr.CreateParticlesStrokeShapeForGroup_s_edge=new un,Kr.CreateParticlesStrokeShapeForGroup_s_d=new Vt,Kr.CreateParticlesStrokeShapeForGroup_s_p=new Vt,Kr.CreateParticlesFillShapeForGroup_s_aabb=new Me,Kr.CreateParticlesFillShapeForGroup_s_p=new Vt,Kr.UpdatePairsAndTriads_s_dab=new Vt,Kr.UpdatePairsAndTriads_s_dbc=new Vt,Kr.UpdatePairsAndTriads_s_dca=new Vt,Kr.AddContact_s_d=new Vt,Kr.UpdateBodyContacts_s_aabb=new Me,Kr.Solve_s_subStep=new dr,Kr.SolveCollision_s_aabb=new Me,Kr.SolveGravity_s_gravity=new Vt,Kr.SolveBarrier_s_aabb=new Me,Kr.SolveBarrier_s_va=new Vt,Kr.SolveBarrier_s_vb=new Vt,Kr.SolveBarrier_s_pba=new Vt,Kr.SolveBarrier_s_vba=new Vt,Kr.SolveBarrier_s_vc=new Vt,Kr.SolveBarrier_s_pca=new Vt,Kr.SolveBarrier_s_vca=new Vt,Kr.SolveBarrier_s_qba=new Vt,Kr.SolveBarrier_s_qca=new Vt,Kr.SolveBarrier_s_dv=new Vt,Kr.SolveBarrier_s_f=new Vt,Kr.SolvePressure_s_f=new Vt,Kr.SolveDamping_s_v=new Vt,Kr.SolveDamping_s_f=new Vt,Kr.SolveRigidDamping_s_t0=new Vt,Kr.SolveRigidDamping_s_t1=new Vt,Kr.SolveRigidDamping_s_p=new Vt,Kr.SolveRigidDamping_s_v=new Vt,Kr.SolveExtraDamping_s_v=new Vt,Kr.SolveExtraDamping_s_f=new Vt,Kr.SolveRigid_s_position=new Vt,Kr.SolveRigid_s_rotation=new Tt,Kr.SolveRigid_s_transform=new Dt,Kr.SolveRigid_s_velocityTransform=new Dt,Kr.SolveElastic_s_pa=new Vt,Kr.SolveElastic_s_pb=new Vt,Kr.SolveElastic_s_pc=new Vt,Kr.SolveElastic_s_r=new Tt,Kr.SolveElastic_s_t0=new Vt,Kr.SolveSpring_s_pa=new Vt,Kr.SolveSpring_s_pb=new Vt,Kr.SolveSpring_s_d=new Vt,Kr.SolveSpring_s_f=new Vt,Kr.SolveTensile_s_weightedNormal=new Vt,Kr.SolveTensile_s_s=new Vt,Kr.SolveTensile_s_f=new Vt,Kr.SolveViscous_s_v=new Vt,Kr.SolveViscous_s_f=new Vt,Kr.SolveRepulsive_s_f=new Vt,Kr.SolvePowder_s_f=new Vt,Kr.SolveSolid_s_f=new Vt,Kr.RemoveSpuriousBodyContacts_s_n=new Vt,Kr.RemoveSpuriousBodyContacts_s_pos=new Vt,Kr.RemoveSpuriousBodyContacts_s_normal=new Vt,function(e){var i=function t(){a(this,t),this.data=null,this.userSuppliedCapacity=0};e.UserOverridableBuffer=i;var n=function(){function t(){a(this,t),this.index=T,this.tag=0}return u(t,null,[{key:"CompareProxyProxy",value:function(t,e){return t.tag<e.tag}},{key:"CompareTagProxy",value:function(t,e){return t<e.tag}},{key:"CompareProxyTag",value:function(t,e){return t.tag<e}}]),t}();e.Proxy=n;var r=function(){function t(i,n,r,s,o){a(this,t),this.m_system=i,this.m_xLower=(n&e.xMask)>>>0,this.m_xUpper=(r&e.xMask)>>>0,this.m_yLower=(n&e.yMask)>>>0,this.m_yUpper=(r&e.yMask)>>>0,this.m_first=s,this.m_last=o}return u(t,[{key:"GetNext",value:function(){for(;this.m_first<this.m_last;){var t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&e.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return T}}]),t}();e.InsideBoundsEnumerator=r;var l=function t(){a(this,t),this.next=null,this.count=0,this.index=0};e.ParticleListNode=l;var c=function(){function t(){a(this,t)}return u(t,[{key:"Allocate",value:function(t,e){return e}},{key:"Clear",value:function(){}},{key:"GetCount",value:function(){return 0}},{key:"Invalidate",value:function(t){}},{key:"GetValidBuffer",value:function(){return[]}},{key:"GetBuffer",value:function(){return[]}},{key:"SetCount",value:function(t){}}]),t}();e.FixedSetAllocator=c;var m=function t(e,i){a(this,t),this.second=T,this.first=e,this.second=i};e.FixtureParticle=m;var _=function(t){s(i,t);var e=o(i);function i(){return a(this,i),e.apply(this,arguments)}return u(i,[{key:"Initialize",value:function(t,e){}},{key:"Find",value:function(t){return T}}]),i}(e.FixedSetAllocator);e.FixtureParticleSet=_;var f=function t(e,i){a(this,t),this.first=T,this.second=T,this.first=e,this.second=i};e.ParticlePair=f;var d=function(t){s(i,t);var e=o(i);function i(){return a(this,i),e.apply(this,arguments)}return u(i,[{key:"Initialize",value:function(t,e){}},{key:"Find",value:function(t){return T}}]),i}(e.FixedSetAllocator);e.b2ParticlePairSet=d;var p=function(){function t(){a(this,t)}return u(t,[{key:"IsNecessary",value:function(t){return!0}},{key:"ShouldCreatePair",value:function(t,e){return!0}},{key:"ShouldCreateTriad",value:function(t,e,i){return!0}}]),t}();e.ConnectionFilter=p;var v=function(t){s(i,t);var e=o(i);function i(t,n,r,s){var o;return a(this,i),(o=e.call(this)).m_callDestructionListener=!1,o.m_destroyed=0,o.m_system=t,o.m_shape=n,o.m_xf=r,o.m_callDestructionListener=s,o.m_destroyed=0,o}return u(i,[{key:"ReportFixture",value:function(t){return!1}},{key:"ReportParticle",value:function(t,e){if(t!==this.m_system)return!1;if(!this.m_system.m_positionBuffer.data)throw new Error;return this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0}},{key:"Destroyed",value:function(){return this.m_destroyed}}]),i}(cr);e.DestroyParticlesInShapeCallback=v;var g=function(t){s(i,t);var e=o(i);function i(t){var n;return a(this,i),(n=e.call(this)).m_threshold=0,n.m_threshold=t,n}return u(i,[{key:"ShouldCreatePair",value:function(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t}},{key:"ShouldCreateTriad",value:function(t,e,i){return(t<this.m_threshold||e<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=i)}}]),i}(e.ConnectionFilter);e.JoinParticleGroupsFilter=g;var x=function(e){s(n,e);var i=o(n);function n(e){var r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;return a(this,n),(r=i.call(this,t.b2ShapeType.e_unknown,0)).m_shapeCount=0,r.m_shapes=e,r.m_shapeCount=s,r}return u(n,[{key:"Clone",value:function(){throw new Error}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){for(var i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(t,e))return!0;return!1}},{key:"ComputeDistance",value:function(t,e,i,n){return 0}},{key:"RayCast",value:function(t,e,i,n){return!1}},{key:"ComputeAABB",value:function(t,e,i){var n=new Me;t.lowerBound.x=+h,t.lowerBound.y=+h,t.upperBound.x=-h,t.upperBound.y=-h;for(var r=0;r<this.m_shapeCount;r++)for(var s=this.m_shapes[r].GetChildCount(),o=0;o<s;o++){var a=n;this.m_shapes[r].ComputeAABB(a,e,o),t.Combine1(a)}}},{key:"ComputeMass",value:function(t,e){}},{key:"SetupDistanceProxy",value:function(t,e){}},{key:"ComputeSubmergedArea",value:function(t,e,i,n){return 0}},{key:"Dump",value:function(t){}}]),n}(sn);e.CompositeShape=x;var b=function(e){s(n,e);var i=o(n);function n(t){var e;return a(this,n),(e=i.call(this)).m_flagsBuffer=t,e}return u(n,[{key:"IsNecessary",value:function(e){if(!this.m_flagsBuffer.data)throw new Error;return 0!==(this.m_flagsBuffer.data[e]&t.b2ParticleFlag.b2_reactiveParticle)}}]),n}(e.ConnectionFilter);e.ReactiveFilter=b;var w=function(i){s(r,i);var n=o(r);function r(t,e){var i;return a(this,r),(i=n.call(this,t)).m_contactFilter=e,i}return u(r,[{key:"ShouldCollideFixtureParticle",value:function(e,i,n){return!(this.m_contactFilter&&this.m_system.GetFlagsBuffer()[n]&t.b2ParticleFlag.b2_fixtureContactFilterParticle)||this.m_contactFilter.ShouldCollideFixtureParticle(e,this.m_system,n)}},{key:"ReportFixtureAndParticle",value:function(i,n,r){var s=e.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_n,o=e.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp;if(!this.m_system.m_flagsBuffer.data)throw new Error;if(!this.m_system.m_positionBuffer.data)throw new Error;var a=this.m_system.m_positionBuffer.data[r],u=s,l=i.ComputeDistance(a,u,n);if(l<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(i,this.m_system,r)){var h=i.GetBody(),c=h.GetWorldCenter(),m=h.GetMass(),_=h.GetInertia()-m*h.GetLocalCenter().LengthSquared(),f=m>0?1/m:0,d=_>0?1/_:0,p=this.m_system.m_flagsBuffer.data[r]&t.b2ParticleFlag.b2_wallParticle?0:this.m_system.GetParticleInvMass(),v=Vt.SubVV(a,c,o),y=Vt.CrossVV(v,u),g=p+f+d*y*y,x=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];x.index=r,x.body=h,x.fixture=i,x.weight=1-l*this.m_system.m_inverseDiameter,x.normal.Copy(u.SelfNeg()),x.mass=g>0?1/g:0,this.m_system.DetectStuckParticle(r)}}}]),r}(Xr);w.ReportFixtureAndParticle_s_n=new Vt,w.ReportFixtureAndParticle_s_rp=new Vt,e.UpdateBodyContactsCallback=w;var A=function(i){s(r,i);var n=o(r);function r(t,e){var i;return a(this,r),(i=n.call(this,t)).m_step=e,i}return u(r,[{key:"ReportFixtureAndParticle",value:function(i,n,r){var s=e.SolveCollisionCallback.ReportFixtureAndParticle_s_p1,o=e.SolveCollisionCallback.ReportFixtureAndParticle_s_output,a=e.SolveCollisionCallback.ReportFixtureAndParticle_s_input,u=e.SolveCollisionCallback.ReportFixtureAndParticle_s_p,l=e.SolveCollisionCallback.ReportFixtureAndParticle_s_v,h=e.SolveCollisionCallback.ReportFixtureAndParticle_s_f,c=i.GetBody();if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var m=this.m_system.m_positionBuffer.data[r],_=this.m_system.m_velocityBuffer.data[r],f=o,d=a;if(0===this.m_system.m_iterationIndex){var p=Dt.MulTXV(c.m_xf0,m,s);i.GetShape().GetType()===t.b2ShapeType.e_circleShape&&(p.SelfSub(c.GetLocalCenter()),Tt.MulRV(c.m_xf0.q,p,p),Tt.MulTRV(c.m_xf.q,p,p),p.SelfAdd(c.GetLocalCenter())),Dt.MulXV(c.m_xf,p,d.p1)}else d.p1.Copy(m);if(Vt.AddVMulSV(m,this.m_step.dt,_,d.p2),d.maxFraction=1,i.RayCast(f,d,n)){var v=f.normal,g=u;g.x=(1-f.fraction)*d.p1.x+f.fraction*d.p2.x+y*v.x,g.y=(1-f.fraction)*d.p1.y+f.fraction*d.p2.y+y*v.y;var x=l;x.x=this.m_step.inv_dt*(g.x-m.x),x.y=this.m_step.inv_dt*(g.y-m.y),this.m_system.m_velocityBuffer.data[r].Copy(x);var b=h;b.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(_.x-x.x),b.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(_.y-x.y),this.m_system.ParticleApplyForce(r,b)}}},{key:"ReportParticle",value:function(t,e){return!1}}]),r}(Xr);A.ReportFixtureAndParticle_s_p1=new Vt,A.ReportFixtureAndParticle_s_output=new Ve,A.ReportFixtureAndParticle_s_input=new Ce,A.ReportFixtureAndParticle_s_p=new Vt,A.ReportFixtureAndParticle_s_v=new Vt,A.ReportFixtureAndParticle_s_f=new Vt,e.SolveCollisionCallback=A}(Kr||(Kr={}));var $r=function(){function e(t){a(this,e),this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new _r,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new Vt,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new fr,this.m_island=new Vr,this.s_stack=[],this.m_controllerList=null,this.m_controllerCount=0,this.m_gravity.Copy(t)}return u(e,[{key:"SetDestructionListener",value:function(t){this.m_destructionListener=t}},{key:"SetContactFilter",value:function(t){this.m_contactManager.m_contactFilter=t}},{key:"SetContactListener",value:function(t){this.m_contactManager.m_contactListener=t}},{key:"SetDebugDraw",value:function(t){this.m_debugDraw=t}},{key:"CreateBody",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.IsLocked())throw new Error;var e=new yn(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e}},{key:"DestroyBody",value:function(t){if(this.IsLocked())throw new Error;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var n=t.m_controllerList;n;){var r=n;n=n.nextController,r.controller.RemoveBody(t)}for(var s=t.m_contactList;s;){var o=s;s=s.next,this.m_contactManager.Destroy(o.contact)}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var u=a;a=a.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(u),u.DestroyProxies(),u.Destroy(),t.m_fixtureList=a,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},{key:"CreateJoint",value:function(t){if(this.IsLocked())throw new Error;var i=e._Joint_Create(t,null);i.m_prev=null,i.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=i),this.m_jointList=i,++this.m_jointCount,i.m_edgeA.prev=null,i.m_edgeA.next=i.m_bodyA.m_jointList,i.m_bodyA.m_jointList&&(i.m_bodyA.m_jointList.prev=i.m_edgeA),i.m_bodyA.m_jointList=i.m_edgeA,i.m_edgeB.prev=null,i.m_edgeB.next=i.m_bodyB.m_jointList,i.m_bodyB.m_jointList&&(i.m_bodyB.m_jointList.prev=i.m_edgeB),i.m_bodyB.m_jointList=i.m_edgeB;var n=t.bodyA,r=t.bodyB;if(!t.collideConnected)for(var s=r.GetContactList();s;)s.other===n&&s.contact.FlagForFiltering(),s=s.next;return i}},{key:"DestroyJoint",value:function(t){if(this.IsLocked())throw new Error;var i=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);var n=t.m_bodyA,r=t.m_bodyB;if(n.SetAwake(!0),r.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===n.m_jointList&&(n.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===r.m_jointList&&(r.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,e._Joint_Destroy(t,null),--this.m_jointCount,!i)for(var s=r.GetContactList();s;)s.other===n&&s.contact.FlagForFiltering(),s=s.next}},{key:"CreateParticleSystem",value:function(t){if(this.IsLocked())throw new Error;var e=new Kr(t,this);return e.m_prev=null,e.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=e),this.m_particleSystemList=e,e}},{key:"DestroyParticleSystem",value:function(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next)}},{key:"CalculateReasonableParticleIterations",value:function(t){if(null===this.m_particleSystemList)return 1;function e(t){for(var e=h,i=t.GetParticleSystemList();null!==i;i=i.m_next)e=at(e,i.GetRadius());return e}return kr(this.m_gravity.Length(),e(this),t)}},{key:"Step",value:function(t,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.CalculateReasonableParticleIterations(t),s=e.Step_s_stepTimer.Reset();this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0;var o=e.Step_s_step;o.dt=t,o.velocityIterations=i,o.positionIterations=n,o.particleIterations=r,o.inv_dt=t>0?1/t:0,o.dtRatio=this.m_inv_dt0*t,o.warmStarting=this.m_warmStarting;var a=e.Step_s_timer.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=a.GetMilliseconds(),this.m_stepComplete&&o.dt>0){for(var u=e.Step_s_timer.Reset(),l=this.m_particleSystemList;l;l=l.m_next)l.Solve(o);this.Solve(o),this.m_profile.solve=u.GetMilliseconds()}if(this.m_continuousPhysics&&o.dt>0){var h=e.Step_s_timer.Reset();this.SolveTOI(o),this.m_profile.solveTOI=h.GetMilliseconds()}o.dt>0&&(this.m_inv_dt0=o.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=s.GetMilliseconds()}},{key:"ClearForces",value:function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0}},{key:"DrawParticleSystem",value:function(t){if(null!==this.m_debugDraw){var e=t.GetParticleCount();if(e){var i=t.GetRadius(),n=t.GetPositionBuffer();if(t.m_colorBuffer.data){var r=t.GetColorBuffer();this.m_debugDraw.DrawParticles(n,i,r,e)}else this.m_debugDraw.DrawParticles(n,i,null,e)}}}},{key:"DrawDebugData",value:function(){if(null!==this.m_debugDraw){var i=this.m_debugDraw.GetFlags(),n=e.DrawDebugData_s_color.SetRGB(0,0,0);if(i&t.b2DrawFlags.e_shapeBit)for(var r=this.m_bodyList;r;r=r.m_next){var s=r.m_xf;this.m_debugDraw.PushTransform(s);for(var o=r.GetFixtureList();o;o=o.m_next)r.IsActive()?r.GetType()===t.b2BodyType.b2_staticBody?(n.SetRGB(.5,.9,.5),this.DrawShape(o,n)):r.GetType()===t.b2BodyType.b2_kinematicBody?(n.SetRGB(.5,.5,.9),this.DrawShape(o,n)):r.IsAwake()?(n.SetRGB(.9,.7,.7),this.DrawShape(o,n)):(n.SetRGB(.6,.6,.6),this.DrawShape(o,n)):(n.SetRGB(.5,.5,.3),this.DrawShape(o,n));this.m_debugDraw.PopTransform(s)}if(i&t.b2DrawFlags.e_particleBit)for(var a=this.m_particleSystemList;a;a=a.m_next)this.DrawParticleSystem(a);if(i&t.b2DrawFlags.e_jointBit)for(var u=this.m_jointList;u;u=u.m_next)this.DrawJoint(u);if(i&t.b2DrawFlags.e_aabbBit){n.SetRGB(.9,.3,.9);for(var l=e.DrawDebugData_s_vs,h=this.m_bodyList;h;h=h.m_next)if(h.IsActive())for(var c=h.GetFixtureList();c;c=c.m_next)for(var m=0;m<c.m_proxyCount;++m){var _=c.m_proxies[m].treeNode.aabb;l[0].Set(_.lowerBound.x,_.lowerBound.y),l[1].Set(_.upperBound.x,_.lowerBound.y),l[2].Set(_.upperBound.x,_.upperBound.y),l[3].Set(_.lowerBound.x,_.upperBound.y),this.m_debugDraw.DrawPolygon(l,4,n)}}if(i&t.b2DrawFlags.e_centerOfMassBit)for(var f=this.m_bodyList;f;f=f.m_next){var d=e.DrawDebugData_s_xf;d.q.Copy(f.m_xf.q),d.p.Copy(f.GetWorldCenter()),this.m_debugDraw.DrawTransform(d)}if(i&t.b2DrawFlags.e_controllerBit)for(var p=this.m_controllerList;p;p=p.m_next)p.Draw(this.m_debugDraw)}}},{key:"QueryAABB",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.Query(e,(function(e){var n=e.userData.fixture;return t?t.ReportFixture(n):!i||i(n)})),t instanceof cr)for(var n=this.m_particleSystemList;n;n=n.m_next)t.ShouldQueryParticleSystem(n)&&n.QueryAABB(t,e)}},{key:"QueryAllAABB",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryAABB(null,t,(function(t){return e.push(t),!0})),e}},{key:"QueryPointAABB",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,(function(e){var n=e.userData.fixture;return t?t.ReportFixture(n):!i||i(n)})),t instanceof cr)for(var n=this.m_particleSystemList;n;n=n.m_next)t.ShouldQueryParticleSystem(n)&&n.QueryPointAABB(t,e)}},{key:"QueryAllPointAABB",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryPointAABB(null,t,(function(t){return e.push(t),!0})),e}},{key:"QueryFixtureShape",value:function(t,i,n,r,s){var o=e.QueryFixtureShape_s_aabb;if(i.ComputeAABB(o,r,n),this.m_contactManager.m_broadPhase.Query(o,(function(e){var o=e.userData,a=o.fixture;if(Ge(i,n,a.GetShape(),o.childIndex,r,a.GetBody().GetTransform())){if(t)return t.ReportFixture(a);if(s)return s(a)}return!0})),t instanceof cr)for(var a=this.m_particleSystemList;a;a=a.m_next)t.ShouldQueryParticleSystem(a)&&a.QueryAABB(t,o)}},{key:"QueryAllFixtureShape",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return this.QueryFixtureShape(null,t,e,i,(function(t){return n.push(t),!0})),n}},{key:"QueryFixturePoint",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,(function(n){var r=n.userData.fixture;if(r.TestPoint(e)){if(t)return t.ReportFixture(r);if(i)return i(r)}return!0})),t)for(var n=this.m_particleSystemList;n;n=n.m_next)t.ShouldQueryParticleSystem(n)&&n.QueryPointAABB(t,e)}},{key:"QueryAllFixturePoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryFixturePoint(null,t,(function(t){return e.push(t),!0})),e}},{key:"RayCast",value:function(t,i,n,r){var s=e.RayCast_s_input;if(s.maxFraction=1,s.p1.Copy(i),s.p2.Copy(n),this.m_contactManager.m_broadPhase.RayCast(s,(function(s,o){var a=o.userData,u=a.fixture,l=a.childIndex,h=e.RayCast_s_output;if(u.RayCast(h,s,l)){var c=h.fraction,m=e.RayCast_s_point;if(m.Set((1-c)*i.x+c*n.x,(1-c)*i.y+c*n.y),t)return t.ReportFixture(u,m,h.normal,c);if(r)return r(u,m,h.normal,c)}return s.maxFraction})),t)for(var o=this.m_particleSystemList;o;o=o.m_next)t.ShouldQueryParticleSystem(o)&&o.RayCast(t,i,n)}},{key:"RayCastOne",value:function(t,e){var i=null,n=1;return this.RayCast(null,t,e,(function(t,e,r,s){return s<n&&(n=s,i=t),n})),i}},{key:"RayCastAll",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.RayCast(null,t,e,(function(t,e,n,r){return i.push(t),1})),i}},{key:"GetBodyList",value:function(){return this.m_bodyList}},{key:"GetJointList",value:function(){return this.m_jointList}},{key:"GetParticleSystemList",value:function(){return this.m_particleSystemList}},{key:"GetContactList",value:function(){return this.m_contactManager.m_contactList}},{key:"SetAllowSleeping",value:function(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)}},{key:"GetAllowSleeping",value:function(){return this.m_allowSleep}},{key:"SetWarmStarting",value:function(t){this.m_warmStarting=t}},{key:"GetWarmStarting",value:function(){return this.m_warmStarting}},{key:"SetContinuousPhysics",value:function(t){this.m_continuousPhysics=t}},{key:"GetContinuousPhysics",value:function(){return this.m_continuousPhysics}},{key:"SetSubStepping",value:function(t){this.m_subStepping=t}},{key:"GetSubStepping",value:function(){return this.m_subStepping}},{key:"GetProxyCount",value:function(){return this.m_contactManager.m_broadPhase.GetProxyCount()}},{key:"GetBodyCount",value:function(){return this.m_bodyCount}},{key:"GetJointCount",value:function(){return this.m_jointCount}},{key:"GetContactCount",value:function(){return this.m_contactManager.m_contactCount}},{key:"GetTreeHeight",value:function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}},{key:"GetTreeBalance",value:function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}},{key:"GetTreeQuality",value:function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}},{key:"SetGravity",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Vt.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(var i=this.m_bodyList;i;i=i.m_next)i.SetAwake(!0)}},{key:"GetGravity",value:function(){return this.m_gravity}},{key:"IsLocked",value:function(){return this.m_locked}},{key:"SetAutoClearForces",value:function(t){this.m_clearForces=t}},{key:"GetAutoClearForces",value:function(){return this.m_clearForces}},{key:"ShiftOrigin",value:function(t){if(this.IsLocked())throw new Error;for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(var i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}},{key:"GetContactManager",value:function(){return this.m_contactManager}},{key:"GetProfile",value:function(){return this.m_profile}},{key:"Dump",value:function(e){if(!this.m_locked){e("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),e("this.m_world.SetGravity(g);\n"),e("const bodies: b2Body[] = [];\n"),e("const joints: b2Joint[] = [];\n");for(var i=0,n=this.m_bodyList;n;n=n.m_next)n.m_islandIndex=i,n.Dump(e),++i;i=0;for(var r=this.m_jointList;r;r=r.m_next)r.m_index=i,++i;for(var s=this.m_jointList;s;s=s.m_next)s.m_type!==t.b2JointType.e_gearJoint&&(e("{\n"),s.Dump(e),e("}\n"));for(var o=this.m_jointList;o;o=o.m_next)o.m_type===t.b2JointType.e_gearJoint&&(e("{\n"),o.Dump(e),e("}\n"))}}},{key:"DrawJoint",value:function(i){if(null!==this.m_debugDraw){var n=i.GetBodyA(),r=i.GetBodyB(),s=n.m_xf,o=r.m_xf,a=s.p,u=o.p,l=i.GetAnchorA(e.DrawJoint_s_p1),h=i.GetAnchorB(e.DrawJoint_s_p2),c=e.DrawJoint_s_color.SetRGB(.5,.8,.8);switch(i.m_type){case t.b2JointType.e_distanceJoint:this.m_debugDraw.DrawSegment(l,h,c);break;case t.b2JointType.e_pulleyJoint:var m=i,_=m.GetGroundAnchorA(),f=m.GetGroundAnchorB();this.m_debugDraw.DrawSegment(_,l,c),this.m_debugDraw.DrawSegment(f,h,c),this.m_debugDraw.DrawSegment(_,f,c);break;case t.b2JointType.e_mouseJoint:var d=e.DrawJoint_s_c;d.Set(0,1,0),this.m_debugDraw.DrawPoint(l,4,d),this.m_debugDraw.DrawPoint(h,4,d),d.Set(.8,.8,.8),this.m_debugDraw.DrawSegment(l,h,d);break;default:this.m_debugDraw.DrawSegment(a,l,c),this.m_debugDraw.DrawSegment(l,h,c),this.m_debugDraw.DrawSegment(u,h,c)}}}},{key:"DrawShape",value:function(i,n){if(null!==this.m_debugDraw){var r=i.GetShape();switch(r.m_type){case t.b2ShapeType.e_circleShape:var s=r,o=s.m_p,a=s.m_radius,u=Vt.UNITX;this.m_debugDraw.DrawSolidCircle(o,a,u,n);break;case t.b2ShapeType.e_edgeShape:var l=r,h=l.m_vertex1,c=l.m_vertex2;this.m_debugDraw.DrawSegment(h,c,n);break;case t.b2ShapeType.e_chainShape:var m=r,_=m.m_count,f=m.m_vertices,d=e.DrawShape_s_ghostColor.SetRGBA(.75*n.r,.75*n.g,.75*n.b,n.a),p=f[0];if(this.m_debugDraw.DrawPoint(p,4,n),m.m_hasPrevVertex){var v=m.m_prevVertex;this.m_debugDraw.DrawSegment(v,p,d),this.m_debugDraw.DrawCircle(v,.1,d)}for(var y=1;y<_;++y){var g=f[y];this.m_debugDraw.DrawSegment(p,g,n),this.m_debugDraw.DrawPoint(g,4,n),p=g}if(m.m_hasNextVertex){var x=m.m_nextVertex;this.m_debugDraw.DrawSegment(x,p,d),this.m_debugDraw.DrawCircle(x,.1,d)}break;case t.b2ShapeType.e_polygonShape:var b=r,w=b.m_count,A=b.m_vertices;this.m_debugDraw.DrawSolidPolygon(A,w,n)}}}},{key:"Solve",value:function(e){for(var i=this.m_bodyList;i;i=i.m_next)i.m_xf0.Copy(i.m_xf);for(var n=this.m_controllerList;n;n=n.m_next)n.Step(e);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var r=this.m_island;r.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener);for(var s=this.m_bodyList;s;s=s.m_next)s.m_islandFlag=!1;for(var o=this.m_contactManager.m_contactList;o;o=o.m_next)o.m_islandFlag=!1;for(var a=this.m_jointList;a;a=a.m_next)a.m_islandFlag=!1;for(var u=this.s_stack,l=this.m_bodyList;l;l=l.m_next)if(!l.m_islandFlag&&l.IsAwake()&&l.IsActive()&&l.GetType()!==t.b2BodyType.b2_staticBody){r.Clear();var h=0;for(u[h++]=l,l.m_islandFlag=!0;h>0;){var c=u[--h];if(!c)throw new Error;if(r.AddBody(c),c.m_awakeFlag=!0,c.GetType()!==t.b2BodyType.b2_staticBody){for(var m=c.m_contactList;m;m=m.next){var _=m.contact;if(!_.m_islandFlag&&_.IsEnabled()&&_.IsTouching()){var f=_.m_fixtureA.m_isSensor,d=_.m_fixtureB.m_isSensor;if(!f&&!d){r.AddContact(_),_.m_islandFlag=!0;var p=m.other;if(!p)throw new Error;p.m_islandFlag||(u[h++]=p,p.m_islandFlag=!0)}}}for(var v=c.m_jointList;v;v=v.next)if(!v.joint.m_islandFlag){var y=v.other;y.IsActive()&&(r.AddJoint(v.joint),v.joint.m_islandFlag=!0,y.m_islandFlag||(u[h++]=y,y.m_islandFlag=!0))}}}var g=new fr;r.Solve(g,e,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=g.solveInit,this.m_profile.solveVelocity+=g.solveVelocity,this.m_profile.solvePosition+=g.solvePosition;for(var x=0;x<r.m_bodyCount;++x){var b=r.m_bodies[x];b.GetType()===t.b2BodyType.b2_staticBody&&(b.m_islandFlag=!1)}}for(var w=0;w<u.length&&u[w];++w)u[w]=null;for(var A=new Lt,S=this.m_bodyList;S;S=S.m_next)S.m_islandFlag&&S.GetType()!==t.b2BodyType.b2_staticBody&&S.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=A.GetMilliseconds()}},{key:"SolveTOI",value:function(i){var n=this.m_island;if(n.Initialize(2*w,w,0,null,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var r=this.m_bodyList;r;r=r.m_next)r.m_islandFlag=!1,r.m_sweep.alpha0=0;for(var s=this.m_contactManager.m_contactList;s;s=s.m_next)s.m_toiFlag=!1,s.m_islandFlag=!1,s.m_toiCount=0,s.m_toi=1}for(;;){for(var o=null,a=1,u=this.m_contactManager.m_contactList;u;u=u.m_next)if(u.IsEnabled()&&!(u.m_toiCount>b)){var l=1;if(u.m_toiFlag)l=u.m_toi;else{var h=u.GetFixtureA(),m=u.GetFixtureB();if(h.IsSensor()||m.IsSensor())continue;var _=h.GetBody(),f=m.GetBody(),d=_.m_type,p=f.m_type,v=_.IsAwake()&&d!==t.b2BodyType.b2_staticBody,y=f.IsAwake()&&p!==t.b2BodyType.b2_staticBody;if(!v&&!y)continue;var g=_.IsBullet()||d!==t.b2BodyType.b2_dynamicBody,x=f.IsBullet()||p!==t.b2BodyType.b2_dynamicBody;if(!g&&!x)continue;var A=_.m_sweep.alpha0;_.m_sweep.alpha0<f.m_sweep.alpha0?(A=f.m_sweep.alpha0,_.m_sweep.Advance(A)):f.m_sweep.alpha0<_.m_sweep.alpha0&&(A=_.m_sweep.alpha0,f.m_sweep.Advance(A));var S=u.GetChildIndexA(),B=u.GetChildIndexB(),C=e.SolveTOI_s_toi_input;C.proxyA.SetShape(h.GetShape(),S),C.proxyB.SetShape(m.GetShape(),B),C.sweepA.Copy(_.m_sweep),C.sweepB.Copy(f.m_sweep),C.tMax=1;var V=e.SolveTOI_s_toi_output;li(V,C);var M=V.t;l=V.state===t.b2TOIOutputState.e_touching?at(A+(1-A)*M,1):1,u.m_toi=l,u.m_toiFlag=!0}l<a&&(o=u,a=l)}if(null===o||1-10*c<a){this.m_stepComplete=!0;break}var k=o.GetFixtureA(),P=o.GetFixtureB(),I=k.GetBody(),T=P.GetBody(),D=e.SolveTOI_s_backup1.Copy(I.m_sweep),G=e.SolveTOI_s_backup2.Copy(T.m_sweep);if(I.Advance(a),T.Advance(a),o.Update(this.m_contactManager.m_contactListener),o.m_toiFlag=!1,++o.m_toiCount,o.IsEnabled()&&o.IsTouching()){I.SetAwake(!0),T.SetAwake(!0),n.Clear(),n.AddBody(I),n.AddBody(T),n.AddContact(o),I.m_islandFlag=!0,T.m_islandFlag=!0,o.m_islandFlag=!0;for(var R=0;R<2;++R){var E=0===R?I:T;if(E.m_type===t.b2BodyType.b2_dynamicBody)for(var F=E.m_contactList;F&&n.m_bodyCount!==n.m_bodyCapacity&&n.m_contactCount!==n.m_contactCapacity;F=F.next){var L=F.contact;if(!L.m_islandFlag){var j=F.other;if(j.m_type!==t.b2BodyType.b2_dynamicBody||E.IsBullet()||j.IsBullet()){var O=L.m_fixtureA.m_isSensor,N=L.m_fixtureB.m_isSensor;if(!O&&!N){var q=e.SolveTOI_s_backup.Copy(j.m_sweep);j.m_islandFlag||j.Advance(a),L.Update(this.m_contactManager.m_contactListener),L.IsEnabled()&&L.IsTouching()?(L.m_islandFlag=!0,n.AddContact(L),j.m_islandFlag||(j.m_islandFlag=!0,j.m_type!==t.b2BodyType.b2_staticBody&&j.SetAwake(!0),n.AddBody(j))):(j.m_sweep.Copy(q),j.SynchronizeTransform())}}}}}var z=e.SolveTOI_s_subStep;z.dt=(1-a)*i.dt,z.inv_dt=1/z.dt,z.dtRatio=1,z.positionIterations=20,z.velocityIterations=i.velocityIterations,z.particleIterations=i.particleIterations,z.warmStarting=!1,n.SolveTOI(z,I.m_islandIndex,T.m_islandIndex);for(var U=0;U<n.m_bodyCount;++U){var J=n.m_bodies[U];if(J.m_islandFlag=!1,J.m_type===t.b2BodyType.b2_dynamicBody){J.SynchronizeFixtures();for(var X=J.m_contactList;X;X=X.next)X.contact.m_toiFlag=!1,X.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else o.SetEnabled(!1),I.m_sweep.Copy(D),T.m_sweep.Copy(G),I.SynchronizeTransform(),T.SynchronizeTransform()}}},{key:"AddController",value:function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t}},{key:"RemoveController",value:function(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t}}],[{key:"_Joint_Create",value:function(e,i){switch(e.type){case t.b2JointType.e_distanceJoint:return new Sn(e);case t.b2JointType.e_mouseJoint:return new Gn(e);case t.b2JointType.e_prismaticJoint:return new En(e);case t.b2JointType.e_revoluteJoint:return new Nn(e);case t.b2JointType.e_pulleyJoint:return new jn(e);case t.b2JointType.e_gearJoint:return new Pn(e);case t.b2JointType.e_wheelJoint:return new Yn(e);case t.b2JointType.e_weldJoint:return new Jn(e);case t.b2JointType.e_frictionJoint:return new Mn(e);case t.b2JointType.e_ropeJoint:return new zn(e);case t.b2JointType.e_motorJoint:return new Tn(e);case t.b2JointType.e_areaJoint:return new Cn(e)}throw new Error}},{key:"_Joint_Destroy",value:function(t,e){}}]),e}();$r.Step_s_step=new dr,$r.Step_s_stepTimer=new Lt,$r.Step_s_timer=new Lt,$r.DrawDebugData_s_color=new Et(0,0,0),$r.DrawDebugData_s_vs=Vt.MakeArray(4),$r.DrawDebugData_s_xf=new Dt,$r.QueryFixtureShape_s_aabb=new Me,$r.RayCast_s_input=new Ce,$r.RayCast_s_output=new Ve,$r.RayCast_s_point=new Vt,$r.DrawJoint_s_p1=new Vt,$r.DrawJoint_s_p2=new Vt,$r.DrawJoint_s_color=new Et(.5,.8,.8),$r.DrawJoint_s_c=new Et,$r.DrawShape_s_ghostColor=new Et,$r.SolveTOI_s_subStep=new dr,$r.SolveTOI_s_backup=new Rt,$r.SolveTOI_s_backup1=new Rt,$r.SolveTOI_s_backup2=new Rt,$r.SolveTOI_s_toi_input=new He,$r.SolveTOI_s_toi_output=new Ke;var ts=function t(e,i){a(this,t),this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=e,this.body=i},es=function(){function t(){a(this,t),this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null}return u(t,[{key:"GetNext",value:function(){return this.m_next}},{key:"GetPrev",value:function(){return this.m_prev}},{key:"GetBodyList",value:function(){return this.m_bodyList}},{key:"AddBody",value:function(t){var e=new ts(this,t);e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=e),this.m_bodyList=e,++this.m_bodyCount,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=e),t.m_controllerList=e,++t.m_controllerCount}},{key:"RemoveBody",value:function(t){if(this.m_bodyCount<=0)throw new Error;for(var e=this.m_bodyList;e&&e.body!==t;)e=e.nextBody;if(null===e)throw new Error;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),this.m_bodyList===e&&(this.m_bodyList=e.nextBody),--this.m_bodyCount,e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),t.m_controllerList===e&&(t.m_controllerList=e.nextController),--t.m_controllerCount}},{key:"Clear",value:function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0}}]),t}(),is=function(t){s(i,t);var e=o(i);function i(){var t;return a(this,i),(t=e.apply(this,arguments)).normal=new Vt(0,1),t.offset=0,t.density=0,t.velocity=new Vt(0,0),t.linearDrag=0,t.angularDrag=0,t.useDensity=!1,t.useWorldGravity=!0,t.gravity=new Vt(0,0),t}return u(i,[{key:"Step",value:function(t){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(i.IsAwake()){for(var n=new Vt,r=new Vt,s=0,o=0,a=i.GetFixtureList();a;a=a.m_next){var u=new Vt,l=a.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),u);s+=l,n.x+=l*u.x,n.y+=l*u.y;var h=0;o+=l*(h=this.useDensity?a.GetDensity():1),r.x+=l*u.x*h,r.y+=l*u.y*h}if(n.x/=s,n.y/=s,r.x/=o,r.y/=o,!(s<c)){var m=this.gravity.Clone().SelfNeg();m.SelfMul(this.density*s),i.ApplyForce(m,r);var _=i.GetLinearVelocityFromWorldPoint(n,new Vt);_.SelfSub(this.velocity),_.SelfMul(-this.linearDrag*s),i.ApplyForce(_,n),i.ApplyTorque(-i.GetInertia()/i.GetMass()*s*i.GetAngularVelocity()*this.angularDrag)}}}}}},{key:"Draw",value:function(t){var e=100,i=new Vt,n=new Vt;i.x=this.normal.x*this.offset+this.normal.y*e,i.y=this.normal.y*this.offset-this.normal.x*e,n.x=this.normal.x*this.offset-this.normal.y*e,n.y=this.normal.y*this.offset+this.normal.x*e;var r=new Et(0,0,.8);t.DrawSegment(i,n,r)}}]),i}(es),ns=function(t){s(i,t);var e=o(i);function i(){var t;return a(this,i),(t=e.apply(this,arguments)).A=new Vt(0,0),t}return u(i,[{key:"Step",value:function(t){for(var e=Vt.MulSV(t.dt,this.A,i.Step_s_dtA),n=this.m_bodyList;n;n=n.nextBody){var r=n.body;r.IsAwake()&&r.SetLinearVelocity(Vt.AddVV(r.GetLinearVelocity(),e,Vt.s_t0))}}},{key:"Draw",value:function(t){}}]),i}(es);ns.Step_s_dtA=new Vt;var rs=function(t){s(i,t);var e=o(i);function i(){var t;return a(this,i),(t=e.apply(this,arguments)).F=new Vt(0,0),t}return u(i,[{key:"Step",value:function(t){for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;i.IsAwake()&&i.ApplyForce(this.F,i.GetWorldCenter())}}},{key:"Draw",value:function(t){}}]),i}(es),ss=function(t){s(i,t);var e=o(i);function i(){var t;return a(this,i),(t=e.apply(this,arguments)).G=1,t.invSqr=!0,t}return u(i,[{key:"Step",value:function(t){if(this.invSqr)for(var e=this.m_bodyList;e;e=e.nextBody)for(var n=e.body,r=n.GetWorldCenter(),s=n.GetMass(),o=this.m_bodyList;o&&o!==e;o=o.nextBody){var a=o.body,u=a.GetWorldCenter(),l=a.GetMass(),h=u.x-r.x,m=u.y-r.y,_=h*h+m*m;if(!(_<c)){var f=i.Step_s_f.Set(h,m);f.SelfMul(this.G/_/ft(_)*s*l),n.IsAwake()&&n.ApplyForce(f,r),a.IsAwake()&&a.ApplyForce(f.SelfMul(-1),u)}}else for(var d=this.m_bodyList;d;d=d.nextBody)for(var p=d.body,v=p.GetWorldCenter(),y=p.GetMass(),g=this.m_bodyList;g&&g!==d;g=g.nextBody){var x=g.body,b=x.GetWorldCenter(),w=x.GetMass(),A=b.x-v.x,S=b.y-v.y,B=A*A+S*S;if(!(B<c)){var C=i.Step_s_f.Set(A,S);C.SelfMul(this.G/B*y*w),p.IsAwake()&&p.ApplyForce(C,v),x.IsAwake()&&x.ApplyForce(C.SelfMul(-1),b)}}}},{key:"Draw",value:function(t){}}]),i}(es);ss.Step_s_f=new Vt;var os=function(t){s(i,t);var e=o(i);function i(){var t;return a(this,i),(t=e.apply(this,arguments)).T=new Pt,t.maxTimestep=0,t}return u(i,[{key:"Step",value:function(t){var e=t.dt;if(!(e<=c)){e>this.maxTimestep&&this.maxTimestep>0&&(e=this.maxTimestep);for(var n=this.m_bodyList;n;n=n.nextBody){var r=n.body;if(r.IsAwake()){var s=r.GetWorldVector(Pt.MulMV(this.T,r.GetLocalVector(r.GetLinearVelocity(),Vt.s_t0),Vt.s_t1),i.Step_s_damping);r.SetLinearVelocity(Vt.AddVV(r.GetLinearVelocity(),Vt.MulSV(e,s,Vt.s_t0),Vt.s_t1))}}}}},{key:"Draw",value:function(t){}},{key:"SetAxisAligned",value:function(t,e){this.T.ex.x=-t,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-e,this.maxTimestep=t>0||e>0?1/ut(t,e):0}}]),i}(es);os.Step_s_damping=new Vt;var as=function t(){a(this,t),this.vertices=[],this.count=0,this.masses=[],this.gravity=new Vt(0,0),this.damping=.1,this.k2=.9,this.k3=.1},us=function(){function t(){a(this,t),this.m_count=0,this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_ims=[],this.m_Ls=[],this.m_as=[],this.m_gravity=new Vt,this.m_damping=0,this.m_k2=1,this.m_k3=.1}return u(t,[{key:"GetVertexCount",value:function(){return this.m_count}},{key:"GetVertices",value:function(){return this.m_ps}},{key:"Initialize",value:function(t){this.m_count=t.count,this.m_ps=Vt.MakeArray(this.m_count),this.m_p0s=Vt.MakeArray(this.m_count),this.m_vs=Vt.MakeArray(this.m_count),this.m_ims=it(this.m_count);for(var e=0;e<this.m_count;++e){this.m_ps[e].Copy(t.vertices[e]),this.m_p0s[e].Copy(t.vertices[e]),this.m_vs[e].SetZero();var i=t.masses[e];this.m_ims[e]=i>0?1/i:0}var n=this.m_count-1,r=this.m_count-2;this.m_Ls=it(n),this.m_as=it(r);for(var s=0;s<n;++s){var o=this.m_ps[s],a=this.m_ps[s+1];this.m_Ls[s]=Vt.DistanceVV(o,a)}for(var u=0;u<r;++u){var l=this.m_ps[u],h=this.m_ps[u+1],c=this.m_ps[u+2],m=Vt.SubVV(h,l,Vt.s_t0),_=Vt.SubVV(c,h,Vt.s_t1),f=Vt.CrossVV(m,_),d=Vt.DotVV(m,_);this.m_as[u]=wt(f,d)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3}},{key:"Step",value:function(t,e){if(0!==t){for(var i=Math.exp(-t*this.m_damping),n=0;n<this.m_count;++n)this.m_p0s[n].Copy(this.m_ps[n]),this.m_ims[n]>0&&this.m_vs[n].SelfMulAdd(t,this.m_gravity),this.m_vs[n].SelfMul(i),this.m_ps[n].SelfMulAdd(t,this.m_vs[n]);for(var r=0;r<e;++r)this.SolveC2(),this.SolveC3(),this.SolveC2();for(var s=1/t,o=0;o<this.m_count;++o)Vt.MulSV(s,Vt.SubVV(this.m_ps[o],this.m_p0s[o],Vt.s_t0),this.m_vs[o])}}},{key:"SolveC2",value:function(){for(var e=this.m_count-1,i=0;i<e;++i){var n=this.m_ps[i],r=this.m_ps[i+1],s=Vt.SubVV(r,n,t.s_d),o=s.Normalize(),a=this.m_ims[i],u=this.m_ims[i+1];if(a+u!==0){var l=a/(a+u),h=u/(a+u);n.SelfMulSub(this.m_k2*l*(this.m_Ls[i]-o),s),r.SelfMulAdd(this.m_k2*h*(this.m_Ls[i]-o),s)}}}},{key:"SetAngle",value:function(t){for(var e=this.m_count-2,i=0;i<e;++i)this.m_as[i]=t}},{key:"SolveC3",value:function(){for(var e=this.m_count-2,i=0;i<e;++i){var n=this.m_ps[i],r=this.m_ps[i+1],s=this.m_ps[i+2],o=this.m_ims[i],a=this.m_ims[i+1],u=this.m_ims[i+2],l=Vt.SubVV(r,n,t.s_d1),h=Vt.SubVV(s,r,t.s_d2),c=l.LengthSquared(),m=h.LengthSquared();if(c*m!==0){var f=Vt.CrossVV(l,h),d=Vt.DotVV(l,h),p=wt(f,d),v=Vt.MulSV(-1/c,l.SelfSkew(),t.s_Jd1),y=Vt.MulSV(1/m,h.SelfSkew(),t.s_Jd2),g=Vt.NegV(v,t.s_J1),x=Vt.SubVV(v,y,t.s_J2),b=y,w=o*Vt.DotVV(g,g)+a*Vt.DotVV(x,x)+u*Vt.DotVV(b,b);if(0!==w){w=1/w;for(var A=p-this.m_as[i];A>_;)A=(p-=2*_)-this.m_as[i];for(;A<-_;)A=(p+=2*_)-this.m_as[i];var S=-this.m_k3*w*A;n.SelfMulAdd(o*S,g),r.SelfMulAdd(a*S,x),s.SelfMulAdd(u*S,b)}}}}},{key:"Draw",value:function(t){for(var e=new Et(.4,.5,.7),i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],e)}}]),t}();us.s_d=new Vt,us.s_d1=new Vt,us.s_d2=new Vt,us.s_Jd1=new Vt,us.s_Jd2=new Vt,us.s_J1=new Vt,us.s_J2=new Vt,t.b2Assert=e,t.b2Maybe=i,t.b2_maxFloat=h,t.b2_epsilon=c,t.b2_epsilon_sq=m,t.b2_pi=_,t.b2_maxManifoldPoints=f,t.b2_maxPolygonVertices=d,t.b2_aabbExtension=p,t.b2_aabbMultiplier=v,t.b2_linearSlop=y,t.b2_angularSlop=g,t.b2_polygonRadius=x,t.b2_maxSubSteps=b,t.b2_maxTOIContacts=w,t.b2_velocityThreshold=A,t.b2_maxLinearCorrection=S,t.b2_maxAngularCorrection=B,t.b2_maxTranslation=C,t.b2_maxTranslationSquared=V,t.b2_maxRotation=M,t.b2_maxRotationSquared=k,t.b2_baumgarte=P,t.b2_toiBaumgarte=I,t.b2_invalidParticleIndex=T,t.b2_maxParticleIndex=D,t.b2_particleStride=G,t.b2_minParticleWeight=R,t.b2_maxParticlePressure=E,t.b2_maxParticleForce=F,t.b2_maxTriadDistance=L,t.b2_maxTriadDistanceSquared=j,t.b2_minParticleSystemBufferCapacity=O,t.b2_barrierCollisionTime=N,t.b2_timeToSleep=q,t.b2_linearSleepTolerance=z,t.b2_angularSleepTolerance=U,t.b2Alloc=J,t.b2Free=X,t.b2Log=Y,t.b2Version=W,t.b2_version=Z,t.b2_branch=H,t.b2_commit=Q,t.b2ParseInt=K,t.b2ParseUInt=$,t.b2MakeArray=tt,t.b2MakeNullArray=et,t.b2MakeNumberArray=it,t.b2_pi_over_180=nt,t.b2_180_over_pi=rt,t.b2_two_pi=st,t.b2Abs=ot,t.b2Min=at,t.b2Max=ut,t.b2Clamp=lt,t.b2Swap=ht,t.b2IsValid=ct,t.b2Sq=mt,t.b2InvSqrt=_t,t.b2Sqrt=ft,t.b2Pow=dt,t.b2DegToRad=pt,t.b2RadToDeg=vt,t.b2Cos=yt,t.b2Sin=gt,t.b2Acos=xt,t.b2Asin=bt,t.b2Atan2=wt,t.b2NextPowerOfTwo=At,t.b2IsPowerOfTwo=St,t.b2Random=Bt,t.b2RandomRange=Ct,t.b2Vec2=Vt,t.b2Vec2_zero=Mt,t.b2Vec3=kt,t.b2Mat22=Pt,t.b2Mat33=It,t.b2Rot=Tt,t.b2Transform=Dt,t.b2Sweep=Rt,t.b2Color=Et,t.b2Draw=Ft,t.b2Timer=Lt,t.b2Counter=jt,t.b2GrowableStack=Ot,t.b2BlockAllocator=Nt,t.b2StackAllocator=qt,t.b2ContactFeature=ye,t.b2ContactID=ge,t.b2ManifoldPoint=xe,t.b2Manifold=we,t.b2WorldManifold=Ae,t.b2GetPointStates=Se,t.b2ClipVertex=Be,t.b2RayCastInput=Ce,t.b2RayCastOutput=Ve,t.b2AABB=Me,t.b2TestOverlapAABB=ke,t.b2ClipSegmentToLine=Pe,t.b2TestOverlapShape=Ge,t.b2DistanceProxy=zt,t.b2SimplexCache=Ut,t.b2DistanceInput=Jt,t.b2DistanceOutput=Xt,t.b2ShapeCastInput=Yt,t.b2ShapeCastOutput=Wt,t.b2_gjk_reset=Zt,t.b2SimplexVertex=Ht,t.b2Simplex=Qt,t.b2Distance=oe,t.b2ShapeCast=pe,t.b2Pair=Le,t.b2BroadPhase=je,t.b2PairLessThan=Oe,t.b2TreeNode=Ee,t.b2DynamicTree=Fe,t.b2_toi_reset=Ne,t.b2TOIInput=He,t.b2TOIOutput=Ke,t.b2SeparationFunction=$e,t.b2TimeOfImpact=li,t.b2CollideCircles=mi,t.b2CollidePolygonAndCircle=pi,t.b2CollidePolygons=Oi,t.b2CollideEdgeAndCircle=Zi,t.b2CollideEdgeAndPolygon=en,t.b2MassData=rn,t.b2Shape=sn,t.b2CircleShape=on,t.b2PolygonShape=an,t.b2EdgeShape=un,t.b2ChainShape=ln,t.b2Filter=hn,t.b2FixtureDef=mn,t.b2FixtureProxy=_n,t.b2Fixture=fn,t.b2BodyDef=vn,t.b2Body=yn,t.b2World=$r,t.b2DestructionListener=ar,t.b2ContactFilter=ur,t.b2ContactImpulse=lr,t.b2ContactListener=hr,t.b2QueryCallback=cr,t.b2RayCastCallback=mr,t.b2Island=Vr,t.b2Profile=fr,t.b2TimeStep=dr,t.b2Position=pr,t.b2Velocity=vr,t.b2SolverData=yr,t.b2ContactManager=_r,t.b2MixFriction=Wn,t.b2MixRestitution=Zn,t.b2ContactEdge=Hn,t.b2Contact=Qn,t.b2ContactRegister=sr,t.b2ContactFactory=or,t.g_blockSolve=gr,t.b2VelocityConstraintPoint=xr,t.b2ContactVelocityConstraint=br,t.b2ContactPositionConstraint=wr,t.b2ContactSolverDef=Ar,t.b2PositionSolverManifold=Sr,t.b2ContactSolver=Br,t.b2CircleContact=Kn,t.b2PolygonContact=$n,t.b2PolygonAndCircleContact=tr,t.b2EdgeAndCircleContact=er,t.b2EdgeAndPolygonContact=ir,t.b2ChainAndCircleContact=nr,t.b2ChainAndPolygonContact=rr,t.b2Jacobian=gn,t.b2JointEdge=xn,t.b2JointDef=bn,t.b2Joint=wn,t.b2AreaJointDef=Bn,t.b2AreaJoint=Cn,t.b2DistanceJointDef=An,t.b2DistanceJoint=Sn,t.b2FrictionJointDef=Vn,t.b2FrictionJoint=Mn,t.b2GearJointDef=kn,t.b2GearJoint=Pn,t.b2MotorJointDef=In,t.b2MotorJoint=Tn,t.b2MouseJointDef=Dn,t.b2MouseJoint=Gn,t.b2PrismaticJointDef=Rn,t.b2PrismaticJoint=En,t.b2_minPulleyLength=Fn,t.b2PulleyJointDef=Ln,t.b2PulleyJoint=jn,t.b2RevoluteJointDef=On,t.b2RevoluteJoint=Nn,t.b2RopeJointDef=qn,t.b2RopeJoint=zn,t.b2WeldJointDef=Un,t.b2WeldJoint=Jn,t.b2WheelJointDef=Xn,t.b2WheelJoint=Yn,t.b2ControllerEdge=ts,t.b2Controller=es,t.b2BuoyancyController=is,t.b2ConstantAccelController=ns,t.b2ConstantForceController=rs,t.b2GravityController=ss,t.b2TensorDampingController=os,t.b2ParticleDef=Mr,t.b2CalculateParticleIterations=kr,t.b2ParticleHandle=Ir,t.b2ParticleGroupDef=Tr,t.b2ParticleGroup=Dr,t.b2GrowableBuffer=Jr,t.b2FixtureParticleQueryCallback=Xr,t.b2ParticleContact=Yr,t.b2ParticleBodyContact=Wr,t.b2ParticlePair=Zr,t.b2ParticleTriad=Hr,t.b2ParticleSystemDef=Qr,t.b2ParticleSystem=Kr,t.b2RopeDef=as,t.b2Rope=us,Object.defineProperty(t,"__esModule",{value:!0})}(e)},function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i(17);function r(t,e){var i;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=Object(n.a)(t))||e&&t&&"number"===typeof t.length){i&&(t=i);var r=0,s=function(){};return{s:s,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(u)throw o}}}}},function(t,e,i){"use strict";function n(t,e,i,n,r,s,o){try{var a=t[s](o),u=a.value}catch(l){return void i(l)}a.done?e(u):Promise.resolve(u).then(n,r)}function r(t){return function(){var e=this,i=arguments;return new Promise((function(r,s){var o=t.apply(e,i);function a(t){n(o,r,s,a,u,"next",t)}function u(t){n(o,r,s,a,u,"throw",t)}a(void 0)}))}}i.d(e,"a",(function(){return r}))},function(t,e,i){"use strict"},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function i(t,e,i){var n=i?t[e]:Object.getOwnPropertyDescriptor(t,e);return!i&&n.value&&"object"===typeof n.value&&(n=n.value),!(!n||!function(t){return!!t.get&&"function"===typeof t.get||!!t.set&&"function"===typeof t.set}(n))&&("undefined"===typeof n.enumerable&&(n.enumerable=!0),"undefined"===typeof n.configurable&&(n.configurable=!0),n)}function n(t,e){var i=Object.getOwnPropertyDescriptor(t,e);return!!i&&(i.value&&"object"===typeof i.value&&(i=i.value),!1===i.configurable)}function r(t,e,r,s){for(var a in e)if(e.hasOwnProperty(a)){var u=i(e,a,r);if(!1!==u){if(n((s||t).prototype,a)){if(o.ignoreFinals)continue;throw new Error("cannot override final property '"+a+"', set Class.ignoreFinals = true to skip")}Object.defineProperty(t.prototype,a,u)}else t.prototype[a]=e[a]}}function s(t,e){if(e){Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++)r(t,e[i].prototype||e[i])}}function o(t){var e,i;if(t||(t={}),t.initialize){if("function"!==typeof t.initialize)throw new Error("initialize must be a function");e=t.initialize,delete t.initialize}else if(t.Extends){var n=t.Extends;e=function(){n.apply(this,arguments)}}else e=function(){};t.Extends?(e.prototype=Object.create(t.Extends.prototype),e.prototype.constructor=e,i=t.Extends,delete t.Extends):e.prototype.constructor=e;var o=null;return t.Mixins&&(o=t.Mixins,delete t.Mixins),s(e,o),r(e,t,!0,i),e}o.extend=r,o.mixin=s,o.ignoreFinals=!1,t.exports=o},function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}},function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i(18);function r(t,e){if(t){if("string"===typeof t)return Object(n.a)(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Object(n.a)(t,e):void 0}}},function(t,e,i){"use strict";function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}i.d(e,"a",(function(){return n}))},function(t,e,i){var n=i(15),r=(i(21).nextPowerOfTwo,i(21).isPowerOfTwo),s=i(20).BaseObject,o=new n({initialize:function t(e,i){if(!(this instanceof t))return new t(e,i);s.call(this,e),this.managedArgs=i,this.id=null,this.target=this.context.gl.TEXTURE_2D,this.width=0,this.height=0,this.__shape=[0,0],this.wrapS=t.DEFAULT_WRAP,this.wrapT=t.DEFAULT_WRAP,this.minFilter=t.DEFAULT_FILTER,this.magFilter=t.DEFAULT_FILTER,this.context.addManagedObject(this),this.create()},setup:function(t){var e=this.gl;if(t)if(t.src&&"string"===typeof t.src){var i=new Image,n=t.src,r=t.crossOrigin,s="function"===typeof t.onLoad?t.onLoad:null,a="function"===typeof t.onError?t.onError:null,u=t.genMipmaps,l=this;o.USE_DUMMY_1x1_DATA&&(l.uploadData(1,1),this.width=this.height=0),i.crossOrigin=r,i.onload=function(t){l.uploadImage(i,void 0,void 0,u),"function"===typeof s&&s.call(l,t,l)},i.onerror=function(t){u&&e.generateMipmap(e.TEXTURE_2D),"function"===typeof a&&a.call(l,t,l)},i.onabort=function(t){u&&e.generateMipmap(e.TEXTURE_2D),"function"===typeof a&&a.call(l,t,l)},i.src=n}else t.image?this.uploadImage(t.image,t.format,t.dataType,t.genMipmaps):this.uploadData(t.width,t.height,t.format,t.dataType,t.data,t.genMipmaps)},create:function(){this.gl=this.context.gl;var t=this.gl;this.id=t.createTexture(),this.width=this.height=0,this.target=t.TEXTURE_2D,this.bind(),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.UNPACK_PREMULTIPLY_ALPHA),t.pixelStorei(t.UNPACK_ALIGNMENT,o.UNPACK_ALIGNMENT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.UNPACK_FLIP_Y);var e=o.UNPACK_COLORSPACE_CONVERSION||t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,e),this.setWrap(this.wrapS,this.wrapT,!1),this.setFilter(this.minFilter,this.magFilter,!1),this.managedArgs&&this.setup(this.managedArgs)},destroy:function(){this.id&&this.gl&&this.gl.deleteTexture(this.id),this.context&&this.context.removeManagedObject(this),this.width=this.height=0,this.id=null,this.managedArgs=null,this.context=null,this.gl=null},setWrap:function(t,e,i){t&&e?(this.wrapS=t,this.wrapT=e):this.wrapS=this.wrapT=t,this._checkPOT(),i||this.bind();var n=this.gl;n.texParameteri(this.target,n.TEXTURE_WRAP_S,this.wrapS),n.texParameteri(this.target,n.TEXTURE_WRAP_T,this.wrapT)},setFilter:function(t,e,i){t&&e?(this.minFilter=t,this.magFilter=e):this.minFilter=this.magFilter=t,this._checkPOT(),i||this.bind();var n=this.gl;n.texParameteri(this.target,n.TEXTURE_MIN_FILTER,this.minFilter),n.texParameteri(this.target,n.TEXTURE_MAG_FILTER,this.magFilter)},uploadData:function(t,e,i,n,r,s){var o=this.gl;i=i||o.RGBA,n=n||o.UNSIGNED_BYTE,r=r||null,this.width=t||0==t?t:this.width,this.height=e||0==e?e:this.height,this._checkPOT(),this.bind(),o.texImage2D(this.target,0,i,this.width,this.height,0,i,n,r),s&&o.generateMipmap(this.target)},uploadImage:function(t,e,i,n){var r=this.gl;e=e||r.RGBA,i=i||r.UNSIGNED_BYTE,this.width=t.width,this.height=t.height,this._checkPOT(),this.bind(),r.texImage2D(this.target,0,e,e,i,t),n&&r.generateMipmap(this.target)},uploadSubImage:function(){},_checkPOT:function(){if(!o.FORCE_POT){var t=this.minFilter!==o.Filter.LINEAR&&this.minFilter!==o.Filter.NEAREST,e=this.wrapS!==o.Wrap.CLAMP_TO_EDGE||this.wrapT!==o.Wrap.CLAMP_TO_EDGE;if((t||e)&&(!r(this.width)||!r(this.height)))throw new Error(t?"Non-power-of-two textures cannot use mipmapping as filter":"Non-power-of-two textures must use CLAMP_TO_EDGE as wrap")}},bind:function(t){var e=this.gl;(t||0===t)&&e.activeTexture(e.TEXTURE0+t),e.bindTexture(this.target,this.id)},toString:function(){return this.id+":"+this.width+"x"+this.height},shape:{get:function(){return this.__shape[0]=this.width,this.__shape[1]=this.height,this.__shape},set:function(t){throw new Error("changing shape not supported")}}});o.Filter={NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985},o.Wrap={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},o.Format={DEPTH_COMPONENT:6402,ALPHA:6406,RGBA:6408,RGB:6407,LUMINANCE:6409,LUMINANCE_ALPHA:6410},o.DataType={BYTE:5120,SHORT:5122,INT:5124,FLOAT:5126,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635},o.DEFAULT_WRAP=o.Wrap.CLAMP_TO_EDGE,o.DEFAULT_FILTER=o.Filter.NEAREST,o.FORCE_POT=!1,o.UNPACK_FLIP_Y=!1,o.UNPACK_ALIGNMENT=1,o.UNPACK_PREMULTIPLY_ALPHA=!0,o.UNPACK_COLORSPACE_CONVERSION=void 0,o.USE_DUMMY_1x1_DATA=!0,o.getNumComponents=function(t){switch(t){case o.Format.DEPTH_COMPONENT:case o.Format.ALPHA:case o.Format.LUMINANCE:return 1;case o.Format.LUMINANCE_ALPHA:return 2;case o.Format.RGB:return 3;case o.Format.RGBA:return 4}return null},t.exports=o},function(t,e,i){var n=i(50);function r(t){var e=t&&t.rawgl?t.rawgl:t;return"undefined"!==typeof window.WebGLRenderingContext&&e instanceof window.WebGLRenderingContext?new n(t):t}t.exports.wrapContext=r,t.exports.BaseObject=function(t){if(!t||"object"!==typeof t)throw"valid GL context not specified";this.context=r(t)}},function(t,e){var i=new Int8Array(4),n=new Int32Array(i.buffer,0,1),r=new Float32Array(i.buffer,0,1),s=function(){};s.intBitsToFloat=function(t){return n[0]=t,r[0]},s.floatToIntBits=function(t){return r[0]=t,n[0]},s.intToFloatColor=function(t){return s.intBitsToFloat(4278190079&t)},s.colorToFloat=function(t,e,i,n){return s.intToFloatColor(n<<24|i<<16|e<<8|t)},s.isPowerOfTwo=function(t){return 0===(t&t-1)},s.nextPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},t.exports=s},function(t,e){function i(e){return t.exports=i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},i(e)}t.exports=i},function(t,e,i){var n={EventEmitter:i(56),EmitterSubscription:i(29)};t.exports=n},function(t,e,i){var n=i(35);t.exports=function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}},function(t,e,i){var n=i(22),r=i(36),s=i(76);t.exports=function(t){var e=r();return function(){var i,r=n(t);if(e){var o=n(this).constructor;i=Reflect.construct(r,arguments,o)}else i=r.apply(this,arguments);return s(this,i)}}},function(t,e,i){var n=i(81);t.exports=function(t,e){var i;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=n(t))||e&&t&&"number"===typeof t.length){i&&(t=i);var r=0,s=function(){};return{s:s,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(u)throw o}}}}},function(t,e,i){"use strict";var n=i(26);function r(t){if(this.words=[],null!=(s=t)&&void 0!==s[Symbol.iterator]){var e,i=n(t);try{for(i.s();!(e=i.n()).done;){var r=e.value;this.add(r)}}catch(o){i.e(o)}finally{i.f()}}var s}r.prototype.add=function(t){this.resize(t),this.words[t>>>5]|=1<<t},r.prototype.flip=function(t){this.resize(t),this.words[t>>>5]^=1<<t},r.prototype.clear=function(){this.words=[]},r.prototype.remove=function(t){this.resize(t),this.words[t>>>5]&=~(1<<t)},r.prototype.isEmpty=function(t){for(var e=this.words.length,i=0;i<e;i++)if(0!==this.words[i])return!1;return!0},r.prototype.has=function(t){return 0!==(this.words[t>>>5]&1<<t)},r.prototype.checkedAdd=function(t){this.resize(t);var e=this.words[t>>>5],i=e|1<<t;return this.words[t>>>5]=i,(i^e)>>>t},r.prototype.trim=function(t){for(var e=this.words.length;e>0&&0===this.words[e-1];)e--;this.words=this.words.slice(0,e)},r.prototype.resize=function(t){for(var e=t+32>>>5,i=this.words.length;i<e;i++)this.words[i]=0},r.prototype.hammingWeight=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},r.prototype.hammingWeight4=function(t,e,i,n){return 16843009*((t=(t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)+(e=(e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)+(i=(i=(858993459&(i-=i>>>1&1431655765))+(i>>>2&858993459))+(i>>>4)&252645135)+(n=(n=(858993459&(n-=n>>>1&1431655765))+(n>>>2&858993459))+(n>>>4)&252645135))>>>24},r.prototype.size=function(){for(var t=0,e=this.words.length,i=this.words,n=0;n<e;n++)t+=this.hammingWeight(i[n]);return t},r.prototype.array=function(){for(var t=new Array(this.size()),e=0,i=this.words.length,n=0;n<i;++n)for(var r=this.words[n];0!=r;){var s=r&-r;t[e++]=(n<<5)+this.hammingWeight(s-1|0),r^=s}return t},r.prototype.forEach=function(t){for(var e=this.words.length,i=0;i<e;++i)for(var n=this.words[i];0!=n;){var r=n&-n;t((i<<5)+this.hammingWeight(r-1|0)),n^=r}},r.prototype.clone=function(){var t=Object.create(r.prototype);return t.words=this.words.slice(),t},r.prototype.intersects=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0;i<e;++i)if(0!==(this.words[i]&t.words[i]))return!0;return!1},r.prototype.intersection=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0;i+7<e;i+=8)this.words[i]&=t.words[i],this.words[i+1]&=t.words[i+1],this.words[i+2]&=t.words[i+2],this.words[i+3]&=t.words[i+3],this.words[i+4]&=t.words[i+4],this.words[i+5]&=t.words[i+5],this.words[i+6]&=t.words[i+6],this.words[i+7]&=t.words[i+7];for(;i<e;++i)this.words[i]&=t.words[i];var n=this.words.length;for(i=e;i<n;++i)this.words[i]=0;return this},r.prototype.intersection_size=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0,n=0;n<e;++n)i+=this.hammingWeight(this.words[n]&t.words[n]);return i},r.prototype.new_intersection=function(t){var e=Object.create(r.prototype),i=Math.min(this.words.length,t.words.length);e.words=new Array(i);for(var n=i,s=0;s+7<n;s+=8)e.words[s]=this.words[s]&t.words[s],e.words[s+1]=this.words[s+1]&t.words[s+1],e.words[s+2]=this.words[s+2]&t.words[s+2],e.words[s+3]=this.words[s+3]&t.words[s+3],e.words[s+4]=this.words[s+4]&t.words[s+4],e.words[s+5]=this.words[s+5]&t.words[s+5],e.words[s+6]=this.words[s+6]&t.words[s+6],e.words[s+7]=this.words[s+7]&t.words[s+7];for(;s<n;++s)e.words[s]=this.words[s]&t.words[s];return e},r.prototype.equals=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0;i<e;++i)if(this.words[i]!=t.words[i])return!1;if(this.words.length<t.words.length){var n=t.words.length;for(i=this.words.length;i<n;++i)if(0!=t.words[i])return!1}else if(t.words.length<this.words.length)for(n=this.words.length,i=t.words.length;i<n;++i)if(0!=this.words[i])return!1;return!0},r.prototype.difference=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0;i+7<e;i+=8)this.words[i]&=~t.words[i],this.words[i+1]&=~t.words[i+1],this.words[i+2]&=~t.words[i+2],this.words[i+3]&=~t.words[i+3],this.words[i+4]&=~t.words[i+4],this.words[i+5]&=~t.words[i+5],this.words[i+6]&=~t.words[i+6],this.words[i+7]&=~t.words[i+7];for(;i<e;++i)this.words[i]&=~t.words[i];return this},r.prototype.difference_size=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0,n=0;n<e;++n)i+=this.hammingWeight(this.words[n]&~t.words[n]);for(var r=this.words.length;n<r;++n)i+=this.hammingWeight(this.words[n]);return i},r.prototype.toString=function(){return"{"+this.array().join(",")+"}"},r.prototype.union=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0;i+7<e;i+=8)this.words[i]|=t.words[i],this.words[i+1]|=t.words[i+1],this.words[i+2]|=t.words[i+2],this.words[i+3]|=t.words[i+3],this.words[i+4]|=t.words[i+4],this.words[i+5]|=t.words[i+5],this.words[i+6]|=t.words[i+6],this.words[i+7]|=t.words[i+7];for(;i<e;++i)this.words[i]|=t.words[i];if(this.words.length<t.words.length){this.resize((t.words.length<<5)-1);var n=t.words.length;for(i=e;i<n;++i)this.words[i]=t.words[i]}return this},r.prototype.new_union=function(t){var e=Object.create(r.prototype),i=Math.max(this.words.length,t.words.length);e.words=new Array(i);for(var n=Math.min(this.words.length,t.words.length),s=0;s+7<n;s+=8)e.words[s]=this.words[s]|t.words[s],e.words[s+1]=this.words[s+1]|t.words[s+1],e.words[s+2]=this.words[s+2]|t.words[s+2],e.words[s+3]=this.words[s+3]|t.words[s+3],e.words[s+4]=this.words[s+4]|t.words[s+4],e.words[s+5]=this.words[s+5]|t.words[s+5],e.words[s+6]=this.words[s+6]|t.words[s+6],e.words[s+7]=this.words[s+7]|t.words[s+7];for(;s<n;++s)e.words[s]=this.words[s]|t.words[s];var o=this.words.length;for(s=n;s<o;++s)e.words[s]=this.words[s];var a=t.words.length;for(s=n;s<a;++s)e.words[s]=t.words[s];return e},r.prototype.new_difference=function(t){return this.clone().difference(t)},r.prototype.union_size=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0,n=0;n<e;++n)i+=this.hammingWeight(this.words[n]|t.words[n]);if(this.words.length<t.words.length){var r=t.words.length;for(n=this.words.length;n<r;++n)i+=this.hammingWeight(0|t.words[n])}else for(r=this.words.length,n=t.words.length;n<r;++n)i+=this.hammingWeight(0|this.words[n]);return i},t.exports=r},function(t,e,i){var n=i(15),r=i(20).BaseObject,s=new n({dirty:{set:function(t){this.verticesDirty=t,this.indicesDirty=t}},initialize:function(t,e,i,n,s){if(!i)throw"numVerts not specified, must be > 0";r.call(this,t),this.gl=this.context.gl,this.numVerts=null,this.numIndices=null,this.vertices=null,this.indices=null,this.vertexBuffer=null,this.indexBuffer=null,this.verticesDirty=!0,this.indicesDirty=!0,this.indexUsage=null,this.vertexUsage=null,this._vertexAttribs=null,this.vertexStride=null,this.numVerts=i,this.numIndices=n||0,this.vertexUsage=e?this.gl.STATIC_DRAW:this.gl.DYNAMIC_DRAW,this.indexUsage=e?this.gl.STATIC_DRAW:this.gl.DYNAMIC_DRAW,this._vertexAttribs=s||[],this.indicesDirty=!0,this.verticesDirty=!0;for(var o=0,a=0;a<this._vertexAttribs.length;a++)o+=this._vertexAttribs[a].offsetCount;this.vertexStride=4*o,this.vertices=new Float32Array(this.numVerts),this.indices=new Uint16Array(this.numIndices),this.context.addManagedObject(this),this.create()},create:function(){this.gl=this.context.gl;var t=this.gl;this.vertexBuffer=t.createBuffer(),this.indexBuffer=this.numIndices>0?t.createBuffer():null,this.dirty=!0},destroy:function(){this.vertices=null,this.indices=null,this.vertexBuffer&&this.gl&&this.gl.deleteBuffer(this.vertexBuffer),this.indexBuffer&&this.gl&&this.gl.deleteBuffer(this.indexBuffer),this.vertexBuffer=null,this.indexBuffer=null,this.context&&this.context.removeManagedObject(this),this.gl=null,this.context=null},_updateBuffers:function(t,e){var i=this.gl;if(this.numIndices>0&&(t||i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.indicesDirty&&(i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices,this.indexUsage),this.indicesDirty=!1)),t||i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),this.verticesDirty){if(e){var n=this.vertices.subarray(0,e);i.bufferSubData(i.ARRAY_BUFFER,0,n)}else i.bufferData(i.ARRAY_BUFFER,this.vertices,this.vertexUsage);this.verticesDirty=!1}},draw:function(t,e,i,n){if(0!==e){var r=this.gl;i=i||0,this._updateBuffers(!0,n),this.numIndices>0?r.drawElements(t,e,r.UNSIGNED_SHORT,2*i):r.drawArrays(t,i,e)}},bind:function(t){var e=this.gl,i=0,n=this.vertexStride;this._updateBuffers();for(var r=0;r<this._vertexAttribs.length;r++){var s=this._vertexAttribs[r],o=null===s.location?t.getAttributeLocation(s.name):s.location;e.enableVertexAttribArray(o),e.vertexAttribPointer(o,s.numComponents,s.type||e.FLOAT,s.normalize,n,i),i+=4*s.offsetCount}},unbind:function(t){for(var e=this.gl,i=0;i<this._vertexAttribs.length;i++){var n=this._vertexAttribs[i],r=null===n.location?t.getAttributeLocation(n.name):n.location;e.disableVertexAttribArray(r)}}});s.Attrib=new n({name:null,numComponents:null,location:null,type:null,initialize:function(t,e,i,n,r,s){this.name=t,this.numComponents=e,this.location="number"===typeof i?i:null,this.type=n,this.normalize=Boolean(r),this.offsetCount="number"===typeof s?s:this.numComponents}}),t.exports=s},function(t,e,i){"use strict";var n=function(t){function e(i,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t.call(this,i),this.listener=n,this.context=r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(i(57));t.exports=n},function(t,e,i){"use strict";t.exports=function(t,e,i,n,r,s,o,a){if(!t){var u;if(void 0===e)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[i,n,r,s,o,a],h=0;(u=new Error(e.replace(/%s/g,(function(){return l[h++]})))).name="Invariant Violation"}throw u.framesToPop=1,u}}},function(t,e,i){var n=i(60),r=i(32);t.exports=function(t){var e=Array.apply(null,new Array(16)).map(Number.prototype.valueOf,255),i=r(new Uint8Array(e),[2,2,4]);return n(t,i)}},function(t,e,i){var n=i(61),r=i(62),s="undefined"!==typeof Float64Array;function o(t,e){return t[0]-e[0]}function a(){var t,e=this.stride,i=new Array(e.length);for(t=0;t<i.length;++t)i[t]=[Math.abs(e[t]),t];i.sort(o);var n=new Array(i.length);for(t=0;t<n.length;++t)n[t]=i[t][1];return n}function u(t,e){var i=["View",e,"d",t].join("");e<0&&(i="View_Nil"+t);var r="generic"===t;if(-1===e){var s="function "+i+"(a){this.data=a;};var proto="+i+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+i+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+i+"(a){return new "+i+"(a);}";return new Function(s)()}if(0===e){s="function "+i+"(a,d) {this.data = a;this.offset = d};var proto="+i+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+i+"_copy() {return new "+i+"(this.data,this.offset)};proto.pick=function "+i+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+i+"_get(){return "+(r?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+i+"_set(v){return "+(r?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+i+"(a,b,c,d){return new "+i+"(a,d)}";return new Function("TrivialArray",s)(l[t][0])}s=["'use strict'"];var o=n(e),u=o.map((function(t){return"i"+t})),h="this.offset+"+o.map((function(t){return"this.stride["+t+"]*i"+t})).join("+"),c=o.map((function(t){return"b"+t})).join(","),m=o.map((function(t){return"c"+t})).join(",");s.push("function "+i+"(a,"+c+","+m+",d){this.data=a","this.shape=["+c+"]","this.stride=["+m+"]","this.offset=d|0}","var proto="+i+".prototype","proto.dtype='"+t+"'","proto.dimension="+e),s.push("Object.defineProperty(proto,'size',{get:function "+i+"_size(){return "+o.map((function(t){return"this.shape["+t+"]"})).join("*"),"}})"),1===e?s.push("proto.order=[0]"):(s.push("Object.defineProperty(proto,'order',{get:"),e<4?(s.push("function "+i+"_order(){"),2===e?s.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===e&&s.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):s.push("ORDER})")),s.push("proto.set=function "+i+"_set("+u.join(",")+",v){"),r?s.push("return this.data.set("+h+",v)}"):s.push("return this.data["+h+"]=v}"),s.push("proto.get=function "+i+"_get("+u.join(",")+"){"),r?s.push("return this.data.get("+h+")}"):s.push("return this.data["+h+"]}"),s.push("proto.index=function "+i+"_index(",u.join(),"){return "+h+"}"),s.push("proto.hi=function "+i+"_hi("+u.join(",")+"){return new "+i+"(this.data,"+o.map((function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")})).join(",")+","+o.map((function(t){return"this.stride["+t+"]"})).join(",")+",this.offset)}");var _=o.map((function(t){return"a"+t+"=this.shape["+t+"]"})),f=o.map((function(t){return"c"+t+"=this.stride["+t+"]"}));s.push("proto.lo=function "+i+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+_.join(",")+","+f.join(","));for(var d=0;d<e;++d)s.push("if(typeof i"+d+"==='number'&&i"+d+">=0){d=i"+d+"|0;b+=c"+d+"*d;a"+d+"-=d}");s.push("return new "+i+"(this.data,"+o.map((function(t){return"a"+t})).join(",")+","+o.map((function(t){return"c"+t})).join(",")+",b)}"),s.push("proto.step=function "+i+"_step("+u.join(",")+"){var "+o.map((function(t){return"a"+t+"=this.shape["+t+"]"})).join(",")+","+o.map((function(t){return"b"+t+"=this.stride["+t+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(d=0;d<e;++d)s.push("if(typeof i"+d+"==='number'){d=i"+d+"|0;if(d<0){c+=b"+d+"*(a"+d+"-1);a"+d+"=ceil(-a"+d+"/d)}else{a"+d+"=ceil(a"+d+"/d)}b"+d+"*=d}");s.push("return new "+i+"(this.data,"+o.map((function(t){return"a"+t})).join(",")+","+o.map((function(t){return"b"+t})).join(",")+",c)}");var p=new Array(e),v=new Array(e);for(d=0;d<e;++d)p[d]="a[i"+d+"]",v[d]="b[i"+d+"]";s.push("proto.transpose=function "+i+"_transpose("+u+"){"+u.map((function(t,e){return t+"=("+t+"===undefined?"+e+":"+t+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+i+"(this.data,"+p.join(",")+","+v.join(",")+",this.offset)}"),s.push("proto.pick=function "+i+"_pick("+u+"){var a=[],b=[],c=this.offset");for(d=0;d<e;++d)s.push("if(typeof i"+d+"==='number'&&i"+d+">=0){c=(c+this.stride["+d+"]*i"+d+")|0}else{a.push(this.shape["+d+"]);b.push(this.stride["+d+"])}");return s.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),s.push("return function construct_"+i+"(data,shape,stride,offset){return new "+i+"(data,"+o.map((function(t){return"shape["+t+"]"})).join(",")+","+o.map((function(t){return"stride["+t+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",s.join("\n"))(l[t],a)}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};t.exports=function(t,e,i,n){if(void 0===t)return(0,l.array[0])([]);"number"===typeof t&&(t=[t]),void 0===e&&(e=[t.length]);var o=e.length;if(void 0===i){i=new Array(o);for(var a=o-1,h=1;a>=0;--a)i[a]=h,h*=e[a]}if(void 0===n){n=0;for(a=0;a<o;++a)i[a]<0&&(n-=(e[a]-1)*i[a])}for(var c=function(t){if(r(t))return"buffer";if(s)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(t)?"array":"generic"}(t),m=l[c];m.length<=o+1;)m.push(u(c,m.length-1));return(0,m[o+1])(t,e,i,n)}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(n){"object"===typeof window&&(i=window)}t.exports=i},function(t,e,i){var n=i(75);function r(e,i,s){return"undefined"!==typeof Reflect&&Reflect.get?t.exports=r=Reflect.get:t.exports=r=function(t,e,i){var r=n(t,e);if(r){var s=Object.getOwnPropertyDescriptor(r,e);return s.get?s.get.call(i):s.value}},r(e,i,s||e)}t.exports=r},function(t,e){function i(e,n){return t.exports=i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},i(e,n)}t.exports=i},function(t,e){t.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}},function(t,e,i){"use strict";var n=i(14),r=i(16);Object.defineProperty(e,"__esModule",{value:!0}),e.ComponentMapper=void 0;var s=function(){function t(){n(this,t),this.data=[]}return r(t,[{key:"add",value:function(t,e){this.data[t]=e}},{key:"get",value:function(t){return this.data[t]}},{key:"remove",value:function(t){delete this.data[t]}}]),t}();e.ComponentMapper=s},function(t,e,i){"use strict";var n=i(26),r=i(14),s=i(16),o=i(34),a=i(22),u=i(24),l=i(25),h=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.EntityIteratingSystem=void 0;var c=i(39),m=h(i(27)),_=function(t){u(i,t);var e=l(i);function i(t){var n;return r(this,i),(n=e.call(this)).componentBits=new m.default,n.types=t,n}return s(i,[{key:"setWorld",value:function(t){o(a(i.prototype),"setWorld",this).call(this,t);var e,r=n(this.types);try{for(r.s();!(e=r.n()).done;){var s=e.value;this.componentBits.add(t.getComponentIndex(s))}}catch(u){r.e(u)}finally{r.f()}}},{key:"process",value:function(){this.begin(),this.world.getEntities(this.componentBits,this.processEntity.bind(this)),this.end()}},{key:"begin",value:function(){}},{key:"end",value:function(){}}]),i}(c.System);e.EntityIteratingSystem=_},function(t,e,i){"use strict";var n=i(14),r=i(16);Object.defineProperty(e,"__esModule",{value:!0}),e.System=void 0;var s=function(){function t(){n(this,t)}return r(t,[{key:"setWorld",value:function(t){this.world=t}},{key:"initialized",value:function(){}},{key:"dispose",value:function(){}}]),t}();e.System=s},function(t,e,i){var n=i(15),r=i(28),s=i(51),o=i(54),a=i(90).mat4,u=new n({Mixins:o,initialize:function t(e,i){if(!(this instanceof t))return new t(e,i);o.call(this,e,i),this.projection=a.create(),this.texture=null},resize:function(t,e){this.setProjection(t/2,e/2)},getVertexSize:function(){return u.VERTEX_SIZE},_createVertexAttributes:function(){var t=this.context.gl;return[new r.Attrib(s.POSITION_ATTRIBUTE,2),new r.Attrib(s.COLOR_ATTRIBUTE,4,null,t.UNSIGNED_BYTE,!0,1),new r.Attrib(s.TEXCOORD_ATTRIBUTE+"0",2)]},setProjection:function(t){this.projection=t,!this.drawing||x==oldX&&y==oldY||(this.flush(),this.updateMatrices())},_createShader:function(){var t=new s(this.context,u.DEFAULT_VERT_SHADER,u.DEFAULT_FRAG_SHADER);return t.log&&console.warn("Shader Log:\n"+t.log),t},updateMatrices:function(){this.shader.setUniformMatrix4("u_projection",this.projection)},_preRender:function(){this.texture&&this.texture.bind()},begin:function(){var t=this.context.gl;o.prototype.begin.call(this),this.updateMatrices(),this.shader.setUniformi("u_texture0",0),t.depthMask(!1)},end:function(){var t=this.context.gl;o.prototype.end.call(this),t.depthMask(!0)},flush:function(){this.texture&&0!==this.idx&&(o.prototype.flush.call(this),u.totalRenderCalls++)},drawRegion:function(t,e,i,n,r){this.draw(t.texture,e,i,n,r,t.u,t.v,t.u2,t.v2)},draw:function(t,e,i,n,r){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,m=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,_=arguments.length>13&&void 0!==arguments[13]?arguments[13]:1;if(!this.drawing)throw"Illegal State: trying to draw a batch before begin()";if(t){null===this.texture||this.texture.id!==t.id?(this.flush(),this.texture=t):this.idx==this.vertices.length&&this.flush(),e=e||0,i=i||0;var f=-s,d=(n=0===n?n:n||t.width)-s,p=n-s,v=-s,y=-o,g=-o,x=(r=0===r?r:r||t.height)-o,b=r-o,w=this.color;if(1!==u&&(f*=u,d*=u,p*=u,v*=u),1!==l&&(y*=l,g*=l,x*=l,b*=l),0!==a){var A=Math.cos(a),S=Math.sin(a),B=A*f-S*y,C=S*f+A*y,V=A*d-S*g,M=S*d+A*g,k=A*p-S*x,P=S*p+A*x,I=A*v-S*b,T=S*v+A*b;f=B,d=V,p=k,v=I,y=C,g=M,x=P,b=T}f+=e+s,d+=e+s,p+=e+s,v+=e+s,y+=i+o,g+=i+o,x+=i+o,b+=i+o,this.vertices[this.idx++]=f,this.vertices[this.idx++]=y,this.vertices[this.idx++]=w,this.vertices[this.idx++]=h,this.vertices[this.idx++]=c,this.vertices[this.idx++]=d,this.vertices[this.idx++]=g,this.vertices[this.idx++]=w,this.vertices[this.idx++]=m,this.vertices[this.idx++]=c,this.vertices[this.idx++]=p,this.vertices[this.idx++]=x,this.vertices[this.idx++]=w,this.vertices[this.idx++]=m,this.vertices[this.idx++]=_,this.vertices[this.idx++]=v,this.vertices[this.idx++]=b,this.vertices[this.idx++]=w,this.vertices[this.idx++]=h,this.vertices[this.idx++]=_}},drawVertices:function(t,e,i){if(!this.drawing)throw"Illegal State: trying to draw a batch before begin()";t&&(this.texture!=t?(this.flush(),this.texture=t):this.idx==this.vertices.length&&this.flush(),i=i||0,this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++],this.vertices[this.idx++]=e[i++])}});u.VERTEX_SIZE=5,u.totalRenderCalls=0,u.DEFAULT_FRAG_SHADER=["precision mediump float;","varying vec2 vTexCoord0;","varying vec4 vColor;","uniform sampler2D u_texture0;","void main(void) {","   gl_FragColor = texture2D(u_texture0, vTexCoord0) * vColor;","}"].join("\n"),u.DEFAULT_VERT_SHADER=["attribute vec4 "+s.POSITION_ATTRIBUTE+";","attribute vec4 "+s.COLOR_ATTRIBUTE+";","attribute vec2 "+s.TEXCOORD_ATTRIBUTE+"0;","uniform mat4 u_projection;","varying vec2 vTexCoord0;","varying vec4 vColor;","void main(void) {","   gl_Position =  u_projection * "+s.POSITION_ATTRIBUTE+";","   vTexCoord0 = "+s.TEXCOORD_ATTRIBUTE+"0;","   vColor = "+s.COLOR_ATTRIBUTE+";","   vColor.a = vColor.a * (256.0/255.0);","}"].join("\n"),t.exports=u},,,,,,,,,function(t,e,i){var n=function(t){"use strict";var e,i=Object.prototype,n=i.hasOwnProperty,r="function"===typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function u(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(I){u=function(t,e,i){return t[e]=i}}function l(t,e,i,n){var r=e&&e.prototype instanceof p?e:p,s=Object.create(r.prototype),o=new M(n||[]);return s._invoke=function(t,e,i){var n=c;return function(r,s){if(n===_)throw new Error("Generator is already running");if(n===f){if("throw"===r)throw s;return P()}for(i.method=r,i.arg=s;;){var o=i.delegate;if(o){var a=B(o,i);if(a){if(a===d)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===c)throw n=f,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=_;var u=h(t,e,i);if("normal"===u.type){if(n=i.done?f:m,u.arg===d)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(n=f,i.method="throw",i.arg=u.arg)}}}(t,i,o),s}function h(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(I){return{type:"throw",arg:I}}}t.wrap=l;var c="suspendedStart",m="suspendedYield",_="executing",f="completed",d={};function p(){}function v(){}function y(){}var g={};g[s]=function(){return this};var x=Object.getPrototypeOf,b=x&&x(x(k([])));b&&b!==i&&n.call(b,s)&&(g=b);var w=y.prototype=p.prototype=Object.create(g);function A(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function i(r,s,o,a){var u=h(t[r],t,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"===typeof c&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){i("next",t,o,a)}),(function(t){i("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return i("throw",t,o,a)}))}a(u.arg)}var r;this._invoke=function(t,n){function s(){return new e((function(e,r){i(t,n,e,r)}))}return r=r?r.then(s,s):s()}}function B(t,i){var n=t.iterator[i.method];if(n===e){if(i.delegate=null,"throw"===i.method){if(t.iterator.return&&(i.method="return",i.arg=e,B(t,i),"throw"===i.method))return d;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=h(n,t.iterator,i.arg);if("throw"===r.type)return i.method="throw",i.arg=r.arg,i.delegate=null,d;var s=r.arg;return s?s.done?(i[t.resultName]=s.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,d):s:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,d)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function V(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function M(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function k(t){if(t){var i=t[s];if(i)return i.call(t);if("function"===typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function i(){for(;++r<t.length;)if(n.call(t,r))return i.value=t[r],i.done=!1,i;return i.value=e,i.done=!0,i};return o.next=o}}return{next:P}}function P(){return{value:e,done:!0}}return v.prototype=w.constructor=y,y.constructor=v,v.displayName=u(y,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"===typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,a,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},A(S.prototype),S.prototype[o]=function(){return this},t.AsyncIterator=S,t.async=function(e,i,n,r,s){void 0===s&&(s=Promise);var o=new S(l(e,i,n,r),s);return t.isGeneratorFunction(i)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},A(w),u(w,a,"Generator"),w[s]=function(){return this},w.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var n=e.pop();if(n in t)return i.value=n,i.done=!1,i}return i.done=!0,i}},t.values=k,M.prototype={constructor:M,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(V),!t)for(var i in this)"t"===i.charAt(0)&&n.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function r(n,r){return a.type="throw",a.arg=t,i.next=n,r&&(i.method="next",i.arg=e),!!r}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,d):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),V(i),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var r=n.arg;V(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,i,n){return this.delegate={iterator:k(t),resultName:i,nextLoc:n},"next"===this.method&&(this.arg=e),d}},t}(t.exports);try{regeneratorRuntime=n}catch(r){Function("r","regeneratorRuntime = r")(n)}},function(t,e,i){var n=new(i(15))({initialize:function(t){this.gl=t},addManagedObject:function(t){},removeManagedObject:function(t){},width:{get:function(){return this.gl.canvas.width},set:function(t){this.gl.canvas.width=t}},height:{get:function(){return this.gl.canvas.height},set:function(t){this.gl.canvas.height=t}}});t.exports=n},function(t,e,i){var n=i(15),r=i(52),s=i(20).wrapContext,o=new n({initialize:function(t,e,i,n){if(!e||!i)throw"vertex and fragment shaders must be defined";if(!t||"object"!==typeof t)throw"valid GL context not specified to ShaderProgram";this.context=s(t),this.vertShader=null,this.fragShader=null,this.program=null,this.log="",this.uniformCache=null,this.attributeCache=null,this.attributeLocations=n,this.vertSource=e.trim(),this.fragSource=i.trim(),this.context.addManagedObject(this),this.create()},create:function(){this.gl=this.context.gl,this._compileShaders()},_compileShaders:function(){var t=this.gl,e=r({gl:t,vertex:this.vertSource,fragment:this.fragSource,verbose:o.VERBOSE_COMPILE,attributeLocations:this.attributeLocations});this.log=e.log,this.program=e.program,this.vertShader=e.vertex,this.fragShader=e.fragment,o.VERBOSE_COMPILE&&this.log&&console.warn(this.log),this._fetchUniforms(),this._fetchAttributes()},_fetchUniforms:function(){var t=this.gl;this.uniformCache={};var e=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);if(e)for(var i=0;i<e;i++){var n=t.getActiveUniform(this.program,i);if(null!==n){var r=n.name,s=t.getUniformLocation(this.program,r);this.uniformCache[r]={size:n.size,type:n.type,location:s}}}},_fetchAttributes:function(){var t=this.gl;this.attributeCache={};var e=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);if(e)for(var i=0;i<e;i++){var n=t.getActiveAttrib(this.program,i);if(null!==n){var r=n.name,s=t.getAttribLocation(this.program,r);this.attributeCache[r]={size:n.size,type:n.type,location:s}}}},bind:function(){this.gl.useProgram(this.program)},destroy:function(){if(this.context&&this.context.removeManagedObject(this),this.gl&&this.program){var t=this.gl;t.detachShader(this.program,this.vertShader),t.detachShader(this.program,this.fragShader),t.deleteShader(this.vertShader),t.deleteShader(this.fragShader),t.deleteProgram(this.program)}this.attributeCache=null,this.uniformCache=null,this.vertShader=null,this.fragShader=null,this.program=null,this.gl=null,this.context=null},getUniformInfo:function(t){return this.uniformCache[t]||null},getAttributeInfo:function(t){return this.attributeCache[t]||null},getAttributeLocation:function(t){var e=this.getAttributeInfo(t);return e?e.location:null},getUniformLocation:function(t){var e=this.getUniformInfo(t);return e?e.location:null},hasUniform:function(t){return null!==this.getUniformInfo(t)},hasAttribute:function(t){return null!==this.getAttributeInfo(t)},getUniform:function(t){return this.gl.getUniform(this.program,this.getUniformLocation(t))},getUniformAt:function(t){return this.gl.getUniform(this.program,t)},setUniformi:function(t,e,i,n,r){"use strict";var s=this.gl,o=this.getUniformLocation(t);if(null===o)return!1;switch(arguments.length){case 2:return s.uniform1i(o,e),!0;case 3:return s.uniform2i(o,e,i),!0;case 4:return s.uniform3i(o,e,i,n),!0;case 5:return s.uniform4i(o,e,i,n,r),!0;default:throw"invalid arguments to setUniformi"}},setUniformf:function(t,e,i,n,r){"use strict";var s=this.gl,o=this.getUniformLocation(t);if(null===o)return!1;switch(arguments.length){case 2:return s.uniform1f(o,e),!0;case 3:return s.uniform2f(o,e,i),!0;case 4:return s.uniform3f(o,e,i,n),!0;case 5:return s.uniform4f(o,e,i,n,r),!0;default:throw"invalid arguments to setUniformf"}},setUniformfv:function(t,e,i){"use strict";i=i||e.length;var n=this.gl,r=this.getUniformLocation(t);if(null===r)return!1;switch(i){case 1:return n.uniform1fv(r,e),!0;case 2:return n.uniform2fv(r,e),!0;case 3:return n.uniform3fv(r,e),!0;case 4:return n.uniform4fv(r,e),!0;default:throw"invalid arguments to setUniformf"}},setUniformiv:function(t,e,i){"use strict";i=i||e.length;var n=this.gl,r=this.getUniformLocation(t);if(null===r)return!1;switch(i){case 1:return n.uniform1iv(r,e),!0;case 2:return n.uniform2iv(r,e),!0;case 3:return n.uniform3iv(r,e),!0;case 4:return n.uniform4iv(r,e),!0;default:throw"invalid arguments to setUniformf"}},setUniformMatrix3:function(t,e,i){"use strict";var n="object"===typeof e&&e.val?e.val:e;i=!!i;var r=this.gl,s=this.getUniformLocation(t);if(null===s)return!1;r.uniformMatrix3fv(s,i,n)},setUniformMatrix4:function(t,e,i){"use strict";var n="object"===typeof e&&e.val?e.val:e;i=!!i;var r=this.gl,s=this.getUniformLocation(t);if(null===s)return!1;r.uniformMatrix4fv(s,i,n)}});o.POSITION_ATTRIBUTE="Position",o.NORMAL_ATTRIBUTE="Normal",o.COLOR_ATTRIBUTE="Color",o.TEXCOORD_ATTRIBUTE="TexCoord",o.VERBOSE_COMPILE=!0,t.exports=o},function(t,e,i){var n=i(53);function r(t,e,i,n){var r=t.createShader(e);if(!r)return-1;t.shaderSource(r,i),t.compileShader(r);var o=e===t.VERTEX_SHADER?"vertex":"fragment",a=t.getShaderInfoLog(r)||"";if(!t.getShaderParameter(r,t.COMPILE_STATUS))throw n&&(console.error("Shader error:\n"+a),console.error("Problematic "+o+" shader:\n"+s(i))),new Error("Could not compile "+o+" shader:\n"+a);if(!r)throw new Error("gl.createShader returned 0 for "+o+" shader.\n"+a);return{shader:r,log:a}}function s(t){for(var e=t.split("\n"),i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join("\n")}t.exports=function(t){if(!t||!t.vertex||!t.fragment)throw"must specify 'vertex' and 'fragment' source";var e=t.vertex.trim(),i=t.fragment.trim(),o=t.gl;if(!o&&!(o=n()))throw new Error("WebGL not supported -- try another browser");return function(t,e,i,n,o){var a="",u=r(t,t.VERTEX_SHADER,e,o),l=r(t,t.FRAGMENT_SHADER,i,o),h=u.shader,c=l.shader;a+=u.log+"\n"+l.log;var m=t.createProgram();if(t.attachShader(m,h),t.attachShader(m,c),n)for(var _ in n)n.hasOwnProperty(_)&&t.bindAttribLocation(m,Math.floor(n[_]),_);if(t.linkProgram(m),a+=t.getProgramInfoLog(m)||"",!t.getProgramParameter(m,t.LINK_STATUS))throw o&&(console.error("Shader error:\n"+a),console.error("Problematic shaders:\nVERTEX_SHADER:\n"+s(e)+"\n\nFRAGMENT_SHADER:\n"+s(i))),t.detachShader(m,h),t.detachShader(m,c),t.deleteShader(h),t.deleteShader(c),new Error("Error linking the shader program:\n"+a);return{program:m,vertex:h,fragment:c,log:a.trim()}}(o,e,i,t.attributeLocations,t.verbose)}},function(t,e){t.exports=function(t){var e=(t=t||{}).canvas||document.createElement("canvas");"number"===typeof t.width&&(e.width=t.width),"number"===typeof t.height&&(e.height=t.height);var i=t.attributes||t.attribs||{};try{gl=e.getContext("webgl",i)||e.getContext("experimental-webgl",i)}catch(n){gl=null}return gl}},function(t,e,i){var n=i(15),r=i(28),s=i(20).BaseObject,o=(i(21).colorToFloat,i(55)),a=new n({Mixins:o,initialize:function(t,e){s.call(this,t),e=e||{};var i=this._createShader();this.idx=0,this.mesh=this._createMesh(e.size),o.call(this,this.context.gl,i)},_createMesh:function(t){if((t=t||500)>10922)throw"Can't have more than 10922 sprites per batch: "+t;var e=4*t*this.getVertexSize(),i=6*t,n=this.context.gl;this.vertices=new Float32Array(e),this.indices=new Uint16Array(i);for(var s=0,o=0;s<i;s+=6,o+=4)this.indices[s+0]=o+0,this.indices[s+1]=o+1,this.indices[s+2]=o+2,this.indices[s+3]=o+0,this.indices[s+4]=o+2,this.indices[s+5]=o+3;var a=new r(this.context,!1,e,i,this._createVertexAttributes());return a.vertices=this.vertices,a.indices=this.indices,a.vertexUsage=n.DYNAMIC_DRAW,a.indexUsage=n.STATIC_DRAW,a.dirty=!0,a},_createShader:function(){throw"_createShader not implemented"},_createVertexAttributes:function(){throw"_createVertexAttributes not implemented"},getVertexSize:function(){throw"getVertexSize not implemented"},begin:function(){if(this.drawing)throw"batch.end() must be called before begin";if(this.drawing=!0,this.shader.bind(),this.mesh.bind(this.shader),this._blendingEnabled){var t=this.context.gl;t.enable(t.BLEND)}},end:function(){if(!this.drawing)throw"batch.begin() must be called before end";if(this.idx>0&&this.flush(),this.drawing=!1,this.mesh.unbind(this.shader),this._blendingEnabled){var t=this.context.gl;t.disable(t.BLEND)}},_preRender:function(){},flush:function(){if(0!==this.idx){var t=this.context.gl;this._blendingEnabled&&this._blendSrc&&this._blendDst&&t.blendFunc(this._blendSrc,this._blendDst),this._preRender();var e=this.getVertexSize(),i=this.idx/(4*e);this.mesh.verticesDirty=!0,this.mesh.draw(t.TRIANGLES,6*i,0,this.idx),this.idx=0}},destroy:function(){this.vertices=null,this.indices=null,this.maxVertices=0,this.ownsShader&&this.defaultShader&&this.defaultShader.destroy(),this.defaultShader=null,this._shader=null,this.mesh&&this.mesh.destroy(),this.mesh=null}});t.exports=a},function(t,e,i){var n=i(21).colorToFloat,r=i(15);t.exports=new r({initialize:function(t,e){this._blendSrc=t.ONE,this._blendDst=t.ONE_MINUS_SRC_ALPHA,this._blendingEnabled=!0,this._shader=e,this.defaultShader=this._shader,this.ownsShader=!0,this.drawing=!1,this.color=n(255,255,255,255),this.premultiplied=!0},blendingEnabled:{set:function(t){var e=this._blendingEnabled;if(this.drawing&&this.flush(),this._blendingEnabled=t,this.drawing&&e!=t){var i=this.context.gl;t?i.enable(i.BLEND):i.disable(i.BLEND)}},get:function(){return this._blendingEnabled}},blendSrc:{set:function(t){this.drawing&&this.flush(),this._blendSrc=t},get:function(){return this._blendSrc}},blendDst:{set:function(t){this.drawing&&this.flush(),this._blendDst=t},get:function(){return this._blendDst}},setBlendFunction:function(t,e){this.blendSrc=t,this.blendDst=e},shader:{set:function(t){var e=this.drawing;e&&this.end(),this._shader=t||this.defaultShader,e&&this.begin()},get:function(){return this._shader}},setColor:function(t,e,i,r){var s="number"===typeof t;s&&"number"===typeof e&&"number"===typeof i?r="number"===typeof r?r:1:t=e=i=r=s?t:1,this.premultiplied&&(t*=r,e*=r,i*=r),this.color=n(~~(255*t),~~(255*e),~~(255*i),~~(255*r))}})},function(t,e,i){"use strict";var n=i(29),r=i(58),s=i(59),o=i(30),a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._subscriber=new r,this._currentSubscription=null}return t.prototype.addListener=function(t,e,i){return this._subscriber.addSubscription(t,new n(this._subscriber,e,i))},t.prototype.once=function(t,e,i){var n=this;return this.addListener(t,(function(){n.removeCurrentListener(),e.apply(i,arguments)}))},t.prototype.removeAllListeners=function(t){this._subscriber.removeAllSubscriptions(t)},t.prototype.removeCurrentListener=function(){this._currentSubscription||o(!1),this._subscriber.removeSubscription(this._currentSubscription)},t.prototype.listeners=function(t){var e=this._subscriber.getSubscriptionsForType(t);return e?e.filter(s.thatReturnsTrue).map((function(t){return t.listener})):[]},t.prototype.emit=function(t){var e=this._subscriber.getSubscriptionsForType(t);if(e){for(var i=Object.keys(e),n=0;n<i.length;n++){var r=i[n],s=e[r];s&&(this._currentSubscription=s,this.__emitToSubscription.apply(this,[s].concat(Array.prototype.slice.call(arguments))))}this._currentSubscription=null}},t.prototype.__emitToSubscription=function(t,e){var i=Array.prototype.slice.call(arguments,2);t.listener.apply(t.context,i)},t}();t.exports=a},function(t,e,i){"use strict";var n=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.subscriber=e}return t.prototype.remove=function(){this.subscriber&&(this.subscriber.removeSubscription(this),this.subscriber=null)},t}();t.exports=n},function(t,e,i){"use strict";var n=i(30),r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._subscriptionsForType={},this._currentSubscription=null}return t.prototype.addSubscription=function(t,e){e.subscriber!==this&&n(!1),this._subscriptionsForType[t]||(this._subscriptionsForType[t]=[]);var i=this._subscriptionsForType[t].length;return this._subscriptionsForType[t].push(e),e.eventType=t,e.key=i,e},t.prototype.removeAllSubscriptions=function(t){void 0===t?this._subscriptionsForType={}:delete this._subscriptionsForType[t]},t.prototype.removeSubscription=function(t){var e=t.eventType,i=t.key,n=this._subscriptionsForType[e];n&&delete n[i]},t.prototype.getSubscriptionsForType=function(t){return this._subscriptionsForType[t]},t}();t.exports=r},function(t,e,i){"use strict";function n(t){return function(){return t}}var r=function(){};r.thatReturns=n,r.thatReturnsFalse=n(!1),r.thatReturnsTrue=n(!0),r.thatReturnsNull=n(null),r.thatReturnsThis=function(){return this},r.thatReturnsArgument=function(t){return t},t.exports=r},function(t,e,i){"use strict";var n=i(32),r=i(63),s=i(68);t.exports=function(t){if(arguments.length<=1)throw new Error("gl-texture2d: Missing arguments for texture2d constructor");o||l(t);if("number"===typeof arguments[1])return v(t,arguments[1],arguments[2],arguments[3]||t.RGBA,arguments[4]||t.UNSIGNED_BYTE);if(Array.isArray(arguments[1]))return v(t,0|arguments[1][0],0|arguments[1][1],arguments[2]||t.RGBA,arguments[3]||t.UNSIGNED_BYTE);if("object"===typeof arguments[1]){var e=arguments[1],i=h(e)?e:e.raw;if(i)return y(t,i,0|e.width,0|e.height,arguments[2]||t.RGBA,arguments[3]||t.UNSIGNED_BYTE);if(e.shape&&e.data&&e.stride)return g(t,e)}throw new Error("gl-texture2d: Invalid arguments for texture2d constructor")};var o=null,a=null,u=null;function l(t){o=[t.LINEAR,t.NEAREST_MIPMAP_LINEAR,t.LINEAR_MIPMAP_NEAREST,t.LINEAR_MIPMAP_NEAREST],a=[t.NEAREST,t.LINEAR,t.NEAREST_MIPMAP_NEAREST,t.NEAREST_MIPMAP_LINEAR,t.LINEAR_MIPMAP_NEAREST,t.LINEAR_MIPMAP_LINEAR],u=[t.REPEAT,t.CLAMP_TO_EDGE,t.MIRRORED_REPEAT]}function h(t){return"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement||"undefined"!=typeof ImageData&&t instanceof ImageData}var c=function(t,e){r.muls(t,e,255)};function m(t,e,i){var n=t.gl,r=n.getParameter(n.MAX_TEXTURE_SIZE);if(e<0||e>r||i<0||i>r)throw new Error("gl-texture2d: Invalid texture size");return t._shape=[e,i],t.bind(),n.texImage2D(n.TEXTURE_2D,0,t.format,e,i,0,t.format,t.type,null),t._mipLevels=[0],t}function _(t,e,i,n,r,s){this.gl=t,this.handle=e,this.format=r,this.type=s,this._shape=[i,n],this._mipLevels=[0],this._magFilter=t.NEAREST,this._minFilter=t.NEAREST,this._wrapS=t.CLAMP_TO_EDGE,this._wrapT=t.CLAMP_TO_EDGE,this._anisoSamples=1;var o=this,a=[this._wrapS,this._wrapT];Object.defineProperties(a,[{get:function(){return o._wrapS},set:function(t){return o.wrapS=t}},{get:function(){return o._wrapT},set:function(t){return o.wrapT=t}}]),this._wrapVector=a;var u=[this._shape[0],this._shape[1]];Object.defineProperties(u,[{get:function(){return o._shape[0]},set:function(t){return o.width=t}},{get:function(){return o._shape[1]},set:function(t){return o.height=t}}]),this._shapeVector=u}var f=_.prototype;function d(t,e){return 3===t.length?1===e[2]&&e[1]===t[0]*t[2]&&e[0]===t[2]:1===e[0]&&e[1]===t[0]}function p(t){var e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e}function v(t,e,i,n,r){var s=t.getParameter(t.MAX_TEXTURE_SIZE);if(e<0||e>s||i<0||i>s)throw new Error("gl-texture2d: Invalid texture shape");if(r===t.FLOAT&&!t.getExtension("OES_texture_float"))throw new Error("gl-texture2d: Floating point textures not supported on this platform");var o=p(t);return t.texImage2D(t.TEXTURE_2D,0,n,e,i,0,n,r,null),new _(t,o,e,i,n,r)}function y(t,e,i,n,r,s){var o=p(t);return t.texImage2D(t.TEXTURE_2D,0,r,r,s,e),new _(t,o,i,n,r,s)}function g(t,e){var i=e.dtype,o=e.shape.slice(),a=t.getParameter(t.MAX_TEXTURE_SIZE);if(o[0]<0||o[0]>a||o[1]<0||o[1]>a)throw new Error("gl-texture2d: Invalid texture size");var u=d(o,e.stride.slice()),l=0;"float32"===i?l=t.FLOAT:"float64"===i?(l=t.FLOAT,u=!1,i="float32"):"uint8"===i?l=t.UNSIGNED_BYTE:(l=t.UNSIGNED_BYTE,u=!1,i="uint8");var h,m,f=0;if(2===o.length)f=t.LUMINANCE,o=[o[0],o[1],1],e=n(e.data,o,[e.stride[0],e.stride[1],1],e.offset);else{if(3!==o.length)throw new Error("gl-texture2d: Invalid shape for texture");if(1===o[2])f=t.ALPHA;else if(2===o[2])f=t.LUMINANCE_ALPHA;else if(3===o[2])f=t.RGB;else{if(4!==o[2])throw new Error("gl-texture2d: Invalid shape for pixel coords");f=t.RGBA}}l!==t.FLOAT||t.getExtension("OES_texture_float")||(l=t.UNSIGNED_BYTE,u=!1);var v=e.size;if(u)h=0===e.offset&&e.data.length===v?e.data:e.data.subarray(e.offset,e.offset+v);else{var y=[o[2],o[2]*o[0],1];m=s.malloc(v,i);var g=n(m,o,y,0);"float32"!==i&&"float64"!==i||l!==t.UNSIGNED_BYTE?r.assign(g,e):c(g,e),h=m.subarray(0,v)}var x=p(t);return t.texImage2D(t.TEXTURE_2D,0,f,o[0],o[1],0,f,l,h),u||s.free(m),new _(t,x,o[0],o[1],f,l)}Object.defineProperties(f,{minFilter:{get:function(){return this._minFilter},set:function(t){this.bind();var e=this.gl;if(this.type===e.FLOAT&&o.indexOf(t)>=0&&(e.getExtension("OES_texture_float_linear")||(t=e.NEAREST)),a.indexOf(t)<0)throw new Error("gl-texture2d: Unknown filter mode "+t);return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),this._minFilter=t}},magFilter:{get:function(){return this._magFilter},set:function(t){this.bind();var e=this.gl;if(this.type===e.FLOAT&&o.indexOf(t)>=0&&(e.getExtension("OES_texture_float_linear")||(t=e.NEAREST)),a.indexOf(t)<0)throw new Error("gl-texture2d: Unknown filter mode "+t);return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),this._magFilter=t}},mipSamples:{get:function(){return this._anisoSamples},set:function(t){var e=this._anisoSamples;if(this._anisoSamples=0|Math.max(t,1),e!==this._anisoSamples){var i=this.gl.getExtension("EXT_texture_filter_anisotropic");i&&this.gl.texParameterf(this.gl.TEXTURE_2D,i.TEXTURE_MAX_ANISOTROPY_EXT,this._anisoSamples)}return this._anisoSamples}},wrapS:{get:function(){return this._wrapS},set:function(t){if(this.bind(),u.indexOf(t)<0)throw new Error("gl-texture2d: Unknown wrap mode "+t);return this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,t),this._wrapS=t}},wrapT:{get:function(){return this._wrapT},set:function(t){if(this.bind(),u.indexOf(t)<0)throw new Error("gl-texture2d: Unknown wrap mode "+t);return this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,t),this._wrapT=t}},wrap:{get:function(){return this._wrapVector},set:function(t){if(Array.isArray(t)||(t=[t,t]),2!==t.length)throw new Error("gl-texture2d: Must specify wrap mode for rows and columns");for(var e=0;e<2;++e)if(u.indexOf(t[e])<0)throw new Error("gl-texture2d: Unknown wrap mode "+t);this._wrapS=t[0],this._wrapT=t[1];var i=this.gl;return this.bind(),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,this._wrapS),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,this._wrapT),t}},shape:{get:function(){return this._shapeVector},set:function(t){if(Array.isArray(t)){if(2!==t.length)throw new Error("gl-texture2d: Invalid texture shape")}else t=[0|t,0|t];return m(this,0|t[0],0|t[1]),[0|t[0],0|t[1]]}},width:{get:function(){return this._shape[0]},set:function(t){return m(this,t|=0,this._shape[1]),t}},height:{get:function(){return this._shape[1]},set:function(t){return t|=0,m(this,this._shape[0],t),t}}}),f.bind=function(t){var e=this.gl;return void 0!==t&&e.activeTexture(e.TEXTURE0+(0|t)),e.bindTexture(e.TEXTURE_2D,this.handle),void 0!==t?0|t:e.getParameter(e.ACTIVE_TEXTURE)-e.TEXTURE0},f.dispose=function(){this.gl.deleteTexture(this.handle)},f.generateMipmap=function(){this.bind(),this.gl.generateMipmap(this.gl.TEXTURE_2D);for(var t=Math.min(this._shape[0],this._shape[1]),e=0;t>0;++e,t>>>=1)this._mipLevels.indexOf(e)<0&&this._mipLevels.push(e)},f.setPixels=function(t,e,i,o){var a=this.gl;this.bind(),Array.isArray(e)?(o=i,i=0|e[1],e=0|e[0]):(e=e||0,i=i||0),o=o||0;var u=h(t)?t:t.raw;if(u){this._mipLevels.indexOf(o)<0?(a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,this.type,u),this._mipLevels.push(o)):a.texSubImage2D(a.TEXTURE_2D,o,e,i,this.format,this.type,u)}else{if(!(t.shape&&t.stride&&t.data))throw new Error("gl-texture2d: Unsupported data type");if(t.shape.length<2||e+t.shape[1]>this._shape[1]>>>o||i+t.shape[0]>this._shape[0]>>>o||e<0||i<0)throw new Error("gl-texture2d: Texture dimensions are out of bounds");!function(t,e,i,o,a,u,l,h){var m=h.dtype,_=h.shape.slice();if(_.length<2||_.length>3)throw new Error("gl-texture2d: Invalid ndarray, must be 2d or 3d");var f=0,p=0,v=d(_,h.stride.slice());"float32"===m?f=t.FLOAT:"float64"===m?(f=t.FLOAT,v=!1,m="float32"):"uint8"===m?f=t.UNSIGNED_BYTE:(f=t.UNSIGNED_BYTE,v=!1,m="uint8");if(2===_.length)p=t.LUMINANCE,_=[_[0],_[1],1],h=n(h.data,_,[h.stride[0],h.stride[1],1],h.offset);else{if(3!==_.length)throw new Error("gl-texture2d: Invalid shape for texture");if(1===_[2])p=t.ALPHA;else if(2===_[2])p=t.LUMINANCE_ALPHA;else if(3===_[2])p=t.RGB;else{if(4!==_[2])throw new Error("gl-texture2d: Invalid shape for pixel coords");p=t.RGBA}_[2]}p!==t.LUMINANCE&&p!==t.ALPHA||a!==t.LUMINANCE&&a!==t.ALPHA||(p=a);if(p!==a)throw new Error("gl-texture2d: Incompatible texture format for setPixels");var y=h.size,g=l.indexOf(o)<0;g&&l.push(o);if(f===u&&v)0===h.offset&&h.data.length===y?g?t.texImage2D(t.TEXTURE_2D,o,a,_[0],_[1],0,a,u,h.data):t.texSubImage2D(t.TEXTURE_2D,o,e,i,_[0],_[1],a,u,h.data):g?t.texImage2D(t.TEXTURE_2D,o,a,_[0],_[1],0,a,u,h.data.subarray(h.offset,h.offset+y)):t.texSubImage2D(t.TEXTURE_2D,o,e,i,_[0],_[1],a,u,h.data.subarray(h.offset,h.offset+y));else{var x;x=u===t.FLOAT?s.mallocFloat32(y):s.mallocUint8(y);var b=n(x,_,[_[2],_[2]*_[0],1]);f===t.FLOAT&&u===t.UNSIGNED_BYTE?c(b,h):r.assign(b,h),g?t.texImage2D(t.TEXTURE_2D,o,a,_[0],_[1],0,a,u,x.subarray(0,y)):t.texSubImage2D(t.TEXTURE_2D,o,e,i,_[0],_[1],a,u,x.subarray(0,y)),u===t.FLOAT?s.freeFloat32(x):s.freeUint8(x)}}(a,e,i,o,this.format,this.type,this._mipLevels,t)}}},function(t,e,i){"use strict";t.exports=function(t){for(var e=new Array(t),i=0;i<t;++i)e[i]=i;return e}},function(t,e){function i(t){return!!t.constructor&&"function"===typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}t.exports=function(t){return null!=t&&(i(t)||function(t){return"function"===typeof t.readFloatLE&&"function"===typeof t.slice&&i(t.slice(0,0))}(t)||!!t._isBuffer)}},function(t,e,i){"use strict";var n=i(64),r={body:"",args:[],thisVars:[],localVars:[]};function s(t){if(!t)return r;for(var e=0;e<t.args.length;++e){var i=t.args[e];t.args[e]=0===e?{name:i,lvalue:!0,rvalue:!!t.rvalue,count:t.count||1}:{name:i,lvalue:!1,rvalue:!0,count:1}}return t.thisVars||(t.thisVars=[]),t.localVars||(t.localVars=[]),t}function o(t){for(var e=[],i=0;i<t.args.length;++i)e.push("a"+i);return new Function("P",["return function ",t.funcName,"_ndarrayops(",e.join(","),") {P(",e.join(","),");return a0}"].join(""))(function(t){return n({args:t.args,pre:s(t.pre),body:s(t.body),post:s(t.proc),funcName:t.funcName})}(t))}var a={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var t in a){var i=a[t];e[t]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+i+"c"},funcName:t}),e[t+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a"+i+"=b"},rvalue:!0,funcName:t+"eq"}),e[t+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+i+"s"},funcName:t+"s"}),e[t+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a"+i+"=s"},rvalue:!0,funcName:t+"seq"})}}();var u={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var t in u){var i=u[t];e[t]=o({args:["array","array"],body:{args:["a","b"],body:"a="+i+"b"},funcName:t}),e[t+"eq"]=o({args:["array"],body:{args:["a"],body:"a="+i+"a"},rvalue:!0,count:2,funcName:t+"eq"})}}();var l={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var t in l){var i=l[t];e[t]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+i+"c"},funcName:t}),e[t+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+i+"s"},funcName:t+"s"}),e[t+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a=a"+i+"b"},rvalue:!0,count:2,funcName:t+"eq"}),e[t+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+i+"s"},rvalue:!0,count:2,funcName:t+"seq"})}}();var h=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var t=0;t<h.length;++t){var i=h[t];e[i]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:i}),e[i+"eq"]=o({args:["array"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:i+"eq"})}}();var c=["max","min","atan2","pow"];!function(){for(var t=0;t<c.length;++t){var i=c[t];e[i]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:i}),e[i+"s"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:i+"s"}),e[i+"eq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:i+"eq"}),e[i+"seq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:i+"seq"})}}();var m=["atan2","pow"];!function(){for(var t=0;t<m.length;++t){var i=m[t];e[i+"op"]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:i+"op"}),e[i+"ops"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:i+"ops"}),e[i+"opeq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:i+"opeq"}),e[i+"opseq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:i+"opseq"})}}(),e.any=n({args:["array"],pre:r,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),e.all=n({args:["array"],pre:r,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),e.sum=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),e.prod=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),e.norm2squared=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),e.norm2=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),e.norminf=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),e.norm1=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),e.sup=n({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.inf=n({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.argmin=n({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.argmax=n({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.random=o({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),e.assign=o({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),e.assigns=o({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),e.equals=n({args:["array","array"],pre:r,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},function(t,e,i){"use strict";var n=i(65);function r(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}t.exports=function(t){var e=new r;e.pre=t.pre,e.body=t.body,e.post=t.post;var i=t.args.slice(0);e.argTypes=i;for(var s=0;s<i.length;++s){var o=i[s];if("array"===o||"object"===typeof o&&o.blockIndices){if(e.argTypes[s]="array",e.arrayArgs.push(s),e.arrayBlockIndices.push(o.blockIndices?o.blockIndices:0),e.shimArgs.push("array"+s),s<e.pre.args.length&&e.pre.args[s].count>0)throw new Error("cwise: pre() block may not reference array args");if(s<e.post.args.length&&e.post.args[s].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===o)e.scalarArgs.push(s),e.shimArgs.push("scalar"+s);else if("index"===o){if(e.indexArgs.push(s),s<e.pre.args.length&&e.pre.args[s].count>0)throw new Error("cwise: pre() block may not reference array index");if(s<e.body.args.length&&e.body.args[s].lvalue)throw new Error("cwise: body() block may not write to array index");if(s<e.post.args.length&&e.post.args[s].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===o){if(e.shapeArgs.push(s),s<e.pre.args.length&&e.pre.args[s].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(s<e.body.args.length&&e.body.args[s].lvalue)throw new Error("cwise: body() block may not write to array shape");if(s<e.post.args.length&&e.post.args[s].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!==typeof o||!o.offset)throw new Error("cwise: Unknown argument type "+i[s]);e.argTypes[s]="offset",e.offsetArgs.push({array:o.array,offset:o.offset}),e.offsetArgIndex.push(s)}}if(e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(e.pre.args.length>i.length)throw new Error("cwise: Too many arguments in pre() block");if(e.body.args.length>i.length)throw new Error("cwise: Too many arguments in body() block");if(e.post.args.length>i.length)throw new Error("cwise: Too many arguments in post() block");return e.debug=!!t.printCode||!!t.debug,e.funcName=t.funcName||"cwise",e.blockSize=t.blockSize||64,n(e)}},function(t,e,i){"use strict";var n=i(66);t.exports=function(t){var e=["'use strict'","var CACHED={}"],i=[],r=t.funcName+"_cwise_thunk";e.push(["return function ",r,"(",t.shimArgs.join(","),"){"].join(""));for(var s=[],o=[],a=[["array",t.arrayArgs[0],".shape.slice(",Math.max(0,t.arrayBlockIndices[0]),t.arrayBlockIndices[0]<0?","+t.arrayBlockIndices[0]+")":")"].join("")],u=[],l=[],h=0;h<t.arrayArgs.length;++h){var c=t.arrayArgs[h];i.push(["t",c,"=array",c,".dtype,","r",c,"=array",c,".order"].join("")),s.push("t"+c),s.push("r"+c),o.push("t"+c),o.push("r"+c+".join()"),a.push("array"+c+".data"),a.push("array"+c+".stride"),a.push("array"+c+".offset|0"),h>0&&(u.push("array"+t.arrayArgs[0]+".shape.length===array"+c+".shape.length+"+(Math.abs(t.arrayBlockIndices[0])-Math.abs(t.arrayBlockIndices[h]))),l.push("array"+t.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[0])+"]===array"+c+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[h])+"]"))}for(t.arrayArgs.length>1&&(e.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),e.push("for(var shapeIndex=array"+t.arrayArgs[0]+".shape.length-"+Math.abs(t.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),e.push("if (!("+l.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),e.push("}")),h=0;h<t.scalarArgs.length;++h)a.push("scalar"+t.scalarArgs[h]);return i.push(["type=[",o.join(","),"].join()"].join("")),i.push("proc=CACHED[type]"),e.push("var "+i.join(",")),e.push(["if(!proc){","CACHED[type]=proc=compile([",s.join(","),"])}","return proc(",a.join(","),")}"].join("")),t.debug&&console.log("-----Generated thunk:\n"+e.join("\n")+"\n----------"),new Function("compile",e.join("\n"))(n.bind(void 0,t))}},function(t,e,i){"use strict";var n=i(67);function r(t,e,i){var n,r,s=t.length,o=e.arrayArgs.length,a=e.indexArgs.length>0,u=[],l=[],h=0,c=0;for(n=0;n<s;++n)l.push(["i",n,"=0"].join(""));for(r=0;r<o;++r)for(n=0;n<s;++n)c=h,h=t[n],0===n?l.push(["d",r,"s",n,"=t",r,"p",h].join("")):l.push(["d",r,"s",n,"=(t",r,"p",h,"-s",c,"*t",r,"p",c,")"].join(""));for(l.length>0&&u.push("var "+l.join(",")),n=s-1;n>=0;--n)h=t[n],u.push(["for(i",n,"=0;i",n,"<s",h,";++i",n,"){"].join(""));for(u.push(i),n=0;n<s;++n){for(c=h,h=t[n],r=0;r<o;++r)u.push(["p",r,"+=d",r,"s",n].join(""));a&&(n>0&&u.push(["index[",c,"]-=s",c].join("")),u.push(["++index[",h,"]"].join(""))),u.push("}")}return u.join("\n")}function s(t,e,i){for(var n=t.body,r=[],s=[],o=0;o<t.args.length;++o){var a=t.args[o];if(!(a.count<=0)){var u=new RegExp(a.name,"g"),l="",h=e.arrayArgs.indexOf(o);switch(e.argTypes[o]){case"offset":var c=e.offsetArgIndex.indexOf(o);h=e.offsetArgs[c].array,l="+q"+c;case"array":l="p"+h+l;var m="l"+o,_="a"+h;if(0===e.arrayBlockIndices[h])1===a.count?"generic"===i[h]?a.lvalue?(r.push(["var ",m,"=",_,".get(",l,")"].join("")),n=n.replace(u,m),s.push([_,".set(",l,",",m,")"].join(""))):n=n.replace(u,[_,".get(",l,")"].join("")):n=n.replace(u,[_,"[",l,"]"].join("")):"generic"===i[h]?(r.push(["var ",m,"=",_,".get(",l,")"].join("")),n=n.replace(u,m),a.lvalue&&s.push([_,".set(",l,",",m,")"].join(""))):(r.push(["var ",m,"=",_,"[",l,"]"].join("")),n=n.replace(u,m),a.lvalue&&s.push([_,"[",l,"]=",m].join("")));else{for(var f=[a.name],d=[l],p=0;p<Math.abs(e.arrayBlockIndices[h]);p++)f.push("\\s*\\[([^\\]]+)\\]"),d.push("$"+(p+1)+"*t"+h+"b"+p);if(u=new RegExp(f.join(""),"g"),l=d.join("+"),"generic"===i[h])throw new Error("cwise: Generic arrays not supported in combination with blocks!");n=n.replace(u,[_,"[",l,"]"].join(""))}break;case"scalar":n=n.replace(u,"Y"+e.scalarArgs.indexOf(o));break;case"index":n=n.replace(u,"index");break;case"shape":n=n.replace(u,"shape")}}}return[r.join("\n"),n,s.join("\n")].join("\n").trim()}function o(t){for(var e=new Array(t.length),i=!0,n=0;n<t.length;++n){var r=t[n],s=r.match(/\d+/);s=s?s[0]:"",0===r.charAt(0)?e[n]="u"+r.charAt(1)+s:e[n]=r.charAt(0)+s,n>0&&(i=i&&e[n]===e[n-1])}return i?e[0]:e.join("")}t.exports=function(t,e){for(var i=e[1].length-Math.abs(t.arrayBlockIndices[0])|0,a=new Array(t.arrayArgs.length),u=new Array(t.arrayArgs.length),l=0;l<t.arrayArgs.length;++l)u[l]=e[2*l],a[l]=e[2*l+1];var h=[],c=[],m=[],_=[],f=[];for(l=0;l<t.arrayArgs.length;++l){t.arrayBlockIndices[l]<0?(m.push(0),_.push(i),h.push(i),c.push(i+t.arrayBlockIndices[l])):(m.push(t.arrayBlockIndices[l]),_.push(t.arrayBlockIndices[l]+i),h.push(0),c.push(t.arrayBlockIndices[l]));for(var d=[],p=0;p<a[l].length;p++)m[l]<=a[l][p]&&a[l][p]<_[l]&&d.push(a[l][p]-m[l]);f.push(d)}var v=["SS"],y=["'use strict'"],g=[];for(p=0;p<i;++p)g.push(["s",p,"=SS[",p,"]"].join(""));for(l=0;l<t.arrayArgs.length;++l){v.push("a"+l),v.push("t"+l),v.push("p"+l);for(p=0;p<i;++p)g.push(["t",l,"p",p,"=t",l,"[",m[l]+p,"]"].join(""));for(p=0;p<Math.abs(t.arrayBlockIndices[l]);++p)g.push(["t",l,"b",p,"=t",l,"[",h[l]+p,"]"].join(""))}for(l=0;l<t.scalarArgs.length;++l)v.push("Y"+l);if(t.shapeArgs.length>0&&g.push("shape=SS.slice(0)"),t.indexArgs.length>0){var x=new Array(i);for(l=0;l<i;++l)x[l]="0";g.push(["index=[",x.join(","),"]"].join(""))}for(l=0;l<t.offsetArgs.length;++l){var b=t.offsetArgs[l],w=[];for(p=0;p<b.offset.length;++p)0!==b.offset[p]&&(1===b.offset[p]?w.push(["t",b.array,"p",p].join("")):w.push([b.offset[p],"*t",b.array,"p",p].join("")));0===w.length?g.push("q"+l+"=0"):g.push(["q",l,"=",w.join("+")].join(""))}var A=n([].concat(t.pre.thisVars).concat(t.body.thisVars).concat(t.post.thisVars));for((g=g.concat(A)).length>0&&y.push("var "+g.join(",")),l=0;l<t.arrayArgs.length;++l)y.push("p"+l+"|=0");t.pre.body.length>3&&y.push(s(t.pre,t,u));var S=s(t.body,t,u),B=function(t){for(var e=0,i=t[0].length;e<i;){for(var n=1;n<t.length;++n)if(t[n][e]!==t[0][e])return e;++e}return e}(f);B<i?y.push(function(t,e,i,n){for(var s=e.length,o=i.arrayArgs.length,a=i.blockSize,u=i.indexArgs.length>0,l=[],h=0;h<o;++h)l.push(["var offset",h,"=p",h].join(""));for(h=t;h<s;++h)l.push(["for(var j"+h+"=SS[",e[h],"]|0;j",h,">0;){"].join("")),l.push(["if(j",h,"<",a,"){"].join("")),l.push(["s",e[h],"=j",h].join("")),l.push(["j",h,"=0"].join("")),l.push(["}else{s",e[h],"=",a].join("")),l.push(["j",h,"-=",a,"}"].join("")),u&&l.push(["index[",e[h],"]=j",h].join(""));for(h=0;h<o;++h){for(var c=["offset"+h],m=t;m<s;++m)c.push(["j",m,"*t",h,"p",e[m]].join(""));l.push(["p",h,"=(",c.join("+"),")"].join(""))}for(l.push(r(e,i,n)),h=t;h<s;++h)l.push("}");return l.join("\n")}(B,f[0],t,S)):y.push(r(f[0],t,S)),t.post.body.length>3&&y.push(s(t.post,t,u)),t.debug&&console.log("-----Generated cwise routine for ",e,":\n"+y.join("\n")+"\n----------");var C=[t.funcName||"unnamed","_cwise_loop_",a[0].join("s"),"m",B,o(u)].join("");return new Function(["function ",C,"(",v.join(","),"){",y.join("\n"),"} return ",C].join(""))()}},function(t,e,i){"use strict";t.exports=function(t,e,i){return 0===t.length?t:e?(i||t.sort(e),function(t,e){for(var i=1,n=t.length,r=t[0],s=t[0],o=1;o<n;++o)if(s=r,e(r=t[o],s)){if(o===i){i++;continue}t[i++]=r}return t.length=i,t}(t,e)):(i||t.sort(),function(t){for(var e=1,i=t.length,n=t[0],r=t[0],s=1;s<i;++s,r=n)if(r=n,(n=t[s])!==r){if(s===e){e++;continue}t[e++]=n}return t.length=e,t}(t))}},function(t,e,i){"use strict";(function(t){var n=i(69),r=i(70),s=i(71).Buffer;t.__TYPEDARRAY_POOL||(t.__TYPEDARRAY_POOL={UINT8:r([32,0]),UINT16:r([32,0]),UINT32:r([32,0]),BIGUINT64:r([32,0]),INT8:r([32,0]),INT16:r([32,0]),INT32:r([32,0]),BIGINT64:r([32,0]),FLOAT:r([32,0]),DOUBLE:r([32,0]),DATA:r([32,0]),UINT8C:r([32,0]),BUFFER:r([32,0])});var o="undefined"!==typeof Uint8ClampedArray,a="undefined"!==typeof BigUint64Array,u="undefined"!==typeof BigInt64Array,l=t.__TYPEDARRAY_POOL;l.UINT8C||(l.UINT8C=r([32,0])),l.BIGUINT64||(l.BIGUINT64=r([32,0])),l.BIGINT64||(l.BIGINT64=r([32,0])),l.BUFFER||(l.BUFFER=r([32,0]));var h=l.DATA,c=l.BUFFER;function m(t){if(t){var e=t.length||t.byteLength,i=n.log2(e);h[i].push(t)}}function _(t){t=n.nextPow2(t);var e=n.log2(t),i=h[e];return i.length>0?i.pop():new ArrayBuffer(t)}function f(t){return new Uint8Array(_(t),0,t)}function d(t){return new Uint16Array(_(2*t),0,t)}function p(t){return new Uint32Array(_(4*t),0,t)}function v(t){return new Int8Array(_(t),0,t)}function y(t){return new Int16Array(_(2*t),0,t)}function g(t){return new Int32Array(_(4*t),0,t)}function x(t){return new Float32Array(_(4*t),0,t)}function b(t){return new Float64Array(_(8*t),0,t)}function w(t){return o?new Uint8ClampedArray(_(t),0,t):f(t)}function A(t){return a?new BigUint64Array(_(8*t),0,t):null}function S(t){return u?new BigInt64Array(_(8*t),0,t):null}function B(t){return new DataView(_(t),0,t)}function C(t){t=n.nextPow2(t);var e=n.log2(t),i=c[e];return i.length>0?i.pop():new s(t)}e.free=function(t){if(s.isBuffer(t))c[n.log2(t.length)].push(t);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(t)&&(t=t.buffer),!t)return;var e=t.length||t.byteLength,i=0|n.log2(e);h[i].push(t)}},e.freeUint8=e.freeUint16=e.freeUint32=e.freeBigUint64=e.freeInt8=e.freeInt16=e.freeInt32=e.freeBigInt64=e.freeFloat32=e.freeFloat=e.freeFloat64=e.freeDouble=e.freeUint8Clamped=e.freeDataView=function(t){m(t.buffer)},e.freeArrayBuffer=m,e.freeBuffer=function(t){c[n.log2(t.length)].push(t)},e.malloc=function(t,e){if(void 0===e||"arraybuffer"===e)return _(t);switch(e){case"uint8":return f(t);case"uint16":return d(t);case"uint32":return p(t);case"int8":return v(t);case"int16":return y(t);case"int32":return g(t);case"float":case"float32":return x(t);case"double":case"float64":return b(t);case"uint8_clamped":return w(t);case"bigint64":return S(t);case"biguint64":return A(t);case"buffer":return C(t);case"data":case"dataview":return B(t);default:return null}return null},e.mallocArrayBuffer=_,e.mallocUint8=f,e.mallocUint16=d,e.mallocUint32=p,e.mallocInt8=v,e.mallocInt16=y,e.mallocInt32=g,e.mallocFloat32=e.mallocFloat=x,e.mallocFloat64=e.mallocDouble=b,e.mallocUint8Clamped=w,e.mallocBigUint64=A,e.mallocBigInt64=S,e.mallocDataView=B,e.mallocBuffer=C,e.clearCache=function(){for(var t=0;t<32;++t)l.UINT8[t].length=0,l.UINT16[t].length=0,l.UINT32[t].length=0,l.INT8[t].length=0,l.INT16[t].length=0,l.INT32[t].length=0,l.FLOAT[t].length=0,l.DOUBLE[t].length=0,l.BIGUINT64[t].length=0,l.BIGINT64[t].length=0,l.UINT8C[t].length=0,h[t].length=0,c[t].length=0}}).call(this,i(33))},function(t,e,i){"use strict";function n(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}e.INT_BITS=32,e.INT_MAX=2147483647,e.INT_MIN=-1<<31,e.sign=function(t){return(t>0)-(t<0)},e.abs=function(t){var e=t>>31;return(t^e)-e},e.min=function(t,e){return e^(t^e)&-(t<e)},e.max=function(t,e){return t^(t^e)&-(t<e)},e.isPow2=function(t){return!(t&t-1)&&!!t},e.log2=function(t){var e,i;return e=(t>65535)<<4,e|=i=((t>>>=e)>255)<<3,e|=i=((t>>>=i)>15)<<2,(e|=i=((t>>>=i)>3)<<1)|(t>>>=i)>>1},e.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},e.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},e.countTrailingZeros=n,e.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1},e.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},e.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var r=new Array(256);!function(t){for(var e=0;e<256;++e){var i=e,n=e,r=7;for(i>>>=1;i;i>>>=1)n<<=1,n|=1&i,--r;t[e]=n<<r&255}}(r),e.reverse=function(t){return r[255&t]<<24|r[t>>>8&255]<<16|r[t>>>16&255]<<8|r[t>>>24&255]},e.interleave2=function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},e.deinterleave2=function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},e.interleave3=function(t,e,i){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<2},e.deinterleave3=function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},e.nextCombination=function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>n(t)+1}},function(t,e,i){"use strict";function n(t,e,i){var r=0|t[i];if(r<=0)return[];var s,o=new Array(r);if(i===t.length-1)for(s=0;s<r;++s)o[s]=e;else for(s=0;s<r;++s)o[s]=n(t,e,i+1);return o}t.exports=function(t,e){switch("undefined"===typeof e&&(e=0),typeof t){case"number":if(t>0)return function(t,e){var i,n;for(i=new Array(t),n=0;n<t;++n)i[n]=e;return i}(0|t,e);break;case"object":if("number"===typeof t.length)return n(t,e,0)}return[]}},function(t,e,i){"use strict";(function(t){var n=i(72),r=i(73),s=i(74);function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(o()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=u.prototype:(null===t&&(t=new u(e)),t.length=e),t}function u(t,e,i){if(!u.TYPED_ARRAY_SUPPORT&&!(this instanceof u))return new u(t,e,i);if("number"===typeof t){if("string"===typeof e)throw new Error("If encoding is specified then the first argument must be a string");return c(this,t)}return l(this,t,e,i)}function l(t,e,i,n){if("number"===typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,i,n){if(e.byteLength,i<0||e.byteLength<i)throw new RangeError("'offset' is out of bounds");if(e.byteLength<i+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===i&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,i):new Uint8Array(e,i,n);u.TYPED_ARRAY_SUPPORT?(t=e).__proto__=u.prototype:t=m(t,e);return t}(t,e,i,n):"string"===typeof e?function(t,e,i){"string"===typeof i&&""!==i||(i="utf8");if(!u.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var n=0|f(e,i),r=(t=a(t,n)).write(e,i);r!==n&&(t=t.slice(0,r));return t}(t,e,i):function(t,e){if(u.isBuffer(e)){var i=0|_(e.length);return 0===(t=a(t,i)).length||e.copy(t,0,0,i),t}if(e){if("undefined"!==typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!==typeof e.length||(n=e.length)!==n?a(t,0):m(t,e);if("Buffer"===e.type&&s(e.data))return m(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function h(t){if("number"!==typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function c(t,e){if(h(e),t=a(t,e<0?0:0|_(e)),!u.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function m(t,e){var i=e.length<0?0:0|_(e.length);t=a(t,i);for(var n=0;n<i;n+=1)t[n]=255&e[n];return t}function _(t){if(t>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|t}function f(t,e){if(u.isBuffer(t))return t.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!==typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return N(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return q(t).length;default:if(n)return N(t).length;e=(""+e).toLowerCase(),n=!0}}function d(t,e,i){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return P(this,e,i);case"utf8":case"utf-8":return C(this,e,i);case"ascii":return M(this,e,i);case"latin1":case"binary":return k(this,e,i);case"base64":return B(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,i);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function p(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function v(t,e,i,n,r){if(0===t.length)return-1;if("string"===typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=r?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(r)return-1;i=t.length-1}else if(i<0){if(!r)return-1;i=0}if("string"===typeof e&&(e=u.from(e,n)),u.isBuffer(e))return 0===e.length?-1:y(t,e,i,n,r);if("number"===typeof e)return e&=255,u.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):y(t,[e],i,n,r);throw new TypeError("val must be string, number or Buffer")}function y(t,e,i,n,r){var s,o=1,a=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;o=2,a/=2,u/=2,i/=2}function l(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(r){var h=-1;for(s=i;s<a;s++)if(l(t,s)===l(e,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===u)return h*o}else-1!==h&&(s-=s-h),h=-1}else for(i+u>a&&(i=a-u),s=i;s>=0;s--){for(var c=!0,m=0;m<u;m++)if(l(t,s+m)!==l(e,m)){c=!1;break}if(c)return s}return-1}function g(t,e,i,n){i=Number(i)||0;var r=t.length-i;n?(n=Number(n))>r&&(n=r):n=r;var s=e.length;if(s%2!==0)throw new TypeError("Invalid hex string");n>s/2&&(n=s/2);for(var o=0;o<n;++o){var a=parseInt(e.substr(2*o,2),16);if(isNaN(a))return o;t[i+o]=a}return o}function x(t,e,i,n){return z(N(e,t.length-i),t,i,n)}function b(t,e,i,n){return z(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,n)}function w(t,e,i,n){return b(t,e,i,n)}function A(t,e,i,n){return z(q(e),t,i,n)}function S(t,e,i,n){return z(function(t,e){for(var i,n,r,s=[],o=0;o<t.length&&!((e-=2)<0);++o)n=(i=t.charCodeAt(o))>>8,r=i%256,s.push(r),s.push(n);return s}(e,t.length-i),t,i,n)}function B(t,e,i){return 0===e&&i===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,i))}function C(t,e,i){i=Math.min(t.length,i);for(var n=[],r=e;r<i;){var s,o,a,u,l=t[r],h=null,c=l>239?4:l>223?3:l>191?2:1;if(r+c<=i)switch(c){case 1:l<128&&(h=l);break;case 2:128===(192&(s=t[r+1]))&&(u=(31&l)<<6|63&s)>127&&(h=u);break;case 3:s=t[r+1],o=t[r+2],128===(192&s)&&128===(192&o)&&(u=(15&l)<<12|(63&s)<<6|63&o)>2047&&(u<55296||u>57343)&&(h=u);break;case 4:s=t[r+1],o=t[r+2],a=t[r+3],128===(192&s)&&128===(192&o)&&128===(192&a)&&(u=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&u<1114112&&(h=u)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),r+=c}return function(t){var e=t.length;if(e<=V)return String.fromCharCode.apply(String,t);var i="",n=0;for(;n<e;)i+=String.fromCharCode.apply(String,t.slice(n,n+=V));return i}(n)}e.Buffer=u,e.SlowBuffer=function(t){+t!=t&&(t=0);return u.alloc(+t)},e.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"===typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(e){return!1}}(),e.kMaxLength=o(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,e,i){return l(null,t,e,i)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,e,i){return function(t,e,i,n){return h(e),e<=0?a(t,e):void 0!==i?"string"===typeof n?a(t,e).fill(i,n):a(t,e).fill(i):a(t,e)}(null,t,e,i)},u.allocUnsafe=function(t){return c(null,t)},u.allocUnsafeSlow=function(t){return c(null,t)},u.isBuffer=function(t){return!(null==t||!t._isBuffer)},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var i=t.length,n=e.length,r=0,s=Math.min(i,n);r<s;++r)if(t[r]!==e[r]){i=t[r],n=e[r];break}return i<n?-1:n<i?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!s(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return u.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var n=u.allocUnsafe(e),r=0;for(i=0;i<t.length;++i){var o=t[i];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,r),r+=o.length}return n},u.byteLength=f,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)p(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)p(this,e,e+3),p(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)p(this,e,e+7),p(this,e+1,e+6),p(this,e+2,e+5),p(this,e+3,e+4);return this},u.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?C(this,0,t):d.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",i=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,i,n,r){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),e<0||i>t.length||n<0||r>this.length)throw new RangeError("out of range index");if(n>=r&&e>=i)return 0;if(n>=r)return-1;if(e>=i)return 1;if(this===t)return 0;for(var s=(r>>>=0)-(n>>>=0),o=(i>>>=0)-(e>>>=0),a=Math.min(s,o),l=this.slice(n,r),h=t.slice(e,i),c=0;c<a;++c)if(l[c]!==h[c]){s=l[c],o=h[c];break}return s<o?-1:o<s?1:0},u.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},u.prototype.indexOf=function(t,e,i){return v(this,t,e,i,!0)},u.prototype.lastIndexOf=function(t,e,i){return v(this,t,e,i,!1)},u.prototype.write=function(t,e,i,n){if(void 0===e)n="utf8",i=this.length,e=0;else if(void 0===i&&"string"===typeof e)n=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-e;if((void 0===i||i>r)&&(i=r),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return g(this,t,e,i);case"utf8":case"utf-8":return x(this,t,e,i);case"ascii":return b(this,t,e,i);case"latin1":case"binary":return w(this,t,e,i);case"base64":return A(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,e,i);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var V=4096;function M(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(127&t[r]);return n}function k(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(t[r]);return n}function P(t,e,i){var n=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>n)&&(i=n);for(var r="",s=e;s<i;++s)r+=O(t[s]);return r}function I(t,e,i){for(var n=t.slice(e,i),r="",s=0;s<n.length;s+=2)r+=String.fromCharCode(n[s]+256*n[s+1]);return r}function T(t,e,i){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function D(t,e,i,n,r,s){if(!u.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<s)throw new RangeError('"value" argument is out of bounds');if(i+n>t.length)throw new RangeError("Index out of range")}function G(t,e,i,n){e<0&&(e=65535+e+1);for(var r=0,s=Math.min(t.length-i,2);r<s;++r)t[i+r]=(e&255<<8*(n?r:1-r))>>>8*(n?r:1-r)}function R(t,e,i,n){e<0&&(e=4294967295+e+1);for(var r=0,s=Math.min(t.length-i,4);r<s;++r)t[i+r]=e>>>8*(n?r:3-r)&255}function E(t,e,i,n,r,s){if(i+n>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function F(t,e,i,n,s){return s||E(t,0,i,4),r.write(t,e,i,n,23,4),i+4}function L(t,e,i,n,s){return s||E(t,0,i,8),r.write(t,e,i,n,52,8),i+8}u.prototype.slice=function(t,e){var i,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),u.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,e)).__proto__=u.prototype;else{var r=e-t;i=new u(r,void 0);for(var s=0;s<r;++s)i[s]=this[s+t]}return i},u.prototype.readUIntLE=function(t,e,i){t|=0,e|=0,i||T(t,e,this.length);for(var n=this[t],r=1,s=0;++s<e&&(r*=256);)n+=this[t+s]*r;return n},u.prototype.readUIntBE=function(t,e,i){t|=0,e|=0,i||T(t,e,this.length);for(var n=this[t+--e],r=1;e>0&&(r*=256);)n+=this[t+--e]*r;return n},u.prototype.readUInt8=function(t,e){return e||T(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return e||T(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return e||T(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return e||T(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return e||T(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,i){t|=0,e|=0,i||T(t,e,this.length);for(var n=this[t],r=1,s=0;++s<e&&(r*=256);)n+=this[t+s]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*e)),n},u.prototype.readIntBE=function(t,e,i){t|=0,e|=0,i||T(t,e,this.length);for(var n=e,r=1,s=this[t+--n];n>0&&(r*=256);)s+=this[t+--n]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*e)),s},u.prototype.readInt8=function(t,e){return e||T(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){e||T(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},u.prototype.readInt16BE=function(t,e){e||T(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},u.prototype.readInt32LE=function(t,e){return e||T(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return e||T(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return e||T(t,4,this.length),r.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return e||T(t,4,this.length),r.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return e||T(t,8,this.length),r.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return e||T(t,8,this.length),r.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,i,n){(t=+t,e|=0,i|=0,n)||D(this,t,e,i,Math.pow(2,8*i)-1,0);var r=1,s=0;for(this[e]=255&t;++s<i&&(r*=256);)this[e+s]=t/r&255;return e+i},u.prototype.writeUIntBE=function(t,e,i,n){(t=+t,e|=0,i|=0,n)||D(this,t,e,i,Math.pow(2,8*i)-1,0);var r=i-1,s=1;for(this[e+r]=255&t;--r>=0&&(s*=256);)this[e+r]=t/s&255;return e+i},u.prototype.writeUInt8=function(t,e,i){return t=+t,e|=0,i||D(this,t,e,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,i){return t=+t,e|=0,i||D(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):G(this,t,e,!0),e+2},u.prototype.writeUInt16BE=function(t,e,i){return t=+t,e|=0,i||D(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):G(this,t,e,!1),e+2},u.prototype.writeUInt32LE=function(t,e,i){return t=+t,e|=0,i||D(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):R(this,t,e,!0),e+4},u.prototype.writeUInt32BE=function(t,e,i){return t=+t,e|=0,i||D(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):R(this,t,e,!1),e+4},u.prototype.writeIntLE=function(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);D(this,t,e,i,r-1,-r)}var s=0,o=1,a=0;for(this[e]=255&t;++s<i&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+i},u.prototype.writeIntBE=function(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);D(this,t,e,i,r-1,-r)}var s=i-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+i},u.prototype.writeInt8=function(t,e,i){return t=+t,e|=0,i||D(this,t,e,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,i){return t=+t,e|=0,i||D(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):G(this,t,e,!0),e+2},u.prototype.writeInt16BE=function(t,e,i){return t=+t,e|=0,i||D(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):G(this,t,e,!1),e+2},u.prototype.writeInt32LE=function(t,e,i){return t=+t,e|=0,i||D(this,t,e,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):R(this,t,e,!0),e+4},u.prototype.writeInt32BE=function(t,e,i){return t=+t,e|=0,i||D(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):R(this,t,e,!1),e+4},u.prototype.writeFloatLE=function(t,e,i){return F(this,t,e,!0,i)},u.prototype.writeFloatBE=function(t,e,i){return F(this,t,e,!1,i)},u.prototype.writeDoubleLE=function(t,e,i){return L(this,t,e,!0,i)},u.prototype.writeDoubleBE=function(t,e,i){return L(this,t,e,!1,i)},u.prototype.copy=function(t,e,i,n){if(i||(i=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-i&&(n=t.length-e+i);var r,s=n-i;if(this===t&&i<e&&e<n)for(r=s-1;r>=0;--r)t[r+e]=this[r+i];else if(s<1e3||!u.TYPED_ARRAY_SUPPORT)for(r=0;r<s;++r)t[r+e]=this[r+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+s),e);return s},u.prototype.fill=function(t,e,i,n){if("string"===typeof t){if("string"===typeof e?(n=e,e=0,i=this.length):"string"===typeof i&&(n=i,i=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==n&&"string"!==typeof n)throw new TypeError("encoding must be a string");if("string"===typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"===typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;var s;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"===typeof t)for(s=e;s<i;++s)this[s]=t;else{var o=u.isBuffer(t)?t:N(new u(t,n).toString()),a=o.length;for(s=0;s<i-e;++s)this[s+e]=o[s%a]}return this};var j=/[^+\/0-9A-Za-z-_]/g;function O(t){return t<16?"0"+t.toString(16):t.toString(16)}function N(t,e){var i;e=e||1/0;for(var n=t.length,r=null,s=[],o=0;o<n;++o){if((i=t.charCodeAt(o))>55295&&i<57344){if(!r){if(i>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}r=i;continue}if(i<56320){(e-=3)>-1&&s.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(e-=3)>-1&&s.push(239,191,189);if(r=null,i<128){if((e-=1)<0)break;s.push(i)}else if(i<2048){if((e-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function q(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(j,"")).length<2)return"";for(;t.length%4!==0;)t+="=";return t}(t))}function z(t,e,i,n){for(var r=0;r<n&&!(r+i>=e.length||r>=t.length);++r)e[r+i]=t[r];return r}}).call(this,i(33))},function(t,e,i){"use strict";e.byteLength=function(t){var e=l(t),i=e[0],n=e[1];return 3*(i+n)/4-n},e.toByteArray=function(t){var e,i,n=l(t),o=n[0],a=n[1],u=new s(function(t,e,i){return 3*(e+i)/4-i}(0,o,a)),h=0,c=a>0?o-4:o;for(i=0;i<c;i+=4)e=r[t.charCodeAt(i)]<<18|r[t.charCodeAt(i+1)]<<12|r[t.charCodeAt(i+2)]<<6|r[t.charCodeAt(i+3)],u[h++]=e>>16&255,u[h++]=e>>8&255,u[h++]=255&e;2===a&&(e=r[t.charCodeAt(i)]<<2|r[t.charCodeAt(i+1)]>>4,u[h++]=255&e);1===a&&(e=r[t.charCodeAt(i)]<<10|r[t.charCodeAt(i+1)]<<4|r[t.charCodeAt(i+2)]>>2,u[h++]=e>>8&255,u[h++]=255&e);return u},e.fromByteArray=function(t){for(var e,i=t.length,r=i%3,s=[],o=16383,a=0,u=i-r;a<u;a+=o)s.push(h(t,a,a+o>u?u:a+o));1===r?(e=t[i-1],s.push(n[e>>2]+n[e<<4&63]+"==")):2===r&&(e=(t[i-2]<<8)+t[i-1],s.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return s.join("")};for(var n=[],r=[],s="undefined"!==typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,u=o.length;a<u;++a)n[a]=o[a],r[o.charCodeAt(a)]=a;function l(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");return-1===i&&(i=e),[i,i===e?0:4-i%4]}function h(t,e,i){for(var r,s,o=[],a=e;a<i;a+=3)r=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),o.push(n[(s=r)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,i,n,r){var s,o,a=8*r-n-1,u=(1<<a)-1,l=u>>1,h=-7,c=i?r-1:0,m=i?-1:1,_=t[e+c];for(c+=m,s=_&(1<<-h)-1,_>>=-h,h+=a;h>0;s=256*s+t[e+c],c+=m,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=n;h>0;o=256*o+t[e+c],c+=m,h-=8);if(0===s)s=1-l;else{if(s===u)return o?NaN:1/0*(_?-1:1);o+=Math.pow(2,n),s-=l}return(_?-1:1)*o*Math.pow(2,s-n)},e.write=function(t,e,i,n,r,s){var o,a,u,l=8*s-r-1,h=(1<<l)-1,c=h>>1,m=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,_=n?0:s-1,f=n?1:-1,d=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+c>=1?m/u:m*Math.pow(2,1-c))*u>=2&&(o++,u/=2),o+c>=h?(a=0,o=h):o+c>=1?(a=(e*u-1)*Math.pow(2,r),o+=c):(a=e*Math.pow(2,c-1)*Math.pow(2,r),o=0));r>=8;t[i+_]=255&a,_+=f,a/=256,r-=8);for(o=o<<r|a,l+=r;l>0;t[i+_]=255&o,_+=f,o/=256,l-=8);t[i+_-f]|=128*d}},function(t,e){var i={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==i.call(t)}},function(t,e,i){var n=i(22);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t}},function(t,e,i){var n=i(77),r=i(78);t.exports=function(t,e){return!e||"object"!==n(e)&&"function"!==typeof e?r(t):e}},function(t,e){function i(e){return"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?t.exports=i=function(t){return typeof t}:t.exports=i=function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(e)}t.exports=i},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e,i){var n=i(35),r=i(36);function s(e,i,o){return r()?t.exports=s=Reflect.construct:t.exports=s=function(t,e,i){var r=[null];r.push.apply(r,e);var s=new(Function.bind.apply(t,r));return i&&n(s,i.prototype),s},s.apply(null,arguments)}t.exports=s},function(t,e,i){"use strict";var n=i(26),r=i(14),s=i(16),o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=o(i(27)),u=i(37),l=function(){function t(){r(this,t),this.index=0,this.mappers={},this.componentBitsMap=[],this.componentIndices=new Map,this.currentComponentIndex=0,this.activeSystems=[],this.passiveSystems=[],this.injectionRegistry={},this.delta=0}return s(t,[{key:"getNewId",value:function(){return this.index++}},{key:"createEntity",value:function(){return this.getNewId()}},{key:"getComponentBits",value:function(t){return this.componentBitsMap[t]||(this.componentBitsMap[t]=new a.default),this.componentBitsMap[t]}},{key:"getMapper",value:function(t){var e=this.getComponentIndex(t);return this.getMapperByIndex(e)}},{key:"getMapperByIndex",value:function(t){return this.mappers[t]||(this.mappers[t]=new u.ComponentMapper),this.mappers[t]}},{key:"getComponentIndex",value:function(t){var e=this.componentIndices.get(t);return void 0===e&&(e=this.currentComponentIndex++,this.componentIndices.set(t,e)),e}},{key:"createEntityByArchetype",value:function(t){var e=this,i=this.getNewId();return t.componentTypes.forEach((function(n){var r=new n;t.componentBitsInitialized||t.componentBits.add(e.getComponentIndex(n)),e.addComponent(i,r,!1)})),this.componentBitsMap[i]=t.componentBits,i}},{key:"addComponent",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.getComponentIndex(e.constructor),r=this.getMapperByIndex(n);return r.add(t,e),i&&this.getComponentBits(t).add(n),e}},{key:"getComponent",value:function(t,e){return this.getMapper(e).get(t)}},{key:"getEntities",value:function(t,e){for(var i=0;i<this.componentBitsMap.length;i++)if(this.componentBitsMap[i]){var n=this.componentBitsMap[i];t.union_size(n)===n.size()&&e(i)}}},{key:"addSystem",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e?this.activeSystems.push(t):this.passiveSystems.push(t),t.setWorld(this),this.injectMapper(t),this.inject(t),t.initialized()}},{key:"injectMapper",value:function(t){var e=t.constructor.__injectMapper__||{};for(var i in e){var n=e[i];t[i]=this.getMapper(n)}}},{key:"register",value:function(t,e){this.injectionRegistry[t]=e}},{key:"inject",value:function(t){var e=t.constructor.__inject__||{};for(var i in e){var n=e[i];t[i]=this.injectionRegistry[n]}}},{key:"dispose",value:function(){var t,e=n(this.activeSystems);try{for(e.s();!(t=e.n()).done;){t.value.dispose()}}catch(s){e.e(s)}finally{e.f()}var i,r=n(this.passiveSystems);try{for(r.s();!(i=r.n()).done;){i.value.dispose()}}catch(s){r.e(s)}finally{r.f()}}},{key:"setDelta",value:function(t){this.delta=t}},{key:"processActiveSystem",value:function(){var t,e=n(this.activeSystems);try{for(e.s();!(t=e.n()).done;){t.value.process()}}catch(i){e.e(i)}finally{e.f()}}},{key:"processPassiveSystem",value:function(){var t,e=n(this.passiveSystems);try{for(e.s();!(t=e.n()).done;){t.value.process()}}catch(i){e.e(i)}finally{e.f()}}},{key:"deleteEntity",value:function(t){for(var e in this.mappers)this.mappers[e].remove(t);delete this.componentBitsMap[t]}},{key:"isEntityActive",value:function(t){return!!this.componentBitsMap[t]}}]),t}();e.default=l},function(t,e,i){var n=i(82);t.exports=function(t,e){if(t){if("string"===typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(t,e):void 0}}},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}},function(t,e,i){"use strict";var n=i(14),r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Archetype=void 0;var s=r(i(27));e.Archetype=function t(e){n(this,t),this.componentBits=new s.default,this.componentBitsInitialized=!1,this.componentTypes=e}},function(t,e,i){"use strict";var n=i(14);Object.defineProperty(e,"__esModule",{value:!0}),e.Component=void 0;e.Component=function t(){n(this,t)}},function(t,e,i){"use strict";var n=i(14),r=i(16),s=i(24),o=i(25);Object.defineProperty(e,"__esModule",{value:!0}),e.EntitySystem=void 0;var a=function(t){s(i,t);var e=o(i);function i(){var t;return n(this,i),(t=e.apply(this,arguments)).entities=[],t}return r(i,[{key:"process",value:function(){this.entities.length=0,this.begin(),this.world.getEntities(this.componentBits,this.processEntity.bind(this)),this.processEntities(this.entities),this.end()}},{key:"processEntity",value:function(t){this.entities.push(t)}}]),i}(i(38).EntityIteratingSystem);e.EntitySystem=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InjectMapper=void 0,e.InjectMapper=function(t){return function(e,i){var n=e.constructor;n.hasOwnProperty("__injectMapper__")||(n.__injectMapper__={}),n.__injectMapper__[i]=t}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Inject=void 0,e.Inject=function(t){return function(e,i){var n=e.constructor;n.hasOwnProperty("__inject__")||(n.__inject__={}),n.__inject__[i]=t}}},,,function(t,e,i){"use strict";i.r(e),i.d(e,"glMatrix",(function(){return n})),i.d(e,"mat2",(function(){return r})),i.d(e,"mat2d",(function(){return s})),i.d(e,"mat3",(function(){return o})),i.d(e,"mat4",(function(){return a})),i.d(e,"quat",(function(){return h})),i.d(e,"quat2",(function(){return c})),i.d(e,"vec2",(function(){return m})),i.d(e,"vec3",(function(){return u})),i.d(e,"vec4",(function(){return l}));var n={};i.r(n),i.d(n,"EPSILON",(function(){return _})),i.d(n,"ARRAY_TYPE",(function(){return f})),i.d(n,"RANDOM",(function(){return d})),i.d(n,"setMatrixArrayType",(function(){return p})),i.d(n,"toRadian",(function(){return y})),i.d(n,"equals",(function(){return g}));var r={};i.r(r),i.d(r,"create",(function(){return x})),i.d(r,"clone",(function(){return b})),i.d(r,"copy",(function(){return w})),i.d(r,"identity",(function(){return A})),i.d(r,"fromValues",(function(){return S})),i.d(r,"set",(function(){return B})),i.d(r,"transpose",(function(){return C})),i.d(r,"invert",(function(){return V})),i.d(r,"adjoint",(function(){return M})),i.d(r,"determinant",(function(){return k})),i.d(r,"multiply",(function(){return P})),i.d(r,"rotate",(function(){return I})),i.d(r,"scale",(function(){return T})),i.d(r,"fromRotation",(function(){return D})),i.d(r,"fromScaling",(function(){return G})),i.d(r,"str",(function(){return R})),i.d(r,"frob",(function(){return E})),i.d(r,"LDU",(function(){return F})),i.d(r,"add",(function(){return L})),i.d(r,"subtract",(function(){return j})),i.d(r,"exactEquals",(function(){return O})),i.d(r,"equals",(function(){return N})),i.d(r,"multiplyScalar",(function(){return q})),i.d(r,"multiplyScalarAndAdd",(function(){return z})),i.d(r,"mul",(function(){return U})),i.d(r,"sub",(function(){return J}));var s={};i.r(s),i.d(s,"create",(function(){return X})),i.d(s,"clone",(function(){return Y})),i.d(s,"copy",(function(){return W})),i.d(s,"identity",(function(){return Z})),i.d(s,"fromValues",(function(){return H})),i.d(s,"set",(function(){return Q})),i.d(s,"invert",(function(){return K})),i.d(s,"determinant",(function(){return $})),i.d(s,"multiply",(function(){return tt})),i.d(s,"rotate",(function(){return et})),i.d(s,"scale",(function(){return it})),i.d(s,"translate",(function(){return nt})),i.d(s,"fromRotation",(function(){return rt})),i.d(s,"fromScaling",(function(){return st})),i.d(s,"fromTranslation",(function(){return ot})),i.d(s,"str",(function(){return at})),i.d(s,"frob",(function(){return ut})),i.d(s,"add",(function(){return lt})),i.d(s,"subtract",(function(){return ht})),i.d(s,"multiplyScalar",(function(){return ct})),i.d(s,"multiplyScalarAndAdd",(function(){return mt})),i.d(s,"exactEquals",(function(){return _t})),i.d(s,"equals",(function(){return ft})),i.d(s,"mul",(function(){return dt})),i.d(s,"sub",(function(){return pt}));var o={};i.r(o),i.d(o,"create",(function(){return vt})),i.d(o,"fromMat4",(function(){return yt})),i.d(o,"clone",(function(){return gt})),i.d(o,"copy",(function(){return xt})),i.d(o,"fromValues",(function(){return bt})),i.d(o,"set",(function(){return wt})),i.d(o,"identity",(function(){return At})),i.d(o,"transpose",(function(){return St})),i.d(o,"invert",(function(){return Bt})),i.d(o,"adjoint",(function(){return Ct})),i.d(o,"determinant",(function(){return Vt})),i.d(o,"multiply",(function(){return Mt})),i.d(o,"translate",(function(){return kt})),i.d(o,"rotate",(function(){return Pt})),i.d(o,"scale",(function(){return It})),i.d(o,"fromTranslation",(function(){return Tt})),i.d(o,"fromRotation",(function(){return Dt})),i.d(o,"fromScaling",(function(){return Gt})),i.d(o,"fromMat2d",(function(){return Rt})),i.d(o,"fromQuat",(function(){return Et})),i.d(o,"normalFromMat4",(function(){return Ft})),i.d(o,"projection",(function(){return Lt})),i.d(o,"str",(function(){return jt})),i.d(o,"frob",(function(){return Ot})),i.d(o,"add",(function(){return Nt})),i.d(o,"subtract",(function(){return qt})),i.d(o,"multiplyScalar",(function(){return zt})),i.d(o,"multiplyScalarAndAdd",(function(){return Ut})),i.d(o,"exactEquals",(function(){return Jt})),i.d(o,"equals",(function(){return Xt})),i.d(o,"mul",(function(){return Yt})),i.d(o,"sub",(function(){return Wt}));var a={};i.r(a),i.d(a,"create",(function(){return Zt})),i.d(a,"clone",(function(){return Ht})),i.d(a,"copy",(function(){return Qt})),i.d(a,"fromValues",(function(){return Kt})),i.d(a,"set",(function(){return $t})),i.d(a,"identity",(function(){return te})),i.d(a,"transpose",(function(){return ee})),i.d(a,"invert",(function(){return ie})),i.d(a,"adjoint",(function(){return ne})),i.d(a,"determinant",(function(){return re})),i.d(a,"multiply",(function(){return se})),i.d(a,"translate",(function(){return oe})),i.d(a,"scale",(function(){return ae})),i.d(a,"rotate",(function(){return ue})),i.d(a,"rotateX",(function(){return le})),i.d(a,"rotateY",(function(){return he})),i.d(a,"rotateZ",(function(){return ce})),i.d(a,"fromTranslation",(function(){return me})),i.d(a,"fromScaling",(function(){return _e})),i.d(a,"fromRotation",(function(){return fe})),i.d(a,"fromXRotation",(function(){return de})),i.d(a,"fromYRotation",(function(){return pe})),i.d(a,"fromZRotation",(function(){return ve})),i.d(a,"fromRotationTranslation",(function(){return ye})),i.d(a,"fromQuat2",(function(){return ge})),i.d(a,"getTranslation",(function(){return xe})),i.d(a,"getScaling",(function(){return be})),i.d(a,"getRotation",(function(){return we})),i.d(a,"fromRotationTranslationScale",(function(){return Ae})),i.d(a,"fromRotationTranslationScaleOrigin",(function(){return Se})),i.d(a,"fromQuat",(function(){return Be})),i.d(a,"frustum",(function(){return Ce})),i.d(a,"perspective",(function(){return Ve})),i.d(a,"perspectiveFromFieldOfView",(function(){return Me})),i.d(a,"ortho",(function(){return ke})),i.d(a,"lookAt",(function(){return Pe})),i.d(a,"targetTo",(function(){return Ie})),i.d(a,"str",(function(){return Te})),i.d(a,"frob",(function(){return De})),i.d(a,"add",(function(){return Ge})),i.d(a,"subtract",(function(){return Re})),i.d(a,"multiplyScalar",(function(){return Ee})),i.d(a,"multiplyScalarAndAdd",(function(){return Fe})),i.d(a,"exactEquals",(function(){return Le})),i.d(a,"equals",(function(){return je})),i.d(a,"mul",(function(){return Oe})),i.d(a,"sub",(function(){return Ne}));var u={};i.r(u),i.d(u,"create",(function(){return qe})),i.d(u,"clone",(function(){return ze})),i.d(u,"length",(function(){return Ue})),i.d(u,"fromValues",(function(){return Je})),i.d(u,"copy",(function(){return Xe})),i.d(u,"set",(function(){return Ye})),i.d(u,"add",(function(){return We})),i.d(u,"subtract",(function(){return Ze})),i.d(u,"multiply",(function(){return He})),i.d(u,"divide",(function(){return Qe})),i.d(u,"ceil",(function(){return Ke})),i.d(u,"floor",(function(){return $e})),i.d(u,"min",(function(){return ti})),i.d(u,"max",(function(){return ei})),i.d(u,"round",(function(){return ii})),i.d(u,"scale",(function(){return ni})),i.d(u,"scaleAndAdd",(function(){return ri})),i.d(u,"distance",(function(){return si})),i.d(u,"squaredDistance",(function(){return oi})),i.d(u,"squaredLength",(function(){return ai})),i.d(u,"negate",(function(){return ui})),i.d(u,"inverse",(function(){return li})),i.d(u,"normalize",(function(){return hi})),i.d(u,"dot",(function(){return ci})),i.d(u,"cross",(function(){return mi})),i.d(u,"lerp",(function(){return _i})),i.d(u,"hermite",(function(){return fi})),i.d(u,"bezier",(function(){return di})),i.d(u,"random",(function(){return pi})),i.d(u,"transformMat4",(function(){return vi})),i.d(u,"transformMat3",(function(){return yi})),i.d(u,"transformQuat",(function(){return gi})),i.d(u,"rotateX",(function(){return xi})),i.d(u,"rotateY",(function(){return bi})),i.d(u,"rotateZ",(function(){return wi})),i.d(u,"angle",(function(){return Ai})),i.d(u,"str",(function(){return Si})),i.d(u,"exactEquals",(function(){return Bi})),i.d(u,"equals",(function(){return Ci})),i.d(u,"sub",(function(){return Vi})),i.d(u,"mul",(function(){return Mi})),i.d(u,"div",(function(){return ki})),i.d(u,"dist",(function(){return Pi})),i.d(u,"sqrDist",(function(){return Ii})),i.d(u,"len",(function(){return Ti})),i.d(u,"sqrLen",(function(){return Di})),i.d(u,"forEach",(function(){return Gi}));var l={};i.r(l),i.d(l,"create",(function(){return Ri})),i.d(l,"clone",(function(){return Ei})),i.d(l,"fromValues",(function(){return Fi})),i.d(l,"copy",(function(){return Li})),i.d(l,"set",(function(){return ji})),i.d(l,"add",(function(){return Oi})),i.d(l,"subtract",(function(){return Ni})),i.d(l,"multiply",(function(){return qi})),i.d(l,"divide",(function(){return zi})),i.d(l,"ceil",(function(){return Ui})),i.d(l,"floor",(function(){return Ji})),i.d(l,"min",(function(){return Xi})),i.d(l,"max",(function(){return Yi})),i.d(l,"round",(function(){return Wi})),i.d(l,"scale",(function(){return Zi})),i.d(l,"scaleAndAdd",(function(){return Hi})),i.d(l,"distance",(function(){return Qi})),i.d(l,"squaredDistance",(function(){return Ki})),i.d(l,"length",(function(){return $i})),i.d(l,"squaredLength",(function(){return tn})),i.d(l,"negate",(function(){return en})),i.d(l,"inverse",(function(){return nn})),i.d(l,"normalize",(function(){return rn})),i.d(l,"dot",(function(){return sn})),i.d(l,"lerp",(function(){return on})),i.d(l,"random",(function(){return an})),i.d(l,"transformMat4",(function(){return un})),i.d(l,"transformQuat",(function(){return ln})),i.d(l,"str",(function(){return hn})),i.d(l,"exactEquals",(function(){return cn})),i.d(l,"equals",(function(){return mn})),i.d(l,"sub",(function(){return _n})),i.d(l,"mul",(function(){return fn})),i.d(l,"div",(function(){return dn})),i.d(l,"dist",(function(){return pn})),i.d(l,"sqrDist",(function(){return vn})),i.d(l,"len",(function(){return yn})),i.d(l,"sqrLen",(function(){return gn})),i.d(l,"forEach",(function(){return xn}));var h={};i.r(h),i.d(h,"create",(function(){return bn})),i.d(h,"identity",(function(){return wn})),i.d(h,"setAxisAngle",(function(){return An})),i.d(h,"getAxisAngle",(function(){return Sn})),i.d(h,"multiply",(function(){return Bn})),i.d(h,"rotateX",(function(){return Cn})),i.d(h,"rotateY",(function(){return Vn})),i.d(h,"rotateZ",(function(){return Mn})),i.d(h,"calculateW",(function(){return kn})),i.d(h,"slerp",(function(){return Pn})),i.d(h,"random",(function(){return In})),i.d(h,"invert",(function(){return Tn})),i.d(h,"conjugate",(function(){return Dn})),i.d(h,"fromMat3",(function(){return Gn})),i.d(h,"fromEuler",(function(){return Rn})),i.d(h,"str",(function(){return En})),i.d(h,"clone",(function(){return Fn})),i.d(h,"fromValues",(function(){return Ln})),i.d(h,"copy",(function(){return jn})),i.d(h,"set",(function(){return On})),i.d(h,"add",(function(){return Nn})),i.d(h,"mul",(function(){return qn})),i.d(h,"scale",(function(){return zn})),i.d(h,"dot",(function(){return Un})),i.d(h,"lerp",(function(){return Jn})),i.d(h,"length",(function(){return Xn})),i.d(h,"len",(function(){return Yn})),i.d(h,"squaredLength",(function(){return Wn})),i.d(h,"sqrLen",(function(){return Zn})),i.d(h,"normalize",(function(){return Hn})),i.d(h,"exactEquals",(function(){return Qn})),i.d(h,"equals",(function(){return Kn})),i.d(h,"rotationTo",(function(){return $n})),i.d(h,"sqlerp",(function(){return tr})),i.d(h,"setAxes",(function(){return er}));var c={};i.r(c),i.d(c,"create",(function(){return ir})),i.d(c,"clone",(function(){return nr})),i.d(c,"fromValues",(function(){return rr})),i.d(c,"fromRotationTranslationValues",(function(){return sr})),i.d(c,"fromRotationTranslation",(function(){return or})),i.d(c,"fromTranslation",(function(){return ar})),i.d(c,"fromRotation",(function(){return ur})),i.d(c,"fromMat4",(function(){return lr})),i.d(c,"copy",(function(){return hr})),i.d(c,"identity",(function(){return cr})),i.d(c,"set",(function(){return mr})),i.d(c,"getReal",(function(){return _r})),i.d(c,"getDual",(function(){return fr})),i.d(c,"setReal",(function(){return dr})),i.d(c,"setDual",(function(){return pr})),i.d(c,"getTranslation",(function(){return vr})),i.d(c,"translate",(function(){return yr})),i.d(c,"rotateX",(function(){return gr})),i.d(c,"rotateY",(function(){return xr})),i.d(c,"rotateZ",(function(){return br})),i.d(c,"rotateByQuatAppend",(function(){return wr})),i.d(c,"rotateByQuatPrepend",(function(){return Ar})),i.d(c,"rotateAroundAxis",(function(){return Sr})),i.d(c,"add",(function(){return Br})),i.d(c,"multiply",(function(){return Cr})),i.d(c,"mul",(function(){return Vr})),i.d(c,"scale",(function(){return Mr})),i.d(c,"dot",(function(){return kr})),i.d(c,"lerp",(function(){return Pr})),i.d(c,"invert",(function(){return Ir})),i.d(c,"conjugate",(function(){return Tr})),i.d(c,"length",(function(){return Dr})),i.d(c,"len",(function(){return Gr})),i.d(c,"squaredLength",(function(){return Rr})),i.d(c,"sqrLen",(function(){return Er})),i.d(c,"normalize",(function(){return Fr})),i.d(c,"str",(function(){return Lr})),i.d(c,"exactEquals",(function(){return jr})),i.d(c,"equals",(function(){return Or}));var m={};i.r(m),i.d(m,"create",(function(){return Nr})),i.d(m,"clone",(function(){return qr})),i.d(m,"fromValues",(function(){return zr})),i.d(m,"copy",(function(){return Ur})),i.d(m,"set",(function(){return Jr})),i.d(m,"add",(function(){return Xr})),i.d(m,"subtract",(function(){return Yr})),i.d(m,"multiply",(function(){return Wr})),i.d(m,"divide",(function(){return Zr})),i.d(m,"ceil",(function(){return Hr})),i.d(m,"floor",(function(){return Qr})),i.d(m,"min",(function(){return Kr})),i.d(m,"max",(function(){return $r})),i.d(m,"round",(function(){return ts})),i.d(m,"scale",(function(){return es})),i.d(m,"scaleAndAdd",(function(){return is})),i.d(m,"distance",(function(){return ns})),i.d(m,"squaredDistance",(function(){return rs})),i.d(m,"length",(function(){return ss})),i.d(m,"squaredLength",(function(){return os})),i.d(m,"negate",(function(){return as})),i.d(m,"inverse",(function(){return us})),i.d(m,"normalize",(function(){return ls})),i.d(m,"dot",(function(){return hs})),i.d(m,"cross",(function(){return cs})),i.d(m,"lerp",(function(){return ms})),i.d(m,"random",(function(){return _s})),i.d(m,"transformMat2",(function(){return fs})),i.d(m,"transformMat2d",(function(){return ds})),i.d(m,"transformMat3",(function(){return ps})),i.d(m,"transformMat4",(function(){return vs})),i.d(m,"rotate",(function(){return ys})),i.d(m,"angle",(function(){return gs})),i.d(m,"str",(function(){return xs})),i.d(m,"exactEquals",(function(){return bs})),i.d(m,"equals",(function(){return ws})),i.d(m,"len",(function(){return As})),i.d(m,"sub",(function(){return Ss})),i.d(m,"mul",(function(){return Bs})),i.d(m,"div",(function(){return Cs})),i.d(m,"dist",(function(){return Vs})),i.d(m,"sqrDist",(function(){return Ms})),i.d(m,"sqrLen",(function(){return ks})),i.d(m,"forEach",(function(){return Ps}));var _=1e-6,f="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;function p(t){f=t}var v=Math.PI/180;function y(t){return t*v}function g(t,e){return Math.abs(t-e)<=_*Math.max(1,Math.abs(t),Math.abs(e))}function x(){var t=new f(4);return f!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function b(t){var e=new f(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function w(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function A(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function S(t,e,i,n){var r=new f(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r}function B(t,e,i,n,r){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t}function C(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function V(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i*s-r*n;return o?(o=1/o,t[0]=s*o,t[1]=-n*o,t[2]=-r*o,t[3]=i*o,t):null}function M(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t}function k(t){return t[0]*t[3]-t[2]*t[1]}function P(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=i[0],u=i[1],l=i[2],h=i[3];return t[0]=n*a+s*u,t[1]=r*a+o*u,t[2]=n*l+s*h,t[3]=r*l+o*h,t}function I(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(i),u=Math.cos(i);return t[0]=n*u+s*a,t[1]=r*u+o*a,t[2]=n*-a+s*u,t[3]=r*-a+o*u,t}function T(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=i[0],u=i[1];return t[0]=n*a,t[1]=r*a,t[2]=s*u,t[3]=o*u,t}function D(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t}function G(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function R(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function E(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))}function F(t,e,i,n){return t[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-t[2]*i[1],[t,e,i]}function L(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function j(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function O(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function N(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],o=e[0],a=e[1],u=e[2],l=e[3];return Math.abs(i-o)<=_*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=_*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-u)<=_*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(s-l)<=_*Math.max(1,Math.abs(s),Math.abs(l))}function q(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function z(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t}var U=P,J=j;function X(){var t=new f(6);return f!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function Y(t){var e=new f(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function W(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Z(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function H(t,e,i,n,r,s){var o=new f(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=n,o[4]=r,o[5]=s,o}function Q(t,e,i,n,r,s,o){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=s,t[5]=o,t}function K(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],u=i*s-n*r;return u?(u=1/u,t[0]=s*u,t[1]=-n*u,t[2]=-r*u,t[3]=i*u,t[4]=(r*a-s*o)*u,t[5]=(n*o-i*a)*u,t):null}function $(t){return t[0]*t[3]-t[1]*t[2]}function tt(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],u=e[5],l=i[0],h=i[1],c=i[2],m=i[3],_=i[4],f=i[5];return t[0]=n*l+s*h,t[1]=r*l+o*h,t[2]=n*c+s*m,t[3]=r*c+o*m,t[4]=n*_+s*f+a,t[5]=r*_+o*f+u,t}function et(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],u=e[5],l=Math.sin(i),h=Math.cos(i);return t[0]=n*h+s*l,t[1]=r*h+o*l,t[2]=n*-l+s*h,t[3]=r*-l+o*h,t[4]=a,t[5]=u,t}function it(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],u=e[5],l=i[0],h=i[1];return t[0]=n*l,t[1]=r*l,t[2]=s*h,t[3]=o*h,t[4]=a,t[5]=u,t}function nt(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],u=e[5],l=i[0],h=i[1];return t[0]=n,t[1]=r,t[2]=s,t[3]=o,t[4]=n*l+s*h+a,t[5]=r*l+o*h+u,t}function rt(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t[4]=0,t[5]=0,t}function st(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function ot(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function at(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function ut(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)}function lt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function ht(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function ct(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function mt(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t}function _t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function ft(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],u=e[0],l=e[1],h=e[2],c=e[3],m=e[4],f=e[5];return Math.abs(i-u)<=_*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(n-l)<=_*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-h)<=_*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(s-c)<=_*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(o-m)<=_*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-f)<=_*Math.max(1,Math.abs(a),Math.abs(f))}var dt=tt,pt=ht;function vt(){var t=new f(9);return f!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function yt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function gt(t){var e=new f(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function xt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function bt(t,e,i,n,r,s,o,a,u){var l=new f(9);return l[0]=t,l[1]=e,l[2]=i,l[3]=n,l[4]=r,l[5]=s,l[6]=o,l[7]=a,l[8]=u,l}function wt(t,e,i,n,r,s,o,a,u,l){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=s,t[5]=o,t[6]=a,t[7]=u,t[8]=l,t}function At(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function St(t,e){if(t===e){var i=e[1],n=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Bt(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],u=e[6],l=e[7],h=e[8],c=h*o-a*l,m=-h*s+a*u,_=l*s-o*u,f=i*c+n*m+r*_;return f?(f=1/f,t[0]=c*f,t[1]=(-h*n+r*l)*f,t[2]=(a*n-r*o)*f,t[3]=m*f,t[4]=(h*i-r*u)*f,t[5]=(-a*i+r*s)*f,t[6]=_*f,t[7]=(-l*i+n*u)*f,t[8]=(o*i-n*s)*f,t):null}function Ct(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],u=e[6],l=e[7],h=e[8];return t[0]=o*h-a*l,t[1]=r*l-n*h,t[2]=n*a-r*o,t[3]=a*u-s*h,t[4]=i*h-r*u,t[5]=r*s-i*a,t[6]=s*l-o*u,t[7]=n*u-i*l,t[8]=i*o-n*s,t}function Vt(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],u=t[7],l=t[8];return e*(l*s-o*u)+i*(-l*r+o*a)+n*(u*r-s*a)}function Mt(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=e[8],m=i[0],_=i[1],f=i[2],d=i[3],p=i[4],v=i[5],y=i[6],g=i[7],x=i[8];return t[0]=m*n+_*o+f*l,t[1]=m*r+_*a+f*h,t[2]=m*s+_*u+f*c,t[3]=d*n+p*o+v*l,t[4]=d*r+p*a+v*h,t[5]=d*s+p*u+v*c,t[6]=y*n+g*o+x*l,t[7]=y*r+g*a+x*h,t[8]=y*s+g*u+x*c,t}function kt(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=e[8],m=i[0],_=i[1];return t[0]=n,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=m*n+_*o+l,t[7]=m*r+_*a+h,t[8]=m*s+_*u+c,t}function Pt(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=e[8],m=Math.sin(i),_=Math.cos(i);return t[0]=_*n+m*o,t[1]=_*r+m*a,t[2]=_*s+m*u,t[3]=_*o-m*n,t[4]=_*a-m*r,t[5]=_*u-m*s,t[6]=l,t[7]=h,t[8]=c,t}function It(t,e,i){var n=i[0],r=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Tt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Dt(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Gt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Rt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Et(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i+i,a=n+n,u=r+r,l=i*o,h=n*o,c=n*a,m=r*o,_=r*a,f=r*u,d=s*o,p=s*a,v=s*u;return t[0]=1-c-f,t[3]=h-v,t[6]=m+p,t[1]=h+v,t[4]=1-l-f,t[7]=_-d,t[2]=m-p,t[5]=_+d,t[8]=1-l-c,t}function Ft(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],u=e[6],l=e[7],h=e[8],c=e[9],m=e[10],_=e[11],f=e[12],d=e[13],p=e[14],v=e[15],y=i*a-n*o,g=i*u-r*o,x=i*l-s*o,b=n*u-r*a,w=n*l-s*a,A=r*l-s*u,S=h*d-c*f,B=h*p-m*f,C=h*v-_*f,V=c*p-m*d,M=c*v-_*d,k=m*v-_*p,P=y*k-g*M+x*V+b*C-w*B+A*S;return P?(P=1/P,t[0]=(a*k-u*M+l*V)*P,t[1]=(u*C-o*k-l*B)*P,t[2]=(o*M-a*C+l*S)*P,t[3]=(r*M-n*k-s*V)*P,t[4]=(i*k-r*C+s*B)*P,t[5]=(n*C-i*M-s*S)*P,t[6]=(d*A-p*w+v*b)*P,t[7]=(p*x-f*A-v*g)*P,t[8]=(f*w-d*x+v*y)*P,t):null}function Lt(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function jt(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Ot(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))}function Nt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function qt(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function zt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function Ut(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t}function Jt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Xt(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],u=t[6],l=t[7],h=t[8],c=e[0],m=e[1],f=e[2],d=e[3],p=e[4],v=e[5],y=e[6],g=e[7],x=e[8];return Math.abs(i-c)<=_*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-m)<=_*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(r-f)<=_*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-d)<=_*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-p)<=_*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-v)<=_*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(u-y)<=_*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(l-g)<=_*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(h-x)<=_*Math.max(1,Math.abs(h),Math.abs(x))}var Yt=Mt,Wt=qt;function Zt(){var t=new f(16);return f!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Ht(t){var e=new f(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Qt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Kt(t,e,i,n,r,s,o,a,u,l,h,c,m,_,d,p){var v=new f(16);return v[0]=t,v[1]=e,v[2]=i,v[3]=n,v[4]=r,v[5]=s,v[6]=o,v[7]=a,v[8]=u,v[9]=l,v[10]=h,v[11]=c,v[12]=m,v[13]=_,v[14]=d,v[15]=p,v}function $t(t,e,i,n,r,s,o,a,u,l,h,c,m,_,f,d,p){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=s,t[5]=o,t[6]=a,t[7]=u,t[8]=l,t[9]=h,t[10]=c,t[11]=m,t[12]=_,t[13]=f,t[14]=d,t[15]=p,t}function te(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ee(t,e){if(t===e){var i=e[1],n=e[2],r=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=s,t[11]=e[14],t[12]=r,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function ie(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],u=e[6],l=e[7],h=e[8],c=e[9],m=e[10],_=e[11],f=e[12],d=e[13],p=e[14],v=e[15],y=i*a-n*o,g=i*u-r*o,x=i*l-s*o,b=n*u-r*a,w=n*l-s*a,A=r*l-s*u,S=h*d-c*f,B=h*p-m*f,C=h*v-_*f,V=c*p-m*d,M=c*v-_*d,k=m*v-_*p,P=y*k-g*M+x*V+b*C-w*B+A*S;return P?(P=1/P,t[0]=(a*k-u*M+l*V)*P,t[1]=(r*M-n*k-s*V)*P,t[2]=(d*A-p*w+v*b)*P,t[3]=(m*w-c*A-_*b)*P,t[4]=(u*C-o*k-l*B)*P,t[5]=(i*k-r*C+s*B)*P,t[6]=(p*x-f*A-v*g)*P,t[7]=(h*A-m*x+_*g)*P,t[8]=(o*M-a*C+l*S)*P,t[9]=(n*C-i*M-s*S)*P,t[10]=(f*w-d*x+v*y)*P,t[11]=(c*x-h*w-_*y)*P,t[12]=(a*B-o*V-u*S)*P,t[13]=(i*V-n*B+r*S)*P,t[14]=(d*g-f*b-p*y)*P,t[15]=(h*b-c*g+m*y)*P,t):null}function ne(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],u=e[6],l=e[7],h=e[8],c=e[9],m=e[10],_=e[11],f=e[12],d=e[13],p=e[14],v=e[15];return t[0]=a*(m*v-_*p)-c*(u*v-l*p)+d*(u*_-l*m),t[1]=-(n*(m*v-_*p)-c*(r*v-s*p)+d*(r*_-s*m)),t[2]=n*(u*v-l*p)-a*(r*v-s*p)+d*(r*l-s*u),t[3]=-(n*(u*_-l*m)-a*(r*_-s*m)+c*(r*l-s*u)),t[4]=-(o*(m*v-_*p)-h*(u*v-l*p)+f*(u*_-l*m)),t[5]=i*(m*v-_*p)-h*(r*v-s*p)+f*(r*_-s*m),t[6]=-(i*(u*v-l*p)-o*(r*v-s*p)+f*(r*l-s*u)),t[7]=i*(u*_-l*m)-o*(r*_-s*m)+h*(r*l-s*u),t[8]=o*(c*v-_*d)-h*(a*v-l*d)+f*(a*_-l*c),t[9]=-(i*(c*v-_*d)-h*(n*v-s*d)+f*(n*_-s*c)),t[10]=i*(a*v-l*d)-o*(n*v-s*d)+f*(n*l-s*a),t[11]=-(i*(a*_-l*c)-o*(n*_-s*c)+h*(n*l-s*a)),t[12]=-(o*(c*p-m*d)-h*(a*p-u*d)+f*(a*m-u*c)),t[13]=i*(c*p-m*d)-h*(n*p-r*d)+f*(n*m-r*c),t[14]=-(i*(a*p-u*d)-o*(n*p-r*d)+f*(n*u-r*a)),t[15]=i*(a*m-u*c)-o*(n*m-r*c)+h*(n*u-r*a),t}function re(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],u=t[7],l=t[8],h=t[9],c=t[10],m=t[11],_=t[12],f=t[13],d=t[14],p=t[15];return(e*o-i*s)*(c*p-m*d)-(e*a-n*s)*(h*p-m*f)+(e*u-r*s)*(h*d-c*f)+(i*a-n*o)*(l*p-m*_)-(i*u-r*o)*(l*d-c*_)+(n*u-r*a)*(l*f-h*_)}function se(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=e[8],m=e[9],_=e[10],f=e[11],d=e[12],p=e[13],v=e[14],y=e[15],g=i[0],x=i[1],b=i[2],w=i[3];return t[0]=g*n+x*a+b*c+w*d,t[1]=g*r+x*u+b*m+w*p,t[2]=g*s+x*l+b*_+w*v,t[3]=g*o+x*h+b*f+w*y,g=i[4],x=i[5],b=i[6],w=i[7],t[4]=g*n+x*a+b*c+w*d,t[5]=g*r+x*u+b*m+w*p,t[6]=g*s+x*l+b*_+w*v,t[7]=g*o+x*h+b*f+w*y,g=i[8],x=i[9],b=i[10],w=i[11],t[8]=g*n+x*a+b*c+w*d,t[9]=g*r+x*u+b*m+w*p,t[10]=g*s+x*l+b*_+w*v,t[11]=g*o+x*h+b*f+w*y,g=i[12],x=i[13],b=i[14],w=i[15],t[12]=g*n+x*a+b*c+w*d,t[13]=g*r+x*u+b*m+w*p,t[14]=g*s+x*l+b*_+w*v,t[15]=g*o+x*h+b*f+w*y,t}function oe(t,e,i){var n=i[0],r=i[1],s=i[2],o=void 0,a=void 0,u=void 0,l=void 0,h=void 0,c=void 0,m=void 0,_=void 0,f=void 0,d=void 0,p=void 0,v=void 0;return e===t?(t[12]=e[0]*n+e[4]*r+e[8]*s+e[12],t[13]=e[1]*n+e[5]*r+e[9]*s+e[13],t[14]=e[2]*n+e[6]*r+e[10]*s+e[14],t[15]=e[3]*n+e[7]*r+e[11]*s+e[15]):(o=e[0],a=e[1],u=e[2],l=e[3],h=e[4],c=e[5],m=e[6],_=e[7],f=e[8],d=e[9],p=e[10],v=e[11],t[0]=o,t[1]=a,t[2]=u,t[3]=l,t[4]=h,t[5]=c,t[6]=m,t[7]=_,t[8]=f,t[9]=d,t[10]=p,t[11]=v,t[12]=o*n+h*r+f*s+e[12],t[13]=a*n+c*r+d*s+e[13],t[14]=u*n+m*r+p*s+e[14],t[15]=l*n+_*r+v*s+e[15]),t}function ae(t,e,i){var n=i[0],r=i[1],s=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ue(t,e,i,n){var r,s,o,a,u,l,h,c,m,f,d,p,v,y,g,x,b,w,A,S,B,C,V,M,k=n[0],P=n[1],I=n[2],T=Math.sqrt(k*k+P*P+I*I);return T<_?null:(k*=T=1/T,P*=T,I*=T,r=Math.sin(i),o=1-(s=Math.cos(i)),a=e[0],u=e[1],l=e[2],h=e[3],c=e[4],m=e[5],f=e[6],d=e[7],p=e[8],v=e[9],y=e[10],g=e[11],x=k*k*o+s,b=P*k*o+I*r,w=I*k*o-P*r,A=k*P*o-I*r,S=P*P*o+s,B=I*P*o+k*r,C=k*I*o+P*r,V=P*I*o-k*r,M=I*I*o+s,t[0]=a*x+c*b+p*w,t[1]=u*x+m*b+v*w,t[2]=l*x+f*b+y*w,t[3]=h*x+d*b+g*w,t[4]=a*A+c*S+p*B,t[5]=u*A+m*S+v*B,t[6]=l*A+f*S+y*B,t[7]=h*A+d*S+g*B,t[8]=a*C+c*V+p*M,t[9]=u*C+m*V+v*M,t[10]=l*C+f*V+y*M,t[11]=h*C+d*V+g*M,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function le(t,e,i){var n=Math.sin(i),r=Math.cos(i),s=e[4],o=e[5],a=e[6],u=e[7],l=e[8],h=e[9],c=e[10],m=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+l*n,t[5]=o*r+h*n,t[6]=a*r+c*n,t[7]=u*r+m*n,t[8]=l*r-s*n,t[9]=h*r-o*n,t[10]=c*r-a*n,t[11]=m*r-u*n,t}function he(t,e,i){var n=Math.sin(i),r=Math.cos(i),s=e[0],o=e[1],a=e[2],u=e[3],l=e[8],h=e[9],c=e[10],m=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-l*n,t[1]=o*r-h*n,t[2]=a*r-c*n,t[3]=u*r-m*n,t[8]=s*n+l*r,t[9]=o*n+h*r,t[10]=a*n+c*r,t[11]=u*n+m*r,t}function ce(t,e,i){var n=Math.sin(i),r=Math.cos(i),s=e[0],o=e[1],a=e[2],u=e[3],l=e[4],h=e[5],c=e[6],m=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+l*n,t[1]=o*r+h*n,t[2]=a*r+c*n,t[3]=u*r+m*n,t[4]=l*r-s*n,t[5]=h*r-o*n,t[6]=c*r-a*n,t[7]=m*r-u*n,t}function me(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function _e(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fe(t,e,i){var n,r,s,o=i[0],a=i[1],u=i[2],l=Math.sqrt(o*o+a*a+u*u);return l<_?null:(o*=l=1/l,a*=l,u*=l,n=Math.sin(e),s=1-(r=Math.cos(e)),t[0]=o*o*s+r,t[1]=a*o*s+u*n,t[2]=u*o*s-a*n,t[3]=0,t[4]=o*a*s-u*n,t[5]=a*a*s+r,t[6]=u*a*s+o*n,t[7]=0,t[8]=o*u*s+a*n,t[9]=a*u*s-o*n,t[10]=u*u*s+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function de(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pe(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ve(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ye(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=n+n,u=r+r,l=s+s,h=n*a,c=n*u,m=n*l,_=r*u,f=r*l,d=s*l,p=o*a,v=o*u,y=o*l;return t[0]=1-(_+d),t[1]=c+y,t[2]=m-v,t[3]=0,t[4]=c-y,t[5]=1-(h+d),t[6]=f+p,t[7]=0,t[8]=m+v,t[9]=f-p,t[10]=1-(h+_),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function ge(t,e){var i=new f(3),n=-e[0],r=-e[1],s=-e[2],o=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=n*n+r*r+s*s+o*o;return c>0?(i[0]=2*(a*o+h*n+u*s-l*r)/c,i[1]=2*(u*o+h*r+l*n-a*s)/c,i[2]=2*(l*o+h*s+a*r-u*n)/c):(i[0]=2*(a*o+h*n+u*s-l*r),i[1]=2*(u*o+h*r+l*n-a*s),i[2]=2*(l*o+h*s+a*r-u*n)),ye(t,e,i),t}function xe(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function be(t,e){var i=e[0],n=e[1],r=e[2],s=e[4],o=e[5],a=e[6],u=e[8],l=e[9],h=e[10];return t[0]=Math.sqrt(i*i+n*n+r*r),t[1]=Math.sqrt(s*s+o*o+a*a),t[2]=Math.sqrt(u*u+l*l+h*h),t}function we(t,e){var i=e[0]+e[5]+e[10],n=0;return i>0?(n=2*Math.sqrt(i+1),t[3]=.25*n,t[0]=(e[6]-e[9])/n,t[1]=(e[8]-e[2])/n,t[2]=(e[1]-e[4])/n):e[0]>e[5]&&e[0]>e[10]?(n=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/n,t[0]=.25*n,t[1]=(e[1]+e[4])/n,t[2]=(e[8]+e[2])/n):e[5]>e[10]?(n=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/n,t[0]=(e[1]+e[4])/n,t[1]=.25*n,t[2]=(e[6]+e[9])/n):(n=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/n,t[0]=(e[8]+e[2])/n,t[1]=(e[6]+e[9])/n,t[2]=.25*n),t}function Ae(t,e,i,n){var r=e[0],s=e[1],o=e[2],a=e[3],u=r+r,l=s+s,h=o+o,c=r*u,m=r*l,_=r*h,f=s*l,d=s*h,p=o*h,v=a*u,y=a*l,g=a*h,x=n[0],b=n[1],w=n[2];return t[0]=(1-(f+p))*x,t[1]=(m+g)*x,t[2]=(_-y)*x,t[3]=0,t[4]=(m-g)*b,t[5]=(1-(c+p))*b,t[6]=(d+v)*b,t[7]=0,t[8]=(_+y)*w,t[9]=(d-v)*w,t[10]=(1-(c+f))*w,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function Se(t,e,i,n,r){var s=e[0],o=e[1],a=e[2],u=e[3],l=s+s,h=o+o,c=a+a,m=s*l,_=s*h,f=s*c,d=o*h,p=o*c,v=a*c,y=u*l,g=u*h,x=u*c,b=n[0],w=n[1],A=n[2],S=r[0],B=r[1],C=r[2],V=(1-(d+v))*b,M=(_+x)*b,k=(f-g)*b,P=(_-x)*w,I=(1-(m+v))*w,T=(p+y)*w,D=(f+g)*A,G=(p-y)*A,R=(1-(m+d))*A;return t[0]=V,t[1]=M,t[2]=k,t[3]=0,t[4]=P,t[5]=I,t[6]=T,t[7]=0,t[8]=D,t[9]=G,t[10]=R,t[11]=0,t[12]=i[0]+S-(V*S+P*B+D*C),t[13]=i[1]+B-(M*S+I*B+G*C),t[14]=i[2]+C-(k*S+T*B+R*C),t[15]=1,t}function Be(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i+i,a=n+n,u=r+r,l=i*o,h=n*o,c=n*a,m=r*o,_=r*a,f=r*u,d=s*o,p=s*a,v=s*u;return t[0]=1-c-f,t[1]=h+v,t[2]=m-p,t[3]=0,t[4]=h-v,t[5]=1-l-f,t[6]=_+d,t[7]=0,t[8]=m+p,t[9]=_-d,t[10]=1-l-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ce(t,e,i,n,r,s,o){var a=1/(i-e),u=1/(r-n),l=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*u,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(r+n)*u,t[10]=(o+s)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*l,t[15]=0,t}function Ve(t,e,i,n,r){var s=1/Math.tan(e/2),o=void 0;return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(o=1/(n-r),t[10]=(r+n)*o,t[14]=2*r*n*o):(t[10]=-1,t[14]=-2*n),t}function Me(t,e,i,n){var r=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),u=2/(o+a),l=2/(r+s);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(o-a)*u*.5,t[9]=(r-s)*l*.5,t[10]=n/(i-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*i/(i-n),t[15]=0,t}function ke(t,e,i,n,r,s,o){var a=1/(e-i),u=1/(n-r),l=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+i)*a,t[13]=(r+n)*u,t[14]=(o+s)*l,t[15]=1,t}function Pe(t,e,i,n){var r=void 0,s=void 0,o=void 0,a=void 0,u=void 0,l=void 0,h=void 0,c=void 0,m=void 0,f=void 0,d=e[0],p=e[1],v=e[2],y=n[0],g=n[1],x=n[2],b=i[0],w=i[1],A=i[2];return Math.abs(d-b)<_&&Math.abs(p-w)<_&&Math.abs(v-A)<_?te(t):(h=d-b,c=p-w,m=v-A,r=g*(m*=f=1/Math.sqrt(h*h+c*c+m*m))-x*(c*=f),s=x*(h*=f)-y*m,o=y*c-g*h,(f=Math.sqrt(r*r+s*s+o*o))?(r*=f=1/f,s*=f,o*=f):(r=0,s=0,o=0),a=c*o-m*s,u=m*r-h*o,l=h*s-c*r,(f=Math.sqrt(a*a+u*u+l*l))?(a*=f=1/f,u*=f,l*=f):(a=0,u=0,l=0),t[0]=r,t[1]=a,t[2]=h,t[3]=0,t[4]=s,t[5]=u,t[6]=c,t[7]=0,t[8]=o,t[9]=l,t[10]=m,t[11]=0,t[12]=-(r*d+s*p+o*v),t[13]=-(a*d+u*p+l*v),t[14]=-(h*d+c*p+m*v),t[15]=1,t)}function Ie(t,e,i,n){var r=e[0],s=e[1],o=e[2],a=n[0],u=n[1],l=n[2],h=r-i[0],c=s-i[1],m=o-i[2],_=h*h+c*c+m*m;_>0&&(h*=_=1/Math.sqrt(_),c*=_,m*=_);var f=u*m-l*c,d=l*h-a*m,p=a*c-u*h;return(_=f*f+d*d+p*p)>0&&(f*=_=1/Math.sqrt(_),d*=_,p*=_),t[0]=f,t[1]=d,t[2]=p,t[3]=0,t[4]=c*p-m*d,t[5]=m*f-h*p,t[6]=h*d-c*f,t[7]=0,t[8]=h,t[9]=c,t[10]=m,t[11]=0,t[12]=r,t[13]=s,t[14]=o,t[15]=1,t}function Te(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function De(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))}function Ge(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function Re(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function Ee(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function Fe(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t[9]=e[9]+i[9]*n,t[10]=e[10]+i[10]*n,t[11]=e[11]+i[11]*n,t[12]=e[12]+i[12]*n,t[13]=e[13]+i[13]*n,t[14]=e[14]+i[14]*n,t[15]=e[15]+i[15]*n,t}function Le(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function je(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],u=t[6],l=t[7],h=t[8],c=t[9],m=t[10],f=t[11],d=t[12],p=t[13],v=t[14],y=t[15],g=e[0],x=e[1],b=e[2],w=e[3],A=e[4],S=e[5],B=e[6],C=e[7],V=e[8],M=e[9],k=e[10],P=e[11],I=e[12],T=e[13],D=e[14],G=e[15];return Math.abs(i-g)<=_*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(n-x)<=_*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(r-b)<=_*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(s-w)<=_*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(o-A)<=_*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-S)<=_*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(u-B)<=_*Math.max(1,Math.abs(u),Math.abs(B))&&Math.abs(l-C)<=_*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(h-V)<=_*Math.max(1,Math.abs(h),Math.abs(V))&&Math.abs(c-M)<=_*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(m-k)<=_*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(f-P)<=_*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(d-I)<=_*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(p-T)<=_*Math.max(1,Math.abs(p),Math.abs(T))&&Math.abs(v-D)<=_*Math.max(1,Math.abs(v),Math.abs(D))&&Math.abs(y-G)<=_*Math.max(1,Math.abs(y),Math.abs(G))}var Oe=se,Ne=Re;function qe(){var t=new f(3);return f!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ze(t){var e=new f(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Ue(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)}function Je(t,e,i){var n=new f(3);return n[0]=t,n[1]=e,n[2]=i,n}function Xe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ye(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t}function We(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Ze(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function He(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Qe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function Ke(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function $e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function ti(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function ei(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function ii(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ni(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function ri(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t}function si(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(i*i+n*n+r*r)}function oi(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return i*i+n*n+r*r}function ai(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n}function ui(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function li(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function hi(t,e){var i=e[0],n=e[1],r=e[2],s=i*i+n*n+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t}function ci(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function mi(t,e,i){var n=e[0],r=e[1],s=e[2],o=i[0],a=i[1],u=i[2];return t[0]=r*u-s*a,t[1]=s*o-n*u,t[2]=n*a-r*o,t}function _i(t,e,i,n){var r=e[0],s=e[1],o=e[2];return t[0]=r+n*(i[0]-r),t[1]=s+n*(i[1]-s),t[2]=o+n*(i[2]-o),t}function fi(t,e,i,n,r,s){var o=s*s,a=o*(2*s-3)+1,u=o*(s-2)+s,l=o*(s-1),h=o*(3-2*s);return t[0]=e[0]*a+i[0]*u+n[0]*l+r[0]*h,t[1]=e[1]*a+i[1]*u+n[1]*l+r[1]*h,t[2]=e[2]*a+i[2]*u+n[2]*l+r[2]*h,t}function di(t,e,i,n,r,s){var o=1-s,a=o*o,u=s*s,l=a*o,h=3*s*a,c=3*u*o,m=u*s;return t[0]=e[0]*l+i[0]*h+n[0]*c+r[0]*m,t[1]=e[1]*l+i[1]*h+n[1]*c+r[1]*m,t[2]=e[2]*l+i[2]*h+n[2]*c+r[2]*m,t}function pi(t,e){e=e||1;var i=2*d()*Math.PI,n=2*d()-1,r=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*r,t[1]=Math.sin(i)*r,t[2]=n*e,t}function vi(t,e,i){var n=e[0],r=e[1],s=e[2],o=i[3]*n+i[7]*r+i[11]*s+i[15];return o=o||1,t[0]=(i[0]*n+i[4]*r+i[8]*s+i[12])/o,t[1]=(i[1]*n+i[5]*r+i[9]*s+i[13])/o,t[2]=(i[2]*n+i[6]*r+i[10]*s+i[14])/o,t}function yi(t,e,i){var n=e[0],r=e[1],s=e[2];return t[0]=n*i[0]+r*i[3]+s*i[6],t[1]=n*i[1]+r*i[4]+s*i[7],t[2]=n*i[2]+r*i[5]+s*i[8],t}function gi(t,e,i){var n=i[0],r=i[1],s=i[2],o=i[3],a=e[0],u=e[1],l=e[2],h=r*l-s*u,c=s*a-n*l,m=n*u-r*a,_=r*m-s*c,f=s*h-n*m,d=n*c-r*h,p=2*o;return h*=p,c*=p,m*=p,_*=2,f*=2,d*=2,t[0]=a+h+_,t[1]=u+c+f,t[2]=l+m+d,t}function xi(t,e,i,n){var r=[],s=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],s[0]=r[0],s[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),s[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function bi(t,e,i,n){var r=[],s=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],s[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),s[1]=r[1],s[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function wi(t,e,i,n){var r=[],s=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],s[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),s[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),s[2]=r[2],t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function Ai(t,e){var i=Je(t[0],t[1],t[2]),n=Je(e[0],e[1],e[2]);hi(i,i),hi(n,n);var r=ci(i,n);return r>1?0:r<-1?Math.PI:Math.acos(r)}function Si(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Bi(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Ci(t,e){var i=t[0],n=t[1],r=t[2],s=e[0],o=e[1],a=e[2];return Math.abs(i-s)<=_*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-o)<=_*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=_*Math.max(1,Math.abs(r),Math.abs(a))}var Vi=Ze,Mi=He,ki=Qe,Pi=si,Ii=oi,Ti=Ue,Di=ai,Gi=function(){var t=qe();return function(e,i,n,r,s,o){var a=void 0,u=void 0;for(i||(i=3),n||(n=0),u=r?Math.min(r*i+n,e.length):e.length,a=n;a<u;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}}();function Ri(){var t=new f(4);return f!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ei(t){var e=new f(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Fi(t,e,i,n){var r=new f(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r}function Li(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ji(t,e,i,n,r){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t}function Oi(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function Ni(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function qi(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function zi(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function Ui(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Ji(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Xi(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function Yi(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function Wi(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Zi(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Hi(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t}function Qi(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(i*i+n*n+r*r+s*s)}function Ki(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2],s=e[3]-t[3];return i*i+n*n+r*r+s*s}function $i(t){var e=t[0],i=t[1],n=t[2],r=t[3];return Math.sqrt(e*e+i*i+n*n+r*r)}function tn(t){var e=t[0],i=t[1],n=t[2],r=t[3];return e*e+i*i+n*n+r*r}function en(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function nn(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function rn(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i*i+n*n+r*r+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=n*o,t[2]=r*o,t[3]=s*o),t}function sn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function on(t,e,i,n){var r=e[0],s=e[1],o=e[2],a=e[3];return t[0]=r+n*(i[0]-r),t[1]=s+n*(i[1]-s),t[2]=o+n*(i[2]-o),t[3]=a+n*(i[3]-a),t}function an(t,e){var i,n,r,s,o,a;e=e||1;do{o=(i=2*d()-1)*i+(n=2*d()-1)*n}while(o>=1);do{a=(r=2*d()-1)*r+(s=2*d()-1)*s}while(a>=1);var u=Math.sqrt((1-o)/a);return t[0]=e*i,t[1]=e*n,t[2]=e*r*u,t[3]=e*s*u,t}function un(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*s+i[12]*o,t[1]=i[1]*n+i[5]*r+i[9]*s+i[13]*o,t[2]=i[2]*n+i[6]*r+i[10]*s+i[14]*o,t[3]=i[3]*n+i[7]*r+i[11]*s+i[15]*o,t}function ln(t,e,i){var n=e[0],r=e[1],s=e[2],o=i[0],a=i[1],u=i[2],l=i[3],h=l*n+a*s-u*r,c=l*r+u*n-o*s,m=l*s+o*r-a*n,_=-o*n-a*r-u*s;return t[0]=h*l+_*-o+c*-u-m*-a,t[1]=c*l+_*-a+m*-o-h*-u,t[2]=m*l+_*-u+h*-a-c*-o,t[3]=e[3],t}function hn(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function cn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function mn(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],o=e[0],a=e[1],u=e[2],l=e[3];return Math.abs(i-o)<=_*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=_*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-u)<=_*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(s-l)<=_*Math.max(1,Math.abs(s),Math.abs(l))}var _n=Ni,fn=qi,dn=zi,pn=Qi,vn=Ki,yn=$i,gn=tn,xn=function(){var t=Ri();return function(e,i,n,r,s,o){var a=void 0,u=void 0;for(i||(i=4),n||(n=0),u=r?Math.min(r*i+n,e.length):e.length,a=n;a<u;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}();function bn(){var t=new f(4);return f!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function wn(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function An(t,e,i){i*=.5;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t}function Sn(t,e){var i=2*Math.acos(e[3]),n=Math.sin(i/2);return n>_?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),i}function Bn(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=i[0],u=i[1],l=i[2],h=i[3];return t[0]=n*h+o*a+r*l-s*u,t[1]=r*h+o*u+s*a-n*l,t[2]=s*h+o*l+n*u-r*a,t[3]=o*h-n*a-r*u-s*l,t}function Cn(t,e,i){i*=.5;var n=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(i),u=Math.cos(i);return t[0]=n*u+o*a,t[1]=r*u+s*a,t[2]=s*u-r*a,t[3]=o*u-n*a,t}function Vn(t,e,i){i*=.5;var n=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(i),u=Math.cos(i);return t[0]=n*u-s*a,t[1]=r*u+o*a,t[2]=s*u+n*a,t[3]=o*u-r*a,t}function Mn(t,e,i){i*=.5;var n=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(i),u=Math.cos(i);return t[0]=n*u+r*a,t[1]=r*u-n*a,t[2]=s*u+o*a,t[3]=o*u-s*a,t}function kn(t,e){var i=e[0],n=e[1],r=e[2];return t[0]=i,t[1]=n,t[2]=r,t[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r)),t}function Pn(t,e,i,n){var r=e[0],s=e[1],o=e[2],a=e[3],u=i[0],l=i[1],h=i[2],c=i[3],m=void 0,f=void 0,d=void 0,p=void 0,v=void 0;return(f=r*u+s*l+o*h+a*c)<0&&(f=-f,u=-u,l=-l,h=-h,c=-c),1-f>_?(m=Math.acos(f),d=Math.sin(m),p=Math.sin((1-n)*m)/d,v=Math.sin(n*m)/d):(p=1-n,v=n),t[0]=p*r+v*u,t[1]=p*s+v*l,t[2]=p*o+v*h,t[3]=p*a+v*c,t}function In(t){var e=d(),i=d(),n=d(),r=Math.sqrt(1-e),s=Math.sqrt(e);return t[0]=r*Math.sin(2*Math.PI*i),t[1]=r*Math.cos(2*Math.PI*i),t[2]=s*Math.sin(2*Math.PI*n),t[3]=s*Math.cos(2*Math.PI*n),t}function Tn(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i*i+n*n+r*r+s*s,a=o?1/o:0;return t[0]=-i*a,t[1]=-n*a,t[2]=-r*a,t[3]=s*a,t}function Dn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Gn(t,e){var i=e[0]+e[4]+e[8],n=void 0;if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var s=(r+1)%3,o=(r+2)%3;n=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*o+o]+1),t[r]=.5*n,n=.5/n,t[3]=(e[3*s+o]-e[3*o+s])*n,t[s]=(e[3*s+r]+e[3*r+s])*n,t[o]=(e[3*o+r]+e[3*r+o])*n}return t}function Rn(t,e,i,n){var r=.5*Math.PI/180;e*=r,i*=r,n*=r;var s=Math.sin(e),o=Math.cos(e),a=Math.sin(i),u=Math.cos(i),l=Math.sin(n),h=Math.cos(n);return t[0]=s*u*h-o*a*l,t[1]=o*a*h+s*u*l,t[2]=o*u*l-s*a*h,t[3]=o*u*h+s*a*l,t}function En(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Fn=Ei,Ln=Fi,jn=Li,On=ji,Nn=Oi,qn=Bn,zn=Zi,Un=sn,Jn=on,Xn=$i,Yn=Xn,Wn=tn,Zn=Wn,Hn=rn,Qn=cn,Kn=mn,$n=function(){var t=qe(),e=Je(1,0,0),i=Je(0,1,0);return function(n,r,s){var o=ci(r,s);return o<-.999999?(mi(t,e,r),Ti(t)<1e-6&&mi(t,i,r),hi(t,t),An(n,t,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(mi(t,r,s),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+o,Hn(n,n))}}(),tr=function(){var t=bn(),e=bn();return function(i,n,r,s,o,a){return Pn(t,n,o,a),Pn(e,r,s,a),Pn(i,t,e,2*a*(1-a)),i}}(),er=function(){var t=vt();return function(e,i,n,r){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],Hn(e,Gn(e,t))}}();function ir(){var t=new f(8);return f!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function nr(t){var e=new f(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function rr(t,e,i,n,r,s,o,a){var u=new f(8);return u[0]=t,u[1]=e,u[2]=i,u[3]=n,u[4]=r,u[5]=s,u[6]=o,u[7]=a,u}function sr(t,e,i,n,r,s,o){var a=new f(8);a[0]=t,a[1]=e,a[2]=i,a[3]=n;var u=.5*r,l=.5*s,h=.5*o;return a[4]=u*n+l*i-h*e,a[5]=l*n+h*t-u*i,a[6]=h*n+u*e-l*t,a[7]=-u*t-l*e-h*i,a}function or(t,e,i){var n=.5*i[0],r=.5*i[1],s=.5*i[2],o=e[0],a=e[1],u=e[2],l=e[3];return t[0]=o,t[1]=a,t[2]=u,t[3]=l,t[4]=n*l+r*u-s*a,t[5]=r*l+s*o-n*u,t[6]=s*l+n*a-r*o,t[7]=-n*o-r*a-s*u,t}function ar(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t}function ur(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function lr(t,e){var i=bn();we(i,e);var n=new f(3);return xe(n,e),or(t,i,n),t}function hr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function cr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function mr(t,e,i,n,r,s,o,a,u){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=s,t[5]=o,t[6]=a,t[7]=u,t}var _r=jn;function fr(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var dr=jn;function pr(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function vr(t,e){var i=e[4],n=e[5],r=e[6],s=e[7],o=-e[0],a=-e[1],u=-e[2],l=e[3];return t[0]=2*(i*l+s*o+n*u-r*a),t[1]=2*(n*l+s*a+r*o-i*u),t[2]=2*(r*l+s*u+i*a-n*o),t}function yr(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=.5*i[0],u=.5*i[1],l=.5*i[2],h=e[4],c=e[5],m=e[6],_=e[7];return t[0]=n,t[1]=r,t[2]=s,t[3]=o,t[4]=o*a+r*l-s*u+h,t[5]=o*u+s*a-n*l+c,t[6]=o*l+n*u-r*a+m,t[7]=-n*a-r*u-s*l+_,t}function gr(t,e,i){var n=-e[0],r=-e[1],s=-e[2],o=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=a*o+h*n+u*s-l*r,m=u*o+h*r+l*n-a*s,_=l*o+h*s+a*r-u*n,f=h*o-a*n-u*r-l*s;return Cn(t,e,i),n=t[0],r=t[1],s=t[2],o=t[3],t[4]=c*o+f*n+m*s-_*r,t[5]=m*o+f*r+_*n-c*s,t[6]=_*o+f*s+c*r-m*n,t[7]=f*o-c*n-m*r-_*s,t}function xr(t,e,i){var n=-e[0],r=-e[1],s=-e[2],o=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=a*o+h*n+u*s-l*r,m=u*o+h*r+l*n-a*s,_=l*o+h*s+a*r-u*n,f=h*o-a*n-u*r-l*s;return Vn(t,e,i),n=t[0],r=t[1],s=t[2],o=t[3],t[4]=c*o+f*n+m*s-_*r,t[5]=m*o+f*r+_*n-c*s,t[6]=_*o+f*s+c*r-m*n,t[7]=f*o-c*n-m*r-_*s,t}function br(t,e,i){var n=-e[0],r=-e[1],s=-e[2],o=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=a*o+h*n+u*s-l*r,m=u*o+h*r+l*n-a*s,_=l*o+h*s+a*r-u*n,f=h*o-a*n-u*r-l*s;return Mn(t,e,i),n=t[0],r=t[1],s=t[2],o=t[3],t[4]=c*o+f*n+m*s-_*r,t[5]=m*o+f*r+_*n-c*s,t[6]=_*o+f*s+c*r-m*n,t[7]=f*o-c*n-m*r-_*s,t}function wr(t,e,i){var n=i[0],r=i[1],s=i[2],o=i[3],a=e[0],u=e[1],l=e[2],h=e[3];return t[0]=a*o+h*n+u*s-l*r,t[1]=u*o+h*r+l*n-a*s,t[2]=l*o+h*s+a*r-u*n,t[3]=h*o-a*n-u*r-l*s,a=e[4],u=e[5],l=e[6],h=e[7],t[4]=a*o+h*n+u*s-l*r,t[5]=u*o+h*r+l*n-a*s,t[6]=l*o+h*s+a*r-u*n,t[7]=h*o-a*n-u*r-l*s,t}function Ar(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=i[0],u=i[1],l=i[2],h=i[3];return t[0]=n*h+o*a+r*l-s*u,t[1]=r*h+o*u+s*a-n*l,t[2]=s*h+o*l+n*u-r*a,t[3]=o*h-n*a-r*u-s*l,a=i[4],u=i[5],l=i[6],h=i[7],t[4]=n*h+o*a+r*l-s*u,t[5]=r*h+o*u+s*a-n*l,t[6]=s*h+o*l+n*u-r*a,t[7]=o*h-n*a-r*u-s*l,t}function Sr(t,e,i,n){if(Math.abs(n)<_)return hr(t,e);var r=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);n*=.5;var s=Math.sin(n),o=s*i[0]/r,a=s*i[1]/r,u=s*i[2]/r,l=Math.cos(n),h=e[0],c=e[1],m=e[2],f=e[3];t[0]=h*l+f*o+c*u-m*a,t[1]=c*l+f*a+m*o-h*u,t[2]=m*l+f*u+h*a-c*o,t[3]=f*l-h*o-c*a-m*u;var d=e[4],p=e[5],v=e[6],y=e[7];return t[4]=d*l+y*o+p*u-v*a,t[5]=p*l+y*a+v*o-d*u,t[6]=v*l+y*u+d*a-p*o,t[7]=y*l-d*o-p*a-v*u,t}function Br(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t}function Cr(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=i[4],u=i[5],l=i[6],h=i[7],c=e[4],m=e[5],_=e[6],f=e[7],d=i[0],p=i[1],v=i[2],y=i[3];return t[0]=n*y+o*d+r*v-s*p,t[1]=r*y+o*p+s*d-n*v,t[2]=s*y+o*v+n*p-r*d,t[3]=o*y-n*d-r*p-s*v,t[4]=n*h+o*a+r*l-s*u+c*y+f*d+m*v-_*p,t[5]=r*h+o*u+s*a-n*l+m*y+f*p+_*d-c*v,t[6]=s*h+o*l+n*u-r*a+_*y+f*v+c*p-m*d,t[7]=o*h-n*a-r*u-s*l+f*y-c*d-m*p-_*v,t}var Vr=Cr;function Mr(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t}var kr=Un;function Pr(t,e,i,n){var r=1-n;return kr(e,i)<0&&(n=-n),t[0]=e[0]*r+i[0]*n,t[1]=e[1]*r+i[1]*n,t[2]=e[2]*r+i[2]*n,t[3]=e[3]*r+i[3]*n,t[4]=e[4]*r+i[4]*n,t[5]=e[5]*r+i[5]*n,t[6]=e[6]*r+i[6]*n,t[7]=e[7]*r+i[7]*n,t}function Ir(t,e){var i=Rr(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t}function Tr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var Dr=Xn,Gr=Dr,Rr=Wn,Er=Rr;function Fr(t,e){var i=Rr(e);if(i>0){i=Math.sqrt(i);var n=e[0]/i,r=e[1]/i,s=e[2]/i,o=e[3]/i,a=e[4],u=e[5],l=e[6],h=e[7],c=n*a+r*u+s*l+o*h;t[0]=n,t[1]=r,t[2]=s,t[3]=o,t[4]=(a-n*c)/i,t[5]=(u-r*c)/i,t[6]=(l-s*c)/i,t[7]=(h-o*c)/i}return t}function Lr(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function jr(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function Or(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],u=t[6],l=t[7],h=e[0],c=e[1],m=e[2],f=e[3],d=e[4],p=e[5],v=e[6],y=e[7];return Math.abs(i-h)<=_*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-c)<=_*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-m)<=_*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(s-f)<=_*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(o-d)<=_*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-p)<=_*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(u-v)<=_*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(l-y)<=_*Math.max(1,Math.abs(l),Math.abs(y))}function Nr(){var t=new f(2);return f!=Float32Array&&(t[0]=0,t[1]=0),t}function qr(t){var e=new f(2);return e[0]=t[0],e[1]=t[1],e}function zr(t,e){var i=new f(2);return i[0]=t,i[1]=e,i}function Ur(t,e){return t[0]=e[0],t[1]=e[1],t}function Jr(t,e,i){return t[0]=e,t[1]=i,t}function Xr(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Yr(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function Wr(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function Zr(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function Hr(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Qr(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Kr(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function $r(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function ts(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function es(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function is(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t}function ns(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)}function rs(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n}function ss(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function os(t){var e=t[0],i=t[1];return e*e+i*i}function as(t,e){return t[0]=-e[0],t[1]=-e[1],t}function us(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function ls(t,e){var i=e[0],n=e[1],r=i*i+n*n;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t}function hs(t,e){return t[0]*e[0]+t[1]*e[1]}function cs(t,e,i){var n=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=n,t}function ms(t,e,i,n){var r=e[0],s=e[1];return t[0]=r+n*(i[0]-r),t[1]=s+n*(i[1]-s),t}function _s(t,e){e=e||1;var i=2*d()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function fs(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r,t[1]=i[1]*n+i[3]*r,t}function ds(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r+i[4],t[1]=i[1]*n+i[3]*r+i[5],t}function ps(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[3]*r+i[6],t[1]=i[1]*n+i[4]*r+i[7],t}function vs(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t}function ys(t,e,i,n){var r=e[0]-i[0],s=e[1]-i[1],o=Math.sin(n),a=Math.cos(n);return t[0]=r*a-s*o+i[0],t[1]=r*o+s*a+i[1],t}function gs(t,e){var i=t[0],n=t[1],r=e[0],s=e[1],o=i*i+n*n;o>0&&(o=1/Math.sqrt(o));var a=r*r+s*s;a>0&&(a=1/Math.sqrt(a));var u=(i*r+n*s)*o*a;return u>1?0:u<-1?Math.PI:Math.acos(u)}function xs(t){return"vec2("+t[0]+", "+t[1]+")"}function bs(t,e){return t[0]===e[0]&&t[1]===e[1]}function ws(t,e){var i=t[0],n=t[1],r=e[0],s=e[1];return Math.abs(i-r)<=_*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(n-s)<=_*Math.max(1,Math.abs(n),Math.abs(s))}var As=ss,Ss=Yr,Bs=Wr,Cs=Zr,Vs=ns,Ms=rs,ks=os,Ps=function(){var t=Nr();return function(e,i,n,r,s,o){var a=void 0,u=void 0;for(i||(i=2),n||(n=0),u=r?Math.min(r*i+n,e.length):e.length,a=n;a<u;a+=i)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}}()}]]);
//# sourceMappingURL=2.88f4dc3b.chunk.js.map